/* 고객 테이블 생성 */
CREATE TABLE CUSTOMER
(
	CUSTOMER_UID NUMBER(6) NOT NULL,
	CUSTOMER_ID VARCHAR2(20),
	CUSTOMER_PASSWORD VARCHAR2(20),
	CUSTOMER_NAME VARCHAR2(20),
	CUSTOMER_TEL VARCHAR2(20),
	CUSTOMER_SEX VARCHAR2(20),
	CUSTOMER_CARNUM VARCHAR2(20),
	CONSTRAINT CUSTOMER_CUSTOMER_UID_PK PRIMARY KEY(CUSTOMER_UID)
);

DROP TABLE CUSTOMER
SELECT * FROM CUSTOMER;

--SEQUENCE 삭제
DROP SEQUENCE CUSTOMER_NUM_SEQ
--SEQUENCE 생성
CREATE SEQUENCE CUSTOMER_NUM_SEQ
START WITH 1
INCREMENT BY 1
NOCACHE
NOCYCLE;
--SEQUENCE 증가
INSERT INTO CUSTOMER VALUES(CUSTOMER_NUM_SEQ.NEXTVAL, '1','1','1','1','1','1');

--컬럼 추가
ALTER TABLE CUSTOMER ADD CUSTOMER_TEL VARCHAR2(20);
ALTER TABLE CUSTOMER ADD CUSTOMER_CARNUM VARCHAR2(20);
--컬럼 삭제
ALTER TABLE CUSTOMER DROP COLUMN CUSTOMER_TEL;


/*시간당 요금 테이블 생성*/
CREATE TABLE HOURCHARGE
(
    COMPANY_UID NUMBER(5) NOT NULL,
	TYPE VARCHAR2(60),
	PRICE NUMBER(30),
	CONSTRAINT HOURCHARGE_COMPANY_UID_PK PRIMARY KEY(COMPANY_UID)
);

--시간당 요금 정보 삽임 / 시간당 요금 계산은 JAVA에서 처리하도록 한다.
--역삼역
INSERT INTO HOURCHARGE VALUES(1, '시간당이용요금', 5000);

--강남역
INSERT INTO HOURCHARGE VALUES(2, '시간당이용요금', 6000);

--교대역
INSERT INTO HOURCHARGE VALUES(3, '시간당이용요금', 7000);

DROP TABLE HOURCHARGE
SELECT * FROM HOURCHARGE

/* 주차장 테이블 생성 */
CREATE TABLE PARKING
(
	PARKING_UID NUMBER(6) NOT NULL,
	TOTAL_SEAT_NUMBER NUMBER(10),
	PARKING_BRANDNAME VARCHAR2(40),
	PARKING_LOCATION VARCHAR2(100),
	PARKING_HOUROFUSE_WEEKDAYS VARCHAR2(100),
	PARKING_HOUROFUSE_WEEKEND VARCHAR2(100),
	PARKING_TEL VARCHAR2(40),
	PARKING_MANAGER VARCHAR2(40),
	PARKING_MANAGER_PHONE VARCHAR2(40),
	CONSTRAINT PARKING_PARKING_UID_PK PRIMARY KEY(PARKING_UID)
);

UPDATE PARKING SET TOTAL_SEAT_NUMBER = 90 WHERE PARKING_UID = 1

INSERT INTO PARKING VALUES(1, 90, '역삼점 주차장', '서울 강남구 테헤란로7길 32 국기원', '주중 00:00 ~ 24:00', '주말 00:00 ~ 24:00','1544-3113', '최태원', '010-4059-2342');
INSERT INTO PARKING VALUES(2, 90, '강남점 주차장', '서울 강남구 강남대로 432 점프밀라노', '주중 00:00 ~ 24:00', '주말 00:00 ~ 24:00','02-6440-5133', '김상회', '010-2239-9342');
INSERT INTO PARKING VALUES(3, 90, '교대점 주차장', '서울 서초구 서초대로 301 동익성봉빌딩', '주중 00:00 ~ 24:00', '주말 00:00 ~ 24:00','1544-3113', '하민지', '010-7211-9910');

SELECT TOTAL_SEAT_NUMBER, PARKING_BRANDNAME, PARKING_LOCATION, PARKING_HOUROFUSE_WEEKDAYS,PARKING_HOUROFUSE_WEEKEND, PARKING_TEL, PARKING_MANAGER, PARKING_MANAGER_PHONE FROM PARKING WHERE PARKING_UID = 1;
						
DROP TABLE PARKING
SELECT * FROM PARKING

/* 주차공간 테이블 생성 */
CREATE TABLE SEAT 
(
	PARKING_UID NUMBER(6) NOT NULL,
	SEAT_UID VARCHAR2(10) NOT NULL,
	ISSUE NUMBER(6) DEFAULT 0,
	CONSTRAINT SEAT_PK PRIMARY KEY(SEAT_UID, PARKING_UID),
	CONSTRAINT SEAT_PARKING_UID_FK FOREIGN KEY(PARKING_UID) REFERENCES PARKING(PARKING_UID)
);

--주차 공간 삽입은 JAVA에서 사용자가 하도록한다.

DROP TABLE SEAT
SELECT * FROM SEAT

--테이블의 해당되는 조건의 행을 삭제한다.
DELETE FROM SEAT WHERE SEAT_UID = 'A5' AND PARKING_UID = 1;
DELETE FROM SEAT WHERE SEAT_UID = 'A15' AND PARKING_UID = 1;

/*주차장 공휴일 테이블 생성*/
CREATE TABLE SCHEDULE
(
	SCHEDULE_UID NUMBER(6) NOT NULL,
	SCHEDULE_DATE DATE,
	PARKING_UID NUMBER(6),
	CONSTRAINT SCHEDULE_SCHEDULE_UID_PK PRIMARY KEY(SCHEDULE_UID),
	CONSTRAINT SCHEDYLE_PARKING_UID_FK FOREIGN KEY(PARKING_UID) REFERENCES PARKING(PARKING_UID)
);

--공휴일(정보) 삽입

SELECT SCHEDULE_DATE FROM SCHEDULE WHERE SCHEDULE_UID = 1; 

--역삼점
INSERT INTO SCHEDULE VALUES(1, TO_DATE(20171106, 'YYYY-MM-DD'),1);

--강남점
INSERT INTO SCHEDULE VALUES(2, TO_DATE(20171216, 'YYYY-MM-DD'),2);

--교대점
INSERT INTO SCHEDULE VALUES(3, TO_DATE(20170906, 'YYYY-MM-DD'),3);

DROP TABLE SCHEDULE
SELECT * FROM SCHEDULE

/*주차 티켓 테이블 생성*/
CREATE TABLE TICKET
(
	TICKET_UID NUMBER(6) NOT NULL,
	SCHEDULE_UID NUMBER(4),
	PARKING_UID NUMBER(6),
	SEAT_ID VARCHAR2(20),
	COMPANY_UID NUMBER(30),
	TICKET_ID VARCHAR2(20),
	CONSTRAINT TICKET_TICKET_UID_PK PRIMARY KEY(TICKET_UID),
	CONSTRAINT TICKET_COMPANY_UID_FK FOREIGN KEY(COMPANY_UID) REFERENCES HOURCHARGE(COMPANY_UID),
	CONSTRAINT TICKET_PARKING_UID_FK FOREIGN KEY(PARKING_UID) REFERENCES PARKING(PARKING_UID),
	CONSTRAINT TICKET_SCHEDULE_UID_FK FOREIGN KEY(SCHEDULE_UID) REFERENCES SCHEDULE(SCHEDULE_UID)
);

SELECT * FROM TICKET
DROP TABLE TICKET

CREATE SEQUENCE TICKET_NUM_SEQ
START WITH 1
INCREMENT BY 1
NOCACHE
NOCYCLE;

INSERT INTO TICKET VALUES(TICKET_NUM_SEQ.NEXTVAL,1,1,'A1', 1)
DROP SEQUENCE TICKET_NUM_SEQ

/*결제 테이블 생성*/
CREATE TABLE PAYMENT
(
	PAYMENT_UID NUMBER(6) NOT NULL,
	TOTAL_PRICE NUMBER(6),
	PAYMENT_OPTION VARCHAR2(20),
	PAYMENT_DATE VARCHAR2(50),
	PAYMENT_SPACENAME VARCHAR2(50),
	PAYMENT_SPACECODE VARCHAR2(50),
	PAYMENT_ID VARCHAR2(50),
	CONSTRAINT PAYMENT_PAYMENT_UID_PK PRIMARY KEY(PAYMENT_UID)
);

DROP TABLE PAYMENT
SELECT * FROM PAYMENT

DROP SEQUENCE PAYMENT_NUM_SEQ;
CREATE SEQUENCE PAYMENT_NUM_SEQ
START WITH 1
INCREMENT BY 1
NOCACHE
NOCYCLE;

INSERT INTO PAYMENT VALUES (PAYMENT_NUM_SEQ.NEXTVAL,1,'현금',TO_DATE(20171106, 'YYYY-MM-DD'));

SELECT PAYMENT_UID, PAYMENT_OPTION, TOTAL_PRICE, PAYMENT_DATE, PAYMENT_SPACENAME, PAYMENT_SPACECODE FROM PAYMENT WHERE PAYMENT_ID = 'SITDITRD' ORDER BY PAYMENT_UID
