<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
    PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="ticket">
	<select id="count" parameterType="java.util.Map" resultType="int">
		select count(*) from route where route_depart_day = #{startDate} and route_depart_region = #{depart_region} and route_arrive_region = #{arrive_region}
		<choose>
			<when test="airline_name != 'all'">
				and airline_name = #{airline_name}
			</when>
		</choose>
	</select>
	
	<select id="list" parameterType="dto.TicketPageDTO" resultType="dto.TicketDTO"> 
		 select b.* from
	     (select rownum as rm, a.* from(
	     select * from route 
	     where route_depart_day = #{startDate} and route_depart_region = #{depart_region} and route_arrive_region = #{arrive_region} 
	    
	    <choose>
			<when test="airline_name != 'all'">
				and airline_name = #{airline_name}
			</when>
		</choose>
	    
	     order by 
	     
	    <choose>
	  		<!-- 항공사 8개 필터링이 되지 않은 경우 -->
	   		<when test="airline_name == 'all' and searchKey =='all'">
				route_code asc)a)b
			</when>
			
	    	<when test="airline_name == 'all' and searchKey =='전체보기'">
				route_code asc)a)b
			</when>
			
			<when test="airline_name == 'all' and searchKey =='최저가'">
				route_charge asc)a)b
			</when>
			
			<when test="airline_name == 'all' and searchKey =='최고가'">
				route_charge desc)a)b
			</when>
			
			<when test="airline_name == 'all' and searchKey =='최단시간'">
				route_estimate_time asc)a)b
			</when>
			
			<when test="airline_name == 'all' and searchKey =='최장시간'">
				route_estimate_time desc)a)b
			</when>
			
			<when test="airline_name == 'all' and searchKey =='빠른 출발순'">
				depart_time asc)a)b
			</when>
			
			<when test="airline_name == 'all' and searchKey =='늦은 출발순'">
				depart_time desc)a)b
			</when>
			
			<when test="airline_name == 'all' and searchKey =='빠른 도착순'">
				arrive_time asc)a)b
			</when>
			
			<when test="airline_name == 'all' and searchKey =='늦은 도착순'">
				arrive_time desc)a)b
			</when>
			
			<!-- 항공사 8개 필터링이 된 경우-->
			<when test="airline_name != 'all' and searchKey =='all'">
				route_code asc)a)b
			</when>
			
	    	<when test="airline_name != 'all' and searchKey =='전체보기'">
				route_code asc)a)b
			</when>
			
			<when test="airline_name != 'all' and searchKey =='최저가'">
				route_charge asc)a)b
			</when>
			
			<when test="airline_name != 'all' and searchKey =='최고가'">
				route_charge desc)a)b
			</when>
			
			<when test="airline_name != 'all' and searchKey =='최단시간'">
				route_estimate_time asc)a)b
			</when>
			
			<when test="airline_name != 'all' and searchKey =='최장시간'">
				route_estimate_time desc)a)b
			</when>
			
			<when test="airline_name != 'all' and searchKey =='빠른 출발순'">
				depart_time asc)a)b
			</when>
			
			<when test="airline_name != 'all' and searchKey =='늦은 출발순'">
				depart_time desc)a)b
			</when>
			
			<when test="airline_name != 'all' and searchKey =='빠른 도착순'">
				arrive_time asc)a)b
			</when>
			
			<when test="airline_name != 'all' and searchKey =='늦은 도착순'">
				arrive_time desc)a)b
			</when>
		</choose>
		
	    <![CDATA[
	     where b.rm >= #{startRow} and b.rm <= #{endRow}
		]]>
	</select>
</mapper>
