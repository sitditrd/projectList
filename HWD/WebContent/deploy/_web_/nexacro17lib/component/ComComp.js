if(!nexacro.NormalDataset){nexacro.NormalDataset=function(id,parent){nexacro.Dataset.call(this,id,parent);this.url="";this.arguments="";this.serverdatasetid="";this.firefirstcount=0;this.firenextcount=0;this.progressload=false;this.preload=false;this._is_preloaded=false;};var _pNormalDataset=nexacro._createPrototype(nexacro.Dataset,nexacro.NormalDataset);nexacro.NormalDataset.prototype=_pNormalDataset;nexacro.NormalDataset.ROWTYPE_EMPTY=0;nexacro.NormalDataset.ROWTYPE_NORMAL=1;nexacro.NormalDataset.ROWTYPE_INSERT=2;nexacro.NormalDataset.ROWTYPE_UPDATE=4;nexacro.NormalDataset.ROWTYPE_DELETE=8;nexacro.NormalDataset.ROWTYPE_GROUP=16;nexacro.NormalDataset.REASON_LOAD=0;nexacro.NormalDataset.REASON_LOADPROCESS=1;nexacro.NormalDataset.REASON_RESET=2;nexacro.NormalDataset.REASON_LOADCONTENT=3;nexacro.NormalDataset.REASON_ASSIGN=10;nexacro.NormalDataset.REASON_COPY=11;nexacro.NormalDataset.REASON_APPEND=12;nexacro.NormalDataset.REASON_MERGE=13;nexacro.NormalDataset.REASON_DELETE=20;nexacro.NormalDataset.REASON_DELETEALL=22;nexacro.NormalDataset.REASON_CLEARDATA=23;nexacro.NormalDataset.REASON_CLEAR=24;nexacro.NormalDataset.REASON_SORTGROUP=30;nexacro.NormalDataset.REASON_FILTER=31;nexacro.NormalDataset.REASON_MOVE=32;nexacro.NormalDataset.REASON_EXCHANGE=33;nexacro.NormalDataset.REASON_CHANGELAYOUT=34;nexacro.NormalDataset.REASON_CHANGESTATUS=40;nexacro.NormalDataset.REASON_ENABLEEVENT=41;nexacro.NormalDataset.REASON_ROWCHANGE=51;nexacro.NormalDataset.REASON_ROWINDEXCHANGE=52;nexacro.NormalDataset.REASON_ROWOBJECTCHANGE=53;nexacro.NormalDataset.REASON_BINDSOURCE=90;_pNormalDataset.on_created=function(){if(this.url==""||this.preload==false){if(this.colcount>0){this._endLoad(0,"SUCCESS",3);}}if(!nexacro.isDesignMode&&this.preload&&!this._is_preloaded){if(this.url&&this.parent){var keys=[];keys.push("__preload");keys.push(this.url);keys.push(this.id);keys.push(this.serverdatasetid);var svcid=keys.join('_');var url=nexacro._getServiceLocation(this.url);var loadmanager=this.parent._load_manager;if(loadmanager){var data=loadmanager.getPreloadDataModule(this.id);if(data){var serverdatasetid=this.serverdatasetid;if(!serverdatasetid){serverdatasetid="output";}var outds=this.id+"="+serverdatasetid;var tritem=new nexacro.TransactionItem(url,this.parent,svcid,"",outds,"",0,true);tritem._usewaitcursor=false;tritem._loadFromData(data);this._is_preloaded=true;}}}}this._defaultKeyStr=this.keystring;this._defaultFilterStr=this.filterstr;};_pNormalDataset.destroy=function(){nexacro.Dataset.prototype.destroy.call(this);this._refform=null;};_pNormalDataset.set_url=function(v){this.url=v;};_pNormalDataset.set_arguments=function(v){this.arguments=v;};_pNormalDataset.set_firefirstcount=function(v){v=parseInt(v)|0;if(isFinite(v)){this.firefirstcount=v;}};_pNormalDataset.set_firenextcount=function(v){v=parseInt(v)|0;if(isFinite(v)){this.firenextcount=v;}};_pNormalDataset.set_progressload=function(v){this.progressload=nexacro._toBoolean(v);};_pNormalDataset.set_preload=function(v){this.preload=nexacro._toBoolean(v);};_pNormalDataset.set_serverdatasetid=function(v){this.serverdatasetid=v;};_pNormalDataset.load=function(async,datatype){var baseurl;if(this._refform){baseurl=this._refform._getRefFormBaseUrl();}var url=nexacro._getServiceLocation(this.url,baseurl);if(url.length&&this.parent){var svcid="__normaldataset_loadurl_"+this.id;var loadmanager=this.parent._load_manager;if(loadmanager){var serverdatasetid=this.serverdatasetid;if(!serverdatasetid){serverdatasetid="output";}var outds=this.id+"="+serverdatasetid;var service=nexacro._getServiceObject(this.url,true);loadmanager.loadDataModule(url,svcid,"",outds,this.arguments,null,async,datatype,false,service);}}else{this._endLoad( -1,"empty url",3);}};_pNormalDataset.append=function(url){this._append(url,true,0);};_pNormalDataset._append=function(svcurl,async,datatype){var baseurl;if(this._refform){baseurl=this._refform._getRefFormBaseUrl();}var serviceurl=svcurl?svcurl:this.url;if(!serviceurl){this._endLoad( -1,"empty url",0);return;}var url=nexacro._getServiceLocation(serviceurl,baseurl);if(url&&url.length&&this.parent){var svcid="__normaldataset_appendurl_"+this.id;var loadmanager=this.parent._load_manager;if(loadmanager){var serverdatasetid=this.serverdatasetid;if(!serverdatasetid){serverdatasetid="output";}var outds=this.id+"="+serverdatasetid+":P";var service=nexacro._getServiceObject(url,true);loadmanager.loadDataModule(url,svcid,"",outds,this.arguments,null,async,datatype,false,service);}}else{this._endLoad( -1,"empty url",0);}};_pNormalDataset.on_preload_data=function(url,errstatus,data,fireerrorcode,returncode,requesturi,locationuri,extramsg){if(errstatus!=0){nexacro._onHttpSystemError(this,true,this,fireerrorcode,url,returncode,requesturi,locationuri,extramsg);}else if(data&&!this._is_preloaded){var keys=[];keys.push("__preload");keys.push(this.url);keys.push(this.id);keys.push(this.serverdatasetid);var svcid=keys.join('_');var serverdatasetid=this.serverdatasetid;if(!serverdatasetid){serverdatasetid="output";}var outds=this.id+"="+serverdatasetid;var tritem=new nexacro.TransactionItem(this.url,this.parent,svcid,"",outds,"",0,true);tritem._usewaitcursor=false;tritem._loadFromData(data);this._is_preloaded=true;}};delete _pNormalDataset;}
if(!nexacro.DomParser){nexacro.DomParseErrorEventInfo=function(obj,id,level,line,column,message,description){this.id=this.eventid=id||"onerror";this.fromobject=this.fromreferenceobject=obj;this.level=level;this.line=line;this.column=column;this.message=message;this.description=description;};var _pDomParseErrorEventInfo=nexacro._createPrototype(nexacro.Event,nexacro.DomParseErrorEventInfo);nexacro.DomParseErrorEventInfo.prototype=_pDomParseErrorEventInfo;_pDomParseErrorEventInfo._type_name="DomParseErrorEventInfo";delete _pDomParseErrorEventInfo;nexacro.DomParser=function(id,parent){this.id=this.name=id;this.parent=parent;};var _pDomParser=nexacro._createPrototype(nexacro._EventSinkObject,nexacro.DomParser);nexacro.DomParser.prototype=_pDomParser;_pDomParser._type_name="DomParser";_pDomParser._event_list={"onerror":1};_pDomParser.on_created=nexacro._emptyFn;_pDomParser.parseFromString=function(strText,strMineType){if(!strMineType||strMineType=="text/xml"){var xmlDoc=nexacro._parseXMLDocument(strText);if(xmlDoc){var error=nexacro._getParserError(xmlDoc);if(error){this.on_fire_onparseerror("error",error.line,error.column,error.message,error.desc);return null;}}return xmlDoc;}return null;};_pDomParser.on_fire_onparseerror=function(level,line,column,message,description){if(this.onerror&&this.onerror._has_handlers){var evt=new nexacro.DomParseErrorEventInfo(this,"onerror",level,line,column,message,description);return this.onerror._fireEvent(this,evt);}return false;};delete _pDomParser;nexacro.XmlSerializer=function(id,parent){this.id=this.name=id;this.parent=parent;};var _pXmlSerializer=nexacro._createPrototype(nexacro.Object,nexacro.XmlSerializer);nexacro.XmlSerializer.prototype=_pXmlSerializer;_pXmlSerializer.on_created=nexacro._emptyFn;_pXmlSerializer.serializeToString=function(xmldoc){return nexacro._documentToXml(xmldoc);};delete _pXmlSerializer;}
if(!nexacro._IconText){nexacro._IconText=function(id,left,top,width,height,right,bottom,minwidth,maxwidth,minheight,maxheight,parent){nexacro.Component.call(this,id,left,top,width,height,right,bottom,minwidth,maxwidth,minheight,maxheight,parent);};var _pIconText=nexacro._createPrototype(nexacro.Component,nexacro._IconText);nexacro._IconText.prototype=_pIconText;_pIconText._type_name="IconText";_pIconText._cell_elem=null;_pIconText.text="";_pIconText.icon="";_pIconText.iconPosition="";_pIconText.textPadding="";_pIconText.textwidth=undefined;_pIconText.tabstop=false;_pIconText._textpadding=null;_pIconText._is_focus_accept=false;_pIconText._is_simple_control=true;_pIconText._is_eventinfo_control=false;_pIconText._is_fiticonsize=false;_pIconText._icon_width=0;_pIconText._icon_height=0;_pIconText.accessibilityrole="Icon";_pIconText.on_create_contents=function(){var control_elem=this.getElement();if(control_elem){var cellElem=this._cell_elem=new nexacro.IconTextElement(control_elem,"icontext",this._is_fiticonsize);cellElem.setElementPosition(this._getClientLeft(),this._getClientTop());cellElem.setElementSize(control_elem.client_width,control_elem.client_height);if(this.textAlign){cellElem.setElementTextAlign(this.textAlign);}if(this.verticalAlign){cellElem.setElementVerticalAlign(this.verticalAlign);}var wordwrap_info=this._getCSSStyleValue("wordWrap");if(wordwrap_info){cellElem.setElementCSSMapInfo(wordwrap_info);}if(this.wordWrap){cellElem.setElementWordWrap(this.wordWrap);}var textPadding=this._textpadding||this._getCSSStyleValue("textPadding");if(textPadding){cellElem.setElementTextPadding(textPadding);}if(this.textwidth!=null){cellElem.setElementTextWidth(this.textwidth);}if(this._textdecoration){cellElem.setElementTextDecoration(this._textdecoration);}if(this._displaytext){cellElem.setElementText(this._displaytext);}var icon=this._icon||this._getCSSStyleValue("icon");if(icon){cellElem.setElementIcon(icon);}var icon_pos=this.iconPosition||this._getCSSStyleValue("iconPosition");cellElem.setElementIconPos(icon_pos);}};_pIconText.on_created_contents=function(win){if(this.expr){this._on_apply_expr(this.expr);}if(this.fittocontents!="none"){this._update_position();}var cellElem=this._cell_elem;if(cellElem){cellElem.create(win);}};_pIconText.on_destroy_contents=function(){var cellElem=this._cell_elem;if(cellElem){cellElem.destroy();this._cell_elem=null;}if(this._textpadding){this._textpadding=null;}if(this._icon){this._icon=null;}};_pIconText.on_create_contents_command=function(){if(this.expr){this._on_apply_expr(this.expr);}var cellElem=this._cell_elem;if(cellElem){return cellElem.createCommand();}return "";};_pIconText.on_attach_contents_handle=function(win){var cellElem=this._cell_elem;if(cellElem){cellElem.attachHandle(win);}if(this.fittocontents!="none"){this._update_position();}};_pIconText.on_change_containerRect=function(width,height){if(this._is_created_contents){var cellElem=this._cell_elem;cellElem.setElementSize(width,height);}};_pIconText.on_change_containerPos=function(left,top){if(this._is_created_contents){var cellElem=this._cell_elem;cellElem.setElementPosition(left,top);}};_pIconText.on_apply_status=function(status,userstatus){var cellElem=this._cell_elem;if(cellElem){if(!this.textPadding){cellElem.setElementTextPadding(this._getCSSStyleValue("textPadding",status,userstatus));}if(!this.icon){cellElem.setElementIcon(this._getCSSStyleValue("icon",status,userstatus));}if(!this.iconPosition){cellElem.setElementIconPos(this._getCSSStyleValue("iconPosition",status,userstatus));}var wordwrap_info=this._getCSSStyleValue("wordWrap",status,userstatus);if(wordwrap_info){cellElem.setElementCSSMapInfo(wordwrap_info);}}};_pIconText.on_get_accessibility_label=function(){return this.text;};_pIconText._on_getFitSize=function(){var control_elem=this.getElement();if(control_elem){var total_w=0;var total_h=0;var border=this._getCurrentStyleBorder();if(border){total_w+=border._getBorderWidth();total_h+=border._getBorderHeight();}var padding=this._getCurrentStylePadding();if(padding){total_w+=padding.left+padding.right;total_h+=padding.top+padding.bottom;}var text=this.text;if(text){var font=this._getCurrentStyleInheritValue("font");var wordspace=this._getCurrentStyleInheritValue("wordSpacing");var letterspace=this._getCurrentStyleInheritValue("letterSpacing");var wordwrap="none";var width;var multiline=false;if(text.search("\n")> -1){multiline=true;}if(this.fittocontents=="height"){wordwrap=this.wordWrap||this._getCSSStyleValue("wordWrap");if(wordwrap&&wordwrap!="none"){multiline=true;}width=this._adjust_width-total_w;}var text_size=nexacro._getTextSize(text,font,multiline,width,wordwrap,wordspace,letterspace);total_w+=Math.ceil(this.textwidth!=null?this.textwidth:text_size[0]);total_h+=Math.ceil(text_size[1]);}var icon=this._icon||this._getCSSStyleValue("icon");if(icon){var textpadding=this._textpadding||this._getCSSStyleValue("textPadding");var icon_pos=this.iconPosition||this._getCSSStyleValue("iconPosition");var icon_size;if(this._icon_width!=0&&this._icon_height!=0){icon_size={width:this._icon_width,height:this._icon_height};}else{icon_size=nexacro._getImageSize(icon.url,this._on_icon_onload,this,undefined,this.image)||{width:this._icon_width,height:this._icon_height};}if(icon_pos=="top"||icon_pos=="bottom"){total_h+=icon_size.height;total_w=Math.max(total_w,icon_size.width);}else{total_w+=icon_size.width;total_h=Math.max(total_h,icon_size.height);}if(textpadding){total_w+=textpadding.left+textpadding.right;total_h+=textpadding.top+textpadding.bottom;}}return [total_w,total_h];}return [this._adjust_width,this._adjust_height];};_pIconText._isFocusAcceptable=function(){return nexacro._enableaccessibility;};_pIconText.set_icon=function(v){this.icon=v;if(v){if(this._icon==null||this._icon.value!=v){var icon=nexacro.UrlObject(v,this);this._icon=icon;this.on_apply_icon(icon);}}else{if(this._icon){this._icon=null;this.on_apply_icon(null);}}this._icon_width=0;this._icon_height=0;};_pIconText.on_apply_icon=function(icon){var cellElem=this._cell_elem;if(cellElem){cellElem.setElementIcon(icon||this._getCSSStyleValue("icon",this._status,this._userstatus));}};_pIconText.set_iconPosition=function(v){if(this.iconPosition!=v){this.iconPosition=v;this.on_apply_iconPosition(v);}};_pIconText.on_apply_iconPosition=function(iconpos){var cellElem=this._cell_elem;if(cellElem){cellElem.setElementIconPos(iconpos||this._getCSSStyleValue("iconPosition",this._status,this._userstatus));}};_pIconText.set_textPadding=function(v){this.textPadding=v;if(v){if(this._textpadding==null||this._textpadding.value!=v){var textPadding=nexacro.PaddingObject(v);this._textpadding=textPadding;this.on_apply_textPadding(textPadding);}}else{if(this._textpadding){this._textpadding=null;this.on_apply_textPadding(null);}}};_pIconText.on_apply_textPadding=function(textPadding){var cellElem=this._cell_elem;if(cellElem){cellElem.setElementTextPadding(textPadding||this._getCSSStyleValue("textPadding",this._status,this._userstatus));}};_pIconText.set_textwidth=function(v){if(v!==undefined){if(isNaN(v= +v)){return;}}if(this.textwidth!=v){this.textwidth=v;this.on_apply_textwidth(v);}};_pIconText.on_apply_textwidth=function(textwidth){var cellElem=this._cell_elem;if(cellElem){cellElem.setElementTextWidth(textwidth);}};_pIconText.on_apply_text=function(text){var cellElem=this._cell_elem;if(cellElem){cellElem.setElementText(text);}if(nexacro._enableaccessibility){this._setAccessibilityLabel(this._getAccessibilityLabel());}};_pIconText.on_apply_textAlign=function(halign){var cellElem=this._cell_elem;if(cellElem){cellElem.setElementTextAlign(halign);}};_pIconText.on_apply_verticalAlign=function(valign){var cellElem=this._cell_elem;if(cellElem){cellElem.setElementVerticalAlign(valign);}};_pIconText.on_apply_wordWrap=function(wordwrap){if(!this._isEnableRedraw()){return;}var cellElem=this._cell_elem;if(cellElem){cellElem.setElementWordWrap(wordwrap);if(this.fittocontents!="none"){this._update_position();}}};_pIconText.on_apply_textDecoration=function(textDecoration){if(!this._isEnableRedraw()){return;}var cellElem=this._cell_elem;if(cellElem){cellElem.setElementTextDecoration(textDecoration);}};_pIconText._on_icon_onload=function(url,width,height){if(this.fittocontents!=="none"&&(this._icon_width!=width||this._icon_height!=height)){this._icon_width=width;this._icon_height=height;this._update_position();}};_pIconText._getCurrentIcon=function(){var cellElem=this._cell_elem;if(cellElem){return cellElem.icon;}return null;};delete _pIconText;}if(!nexacro._Icon){nexacro._Icon=function(id,left,top,width,height,right,bottom,minwidth,maxwidth,minheight,maxheight,parent){nexacro.Component.call(this,id,left,top,width,height,right,bottom,minwidth,maxwidth,minheight,maxheight,parent);};var _pIcon=nexacro._createPrototype(nexacro.Component,nexacro._Icon);nexacro._Icon.prototype=_pIcon;_pIcon._type_name="Icon";_pIcon._cell_elem=null;_pIcon.icon="";_pIcon.padding="";_pIcon.textAlign="";_pIcon.verticalAlign="";_pIcon.tabstop=false;_pIcon._icon=null;_pIcon._is_focus_accept=false;_pIcon._is_simple_control=true;_pIcon._is_eventinfo_control=false;_pIcon._is_fiticonsize=false;_pIcon.accessibilityrole="Icon";_pIcon.on_create_contents=function(){var control_elem=this.getElement();if(control_elem){var cellElem=new nexacro.IconElement(control_elem,"icon",this._is_fiticonsize);this._cell_elem=cellElem;cellElem.setElementPosition(this._getClientLeft(),this._getClientTop());cellElem.setElementSize(control_elem.client_width,control_elem.client_height);if(this.textAlign){cellElem.setElementTextAlign(this.textAlign);}if(this.verticalAlign){cellElem.setElementVerticalAlign(this.verticalAlign);}var icon=this._icon||this._getCSSStyleValue("icon");if(icon){cellElem.setElementIcon(icon);}}};_pIcon.on_created_contents=function(win){if(this.fittocontents!="none"){this._update_position();}var cellElem=this._cell_elem;if(cellElem){cellElem.create(win);}};_pIcon.on_destroy_contents=function(){var cellElem=this._cell_elem;if(cellElem){cellElem.destroy();this._cell_elem=null;}if(this._icon){this._icon=null;}};_pIcon.on_create_contents_command=function(){var cellElem=this._cell_elem;if(cellElem){return cellElem.createCommand();}return "";};_pIcon.on_attach_contents_handle=function(win){var cellElem=this._cell_elem;if(cellElem){cellElem.attachHandle(win);}if(this.fittocontents!="none"){this._update_position();}};_pIcon.on_change_containerRect=function(width,height){if(this._is_created_contents){var cellElem=this._cell_elem;cellElem.setElementSize(width,height);}};_pIcon.on_change_containerPos=function(left,top){if(this._is_created_contents){var cellElem=this._cell_elem;cellElem.setElementPosition(left,top);}};_pIcon.on_apply_status=function(status,userstatus){var cellElem=this._cell_elem;if(cellElem){if(!this.icon){cellElem.setElementIcon(this._getCSSStyleValue("icon",status,userstatus));}}};_pIcon._on_getFitSize=function(){var elem=this.getElement();if(elem){var total_w=0;var total_h=0;var border=this._getCurrentStyleBorder();if(border){total_w+=border._getBorderWidth();total_h+=border._getBorderHeight();}var padding=this._getCurrentStylePadding();if(padding){total_w+=padding.left+padding.right;total_h+=padding.top+padding.bottom;}var icon=this._icon||this._getCSSStyleValue("icon");if(icon){var icon_pos=this.iconPosition||this._getCSSStyleValue("iconPosition");var icon_size=nexacro._getImageSize(icon.url,this._on_icon_onload,this,undefined,this.image)||{width:0,height:0};if(icon_pos=="left"||icon_pos=="right"){total_w+=icon_size.width;total_h=Math.max(total_h,icon_size.height);}else{total_h+=icon_size.height;total_w=Math.max(total_w,icon_size.width);}}return [total_w,total_h];}return [this._adjust_width,this._adjust_height];};_pIcon._isFocusAcceptable=function(){return nexacro._enableaccessibility;};_pIcon.set_icon=function(v){this.icon=v;if(v){if(this._icon==null||this._icon.value!=v){var icon=nexacro.UrlObject(v,this);this._icon=icon;this.on_apply_icon(icon);}}else{if(this._icon){this._icon=null;this.on_apply_icon(null);}}};_pIcon.on_apply_icon=function(icon){var cellElem=this._cell_elem;if(cellElem){cellElem.setElementIcon(icon||this._getCSSStyleValue("icon",this._status,this._userstatus));}};_pIcon.on_apply_textAlign=function(halign){var cellElem=this._cell_elem;if(cellElem){cellElem.setElementTextAlign(halign);}};_pIcon.on_apply_verticalAlign=function(valign){var cellElem=this._cell_elem;if(cellElem){cellElem.setElementVerticalAlign(valign);}};_pIcon._on_icon_onload=function(url,width,height){if(this.fittocontents!=="none"){this._update_position();}};_pIcon._getCurrentIcon=function(){var cellElem=this._cell_elem;if(cellElem){return cellElem.icon;}return null;};delete _pIcon;}if(!nexacro.Static){nexacro.Static=function(id,left,top,width,height,right,bottom,minwidth,maxwidth,minheight,maxheight,parent){nexacro.Component.call(this,id,left,top,width,height,right,bottom,minwidth,maxwidth,minheight,maxheight,parent);};var _pStatic=nexacro._createPrototype(nexacro.Component,nexacro.Static);nexacro.Static.prototype=_pStatic;_pStatic._type_name="Static";_pStatic._cell_elem=null;_pStatic.text="";_pStatic.usedecorate=false;_pStatic.tabstop=false;_pStatic._is_focus_accept=false;_pStatic._is_simple_control=true;_pStatic._apply_client_padding=true;_pStatic.accessibilityrole="static";_pStatic._event_list={"onclick":1,"onflingstart":1,"onfling":1,"onflingend":1,"onlbuttondown":1,"onlbuttonup":1,"onlongpress":1,"onmouseenter":1,"onmouseleave":1,"onmousemove":1,"onmove":1,"onmousedown":1,"onmouseup":1,"onsize":1,"ontouchstart":1,"ontouchmove":1,"ontouchend":1,"oncontextmenu":1,"onrbuttondown":1,"onrbuttonup":1};_pStatic.on_create_contents=function(){var control_elem=this.getElement();if(control_elem){var cellElem=this._cell_elem=new nexacro.TextBoxElement(control_elem,"text");cellElem.setElementPosition(this._getClientLeft(),this._getClientTop());cellElem.setElementSize(control_elem.client_width,control_elem.client_height);if(this.textAlign){cellElem.setElementTextAlign(this.textAlign);}if(this.verticalAlign){cellElem.setElementVerticalAlign(this.verticalAlign);}var wordwrap_info=this._getCSSStyleValue("wordWrap");if(wordwrap_info){cellElem.setElementCSSMapInfo(wordwrap_info);}if(this.wordWrap){cellElem.setElementWordWrap(this.wordWrap);}if(this._textdecoration){cellElem.setElementTextDecoration(this._textdecoration);}if(this._displaytext){if(this.usedecorate){cellElem.setElementDecorateText(this._displaytext);}else{cellElem.setElementText(this._displaytext);}}}};_pStatic.on_created_contents=function(win){if(this.expr){this._on_apply_expr(this.expr);}if(this.fittocontents!="none"){this._update_position();}var cellElem=this._cell_elem;if(cellElem){cellElem.create(win);}};_pStatic.on_destroy_contents=function(){var cellElem=this._cell_elem;if(cellElem){cellElem.destroy();this._cell_elem=null;}};_pStatic.on_create_contents_command=function(){if(this.expr){this._on_apply_expr(this.expr);}var cellElem=this._cell_elem;if(cellElem){return cellElem.createCommand();}return "";};_pStatic.on_attach_contents_handle=function(win){var cellElem=this._cell_elem;if(cellElem){cellElem.attachHandle(win);}if(this.fittocontents!="none"){this._update_position();}};_pStatic.on_change_containerRect=function(width,height){if(this._is_created_contents){var cellElem=this._cell_elem;cellElem.setElementSize(width,height);}};_pStatic.on_change_containerPos=function(left,top){if(this._is_created_contents){var cellElem=this._cell_elem;cellElem.setElementPosition(left,top);}};_pStatic.on_apply_status=function(status,userstatus){var cellElem=this._cell_elem;if(cellElem){var wordwrap_info=this._getCSSStyleValue("wordWrap",status,userstatus);if(wordwrap_info){cellElem.setElementCSSMapInfo(wordwrap_info);}}};_pStatic.on_get_prop_tabstop=function(){if(nexacro._enableaccessibility){if(this.accessibilityenable&&this.accessibilityrole=="link"){return true;}}return false;};_pStatic.on_get_accessibility_label=function(){if(this.usedecorate){return nexacro._getDisplayTextfromDecorateText(this._displaytext);}return this._displaytext;};_pStatic._isFocusAcceptable=function(){return nexacro._enableaccessibility;};_pStatic._on_getDisplayText=function(){if(this.usedecorate){return nexacro._getDisplayTextfromDecorateText(this._displaytext);}return this._displaytext;};_pStatic._on_getFitSize=function(){var elem=this.getElement();if(elem){var total_w=0;var total_h=0;var border=this._getCurrentStyleBorder();if(border){total_w+=border._getBorderWidth();total_h+=border._getBorderHeight();}var padding=this._getCurrentStylePadding();if(padding){total_w+=padding.left+padding.right;total_h+=padding.top+padding.bottom;}var text=this.text;if(text){var font=this._getCurrentStyleInheritValue("font");var wordspace=this._getCurrentStyleInheritValue("wordSpacing");var letterspace=this._getCurrentStyleInheritValue("letterSpacing");var wordwrap="none";var width;var multiline=false;if(text.search("\n")> -1){multiline=true;}if(this.fittocontents=="height"){wordwrap=this.wordWrap||this._getCSSStyleValue("wordWrap");if(wordwrap&&wordwrap!="none"){multiline=true;}width=this._adjust_width-total_w;}var b_decoration=this.usedecorate;var text_size=nexacro._getTextSize(text,font,multiline,width,wordwrap,wordspace,letterspace,b_decoration);total_w+=Math.ceil(this.textwidth!=null?this.textwidth:text_size[0]);total_h+=Math.ceil(text_size[1]);}return [total_w,total_h];}return [this._adjust_width,this._adjust_height];};_pStatic.set_usedecorate=function(v){v=nexacro._toBoolean(v);if(this.usedecorate!=v){this.usedecorate=v;this.on_apply_usedecorate(v);}};_pStatic.on_apply_usedecorate=function(usedecorate){if(this._displaytext){this.on_apply_text(this._displaytext);}};_pStatic.on_apply_text=function(text){var cellElem=this._cell_elem;if(cellElem){if(this.usedecorate){cellElem.setElementDecorateText(text);}else{cellElem.setElementText(text);}}if(nexacro._enableaccessibility){this._setAccessibilityLabel(this._getAccessibilityLabel());}};_pStatic.on_apply_textAlign=function(halign){var cellElem=this._cell_elem;if(cellElem){cellElem.setElementTextAlign(halign);}};_pStatic.on_apply_verticalAlign=function(valign){var cellElem=this._cell_elem;if(cellElem){cellElem.setElementVerticalAlign(valign);}};_pStatic.on_apply_wordWrap=function(wordwrap){if(!this._isEnableRedraw()){return;}var cellElem=this._cell_elem;if(cellElem){cellElem.setElementWordWrap(wordwrap);if(this.fittocontents!="none"){this._update_position();}}};_pStatic.on_apply_textDecoration=function(textDecoration){if(!this._isEnableRedraw()){return;}var cellElem=this._cell_elem;if(cellElem){cellElem.setElementTextDecoration(textDecoration);}};delete _pStatic;}if(!nexacro._TitleBarIconTextControl){nexacro._TitleBarIconTextControl=function(id,left,top,width,height,right,bottom,minwidth,maxwidth,minheight,maxheight,parent){nexacro._IconText.call(this,id,left,top,width,height,right,bottom,minwidth,maxwidth,minheight,maxheight,parent);};var _pTitleBarIconTextControl=nexacro._createPrototype(nexacro._IconText,nexacro._TitleBarIconTextControl);nexacro._TitleBarIconTextControl.prototype=_pTitleBarIconTextControl;_pTitleBarIconTextControl._type_name="TitleBarIconTextControl";_pTitleBarIconTextControl._is_subcontrol=true;_pTitleBarIconTextControl._is_fiticonsize=true;delete _pTitleBarIconTextControl;}
if(!nexacro.Button){nexacro.Button=function(id,left,top,width,height,right,bottom,minwidth,maxwidth,minheight,maxheight,parent){nexacro._IconText.call(this,id,left,top,width,height,right,bottom,minwidth,maxwidth,minheight,maxheight,parent);};var _pButton=nexacro._createPrototype(nexacro._IconText,nexacro.Button);nexacro.Button.prototype=_pButton;_pButton._type_name="Button";_pButton.tabstop=true;_pButton.defaultbutton=false;_pButton.escapebutton=false;_pButton._is_focus_accept=true;_pButton._cur_ldown_elem=null;_pButton._selectstatus=false;_pButton._use_pushed_status=true;_pButton._use_selected_status=true;_pButton.accessibilityrole="button";_pButton._is_eventinfo_control=true;_pButton.destroyComponent=function(){if(!this._is_alive){return;}var mainform=this._getMainForm();if(mainform){if(mainform._defaultbutton==this){mainform._defaultbutton=null;}else if(mainform._escapebutton==this){mainform._escapebutton=null;}}return nexacro.Component.prototype.destroyComponent.call(this);};_pButton.on_getBindableProperties=function(){return "value";};_pButton._getDlgCode=function(){return {want_tab:false,want_return:true,want_escape:false,want_chars:false,want_arrows:false};};_pButton._isFocusAcceptable=function(){return this._is_focus_accept;};_pButton.set_defaultbutton=function(v){v=nexacro._toBoolean(v);if(this.defaultbutton!=v){this.defaultbutton=v;}var mainform=this._getMainForm();if(mainform){var is_ignore=!(this.parent==mainform||this._is_created);if(v){if(!is_ignore){mainform._defaultbutton=this;this._setAccessibilityFlagDefaultButton(true);}}else{if(mainform._defaultbutton==this){mainform._defaultbutton=null;this._setAccessibilityFlagDefaultButton(false);}}}};_pButton.set_escapebutton=function(v){v=nexacro._toBoolean(v);if(this.escapebutton!=v){this.escapebutton=v;}var mainform=this._getMainForm();if(mainform){var is_ignore=!(this.parent==mainform||this._is_created);if(v){if(!is_ignore){mainform._escapebutton=this;}}else{if(mainform._escapebutton==this){mainform._escapebutton=null;}}}};_pButton._click=function(keycode){if(keycode==nexacro.Event.KEY_ESC||keycode==nexacro.Event.KEY_RETURN){if(this._isAccessibilityEnable()){this._notifyAccessibility();}}this.click();};_pButton.click=function(){this.on_fire_onclick("none",false,false,false, -1, -1, -1, -1, -1, -1,this,this);};_pButton.getSelectStatus=function(){return this._selectstatus;};_pButton.setSelectStatus=function(select){var ret=this._selectstatus;this._selectstatus=select;if(select){this._changeUserStatus("selected",true);}else{this._changeUserStatus("selected",false);}return ret;};_pButton.toggleSelectStatus=function(){var ret=this._selectstatus;this.setSelectStatus(!ret);return ret;};_pButton._on_hotkey=function(){this.click();};_pButton.on_keydown_basic_action=function(keycode){if(this._use_pushed_status){if(keycode==13||keycode==32){this._changeUserStatus("pushed",true);}}};_pButton.on_keyup_basic_action=function(){if(this._use_pushed_status){this._changeUserStatus("pushed",false);}};_pButton.on_fire_sys_onkeydown=function(key_code,alt_key,ctrl_key,shift_key,from_comp,from_refer_comp){var ret=nexacro.Component.prototype.on_fire_sys_onkeydown.call(this,key_code,alt_key,ctrl_key,shift_key,from_comp,from_refer_comp);var window=this._getWindow();this._cur_ldown_elem=window._cur_ldown_elem||window._keydown_element;return ret;};_pButton.on_fire_sys_onkeyup=function(key_code,alt_key,ctrl_key,shift_key,from_comp,from_refer_comp){var ret=nexacro.Component.prototype.on_fire_sys_onkeyup.call(this,key_code,alt_key,ctrl_key,shift_key,from_comp,from_refer_comp);var window=this._getWindow();var elem=window._cur_ldown_elem||window._keydown_element;if(!this._is_subcontrol){if(elem==this._cur_ldown_elem){if(key_code==13||key_code==32){this._click(key_code);}}}this._cur_ldown_elem=null;return ret;};delete _pButton;}if(!nexacro.StepImageButtonControl){nexacro.StepImageButtonControl=function(id,left,top,width,height,right,bottom,minwidth,maxwidth,minheight,maxheight,parent){nexacro.Button.call(this,id,left,top,width,height,right,bottom,minwidth,maxwidth,minheight,maxheight,parent);};var _pStepImageButtonCtrl=nexacro._createPrototype(nexacro.Button,nexacro.StepImageButtonControl);nexacro.StepImageButtonControl.prototype=_pStepImageButtonCtrl;_pStepImageButtonCtrl._type_name="ButtonControl";_pStepImageButtonCtrl._is_subcontrol=true;_pStepImageButtonCtrl._on_getAccessibilityAdditionalLabel=function(){var label="";var parent=this.parent?this.parent:null;if(parent){label=this.id+" "+parent.stepcount;}return label;};_pStepImageButtonCtrl._on_getAccessibilityAdditionalRole=function(){return " Step";};_pStepImageButtonCtrl.on_getIDCSSSelector=function(){return "stepitem";};_pStepImageButtonCtrl.on_changeUserStatus=function(changestatus,value,applyuserstatus,currentstatus,currentuserstatus){if(value){if(applyuserstatus=="pushed"&&currentuserstatus=="selected"){return currentuserstatus;}}return applyuserstatus;};delete _pStepImageButtonCtrl;}if(!nexacro._TitleBarButtonControl){nexacro._TitleBarButtonControl=function(id,left,top,width,height,right,bottom,minwidth,maxwidth,minheight,maxheight,parent){nexacro.Button.call(this,id,left,top,width,height,right,bottom,minwidth,maxwidth,minheight,maxheight,parent);};var _pTitleBarButtonControl=nexacro._createPrototype(nexacro.Button,nexacro._TitleBarButtonControl);nexacro._TitleBarButtonControl.prototype=_pTitleBarButtonControl;_pTitleBarButtonControl._type_name="TitleBarButtonControl";_pTitleBarButtonControl._is_subcontrol=true;delete _pTitleBarButtonControl;}
if(!nexacro.Edit){nexacro.Edit=function(id,left,top,width,height,right,bottom,minwidth,maxwidth,minheight,maxheight,parent,onlydisplay){nexacro.Component.call(this,id,left,top,width,height,right,bottom,minwidth,maxwidth,minheight,maxheight,parent);this._onlydisplay=onlydisplay;if(onlydisplay){this._apply_client_padding=true;this.readonly=true;}};var _pEdit=nexacro._createPrototype(nexacro.Component,nexacro.Edit);nexacro.Edit.prototype=_pEdit;_pEdit._type_name="Edit";_pEdit.value=undefined;_pEdit.displaynulltext="";_pEdit.readonly=false;_pEdit.password=false;_pEdit.autoselect=false;_pEdit.autoskip=false;_pEdit.maxlength=0;_pEdit.usesoftkeyboard=true;_pEdit.inputmode="normal";_pEdit.inputfilter="none";_pEdit.inputtype="normal";_pEdit.imemode="none";_pEdit.useime="global";_pEdit.text="";_pEdit.usecontextmenu=true;_pEdit._input_element=null;_pEdit._inputfilter_obj=null;_pEdit._inputtype_obj=null;_pEdit._undostack=null;_pEdit._default_value=undefined;_pEdit._default_text="";_pEdit._keypad_type="text";_pEdit._imedisable=false;_pEdit._processing_updateToDataset=false;_pEdit._result_updateToDataset=true;_pEdit._onlydisplay=false;_pEdit._apply_client_padding=false;_pEdit._has_inputElement=true;_pEdit._is_simple_control=true;_pEdit._is_editable_control=true;_pEdit._use_readonly_status=true;if((nexacro._Browser=="IE"&&nexacro._BrowserType!="Edge")||nexacro._Browser=="Runtime"){_pEdit._set_node_value=false;}else{_pEdit._set_node_value=true;}if((nexacro._Browser=="IE"&&nexacro._BrowserVersion<10)||nexacro._BrowserType=="Edge"){_pEdit._use_focus_caret=true;_pEdit._caret_pos= -1;}else{_pEdit._use_focus_caret=false;_pEdit._caret_pos= -1;}_pEdit._event_list={"oneditclick":1,"onkeydown":1,"onkeyup":1,"onkillfocus":1,"onsetfocus":1,"ondrag":1,"ondragenter":1,"ondragleave":1,"ondragmove":1,"ondrop":1,"onlbuttondown":1,"onlbuttonup":1,"onrbuttondown":1,"onrbuttonup":1,"onmousedown":1,"onmouseup":1,"onmouseenter":1,"onmouseleave":1,"onmousemove":1,"onmove":1,"onsize":1,"canchange":1,"onchanged":1,"oninput":1,"oncontextmenu":1,"ontouchstart":1,"ontouchmove":1,"ontouchend":1};_pEdit.accessibilityrole="edit";_pEdit.on_create_contents=function(){var control=this.getElement();if(control){var input_elem;if(!this._onlydisplay){input_elem=this._input_element=new nexacro.InputElement(control,"input");input_elem.setElementAutoSkip(this.autoskip);input_elem.setElementAutoSelect(this.autoselect);input_elem.setElementUseIme(this.useime);input_elem.setElementImeMode(this.imemode);input_elem.setElementReadonly(this.readonly);input_elem.setElementDisplayNullText(this.displaynulltext);input_elem.setElementMaxLength(this.maxlength);if((this.inputtype.indexOf("normal")>=0)||(this.inputtype.indexOf("full")>=0)){input_elem._inputtype="text";}else{input_elem._inputtype="";}input_elem.setElementInputType(this.password?"password":this._keypad_type,this._imedisable);}else{input_elem=this._input_element=new nexacro.TextBoxElement(control,"input");input_elem.setElementVerticalAlign("middle");}input_elem.setElementPosition(this._getClientLeft(),this._getClientTop());input_elem.setElementSize(this._getClientWidth(),this._getClientHeight());input_elem.setElementTextDecoration(this._textdecoration);input_elem.setElementTextAlign(this.textAlign);input_elem.setElementPadding(this.padding);this._undostack=new nexacro._EditUndoStack(this);}};_pEdit.on_created_contents=function(win){var input_elem=this._input_element;if(input_elem){this.on_apply_value(this.value);input_elem.create(win);this.set_usesoftkeyboard(this.usesoftkeyboard,true);if(nexacro._isNull(this.value)){this._changeUserStatus("nulltext",true);}}};_pEdit.on_destroy_contents=function(){var input_elem=this._input_element;if(input_elem){input_elem.destroy();this._input_element=null;}var undostack=this._undostack;if(undostack){undostack.destroy();this._undostack=null;}var inputfilterobj=this._inputfilter_obj;if(inputfilterobj){this._inputfilter_obj=null;}var inputtypeobj=this._inputtype_obj;if(inputtypeobj){this._inputtype_obj=null;}};_pEdit.on_create_contents_command=function(){var input_elem=this._input_element;if(input_elem){this.on_apply_value(this.value);this.on_apply_prop_enable(this._real_enable);return input_elem.createCommand();}return "";};_pEdit.on_attach_contents_handle=function(win){var input_elem=this._input_element;if(input_elem){input_elem.attachHandle(win);if(nexacro._isNull(this.value)){this._changeUserStatus("nulltext",true);}}};_pEdit.on_change_containerRect=function(width,height){var input_elem=this._input_element;if(input_elem){input_elem.setElementSize(width,height);}};_pEdit.on_change_containerPos=function(left,top){var input_elem=this._input_element;if(input_elem){input_elem.setElementPosition(left,top);}};_pEdit._apply_setfocus=function(evt_name,self_flag){this._processing_updateToDataset=false;var input_elem=this._input_element;if(input_elem){input_elem.on_apply_imeSet();input_elem.on_apply_force_imeSet();if(evt_name){this._default_value=this.value;this._default_text=this.text;}this._changeUserStatus("nulltext",false);if(!this._onlydisplay){input_elem.setElementFocus(evt_name,self_flag);var text=input_elem.getElementText();if(text!=this.text){this._default_text=this.text=text;}if(!this.autoselect){if(this._use_focus_caret){if(this._caret_pos== -1){input_elem.setElementSetSelect(0,0);}else{input_elem.setElementSetSelect(this._caret_pos.begin,this._caret_pos.end);}}else{if(this._caret_pos== -1){input_elem.setElementSetSelect(0,0);}}}}}};_pEdit.on_getBindableProperties=function(){return "value";};_pEdit.on_apply_prop_enable=function(v){var input_elem=this._input_element;if(input_elem){var color=this._getCSSStyleValue("color");if(!this._onlydisplay){input_elem.setElementEnable(v,color);}}};_pEdit.on_init_bindSource=function(columnid,propid){if(propid=="value"){if(this._undostack){this._undostack.clear();}this._setValue(undefined);}};_pEdit.on_change_bindSource=function(propid,ds,row,col){if(propid=="value"){var input_elem=this._input_element;if(input_elem){if(!this._onlydisplay){input_elem.setCompositionComplete();}}var v=ds.getColumn(row,col);v=this._convertValueType(v,true);if(this._undostack){this._undostack.clear();}var _bSetselect=false;if(this.value!=v){_bSetselect=true;}this._setValue(v);if(input_elem&&_bSetselect&&!this._onlydisplay){input_elem.setElementSetSelect(this.value?this.value.length:0);this._caret_pos=input_elem.getElementCaretPos();}}};_pEdit.on_changeUserStatus=function(changestatus,value,applyuserstatus){if(value){return changestatus;}else{return applyuserstatus;}};_pEdit._getDlgCode=function(){return {want_tab:false,want_return:false,want_escape:false,want_chars:false,want_arrows:false};};_pEdit._getDragData=function(){return this.getSelectedText();};_pEdit.on_get_accessibility_label=function(){var label="";return label;};_pEdit._on_getFitSize=function(){var control_elem=this.getElement();if(control_elem){var total_w=0;var total_h=0;var border=this._getCurrentStyleBorder();if(border){total_w+=border._getBorderWidth();total_h+=border._getBorderHeight();}var padding=this._getCurrentStylePadding();if(padding){total_w+=padding.left+padding.right;total_h+=padding.top+padding.bottom;}var text=this.text;if(text){var font=this._getCurrentStyleInheritValue("font");var wordspace=this._getCurrentStyleInheritValue("wordSpacing");var letterspace=this._getCurrentStyleInheritValue("letterSpacing");var text_size=nexacro._getTextSize(this.text,font,false,undefined,"none",wordspace,letterspace);total_w+=Math.ceil(text_size[0]);total_h+=Math.ceil(text_size[1]);}return [total_w,total_h];}return [this._adjust_width,this._adjust_height];};_pEdit.set_text=nexacro._emptyFn;_pEdit.set_value=function(v){v=this._convertValueType(v);if(this.value!==v){if(!this.applyto_bindSource("value",v)){return;}this._setValue(v);}};_pEdit.on_apply_value=function(value){var input_elem=this._input_element;if(input_elem){var pos=input_elem.getElementCaretPos();var text=this.text;value=(this.value?this.text:this.value);if(this._is_created&&nexacro._isNull(this.value)){this._changeUserStatus("nulltext",true);}else{this._changeUserStatus("nulltext",false);}if(!this._onlydisplay){if(this._undostack){if(pos&&pos!= -1){this._undostack.push(value,pos.begin,pos.end);}else{this._undostack.push(value,0,0);}}input_elem.setElementValue(value);text=input_elem.getElementText();}else{if(this.displaynulltext&&nexacro._isNull(this.value)){input_elem.setElementText(this.displaynulltext);}else{input_elem.setElementText(value);}}if(this.text!=text){this.text=text;}this._updateAccessibilityLabel();this._default_value=this.value;this._default_text=this.text;pos=input_elem.getElementCaretPos();if(pos&&pos!= -1){this._caret_pos=pos;}}};_pEdit.set_displaynulltext=function(v){v=nexacro._toString(v);if(this.displaynulltext!=v){this.displaynulltext=v;this.on_apply_displaynulltext(v);}};_pEdit.on_apply_displaynulltext=function(displaynulltext){var input_elem=this._input_element;if(input_elem){if(this._onlydisplay){this.on_apply_value(this.value);}else{input_elem.setElementDisplayNullText(displaynulltext);}}};_pEdit.set_readonly=function(v){if(this._onlydisplay){return;}v=nexacro._toBoolean(v);if(this.readonly!=v){this.readonly=v;this.on_apply_readonly(v);}};_pEdit.on_apply_readonly=function(readonly){this._changeStatus("readonly",readonly);var input_elem=this._input_element;if(input_elem){if(!this._onlydisplay){input_elem.setElementReadonly(readonly);}}};_pEdit.set_autoselect=function(v){v=nexacro._toBoolean(v);if(this.autoselect!=v){this.autoselect=v;this.on_apply_autoselect(v);}};_pEdit.on_apply_autoselect=function(autoselect){var input_elem=this._input_element;if(input_elem){if(!this._onlydisplay){input_elem.setElementAutoSelect(autoselect);}}};_pEdit.set_autoskip=function(v){v=nexacro._toBoolean(v);if(this.autoskip!=v){this.autoskip=v;this.on_apply_autoskip(v);}};_pEdit.on_apply_autoskip=function(autoskip){var input_elem=this._input_element;if(input_elem){if(!this._onlydisplay){input_elem.setElementAutoSkip(autoskip);}}};_pEdit.set_inputmode=function(v){var inputmode_enum=["normal","upper","lower"];if(inputmode_enum.indexOf(v)== -1){return;}if(this.inputmode!=v){this.inputmode=v;}};_pEdit.set_inputfilter=function(v){if(v){var inputfilter_arr=v.split(',');var inputfilter_enum=["none","alpha","digit","comma","dot","sign","space","symbol"];for(var i=0,len=inputfilter_arr.length;i<len;i++ ){if(inputfilter_enum.indexOf(inputfilter_arr[i])== -1){return;}}}else{return;}if(this.inputfilter!=v){this.inputfilter=v;this._inputfilter_obj=null;this.on_apply_inputfilter(v);}};_pEdit.on_apply_inputfilter=function(inputfilter){this._inputfilter_obj=new nexacro._EditInputFilter(inputfilter);};_pEdit.set_inputtype=function(v){if(v){var inputtype_arr=v.split(',');var inputtype_enum=["normal","alpha","english","digit","number","comma","dot","sign","space","symbol","half","full","numberandenglish"];for(var i=0,len=inputtype_arr.length;i<len;i++ ){if(inputtype_enum.indexOf(inputtype_arr[i])== -1){return;}}}else{return;}if(this.inputtype!=v){this.inputtype=v;this._inputtype_obj=null;this.on_apply_inputtype(v);}};_pEdit.on_apply_inputtype=function(inputtype){this._inputtype_obj=new nexacro._EditInputType(inputtype);if(nexacro._isTouchInteraction&&nexacro._SupportTouch){this._imedisable=false;}else{this._imedisable=this._inputtype_obj.imedisable;}this._keypad_type=this._inputtype_obj.keypadtype;var input_elem=this._input_element;if(input_elem&&!this._onlydisplay){if((this.inputtype.indexOf("normal")>=0)||(this.inputtype.indexOf("full")>=0)){input_elem._inputtype="text";}else{input_elem._inputtype="";}input_elem.setElementInputType(this.password?"password":this._keypad_type);}};_pEdit.set_maxlength=function(v){if(isNaN(v= +v)||v<0){return;}if(this.maxlength!=v){this.maxlength=v;this.on_apply_maxlength(v);}};_pEdit.on_apply_maxlength=function(maxlength){var input_elem=this._input_element;if(input_elem&&!this._onlydisplay){input_elem.setElementMaxLength(maxlength);}};_pEdit.set_password=function(v){v=nexacro._toBoolean(v);if(this.password!=v){this.password=v;this.on_apply_password(v);}};_pEdit.on_apply_password=function(password){var input_elem=this._input_element;if(input_elem&&!this._onlydisplay){input_elem.setElementInputType(password?"password":this._keypad_type,this._imedisable);}};_pEdit.set_useime=function(v){v=nexacro._toBoolean(v);if(this.useime!=v){this.useime=v;this.on_apply_useime(v);}};_pEdit.on_apply_useime=function(useime){var input_elem=this._input_element;if(input_elem&&!this._onlydisplay){input_elem.setElementUseIme(useime);}};_pEdit.set_usesoftkeyboard=function(v,bforce){v=nexacro._toBoolean(v);if(v!=this.usesoftkeyboard||bforce){this.usesoftkeyboard=v;this.on_apply_usesoftkeyboard(bforce);}};_pEdit.on_apply_usesoftkeyboard=function(bforce){var input_elem=this._input_element;if(input_elem&&!this._onlydisplay){input_elem.setElementUseSoftKeyboard(this.usesoftkeyboard,bforce);}};_pEdit.set_imemode=function(v){var imemode_enum=["none","alpha","alpha,full","hangul","hangul,full","katakana","katakana,full","hiragana","direct"];if(imemode_enum.indexOf(v)== -1){return;}if(this.imemode!=v){this.imemode=v;this.on_apply_imemode(v);}};_pEdit.on_apply_imemode=function(imemode){var input_elem=this._input_element;if(input_elem&&!this._onlydisplay){input_elem.setElementImeMode(imemode);}};_pEdit.set_usecontextmenu=function(v){v=nexacro._toBoolean(v);if(this.usecontextmenu!=v){this.usecontextmenu=v;}};_pEdit.set_cursor=function(v){this.cursor=v;if(v){if(this._cursor==null||this._cursor.value!=v){if(this.enable&&v=="auto"){v="text";}var cursor=nexacro.CursorObject(v);this._cursor=cursor;this.on_apply_cursor(cursor);}}else{if(this._cursor){this._cursor=null;this.on_apply_cursor(null);}}};_pEdit.on_apply_textAlign=function(halign){var input_elem=this._input_element;if(input_elem){input_elem.setElementTextAlign(halign);}};_pEdit.on_apply_padding=function(padding){var input_elem=this._input_element;if(input_elem){input_elem.setElementPadding(padding);}};_pEdit.on_apply_textDecoration=function(textDecoration){var input_elem=this._input_element;if(input_elem){input_elem.setElementTextDecoration(textDecoration);}};_pEdit.getLength=function(){return (this.value?this.value.length:0);};_pEdit.getCaretPos=function(){if(this.readonly){return  -1;}var input_elem=this._input_element;if(input_elem){var pos=input_elem.getElementCaretPos();if(pos&&pos!= -1){return pos.begin;}}return  -1;};_pEdit.setCaretPos=function(v){var input_elem=this._input_element;if(input_elem){if(!this._onlydisplay){if(arguments.length==0){v=0;}else{v=nexacro._toInt(v);if(v== -1){if(v){v=this.text.length;}else{v=0;}}}input_elem.setElementSetSelect(v,v);}return true;}return false;};_pEdit.getSelect=function(){var input_elem=this._input_element;if(input_elem&&!this._onlydisplay){return input_elem.getElementSelectionRange();}return [0,0];};_pEdit.setSelect=function(start,end){var input_elem=this._input_element;if(input_elem){if(!this._onlydisplay){var txt=this.text?this.text:"";var txt_len=txt.length;if(nexacro._isNull(start)||start===""){start=0;}if(nexacro._isNull(end)||end===""){end= -1;}if(!nexacro._isNumber(start)){start=nexacro._toInt(start);}if(!nexacro._isNumber(end)){end=nexacro._toInt(end);}if(start== -1){start=txt_len;}if(end== -1){end=txt_len;}if(start>end){var tmp=start;start=end;end=tmp;}input_elem.setElementSetSelect(start,end);}return true;}return false;};_pEdit.getSelectedText=function(){var input_elem=this._input_element;if(input_elem){if(!this._onlydisplay){var sel=input_elem.getElementSelectionRange();var start=sel[0],end=sel[1];var text=this.text;if(text&&(start!=end)){return text.substring(start,end);}}}return "";};_pEdit.setSelectedText=function(v){v=nexacro._toString(v);var input_elem=this._input_element;if(input_elem){if(!this._onlydisplay){var sel=input_elem.getElementSelectionRange();var start=sel[0],end=sel[1];if(start==end){return "";}var insertlen=v.length;var src=this.text.substring(start,end);var newtext=this.text;var newlen=newtext.length-(end-start)+insertlen;if(this.maxlength>0&&newlen>this.maxlength){v=v.substring(0,this.maxlength-insertlen);}newtext=newtext.substring(0,start)+v+newtext.substring(end);if(this.text!=newtext){this._setValue(newtext);input_elem.setElementSetSelect(start,start+insertlen);}return src;}}return "";};_pEdit.updateToDataset=function(){this._result_updateToDataset=this.applyto_bindSource("value",this.value);if(this._result_updateToDataset){this._default_value=this.value;this._default_text=this.text;}this._processing_updateToDataset=true;return this._result_updateToDataset;};_pEdit.on_deactivate_process=function(){var input_elem=this._input_element;if(input_elem){input_elem.setCompositionComplete();}};_pEdit._on_deactivate=function(){if(!this._is_alive){return;}if(!this._isSelected()){this._changeStatus("focused",false);}this.on_deactivate_process.call(this);};_pEdit._on_value_change=function(pretext,prevalue,posttext,postvalue){if(!this.on_fire_canchange(this,pretext,prevalue,posttext,postvalue)){return false;}this._default_value=postvalue;this._default_text=posttext;var input_elem=this._input_element;var pos=input_elem.getElementCaretPos();if(pos&&pos!= -1){this._caret_pos=pos;}if(this._processing_updateToDataset&&!this._result_updateToDataset&&prevalue===postvalue){this._processing_updateToDataset=false;this._result_updateToDataset=true;return false;}else if(!this.applyto_bindSource("value",postvalue)){return false;}this.on_fire_onchanged(this,pretext,prevalue,posttext,postvalue);return true;};_pEdit._on_input_undo=function(item){if(this.readonly||!this._isEnable()){return;}var input_elem=this._input_element;if(input_elem){if(item){var caret=item.end;if(item.value&&item.value.length>caret){caret=item.value.length;}input_elem.updateElementText(item.value,caret);input_elem.setElementSetSelect(item.start,item.end);return true;}}};_pEdit._on_input_redo=function(item){if(this.readonly||!this._isEnable()){return;}var input_elem=this._input_element;if(input_elem){if(item){input_elem.updateElementText(item.value,item.end);input_elem.setElementSetSelect(item.start,item.end);return true;}}};_pEdit.on_keydown_basic_before_process=function(keycode,alt_key,ctrl_key,shift_key){return true;};_pEdit.on_keydown_basic_specialkey_process=function(keycode,alt_key,ctrl_key,shift_key){var input_elem=this._input_element;if(keycode==nexacro.KeyCode_ImeInput&&this._imedisable){input_elem.stopSysEvent();return;}else if(!alt_key&&!shift_key&&ctrl_key&&keycode==90){if(input_elem.isComposing()){input_elem.setCompositionComplete();}if(this._undostack){this._undostack.undo();input_elem._applyMaxlength();input_elem.stopSysEvent();return;}}else if(!alt_key&&!shift_key&&ctrl_key&&keycode==89){if(this._undostack){this._undostack.redo();input_elem.stopSysEvent();return;}}return true;};_pEdit.on_keydown_basic_process=function(keycode,alt_key,ctrl_key,shift_key){var input_elem=this._input_element;if(this._undostack&&!input_elem.isComposing()){var pos=input_elem.getElementCaretPos();if(pos&&pos!= -1){this._undostack.update(pos.begin,pos.end);}}return true;};_pEdit.on_keydown_basic_action=function(keycode,alt_key,ctrl_key,shift_key){if(this.readonly||!this._isEnable()){return;}var input_elem=this._input_element;if(input_elem){if(!this.on_keydown_basic_before_process.call(this,keycode,alt_key,ctrl_key,shift_key)){return;}if(!this.on_keydown_basic_specialkey_process.call(this,keycode,alt_key,ctrl_key,shift_key)){return;}this.on_keydown_basic_process.call(this,keycode,alt_key,ctrl_key,shift_key);}};_pEdit.on_keydown_default_before_process=function(keycode){return true;};_pEdit.on_keydown_default_specialkey_process=function(keycode){var input_elem=this._input_element;if(keycode==nexacro.Event.KEY_RETURN){if(input_elem.isComposing()){input_elem.setCompositionComplete();}var pre_value=this._default_value;var pre_text=this._default_text;var cur_value=input_elem.value;var cur_text=cur_value?cur_value:"";if(pre_value!=cur_value){if(!this._on_value_change(pre_text,pre_value,cur_text,cur_value)){this.value=pre_value;this.text=pre_text;input_elem.setElementValue(pre_text);input_elem.setElementSetSelect(this._caret_pos.begin,this._caret_pos.end);}}}return true;};_pEdit.on_keydown_default_process=function(keycode){return true;};_pEdit.on_keydown_default_action=function(keycode){if(this.readonly||!this._isEnable()){return;}var input_elem=this._input_element;if(input_elem){if(!this.on_keydown_default_before_process.call(this,keycode)){return;}if(!this.on_keydown_default_specialkey_process.call(this,keycode)){return;}this.on_keydown_default_process.call(this,keycode);}};_pEdit.on_keypress_basic_before_process=function(keycode,charcode,alt_key,ctrl_key){return true;};_pEdit.on_keypress_basic_specialkey_process=function(keycode,charcode,alt_key,ctrl_key){var input_elem=this._input_element;if(input_elem){if(keycode==nexacro.Event.KEY_TAB){if(!this._getDlgCode().want_tab){input_elem.stopSysEvent();return;}}if(keycode!==0&&charcode===0){return 2;}else{if(keycode==nexacro.Event.KEY_ENTER||keycode==nexacro.Event.KEY_ESC){return 2;}}}return true;};_pEdit.on_keypress_basic_process=function(keycode,charcode,alt_key,ctrl_key){if(nexacro._OS=="iOS"){return true;}charcode=charcode||keycode;var input_elem=this._input_element;if(!ctrl_key&&!alt_key&&charcode&&!input_elem.isComposing()){var inputChar=String.fromCharCode(charcode);if(inputChar.length>0&&this._isFilterChar(inputChar)){input_elem.stopSysEvent();return false;}}return true;};_pEdit.on_keypress_basic_action=function(keycode,charcode,alt_key,ctrl_key){var input_elem=this._input_element;if(input_elem){if(!this.on_keypress_basic_before_process.call(this,keycode,charcode,alt_key,ctrl_key)){return;}var ret=this.on_keypress_basic_specialkey_process.call(this,keycode,charcode,alt_key,ctrl_key);if(!ret){return;}else if(ret==2){return true;}if(!this.on_keypress_basic_process.call(this,keycode,charcode,alt_key,ctrl_key)){return false;}}};_pEdit.on_beforekeyinput_basic_action=function(value,status,begin,end,inputType){if(this.readonly||!this._isEnable()){return 0;}var input_elem=this._input_element;if(input_elem){if(input_elem._use_event_beforeinput){return this._beforeinput_process_with_HTMLEvent(value,status,begin,end,inputType);}else{return this._beforeinput_process_with_NexacroInputEvent(value,status,begin,end);}}};_pEdit.on_keyinput_basic_before_process=function(input_text){return true;};_pEdit.on_keyinput_basic_process=function(input_text){var input_elem=this._input_element;var input_value=input_elem.value===null?undefined:input_elem.value;input_text=input_text===undefined?input_elem._getInputValue():input_text;this.value=input_value;this.text=input_text;if(this._undostack&&!input_elem.isComposing()){var pos=input_elem.getElementCaretPos();if(pos&&pos!= -1){this._undostack.push(input_value,pos.begin,pos.end);}else{this._undostack.push(input_value,0,0);}}return true;};_pEdit.on_keyinput_basic_action=function(input_text){if(this.readonly||!this._isEnable()){return false;}var input_elem=this._input_element;if(input_elem){if(!this.on_keyinput_basic_before_process.call(this,input_text)){return false;}if(!this.on_keyinput_basic_process.call(this,input_text)){return false;}}this._updateAccessibilityLabel();return true;};_pEdit.on_killfocus_basic_process=function(){var input_elem=this._input_element;var cur_text;if(!this._onlydisplay){var pre_value=this._default_value;var pre_text=this._default_text;var cur_value=input_elem.value;cur_text=cur_value?cur_value:"";var pos=input_elem.getElementCaretPos();if(pre_value!=cur_value){if(!this._on_value_change(pre_text,pre_value,cur_text,cur_value)){var cur_text_len=cur_text?cur_text.length:0;var pre_text_len=pre_text?pre_text.length:0;if(pos!= -1){if(cur_text_len-pre_text_len>=0){pos.begin=pos.end=pos.begin-(cur_text_len-pre_text_len);}if(pos.begin<0){pos.begin=pos.end=0;}this._caret_pos=pos;}else{this._caret_pos.begin=this._caret_pos.end=pre_value?pre_value.length:0;}this.value=pre_value;this.text=pre_text;input_elem.setElementValue(pre_value);input_elem.setElementSetSelect(this._caret_pos.begin,this._caret_pos.end);}}else{this._caret_pos=input_elem.getElementCaretPos();}if(nexacro._isNull(this.value)){this._changeUserStatus("nulltext",true);}if(nexacro._enableaccessibility&&nexacro._Browser=="Runtime"&&nexacro._accessibilitytype==5){this._setAccessibilityStatKillFocus();}var _win=this._getRootWindow();var idx=_win._indexOfCurrentFocusPaths(this);if(idx<0){input_elem.setElementBlur();}}else{if(nexacro._isNull(this.value)){this._changeUserStatus("nulltext",true);}}return true;};_pEdit.on_killfocus_basic_action=function(){var input_elem=this._input_element;if(input_elem){if(!this._onlydisplay){var _sel=input_elem.getElementSelectionRange();if(_sel[0]==_sel[1]){input_elem._setElementLastSelectionRange();}}if(!this.on_killfocus_basic_process.call(this)){return;}}};_pEdit.on_click_basic_action=function(elem,button){var input_elem=this._input_element;if(input_elem){var _window=this._getWindow();if(_window&&this._track_capture){var capture_comp=_window._getCaptureComp(true,false,this);if(!this._onlydisplay&&(!capture_comp||capture_comp==this)){input_elem.setElementFocus(button);}}}};_pEdit.on_fire_onclick=function(button,alt_key,ctrl_key,shift_key,screenX,screenY,canvasX,canvasY){if(this.oneditclick&&this.oneditclick._has_handlers){var caretpos=this.getCaretPos();var clientXY=this._getClientXY(canvasX,canvasY);var evt=new nexacro.EditClickEventInfo(this,"oneditclick",caretpos,button,alt_key,ctrl_key,shift_key,screenX,screenY,canvasX,canvasY,clientXY[0],clientXY[1],this,this);return this.oneditclick._fireEvent(this,evt);}return true;};_pEdit.on_fire_canchange=function(obj,pretext,prevalue,posttext,postvalue){if(this.canchange&&this.canchange._has_handlers){var evt=new nexacro.ChangeEventInfo(obj,"canchange",pretext,prevalue,posttext,postvalue);return this.canchange._fireCheckEvent(this,evt);}return true;};_pEdit.on_fire_onchanged=function(obj,pretext,prevalue,posttext,postvalue){if(this.onchanged&&this.onchanged._has_handlers){var evt=new nexacro.ChangeEventInfo(obj,"onchanged",pretext,prevalue,posttext,postvalue);return this.onchanged._fireEvent(this,evt);}};_pEdit.on_fire_oninput=function(){if(this.oninput&&this.oninput._has_handlers){var evt=new nexacro.InputEventInfo(this,"oninput");return this.oninput._fireEvent(this,evt);}return true;};_pEdit._convertValueType=function(v,bapplyrule){var ret;if(bapplyrule){ret=nexacro.Component.prototype._convertValueType.call(this,v);}else{ret=nexacro._isNull(v)?v:nexacro._toString(v);}return ret;};_pEdit._setValue=function(v){this.text=nexacro._toString(v);this.value=v;this.on_apply_value(v);};_pEdit._setReadonlyView=function(v){var input_elem=this._input_element;if(input_elem){if(!this._onlydisplay){input_elem.setElementReadonly(v);}}};_pEdit._setDefaultCaret=function(){this.setCaretPos(0);};_pEdit._setFocusToNextComponent=function(){var root_comp=this._getRootComponent(this);var next_comp=this._getForm().getNextComponent(root_comp,true);if(next_comp){next_comp.setFocus();if(next_comp._is_editable_control){next_comp._setDefaultCaret();}}};_pEdit._isFilterChar=function(ch){if(ch!=""){if(this._inputfilter_obj&&this._inputfilter_obj.test(ch)){return true;}if(this._inputtype_obj&&!this._inputtype_obj.test(ch)){return true;}}return false;};_pEdit.on_beforeinput_process_with_HTMLEvent=function(value,status,begin,end,inputType){var input_elem=this._input_element;var update_value=value?value.replace(/\r\n/g,""):value;var input_value=input_elem._getInputValue();var update_value_len=update_value?update_value.length:0;var ret=[input_elem._BeforeinputState.PASS];if(inputType=="deleteContentBackward"||inputType=="deleteContentForward"||inputType=="deleteByCut"){return ret;}if(this._inputtype_obj){update_value=this._inputtype_obj.apply(update_value);if(value!=update_value){if(update_value&&inputType=="insertFromPaste"){update_value_len=update_value.length;input_elem._beforeinput_result_data=update_value;input_elem._beforeinput_result_pos={begin:begin+update_value_len,end:begin+update_value_len};ret.push(input_elem._BeforeinputState.REPLACE);}else{ret.push(input_elem._BeforeinputState.CANCEL);}}}if(this._inputfilter_obj){update_value=this._inputfilter_obj.apply(update_value);if(value!=update_value){if(update_value&&inputType=="insertFromPaste"){update_value_len=update_value.length;input_elem._beforeinput_result_data=update_value;input_elem._beforeinput_result_pos={begin:begin+update_value_len,end:begin+update_value_len};ret.push(input_elem._BeforeinputState.REPLACE);}else{ret.push(input_elem._BeforeinputState.CANCEL);}}}if(inputType=="insertFromPaste"){if(update_value){var maxlength=this.maxlength;update_value=update_value.replace(/\r\n/g,"");if(maxlength&&begin+(input_value.length-end)+update_value_len>maxlength){update_value=update_value.substring(0,maxlength-(begin+input_value.length-end));}input_elem._beforeinput_result_insert_data=update_value;update_value_len=update_value.length;update_value=input_value.substring(0,begin)+update_value+input_value.substring(end);input_elem._beforeinput_result_data=update_value;input_elem._beforeinput_result_pos={begin:begin+update_value_len,end:begin+update_value_len};ret.push(input_elem._BeforeinputState.REPLACE);}}if(status==0||status==3){if(update_value){switch(this.inputmode){case "upper":ret.push(input_elem._BeforeinputState.CONVERT_UPPER);break;case "lower":ret.push(input_elem._BeforeinputState.CONVERT_LOWER);break;}}}if(this.maxlength>0&&(status==0||status==3)){input_value=input_value?input_value:input_elem._getInputValue();var check=input_elem._checkMaxLength(input_value+(update_value?update_value:""),end);if(check&&check.ismax){ret.push(input_elem._BeforeinputState.MAXLENGTH);}}if(this.maxlength>0&&(status==1||status==2)){input_value=input_value?input_value:input_elem._getInputValue();if(begin!=end){input_value=input_value.substring(0,begin);}update_value=input_value+update_value;if(update_value.length>this.maxlength){ret.push(input_elem._BeforeinputState.CANCEL);ret.push(input_elem._BeforeinputState.MAXLENGTH);}}return ret;};_pEdit._beforeinput_process_with_HTMLEvent=function(value,status,begin,end,inputType){var input_elem=this._input_element;if(input_elem){return this.on_beforeinput_process_with_HTMLEvent.call(this,value,status,begin,end,inputType);}};_pEdit.on_beforeinput_process_with_NexacroInputEvent=function(value,status,begin,end){var input_elem=this._input_element;var bPaste=input_elem._paste_caret_pos?true:false;var pre_value=input_elem.value;var input_text=value.substring(begin,end);if(input_text){var update_value=input_text;if(nexacro._is_hangul(update_value)||(status==nexacro._CompositionState.NONE||status==nexacro._CompositionState.END)){if(this._inputtype_obj){update_value=this._inputtype_obj.apply(update_value);}if(this._inputfilter_obj){update_value=this._inputfilter_obj.apply(update_value);}if(this.inputmode=="upper"){update_value=update_value.toUpperCase();}else if(this.inputmode=="lower"){update_value=update_value.toLowerCase();}}if(update_value!=input_text){if(bPaste&&!update_value){var pre_value_length=pre_value?pre_value.length:0;var pos=begin+(input_text.length-(value.length-pre_value_length));input_elem.updateElementText(pre_value,pos);}else{input_elem.replaceElementText(update_value,begin,end);}}}};_pEdit._beforeinput_process_with_NexacroInputEvent=function(value,status,begin,end){var input_elem=this._input_element;if(input_elem){this.on_beforeinput_process_with_NexacroInputEvent.call(this,value,status,begin,end);}};_pEdit._on_input_compositionend=function(value){var input_elem=this._input_element;if(input_elem){if(this._undostack){var pos=input_elem.getElementCaretPos();if(pos&&pos!= -1){this._undostack.push(value,pos.begin,pos.end);}else{this._undostack.push(value,0,0);}}}};_pEdit.on_apply_imeSet=function(){var input_elem=this._input_element;if(input_elem){var _locale=input_elem._imelocale.getLocale();var i,len;if(_locale&&nexacro._cache_edit_set[_locale]){for(var prop in nexacro._cache_edit_set[_locale]){this[prop]=nexacro._cache_edit_set[_locale][prop];}for(i=0,len=nexacro._edit_user_override_func.length;i<len;i++ ){if(!nexacro._cache_edit_set[_locale][nexacro._edit_user_override_func[i]]){this[nexacro._edit_user_override_func[i]]=nexacro.Edit.prototype[nexacro._edit_user_override_func[i]];}}}else{for(i=0,len=nexacro._edit_user_override_func.length;i<len;i++ ){this[nexacro._edit_user_override_func[i]]=nexacro.Edit.prototype[nexacro._edit_user_override_func[i]];}}}};_pEdit._setAccessibilityReadOnly=nexacro._emptyFn;_pEdit=null;}
if(!nexacro.MaskEdit){nexacro.MaskEdit=function(id,left,top,width,height,right,bottom,minwidth,maxwidth,minheight,maxheight,parent,onlydisplay){nexacro.Component.call(this,id,left,top,width,height,right,bottom,minwidth,maxwidth,minheight,maxheight,parent);this._onlydisplay=onlydisplay;if(onlydisplay){this._apply_client_padding=true;this.readonly=true;}};var _pMaskEdit=nexacro._createPrototype(nexacro.Component,nexacro.MaskEdit);nexacro.MaskEdit.prototype=_pMaskEdit;_pMaskEdit._type_name="MaskEdit";_pMaskEdit.value=undefined;_pMaskEdit.displaynulltext="";_pMaskEdit.displayinvalidtext="invalid value";_pMaskEdit.readonly=false;_pMaskEdit.autoselect=false;_pMaskEdit.autoskip=false;_pMaskEdit.type="number";_pMaskEdit.trimtype="none";_pMaskEdit.limitbymask="decimal";_pMaskEdit.clipmode="includespace";_pMaskEdit.format="";_pMaskEdit.maskchar="_";_pMaskEdit.text="";_pMaskEdit.usecontextmenu=true;_pMaskEdit.locale="";_pMaskEdit.usesoftkeyboard=true;_pMaskEdit._input_element=null;_pMaskEdit._masktypeobj=null;_pMaskEdit._undostack=null;_pMaskEdit._default_value=undefined;_pMaskEdit._default_text="";_pMaskEdit._locale="";_pMaskEdit._imedisable=true;_pMaskEdit._processing_updateToDataset=false;_pMaskEdit._result_updateToDataset=true;_pMaskEdit._onlydisplay=false;_pMaskEdit._apply_client_padding=false;_pMaskEdit._has_inputElement=true;_pMaskEdit._is_simple_control=true;_pMaskEdit._is_editable_control=true;_pMaskEdit._is_locale_control=true;_pMaskEdit._use_readonly_status=true;_pMaskEdit._event_list={"oneditclick":1,"onkeydown":1,"onkeyup":1,"onkillfocus":1,"onsetfocus":1,"ondrag":1,"ondragenter":1,"ondragleave":1,"ondragmove":1,"ondrop":1,"onlbuttondown":1,"onlbuttonup":1,"onrbuttondown":1,"onrbuttonup":1,"onmousedown":1,"onmouseup":1,"onmouseenter":1,"onmouseleave":1,"onmousemove":1,"onmove":1,"onsize":1,"canchange":1,"onchanged":1,"oninput":1,"oncontextmenu":1,"ontouchstart":1,"ontouchmove":1,"ontouchend":1};_pMaskEdit.accessibilityrole="edit";_pMaskEdit.on_create_contents=function(){var control=this.getElement();if(control){var input_elem;if(!this._onlydisplay){input_elem=this._input_element=new nexacro.InputElement(control,"input");input_elem.setElementAutoSkip(this.autoskip);input_elem.setElementAutoSelect(this.autoselect);input_elem.setElementUseIme("none");input_elem.setElementImeMode("disabled");input_elem.setElementReadonly(this.readonly);}else{input_elem=this._input_element=new nexacro.TextBoxElement(control,"input");input_elem.setElementVerticalAlign("middle");}input_elem.setElementPosition(this._getClientLeft(),this._getClientTop());input_elem.setElementSize(this._getClientWidth(),this._getClientHeight());input_elem.setElementTextDecoration(this._textdecoration);input_elem.setElementTextAlign(this.textAlign);input_elem.setElementPadding(this.padding);this._undostack=new nexacro._EditUndoStack(this);if(nexacro._isTouchInteraction&&nexacro._SupportTouch){this._imedisable=false;}}};_pMaskEdit.on_created_contents=function(win){var input_elem=this._input_element;if(input_elem){this.on_apply_type(this.type);this.on_apply_limitbymask(this.limitbymask);this.on_apply_clipmode(this.clipmode);this.on_apply_maskchar(this.maskchar);this._on_apply_format(this.format);this.on_apply_locale(this._getLocale());this.on_apply_value(this.value);input_elem.create(win);this.on_apply_displaynulltext(this.displaynulltext);this.on_apply_displayinvalidtext(this.displayinvalidtext);this.set_usesoftkeyboard(this.usesoftkeyboard,true);if(nexacro._isNull(this.value)){this._changeUserStatus("nulltext",true);}else{this._changeUserStatus("nulltext",false);if(this._isInvalidValue(this.value)){this._changeUserStatus("invalidtext",true);}else{this._changeUserStatus("invalidtext",false);}}}};_pMaskEdit.on_destroy_contents=function(){var input_elem=this._input_element;if(input_elem){input_elem.destroy();this._input_element=null;}var undostack=this._undostack;if(undostack){undostack.destroy();this._undostack=null;}var masktypeobj=this._masktypeobj;if(masktypeobj){this._masktypeobj=null;}};_pMaskEdit.on_create_contents_command=function(){var input_elem=this._input_element;if(input_elem){this.on_apply_type(this.type);this.on_apply_limitbymask(this.limitbymask);this.on_apply_clipmode(this.clipmode);this.on_apply_maskchar(this.maskchar);this._on_apply_format(this.format);this.on_apply_locale(this._getLocale());this.on_apply_value(this.value);return input_elem.createCommand();}return "";};_pMaskEdit.on_attach_contents_handle=function(win){var input_elem=this._input_element;if(input_elem){input_elem.attachHandle(win);this.on_apply_displaynulltext(this.displaynulltext);this.on_apply_displayinvalidtext(this.displayinvalidtext);if(nexacro._isNull(this.value)){this._changeUserStatus("nulltext",true);}else{this._changeUserStatus("nulltext",false);if(this._isInvalidValue(this.value)){this._changeUserStatus("invalidtext",true);}else{this._changeUserStatus("invalidtext",false);}}}};_pMaskEdit.on_change_containerRect=function(width,height){var input_elem=this._input_element;if(input_elem){input_elem.setElementSize(width,height);}};_pMaskEdit.on_change_containerPos=function(left,top){var input_elem=this._input_element;if(input_elem){input_elem.setElementPosition(left,top);}};_pMaskEdit._apply_setfocus=function(evt_name){this._processing_updateToDataset=false;var input_elem=this._input_element;if(input_elem){var value=this.value;var text="";var emptytext="";var maskobj=this._getMaskObj();if(maskobj){if(!this._onlydisplay){maskobj.setEditStatus(true);}emptytext=this._getEmptyText();if(this._isInvalidValue(value)){text=maskobj.applyMask("");}else{text=maskobj.applyMask(value);}if(evt_name){this._default_value=value;this._default_text=text;}if(!this._onlydisplay){this._changeUserStatus("nulltext",false);this._changeUserStatus("invalidtext",false);if(nexacro._isNull(value)){input_elem.setElementDefaultValue(emptytext);input_elem.setElementValue(null);}else{input_elem.setElementValue(text);}}}if(!this._onlydisplay){input_elem.setElementFocus(evt_name);text=input_elem.getElementText();if(text!=this.text){this._default_text=this.text=text;}}}};_pMaskEdit.on_getBindableProperties=function(){return "value";};_pMaskEdit.on_apply_prop_enable=function(v){var input_elem=this._input_element;if(input_elem){var color=this._getCSSStyleValue("color");if(!this._onlydisplay){input_elem.setElementEnable(v,color);}}};_pMaskEdit.on_init_bindSource=function(columnid,propid){if(propid=="value"){if(this._undostack){this._undostack.clear();}this._setValue(undefined);}};_pMaskEdit.on_change_bindSource=function(propid,ds,row,col){if(propid=="value"){var v=ds.getColumn(row,col);v=this._convertValueType(v,true);if(v===this.value){return;}if(this._undostack){this._undostack.clear();}this._setValue(v);}};_pMaskEdit.on_changeUserStatus=function(changestatus,value,applyuserstatus){if(value){return changestatus;}else{return applyuserstatus;}};_pMaskEdit._getDlgCode=function(){return {want_tab:false,want_return:false,want_escape:false,want_chars:false,want_arrows:false};};_pMaskEdit._getDragData=function(){return this.getSelectedText();};_pMaskEdit.on_get_accessibility_label=function(){var label="";return label;};_pMaskEdit._on_getAccessibilityAdditionalLabel=function(){var input_elem=this._input_element;if(input_elem&&input_elem._wantAccessibilityAdditionalLabel){if(input_elem._wantAccessibilityAdditionalLabel()){if(this.text!==undefined&&this.value!==undefined){return this.text;}}}if(!this.text){return this.displaynulltext?this.displaynulltext:"";}return "";};_pMaskEdit._on_getFitSize=function(){var control_elem=this.getElement();if(control_elem){var total_w=0;var total_h=0;var border=this._getCurrentStyleBorder();if(border){total_w+=border._getBorderWidth();total_h+=border._getBorderHeight();}var padding=this._getCurrentStylePadding();if(padding){total_w+=padding.left+padding.right;total_h+=padding.top+padding.bottom;}var text=this.text;if(text){var font=this._getCurrentStyleInheritValue("font");var wordspace=this._getCurrentStyleInheritValue("wordSpacing");var letterspace=this._getCurrentStyleInheritValue("letterSpacing");var text_size=nexacro._getTextSize(this.text,font,false,undefined,"none",wordspace,letterspace);total_w+=Math.ceil(text_size[0]);total_h+=Math.ceil(text_size[1]);}return [total_w,total_h];}return [this._adjust_width,this._adjust_height];};_pMaskEdit.set_text=nexacro._emptyFn;_pMaskEdit.set_value=function(v){v=this._convertValueType(v);if(this.value!==v){if(!this.applyto_bindSource("value",v)){return;}this._setValue(v);this._updateAccessibilityLabel();}};_pMaskEdit.on_apply_value=function(value){var input_elem=this._input_element;var text;var is_invalidvalue=false;if(input_elem){text=this.text;is_invalidvalue=this._isInvalidValue(value);if(this._is_created){if(nexacro._isNull(value)){this._changeUserStatus("nulltext",true);}else{this._changeUserStatus("nulltext",false);if(is_invalidvalue){this._changeUserStatus("invalidtext",true);}else{this._changeUserStatus("invalidtext",false);}}}else{this._changeUserStatus("nulltext",false);this._changeUserStatus("invalidtext",false);}var maskobj=this._getMaskObj();if(maskobj){if(is_invalidvalue){text=this.text=maskobj.applyMask("");}else{text=this.text=maskobj.applyMask(value);}}if(!this._onlydisplay){var pos=input_elem.getElementCaretPos();if(this._undostack){if(pos&&pos!= -1){this._undostack.push(text,pos.begin,pos.end);}else{this._undostack.push(text,0,0);}}if(nexacro._isNull(value)){input_elem.setElementDefaultValue(text);if(is_invalidvalue){input_elem.setElementValue(text,is_invalidvalue);}else{input_elem.setElementValue(value,is_invalidvalue);}}else{input_elem.setElementValue(text,is_invalidvalue);}this._displaytext=input_elem.getElementText();input_elem.setElementSetSelect((pos&&pos!= -1)?pos.begin:0,pos?pos.end:0);}else{if(this.displaynulltext&&nexacro._isNull(value)){input_elem.setElementText(this.displaynulltext);}else{if(this._isInvalidValue(value)){text=this.displayinvalidtext;}input_elem.setElementText(text);}}if(this.text!=text){this.text=text;}this._default_value=this.value;this._default_text=this.text;}};_pMaskEdit.set_displaynulltext=function(v){v=nexacro._toString(v).replace(/&quot;/g,"\"");if(this.displaynulltext!=v){this.displaynulltext=v;this.on_apply_displaynulltext(v);}};_pMaskEdit.on_apply_displaynulltext=function(displaynulltext){var input_elem=this._input_element;if(input_elem){if(this._onlydisplay){this.on_apply_value(this.value);}else{input_elem.setElementDisplayNullText(displaynulltext);this._displaytext=input_elem.getElementText();}}};_pMaskEdit.set_displayinvalidtext=function(v){v=nexacro._toString(v).replace(/&quot;/g,"\"");if(this.displayinvalidtext!=v){this.displayinvalidtext=v;this.on_apply_displayinvalidtext(v);}};_pMaskEdit.on_apply_displayinvalidtext=function(v){v=nexacro._toString(v).replace(/&quot;/g,"\"");var input_elem=this._input_element;if(input_elem){if(this._onlydisplay){this.on_apply_value(this.value);}else{input_elem.setElementDisplayInvalidText(v);this._displaytext=input_elem.getElementText();}}};_pMaskEdit.set_readonly=function(v){if(this._onlydisplay){return;}v=nexacro._toBoolean(v);if(this.readonly!=v){this.readonly=v;this.on_apply_readonly(v);}};_pMaskEdit.on_apply_readonly=function(readonly){this._changeStatus("readonly",readonly);var input_elem=this._input_element;if(input_elem){if(!this._onlydisplay){input_elem.setElementReadonly(readonly);}}};_pMaskEdit.set_autoselect=function(v){v=nexacro._toBoolean(v);if(this.autoselect!=v){this.autoselect=v;this.on_apply_autoselect(v);}};_pMaskEdit.on_apply_autoselect=function(autoselect){var input_elem=this._input_element;if(input_elem&&!this._onlydisplay){input_elem.setElementAutoSelect(autoselect);}};_pMaskEdit.set_autoskip=function(v){v=nexacro._toBoolean(v);if(this.autoskip!=v){this.autoskip=v;this.on_apply_autoskip(v);}};_pMaskEdit.on_apply_autoskip=function(autoskip){var input_elem=this._input_element;if(input_elem&&!this._onlydisplay){input_elem.setElementAutoSkip(autoskip);}};_pMaskEdit.set_clipmode=function(v){var clipmode_enum=["includespace","excludespace"];if(clipmode_enum.indexOf(v)== -1){return;}if(this.clipmode!=v){this.clipmode=v;this.on_apply_clipmode(v);}};_pMaskEdit.on_apply_clipmode=function(clipmode){var maskobj=this._masktypeobj;if(maskobj){if(this.type=="string"){if(clipmode=="includespace"){maskobj.setFillChar(' ');}else{maskobj.setFillChar('');}}}};_pMaskEdit.set_limitbymask=function(v){var limitbymask_enum=["none","integer","decimal","both"];if(limitbymask_enum.indexOf(v)== -1){return;}if(this.limitbymask!=v){this.limitbymask=v;this.on_apply_limitbymask(v);this.on_apply_value(this.value);}};_pMaskEdit.on_apply_limitbymask=function(limitbymask){var maskobj=this._masktypeobj;if(maskobj){if(this.type=="number"){maskobj.setLimitType(limitbymask);}}};_pMaskEdit.set_format=function(v){v=nexacro._toString(v);if(this.format!=v){this.format=v;this._on_apply_format(v);this.on_apply_value(this.value);}};_pMaskEdit._on_apply_format=function(mask){var maskobj=this._masktypeobj;if(maskobj){mask=mask?mask.replace(/^\s\s*/,''):"";maskobj.setMask(mask);this._on_apply_inputtype();}};_pMaskEdit.set_maskchar=function(v){v=nexacro._toString(v);if(v==""){v="_";}if(this.maskchar!=v){this.maskchar=v;this.on_apply_maskchar(v);this.on_apply_value(this.value);}};_pMaskEdit.on_apply_maskchar=function(maskchar){var maskobj=this._masktypeobj;if(maskobj){maskobj.setMaskChar(maskchar);}};_pMaskEdit.set_trimtype=function(v){var trimtype_enum=["none","left","right","both"];if(trimtype_enum.indexOf(v)== -1){return;}if(this.trimtype!=v){this.trimtype=v;}};_pMaskEdit.set_type=function(v){var type_enum=["number","string"];if(type_enum.indexOf(v)== -1){return;}if(this.type!=v){this.type=v;this.on_apply_type(v);this.on_apply_limitbymask(this.limitbymask);this.on_apply_maskchar(this.maskchar);this.on_apply_clipmode(this.clipmode);this._on_apply_format(this.format);this.on_apply_locale(this._getLocale());this.on_apply_value(this.value);}};_pMaskEdit.on_apply_type=function(type){this._masktypeobj=null;if(type=="number"){this._masktypeobj=new nexacro._EditMaskTypeNumber();}else if(type=="string"){this._masktypeobj=new nexacro._EditMaskTypeString();}var input_elem=this._input_element;if(input_elem){if(type=="number"){input_elem.setElementTextAlignByClassCSSSelector("right");}else{input_elem.setElementTextAlignByClassCSSSelector("left");}}};_pMaskEdit.set_locale=function(v){if(this.locale!=v){this.locale=v;this._locale=v;this.on_apply_locale(v);this.on_apply_value(this.value);}};_pMaskEdit.on_apply_locale=function(locale){var maskobj=this._masktypeobj;if(maskobj){maskobj.setLocale(locale);}};_pMaskEdit.set_usesoftkeyboard=function(v,bforce){v=nexacro._toBoolean(v);if(v!=this.usesoftkeyboard||bforce){this.usesoftkeyboard=v;this.on_apply_usesoftkeyboard(bforce);}};_pMaskEdit.on_apply_usesoftkeyboard=function(bforce){var input_elem=this._input_element;if(input_elem&&!this._onlydisplay){input_elem.setElementUseSoftKeyboard(this.usesoftkeyboard,bforce);}};_pMaskEdit.set_usecontextmenu=function(v){v=nexacro._toBoolean(v);if(this.usecontextmenu!=v){this.usecontextmenu=v;}};_pMaskEdit.set_cursor=function(v){this.cursor=v;if(v){if(this._cursor==null||this._cursor.value!=v){if(this.enable&&v=="auto"){v="text";}var cursor=nexacro.CursorObject(v);this._cursor=cursor;this.on_apply_cursor(cursor);}}else{if(this._cursor){this._cursor=null;this.on_apply_cursor(null);}}};_pMaskEdit.on_apply_textAlign=function(halign){var input_elem=this._input_element;if(input_elem){input_elem.setElementTextAlign(halign);}};_pMaskEdit.on_apply_padding=function(padding){var input_elem=this._input_element;if(input_elem){input_elem.setElementPadding(padding);}};_pMaskEdit.on_apply_textDecoration=function(textDecoration){var input_elem=this._input_element;if(input_elem){input_elem.setElementTextDecoration(textDecoration);}};_pMaskEdit.getLength=function(){return (this.value?this.value.length:0);};_pMaskEdit.getCaretPos=function(){if(this.readonly){return  -1;}var input_elem=this._input_element;if(input_elem){var pos=input_elem.getElementCaretPos();if(pos&&pos!= -1){return pos.begin;}}return  -1;};_pMaskEdit.setCaretPos=function(v){var input_elem=this._input_element;if(input_elem){if(!this._onlydisplay){if(arguments.length==0){v=0;}else{v=nexacro._toInt(v);if(v== -1){if(v){v=this.text.length;}else{v=0;}}}input_elem.setElementSetSelect(v,v);}return true;}return false;};_pMaskEdit.getSelect=function(){var input_elem=this._input_element;if(input_elem){if(!this._onlydisplay){return input_elem.getElementSelectionRange();}}return [0,0];};_pMaskEdit.setSelect=function(start,end){var input_elem=this._input_element;if(input_elem){if(!this._onlydisplay){var txt=this.text?this.text:"";var txt_len=txt.length;if(nexacro._isNull(start)||start===""){start=0;}if(nexacro._isNull(end)||end===""){end= -1;}if(!nexacro._isNumber(start)){start=nexacro._toInt(start);}if(!nexacro._isNumber(end)){end=nexacro._toInt(end);}if(start== -1){start=txt_len;}if(end== -1){end=txt_len;}if(start>end){var tmp=start;start=end;end=tmp;}input_elem.setElementSetSelect(start,end);}return true;}return false;};_pMaskEdit.getSelectedText=function(){var input_elem=this._input_element;if(input_elem){if(!this._onlydisplay){var sel=input_elem.getElementSelectionRange();var start=sel[0],end=sel[1];var text=this.text;if(text&&(start!=end)){return text.substring(start,end);}}}return "";};_pMaskEdit.updateToDataset=function(){this._result_updateToDataset=this.applyto_bindSource("value",this.value);if(this._result_updateToDataset){this._default_value=this.value;this._default_text=this.text;}this._processing_updateToDataset=true;return this._result_updateToDataset;};_pMaskEdit._on_value_change=function(pretext,prevalue,posttext,postvalue){var ret=true;if(!this.on_fire_canchange(this,pretext,prevalue,posttext,postvalue)){ret=false;}if(ret){this._default_value=postvalue;this._default_text=posttext;if(this._processing_updateToDataset&&!this._result_updateToDataset&&prevalue===postvalue){this._processing_updateToDataset=false;this._result_updateToDataset=true;return false;}else if(!this.applyto_bindSource("value",postvalue)){ret=false;}if(ret){var maskobj=this._getMaskObj();if(maskobj){posttext=(this.trimtype!="none")?maskobj.applyMask(postvalue):posttext;}this._default_text=posttext;this.text=posttext;this.on_fire_onchanged(this,pretext,prevalue,posttext,postvalue);this._updateAccessibilityLabel();}}if(!ret){this._default_value=prevalue;this._default_text=pretext;}return ret;};_pMaskEdit._on_input_undo=function(item){if(this.readonly||!this._isEnable()){return;}var input_elem=this._input_element;if(input_elem){if(item){input_elem.updateElementText(item.value,item.end);input_elem.setElementSetSelect(item.start,item.end);return true;}}};_pMaskEdit._on_input_redo=function(item){if(this.readonly||!this._isEnable()){return;}var input_elem=this._input_element;if(input_elem){if(item){input_elem.updateElementText(item.value,item.end);input_elem.setElementSetSelect(item.start,item.end);return true;}}};_pMaskEdit._on_input_autoskip=function(){var maskobj=this._getMaskObj();if(maskobj){if(this.autoskip&&maskobj.isFilled()){this._setFocusToNextComponent();}}};_pMaskEdit.on_keydown_basic_action=function(keycode,alt_key,ctrl_key,shift_key){if(this.readonly||!this._isEnable()){return;}var input_elem=this._input_element;if(input_elem){if(!alt_key&&!shift_key&&ctrl_key&&keycode==90){if(this._undostack){this._undostack.undo();input_elem.stopSysEvent();return;}}else if(!alt_key&&!shift_key&&ctrl_key&&keycode==89){if(this._undostack){this._undostack.redo();input_elem.stopSysEvent();return;}}if(this._undostack){var pos=input_elem.getElementCaretPos();if(pos&&pos!= -1){this._undostack.update(pos.begin,pos.end);}}}};_pMaskEdit.on_keydown_default_action=function(keycode){if(this.readonly||!this._isEnable()){return;}var input_elem=this._input_element;if(input_elem){var maskobj=this._getMaskObj();var input_value=input_elem.value;var pos=input_elem.getElementCaretPos();var idx,ch;if(keycode==nexacro.KeyCode_ImeInput&&this._imedisable){input_elem.stopSysEvent();}else if(keycode==nexacro.Event.KEY_RETURN){var pre_value=this._default_value;var pre_text=this._default_text;var cur_value=this.value;var cur_text=this.text;if(pre_value!=cur_value||cur_text!=pre_text){if(!this._on_value_change(pre_text,pre_value,cur_text,cur_value)){this.value=pre_value;this.text=pre_text;}input_elem.setElementValue(this.text);}}else if(keycode==nexacro.Event.KEY_BACKSPACE){if(maskobj&&input_value){if(pos.end>0&&pos.begin==pos.end){idx=pos.end-1;while((ch=input_value.charAt(idx))){if(maskobj.isDeletableChar(ch,idx)||idx==0){break;}idx-- ;}if(idx!=(pos.end-1)){input_elem.setElementSetSelect(idx+1,idx+1);}}}}else if(keycode==nexacro.Event.KEY_DEL){if(maskobj&&input_value){var len=input_value.length;if(pos.end<len&&pos.begin==pos.end){idx=pos.end;while((ch=input_value.charAt(idx))){if(maskobj.isDeletableChar(ch,idx)||idx==len){break;}idx++ ;}if(idx!=pos.end){input_elem.setElementSetSelect(idx,idx);}}}}}};_pMaskEdit.on_keypress_basic_action=function(keycode,charcode,alt_key,ctrl_key){var input_elem=this._input_element;if(input_elem){if(keycode==nexacro.Event.KEY_TAB){if(!this._getDlgCode().want_tab){input_elem.stopSysEvent();return;}}if(keycode!==0&&charcode===0){return true;}else{if(keycode==nexacro.Event.KEY_ENTER||keycode==nexacro.Event.KEY_ESC){return true;}}charcode=charcode||keycode;if(!ctrl_key&&!alt_key&&charcode){var input_char=String.fromCharCode(charcode);if(input_char.length>0){var maskobj=this._getMaskObj();var pos=input_elem.getElementCaretPos();var input_pos=maskobj.findNearEditablePos(pos.begin,1);if(input_pos<0||maskobj.isFilterChar(input_char,input_pos,pos.end)){input_elem.stopSysEvent();this._on_input_autoskip();return;}maskobj.keyPressed(input_char,input_pos);}}}};_pMaskEdit.on_beforekeyinput_basic_action=function(value,status,begin,end,inputType){if(this.readonly||!this._isEnable()){return 0;}var input_elem=this._input_element;if(input_elem){if(input_elem._use_event_beforeinput){return this._beforeinput_process_with_HTMLEvent(value,status,begin,end,inputType);}else{return this._beforeinput_process_with_NexacroInputEvent(value,status,begin,end);}}};_pMaskEdit.on_keyinput_basic_action=function(){if(this.readonly||!this._isEnable()){return false;}var input_elem=this._input_element;if(input_elem){var input_value=input_elem.value;var input_text=input_value?input_value:"";var maskobj=this._getMaskObj();if(maskobj){input_value=maskobj.removeMask(input_text);}if(this.clipmode=="includespace"){var trimtype=this.trimtype;if(trimtype=="both"){input_value=input_value.replace(/^\s+|\s+$/g,"");}else if(trimtype=="left"){input_value=input_value.replace(/^\s+/,"");}else if(trimtype=="right"){input_value=input_value.replace(/\s+$/,"");}}if(!input_value&&!this._default_value&&!this._default_text){this.value=this._default_value;}else{this.value=input_value;}this.text=input_text;if(this._undostack){var pos=input_elem.getElementCaretPos();if(pos&&pos!= -1){this._undostack.push(input_text,pos.begin,pos.end);}else{this._undostack.push(input_text,0,0);}}}};_pMaskEdit.on_keyinput_default_action=function(){if(this.readonly||!this._isEnable()){return false;}var input_elem=this._input_element;if(input_elem){this._on_input_autoskip();}};_pMaskEdit.on_killfocus_basic_action=function(new_focus,new_refer_focus){var root_comp=this._getRootComponent(this);if(root_comp==new_focus){if(this.parent&&(!this.parent._is_subcontrol||this.parent==new_refer_focus.parent)){return;}}var input_elem=this._input_element;if(input_elem){var pre_value=this._default_value;var pre_text=this._default_text;var cur_value=this.value;var cur_text=this.text;if(pre_value!=cur_value||cur_text!=pre_text){if(!this._on_value_change(pre_text,pre_value,cur_text,cur_value)){this.value=pre_value;}}cur_value=this.value;var maskobj=this._getMaskObj();var is_invalidvalue=this._isInvalidValue(cur_value);if(maskobj){maskobj.setEditStatus(false);if(is_invalidvalue){cur_text=maskobj.applyMask("");}else{cur_text=maskobj.applyMask(cur_value);}this.text=cur_text;if(!this._onlydisplay){if(nexacro._isNull(cur_value)){input_elem.setElementDefaultValue(cur_text);cur_text=cur_value;}input_elem.setElementValue(cur_text,is_invalidvalue);}else{if(this.displaynulltext&&nexacro._isNull(cur_value)){input_elem.setElementText(this.displaynulltext);}else{if(this.displayinvalidtext&&is_invalidvalue){input_elem.setElementText(this.displayinvalidtext);}else{input_elem.setElementText(cur_text);}}}}if(!this._onlydisplay){if(nexacro._isNull(this.value)){this._changeUserStatus("nulltext",true);}else{this._changeUserStatus("nulltext",false);if(this._isInvalidValue(this.value)){this._changeUserStatus("invalidtext",true);}else{this._changeUserStatus("invalidtext",false);}}if(nexacro._enableaccessibility&&nexacro._Browser=="Runtime"&&nexacro._accessibilitytype==5){this._setAccessibilityStatKillFocus();}var _win=this._getRootWindow();var idx=_win._indexOfCurrentFocusPaths(this);if(idx<0){input_elem.setElementBlur();}}}};_pMaskEdit.on_click_basic_action=function(elem,button){var input_elem=this._input_element;if(input_elem){var _window=this._getWindow();if(_window&&this._track_capture){var capture_comp=_window._getCaptureComp(true,false,this);if(!this._onlydisplay&&(!capture_comp||capture_comp==this)){input_elem.setElementFocus(button);}}}};_pMaskEdit.on_fire_onclick=function(button,alt_key,ctrl_key,shift_key,screenX,screenY,canvasX,canvasY){if(this.oneditclick&&this.oneditclick._has_handlers){var caretpos=this.getCaretPos();var clientXY=this._getClientXY(canvasX,canvasY);var evt=new nexacro.EditClickEventInfo(this,"oneditclick",caretpos,button,alt_key,ctrl_key,shift_key,screenX,screenY,canvasX,canvasY,clientXY[0],clientXY[1],this,this);return this.oneditclick._fireEvent(this,evt);}return true;};_pMaskEdit.on_fire_oninput=function(){if(this.oninput&&this.oninput._has_handlers){var evt=new nexacro.InputEventInfo(this,"oninput");return this.oninput._fireEvent(this,evt);}return true;};_pMaskEdit.on_fire_canchange=function(obj,pretext,prevalue,posttext,postvalue){if(this.canchange&&this.canchange._has_handlers){var evt=new nexacro.ChangeEventInfo(obj,"canchange",pretext,prevalue,posttext,postvalue);return this.canchange._fireCheckEvent(this,evt);}return true;};_pMaskEdit.on_fire_onchanged=function(obj,pretext,prevalue,posttext,postvalue){if(this.onchanged&&this.onchanged._has_handlers){var evt=new nexacro.ChangeEventInfo(obj,"onchanged",pretext,prevalue,posttext,postvalue);return this.onchanged._fireEvent(this,evt);}};_pMaskEdit._convertValueType=function(v,bapplyrule){if(nexacro._isNull(v)){return v;}var ret;var datatyperule=nexacro._getDatatypeRule();if(bapplyrule){if(datatyperule=="1.0"){return v;}}ret=nexacro._toString(v).replace(/&quot;/g,"\"");return ret;};_pMaskEdit._setValue=function(v){var text="";if(!nexacro._isNull(v)){text=nexacro._toString(v);}this.text=text;this.value=v;this.on_apply_value(v);};_pMaskEdit._setLocale=function(v){if(!this.locale&&v!=this._locale){this._locale=v;this.on_apply_locale(v);this.on_apply_value(this.value);}};_pMaskEdit._setEnableView=function(v){var input_elem=this._input_element;if(input_elem){if(!this._onlydisplay){input_elem.setElementEnable(v);}}};_pMaskEdit._setDefaultCaret=function(){this.setCaretPos(0);};_pMaskEdit._setFocusToNextComponent=function(){var root_comp=this._getRootComponent(this);var next_comp=this._getForm()._getNextComponent(root_comp,true,true);if(next_comp){next_comp.setFocus();if(!next_comp.autoselect&&next_comp._is_editable_control){next_comp._setDefaultCaret();}}};_pMaskEdit._on_apply_inputtype=function(){var maskobj=this._getMaskObj();var input_elem=this._input_element;if(maskobj&&input_elem){var mode=maskobj.getInputMode();if(!this._onlydisplay){input_elem.setElementInputType(mode,true);}}};_pMaskEdit._getMaskObj=function(){var maskobj=this._masktypeobj;if(maskobj){return maskobj;}return null;};_pMaskEdit._getEmptyText=function(){var maskobj=this._masktypeobj;if(maskobj){return maskobj.applyMask("");}return "";};_pMaskEdit._beforeinput_process_with_HTMLEvent=function(value,status,begin,end,inputType){var input_elem=this._input_element;var maskobj=this._getMaskObj();var ret=[];if(maskobj){var input_value=input_elem._getInputValue();var front_text,rear_text,update_value,result,input_pos;switch(inputType){case "deleteContentBackward":if(begin==end){front_text=input_value.substring(0,begin-1);rear_text=input_value.substring(end);update_value=front_text+rear_text;result=maskobj.arrangeMask(update_value,begin-1,begin-1);input_elem._beforeinput_result_data=result.text;input_elem._beforeinput_result_pos={begin:result.pos,end:result.pos};}else{front_text=input_value.substring(0,begin);rear_text=input_value.substring(end);update_value=front_text+rear_text;if((end-begin==input_value.length)){input_elem._beforeinput_result_data=maskobj.applyMask(update_value);input_elem._beforeinput_result_pos={begin:begin,end:begin};}else{result=maskobj.arrangeMask(update_value,begin,begin);input_elem._beforeinput_result_data=result.text;input_elem._beforeinput_result_pos={begin:result.pos,end:result.pos};}}ret.push(input_elem._BeforeinputState.REPLACE);break;case "deleteContentForward":if(begin==end){front_text=input_value.substring(0,begin);rear_text=input_value.substring(end+1);update_value=front_text+rear_text;result=maskobj.arrangeMask(update_value,begin,begin);input_elem._beforeinput_result_data=result.text;input_elem._beforeinput_result_pos={begin:result.pos,end:result.pos};}else{front_text=input_value.substring(0,begin);rear_text=input_value.substring(end);update_value=front_text+rear_text;if((end-begin==input_value.length)){input_elem._beforeinput_result_data=maskobj.applyMask(update_value);input_elem._beforeinput_result_pos={begin:begin,end:begin};}else{result=maskobj.arrangeMask(update_value,begin,begin);input_elem._beforeinput_result_data=result.text;input_elem._beforeinput_result_pos={begin:result.pos,end:result.pos};}}ret.push(input_elem._BeforeinputState.REPLACE);break;case "deleteByCut":front_text=input_value.substring(0,begin);rear_text=input_value.substring(end);update_value=front_text+rear_text;if((end-begin==input_value.length)){input_elem._beforeinput_result_data=maskobj.applyMask(update_value);input_elem._beforeinput_result_pos={begin:begin,end:begin};}else{result=maskobj.arrangeMask(update_value,begin,begin);input_elem._beforeinput_result_data=result.text;input_elem._beforeinput_result_pos={begin:result.pos,end:result.pos};}ret.push(input_elem._BeforeinputState.REPLACE);break;case "insertText":case "insertCompositionText":value=value?value:"";input_pos=maskobj.findNearEditablePos(begin,1);if(input_pos<0||maskobj.isFilterChar(value,input_pos)){ret.push(input_elem._BeforeinputState.CANCEL);}else{if(this.type=="number"){update_value=input_value.substring(0,begin)+value+input_value.substring(end);result=maskobj.arrangeMask(update_value,begin,end+value.length);if(result==null){ret.push(input_elem._BeforeinputState.CANCEL);}else if(result.text!=update_value){input_elem._beforeinput_result_data=result.text;input_elem._beforeinput_result_pos={begin:result.pos,end:result.pos};ret.push(input_elem._BeforeinputState.REPLACE);}else{ret.push(input_elem._BeforeinputState.PASS);}}else{if(begin==end){update_value=input_value.substring(0,begin)+value+input_value.substring(end);end=end+value.length;}else{update_value=input_value.substring(0,begin)+value+input_value.substring(end,input_value.length);end=begin+value.length;}result=maskobj.arrangeMask(update_value,begin,end);if(result==null){ret.push(input_elem._BeforeinputState.CANCEL);}else{input_pos=maskobj.findNearEditablePos(result.pos,1);input_elem._beforeinput_result_data=result.text;input_elem._beforeinput_result_pos={begin:input_pos,end:input_pos};ret.push(input_elem._BeforeinputState.REPLACE);}}}break;case "insertFromPaste":input_pos=maskobj.findNearEditablePos(begin,1);if(input_pos<0||maskobj.isFilterChar(value,input_pos)){ret.push(input_elem._BeforeinputState.CANCEL);}else{if(this.type=="number"){update_value=input_value.substring(0,begin)+value+input_value.substring(end);result=maskobj.arrangeMask(update_value,begin,end+value.length);if(result==null){ret.push(input_elem._BeforeinputState.CANCEL);}else if(result.text!=update_value){input_elem._beforeinput_result_data=result.text;input_elem._beforeinput_result_pos={begin:result.pos,end:result.pos};ret.push(input_elem._BeforeinputState.REPLACE);}else{ret.push(input_elem._BeforeinputState.PASS);}}else{if(begin==end){update_value=input_value.substring(0,begin)+value+input_value.substring(end);end=end+value.length;}else{update_value=input_value.substring(0,begin)+value+input_value.substring(begin);end=begin+value.length;}result=maskobj.arrangeMask(update_value,begin,end);if(result==null){ret.push(input_elem._BeforeinputState.CANCEL);}else{input_pos=maskobj.findNearEditablePos(result.pos,1);input_elem._beforeinput_result_data=result.text;input_elem._beforeinput_result_pos={begin:input_pos,end:input_pos};ret.push(input_elem._BeforeinputState.REPLACE);}}}break;default:ret.push(input_elem._BeforeinputState.PASS);break;}}return ret;};_pMaskEdit._beforeinput_process_with_NexacroInputEvent=function(value,status,begin,end){var input_elem=this._input_element;var input_text=value?value:"";var maskobj=this._getMaskObj();if(maskobj){var result=maskobj.arrangeMask(input_text,begin,end);if(result==null){input_elem.replaceElementText("",begin,end);input_elem.stopSysEvent();}else{var input_pos=maskobj.findNearEditablePos(result.pos,1);if(result.text!=input_text||result.pos!=input_pos){input_elem.updateElementText(result.text,input_pos);}if(result.text==this.text){var input_value=maskobj.removeMask(result.text);if(this.clipmode=="includespace"){var trimtype=this.trimtype;if(trimtype=="both"){input_value=input_value.replace(/^\s+|\s+$/g,"");}else if(trimtype=="left"){input_value=input_value.replace(/^\s+/,"");}else if(trimtype=="right"){input_value=input_value.replace(/\s+$/,"");}}this.value=input_value;}}}};_pMaskEdit._isInvalidValue=function(v){if(nexacro._isNull(v)||v===""){return false;}if(this.type=="number"){if(!isFinite( +v)||isNaN( +v)){return true;}}else{v=v+"";var maskobj=this._getMaskObj();if(maskobj){maskobj.applyMask(v);if(maskobj._is_mismatch){return true;}}}return false;};_pMaskEdit._on_input_compositionend=function(value){var input_elem=this._input_element;if(input_elem){if(this._undostack){var pos=input_elem.getElementCaretPos();if(pos&&pos!= -1){this._undostack.push(value,pos.begin,pos.end);}else{this._undostack.push(value,0,0);}}}};_pMaskEdit=null;}
if(!nexacro.TextArea){nexacro.TextArea=function(id,left,top,width,height,right,bottom,minwidth,maxwidth,minheight,maxheight,parent,onlydisplay){nexacro.Component.call(this,id,left,top,width,height,right,bottom,minwidth,maxwidth,minheight,maxheight,parent);this._onlydisplay=onlydisplay;if(onlydisplay){this._apply_client_padding=true;this.readonly=true;}};var _pTextArea=nexacro._createPrototype(nexacro.Component,nexacro.TextArea);nexacro.TextArea.prototype=_pTextArea;nexacro.TextArea._TAB_CHAR='\u0009';_pTextArea._type_name="TextArea";_pTextArea.acceptstab=false;_pTextArea.autoselect=false;_pTextArea.autoskip=false;_pTextArea.displaynulltext="";_pTextArea.displayinvalidtext=undefined;_pTextArea.usesoftkeyboard=true;_pTextArea.dragscrolltype="both";_pTextArea.imemode="none";_pTextArea.inputfilter="none";_pTextArea.inputmode="normal";_pTextArea.inputtype="normal";_pTextArea.maxlength=0;_pTextArea.readonly=false;_pTextArea.usecontextmenu=true;_pTextArea.useime="global";_pTextArea.text="";_pTextArea.value=undefined;_pTextArea._input_element=null;_pTextArea._inputfilter_obj=null;_pTextArea._inputtype_obj=null;_pTextArea._undostack=null;_pTextArea._default_value=undefined;_pTextArea._default_text="";_pTextArea._keypad_type="text";_pTextArea._imedisable=false;_pTextArea._want_tab=true;_pTextArea._is_set_value=false;_pTextArea._update_scroll_lock=false;_pTextArea._processing_updateToDataset=false;_pTextArea._result_updateToDataset=true;_pTextArea._apply_filter=true;_pTextArea._onlydisplay=false;_pTextArea._apply_client_padding=false;_pTextArea._has_inputElement=true;_pTextArea._is_scrollable=true;_pTextArea._is_editable_control=true;_pTextArea._use_translate_scroll=false;_pTextArea._use_container_move=false;_pTextArea._use_readonly_status=true;if((nexacro._Browser=="IE"&&nexacro._BrowserVersion<10)||nexacro._BrowserType=="Edge"){_pTextArea._use_focus_caret=true;_pTextArea._caret_pos= -1;}else{_pTextArea._use_focus_caret=false;_pTextArea._caret_pos= -1;}_pTextArea._event_list={"oneditclick":1,"onkeydown":1,"onkeyup":1,"onkillfocus":1,"onsetfocus":1,"ondrag":1,"ondragenter":1,"ondragleave":1,"ondragmove":1,"ondrop":1,"onlbuttondown":1,"onlbuttonup":1,"onrbuttondown":1,"onrbuttonup":1,"onmousedown":1,"onmouseup":1,"onmouseenter":1,"onmouseleave":1,"onmousemove":1,"onmove":1,"onsize":1,"canchange":1,"onchanged":1,"oninput":1,"onmousewheel":1,"oncontextmenu":1,"onvscroll":1,"onhscroll":1,"ontouchstart":1,"ontouchmove":1,"ontouchend":1};_pTextArea.accessibilityrole="textarea";_pTextArea.on_create_contents=function(){var control=this.getElement();if(control){var input_elem;if(!this._onlydisplay){input_elem=this._input_element=new nexacro.TextAreaElement(control,"textarea");input_elem.setElementAutoSkip(this.autoskip);input_elem.setElementAutoSelect(this.autoselect);input_elem.setElementUseIme(this.useime);input_elem.setElementImeMode(this.imemode);input_elem.setElementReadonly(this.readonly);input_elem.setElementDisplayNullText(this.displaynulltext);input_elem.setElementMaxLength(this.maxlength);if((this.inputtype.indexOf("normal")>=0)||(this.inputtype.indexOf("full")>=0)){input_elem._inputtype="text";}else{input_elem._inputtype="";}input_elem.setElementInputType(this._keypad_type,this._imedisable);}else{input_elem=this._input_element=new nexacro.TextBoxElement(control,"textarea");input_elem.setElementVerticalAlign("top");}input_elem.setElementPosition(this._getClientLeft(),this._getClientTop());input_elem.setElementSize(this._getClientWidth(),this._getClientHeight());input_elem.setElementTextDecoration(this._textdecoration);input_elem.setElementTextAlign(this.textAlign);input_elem.setElementPadding(this.padding);var wordwrap_info=this._getCSSStyleValue("wordWrap");if(wordwrap_info){input_elem.setElementCSSMapInfo(wordwrap_info);}if(this.wordWrap){input_elem.setElementWordWrap(this.wordWrap);}this._undostack=new nexacro._EditUndoStack(this);}};_pTextArea.on_created_contents=function(win){var input_elem=this._input_element;if(input_elem){var wordwrap_info=this.wordWrap||this._getCSSStyleValue("wordWrap");if(this._hscrollbartype&&this._hscrollbartype.indexOf("auto")> -1&&(wordwrap_info!="none"&&wordwrap_info!==undefined)){this._hscrollbartype="none";}this.on_apply_padding(this._padding);this.on_apply_value(this.value);input_elem.create(win);this.set_usesoftkeyboard(this.usesoftkeyboard,true);if(nexacro._isNull(this.value)){this._changeUserStatus("nulltext",true);}if(nexacro._enableaccessibility){if(this.readonly){this._setAccessibilityFlagReadOnly(this.readonly);}this._setAccessibilityFlagMultiLine(true);}this.on_apply_scrollbartype();this._onResetScrollBar();this._onRecalcScrollSize();}};_pTextArea.on_destroy_contents=function(){var input_elem=this._input_element;if(input_elem){input_elem.destroy();this._input_element=null;}var undostack=this._undostack;if(undostack){undostack.destroy();this._undostack=null;}var inputfilterobj=this._inputfilter_obj;if(inputfilterobj){this._inputfilter_obj=null;}var inputtypeobj=this._inputtype_obj;if(inputtypeobj){this._inputtype_obj=null;}var vscroll_animationframe=this._vscroll_animationframe;if(vscroll_animationframe){vscroll_animationframe.destroy();}var hscroll_animationframe=this._hscroll_animationframe;if(hscroll_animationframe){hscroll_animationframe.destroy();}};_pTextArea.on_create_contents_command=function(){var input_elem=this._input_element;if(input_elem){var wordwrap_info=this.wordWrap||this._getCSSStyleValue("wordWrap");if(this._hscrollbartype&&this._hscrollbartype.indexOf("auto")> -1&&(wordwrap_info!="none"&&wordwrap_info!==undefined)){this._hscrollbartype="none";}this.on_apply_padding(this._padding);return input_elem.createCommand();}return "";};_pTextArea.on_attach_contents_handle=function(win){var input_elem=this._input_element;if(input_elem){input_elem.attachHandle(win);this.on_apply_value(this.value);if(nexacro._isNull(this.value)){this._changeUserStatus("nulltext",true);}}if(nexacro._enableaccessibility){if(this.readonly){this._setAccessibilityFlagReadOnly(this.readonly);}this._setAccessibilityFlagMultiLine(true);}this.on_apply_scrollbartype();this._onRecalcScrollSize();this._onResetScrollBar();};_pTextArea.on_change_containerRect=function(width,height){var input_elem=this._input_element;if(input_elem){input_elem.setElementSize(width,height);if(this._update_scroll_lock==true){return false;}this._update_scroll_lock=true;this._onRecalcScrollSize();this._onResetScrollBar();this._update_scroll_lock=false;}};_pTextArea.on_change_containerPos=function(left,top){if(this.onlydisplay){var input_elem=this._input_element;if(input_elem){input_elem.setElementPosition(left,top);}}};_pTextArea.on_notify_vscroll_onscroll=function(obj,e){this._scrollTo(this._hscroll_pos,e.pos,false,false,e.type,e._evtkind);var control_elem=this._control_element;if(control_elem){this._input_element.setElementVScrollPos(e.pos);}};_pTextArea._apply_setfocus=function(evt_name,self_flag){this._processing_updateToDataset=false;var input_elem=this._input_element;if(input_elem){input_elem.on_apply_imeSet();input_elem.on_apply_force_imeSet();this._want_tab=true;if(evt_name){this._default_value=this.value;this._default_text=this.text;}var win=this._getWindow();if(win){var ldown_comp=win._cur_ldown_elem?win._cur_ldown_elem.linkedcontrol:null;if(!(ldown_comp&&ldown_comp instanceof nexacro.ScrollBarControl)){if(!this._onlydisplay){input_elem.setElementFocus(evt_name,self_flag);}}}if(!this._onlydisplay){this._changeUserStatus("nulltext",false);var text=input_elem.getElementText();if(text!=this.text){this._default_text=this.text=text;}}if(nexacro._needAdjustScrollPosition(this._is_set_value)){this._adjust_scrollPosition(input_elem,evt_name);}if(!this._onlydisplay&&!this.autoselect){if(this._use_focus_caret){if(this._caret_pos== -1){input_elem.setElementSetSelect(this.value?this.value.length:0);}else{input_elem.setElementSetSelect(this._caret_pos.begin,this._caret_pos.end);}}else if(this._caret_pos== -1){input_elem.setElementSetSelect(this.value?this.value.length:0);}}}};_pTextArea.on_apply_status=function(status,userstatus){var input_elem=this._input_element;if(input_elem){if(!this.wordWrap){var wordwrap_info=this._getCSSStyleValue("wordWrap",status,userstatus);if(wordwrap_info){input_elem.setElementCSSMapInfo(wordwrap_info);}}}};_pTextArea.on_getBindableProperties=function(){return "value";};_pTextArea.on_apply_prop_enable=function(v){var input_elem=this._input_element;if(input_elem){var color=this._getCSSStyleValue("color");if(!this._onlydisplay){input_elem.setElementEnable(v,color);}}};_pTextArea.on_init_bindSource=function(columnid,propid,ds){if(propid=="value"){if(this._undostack){this._undostack.clear();}this._setValue(undefined);}};_pTextArea.on_change_bindSource=function(propid,ds,row,col,index){if(propid=="value"){var input_elem=this._input_element;if(input_elem){if(!this._onlydisplay){input_elem.setCompositionComplete();}}var v=ds.getColumn(row,col);v=this._convertValueType(v,true);if(v==this.value){return;}if(this._undostack){this._undostack.clear();}var _bSetselect=false;if(this.value!=v){_bSetselect=true;}this._setValue(v);if(input_elem&&_bSetselect&&!this._onlydisplay){input_elem.setElementSetSelect(this.value?this.value.length:0);this._caret_pos=input_elem.getElementCaretPos();}}};_pTextArea.on_changeUserStatus=function(changestatus,value,applyuserstatus,currentstatus,currentuserstatus){if(value){return changestatus;}else{return applyuserstatus;}};_pTextArea._onRecalcScrollSize=function(){if(this._onlydisplay){return;}var control_elem=this.getElement();var input_elem=this._input_element;var target_arr=null;var client_width=control_elem.getClientWidth();var client_height=control_elem.getClientHeight();if(client_width<=0||client_height<=0){return;}if(control_elem&&input_elem){var max_width;var max_height;target_arr=nexacro._get_invisible_obj(this);nexacro._reset_invisible_obj(target_arr,true);var hscrollbar=this.hscrollbar;var vscrollbar=this.vscrollbar;var pre_vscrollmax=vscrollbar?vscrollbar._max:0;max_width=input_elem.getElementScrollWidth();max_height=input_elem.getElementScrollHeight();control_elem.setElementScrollMaxSize(max_width,max_height);var pos;var pThis=this;if(vscrollbar){if(pre_vscrollmax!=vscrollbar._max){var textsize=nexacro._getTextSize("A",this._getCurrentStyleInheritValue("font"),false,undefined,"none",this._getCurrentStyleInheritValue("wordSpacing"),this._getCurrentStyleInheritValue("letterSpacing"));var padding=this._getCSSStyleValue("padding");var clientheight=control_elem.getClientHeight();var nodeheight=padding?clientheight-(padding.top+padding.bottom):clientheight;var caretline=this._getCaretLine();var viewstart=vscrollbar._pos?vscrollbar._pos/textsize[1]:0;var viewcount=clientheight/textsize[1];if(viewstart+viewcount<caretline){vscrollbar.set_pos(textsize[1]*caretline-nodeheight);}}else{pos=input_elem.getElementVScrollPos();if(vscrollbar._pos!=pos){vscrollbar.set_pos(pos);}}}if(hscrollbar){pos=input_elem.getElementHScrollPos();if(hscrollbar._pos!=pos){var hscroll_animationframe=this._hscroll_animationframe;if(!hscroll_animationframe){hscroll_animationframe=this._hscroll_animationframe=new nexacro.AnimationFrame(pThis,hscrollbar.set_pos(pos));}else{hscroll_animationframe._setCallback(hscrollbar.set_pos(pos));}if(hscroll_animationframe.callback){hscroll_animationframe.start();}}}}if(target_arr){nexacro._reset_invisible_obj(target_arr,false);}};_pTextArea._getDlgCode=function(keycode,altKey,ctrlKey,shiftKey){var want_arrow=true;var elem;if(nexacro._enableaccessibility){if(!this._onlydisplay){if(keycode==nexacro.Event.KEY_UP){elem=this._input_element;if((elem&&elem.isFirstCaretLine())||!elem){want_arrow=false;}}else if(keycode==nexacro.Event.KEY_DOWN){elem=this._input_element;if(!this.enable||(elem&&elem.isLastCaretLine())||!elem){want_arrow=false;}}}}if(keycode==nexacro.Event.KEY_TAB){if(this.readonly){this._want_tab=false;}}return {want_tab:this._want_tab,want_return:false,want_escape:false,want_chars:false,want_arrows:want_arrow};};_pTextArea._getDragData=function(){return this.getSelectedText();};_pTextArea.on_get_accessibility_label=function(){var label="";return label;};_pTextArea.set_text=nexacro._emptyFn;_pTextArea.set_value=function(v){v=this._convertValueType(v);if(v){if(v.indexOf("\r\n")!= -1||v.indexOf("\n\r")!= -1){v=v.replace(/\r\n|\n\r/g,"\n");}if(v.indexOf("\r")!= -1){v=v.replace(/\r/g,"");}}if(this.value!==v){if(!this.applyto_bindSource("value",v)){return;}this._setValue(v);this._is_set_value=true;}};_pTextArea.on_apply_value=function(value){var input_elem=this._input_element;if(input_elem){var pos=input_elem.getElementCaretPos();var text=this.text;value=value?this.text:value;if(this._is_created&&nexacro._isNull(this.value)){this._changeUserStatus("nulltext",true);}else{this._changeUserStatus("nulltext",false);}if(!this._onlydisplay){if(this._undostack){if(pos&&pos!= -1){this._undostack.push(value,pos.begin,pos.end);}else{this._undostack.push(value,0,0);}}input_elem.setElementValue(value);text=input_elem.getElementText();}else{if(this.displaynulltext&&nexacro._isNull(this.value)){input_elem.setElementText(this.displaynulltext);}else{input_elem.setElementText(value);}}if(this.text!=text){this.text=text;}this._updateAccessibilityLabel();this._default_value=this.value;this._default_text=this.text;if(this._is_created){this._onRecalcScrollSize();this._onResetScrollBar();}pos=input_elem.getElementCaretPos();if(pos&&pos!= -1){this._caret_pos=pos;}}};_pTextArea.set_displaynulltext=function(v){if(this.displaynulltext!=v){this.displaynulltext=v;this.on_apply_displaynulltext(v);}};_pTextArea.on_apply_displaynulltext=function(displaynulltext){var input_elem=this._input_element;if(input_elem){if(this._onlydisplay){this.on_apply_value(this.value);}else{input_elem.setElementDisplayNullText(displaynulltext);}}};_pTextArea.set_usesoftkeyboard=function(v,bforce){v=nexacro._toBoolean(v);if(v!=this.usesoftkeyboard||bforce){this.usesoftkeyboard=v;this.on_apply_usesoftkeyboard(bforce);}};_pTextArea.on_apply_usesoftkeyboard=function(bforce){var input_elem=this._input_element;if(input_elem&&!this._onlydisplay){input_elem.setElementUseSoftKeyboard(this.usesoftkeyboard,bforce);}};_pTextArea.set_readonly=function(v){if(this._onlydisplay){return;}v=nexacro._toBoolean(v);if(this.readonly!=v){this.readonly=v;this.on_apply_readonly(v);}};_pTextArea.on_apply_readonly=function(readonly){this._changeStatus("readonly",readonly);var input_elem=this._input_element;if(input_elem&&!this._onlydisplay){input_elem.setElementReadonly(readonly);}};_pTextArea.set_autoselect=function(v){v=nexacro._toBoolean(v);if(this.autoselect!=v){this.autoselect=v;this.on_apply_autoselect(v);}};_pTextArea.on_apply_autoselect=function(autoselect){var input_elem=this._input_element;if(input_elem&&!this._onlydisplay){input_elem.setElementAutoSelect(autoselect);}};_pTextArea.set_autoskip=function(v){v=nexacro._toBoolean(v);if(this.autoskip!=v){this.autoskip=v;this.on_apply_autoskip(v);}};_pTextArea.on_apply_autoskip=function(autoskip){var input_elem=this._input_element;if(input_elem&&!this._onlydisplay){input_elem.setElementAutoSkip(autoskip);}};_pTextArea.set_inputmode=function(v){var inputmode_enum=["normal","upper","lower"];if(inputmode_enum.indexOf(v)== -1){return;}if(this.inputmode!=v){this.inputmode=v;}};_pTextArea.set_inputfilter=function(v){if(v){var inputfilter_arr=v.split(',');var inputfilter_enum=["none","alpha","digit","comma","dot","sign","space","symbol"];for(var i=0,len=inputfilter_arr.length;i<len;i++ ){if(inputfilter_enum.indexOf(inputfilter_arr[i])== -1){return;}}}else{return;}if(this.inputfilter!=v){this.inputfilter=v;this._inputfilter_obj=null;this.on_apply_inputfilter(v);}};_pTextArea.on_apply_inputfilter=function(inputfilter){this._inputfilter_obj=new nexacro._EditInputFilter(inputfilter);};_pTextArea.set_inputtype=function(v){if(v){var inputtype_arr=v.split(',');var inputtype_enum=["normal","alpha","english","digit","number","comma","dot","sign","space","symbol","half","full","numberandenglish"];for(var i=0,len=inputtype_arr.length;i<len;i++ ){if(inputtype_enum.indexOf(inputtype_arr[i])== -1){return;}}}else{return;}if(this.inputtype!=v){this.inputtype=v;this._inputtype_obj=null;this.on_apply_inputtype(v);}};_pTextArea.on_apply_inputtype=function(inputtype){this._inputtype_obj=new nexacro._EditInputType(inputtype);if(nexacro._isTouchInteraction&&nexacro._SupportTouch){this._imedisable=false;}else{this._imedisable=this._inputtype_obj.imedisable;}this._keypad_type=this._inputtype_obj.keypadtype;var input_elem=this._input_element;if(input_elem&&!this._onlydisplay){if((this.inputtype.indexOf("normal")>=0)||(this.inputtype.indexOf("full")>=0)){input_elem._inputtype="text";}else{input_elem._inputtype="";}input_elem.setElementInputType(this.password?"password":this._keypad_type,this._imedisable);}};_pTextArea.set_maxlength=function(v){if(isNaN(v= +v)||v<0){return;}if(this.maxlength!=v){this.maxlength=v;this.on_apply_maxlength(v);}};_pTextArea.on_apply_maxlength=function(maxlength){var input_elem=this._input_element;if(input_elem&&!this._onlydisplay){input_elem.setElementMaxLength(maxlength);}};_pTextArea.set_useime=function(v){v=nexacro._toBoolean(v);if(this.useime!=v){this.useime=v;this.on_apply_useime(v);}};_pTextArea.on_apply_useime=function(useime){var input_elem=this._input_element;if(input_elem&&!this._onlydisplay){input_elem.setElementUseIme(useime);}};_pTextArea.set_imemode=function(v){var imemode_enum=["none","alpha","alpha,full","hangul","hangul,full","katakana","katakana,full","hiragana","direct"];if(imemode_enum.indexOf(v)== -1){return;}if(this.imemode!=v){this.imemode=v;this.on_apply_imemode(v);}};_pTextArea.on_apply_imemode=function(imemode){var input_elem=this._input_element;if(input_elem&&!this._onlydisplay){input_elem.setElementImeMode(imemode);}};_pTextArea.on_apply_wordWrap=function(wordWrap){var input_elem=this._input_element;if(input_elem){input_elem.setElementWordWrap(wordWrap);}if(this._hscrollbartype&&this._hscrollbartype.indexOf("auto")> -1&&(this.wordWrap!="none"&&this.wordWrap==="")){this._hscrollbartype="none";}if(this._is_created){this._onRecalcScrollSize();}};_pTextArea.set_scrollbartype=function(v){v=nexacro._toString(v).trim();var new_vscrollbartype;var new_hscrollbartype;var arr=v.toLowerCase().split(" ");this.scrollbartype=v;for(var i=0;i<arr.length;i++ ){switch(arr[i]){case "none":case "auto":case "fixed":case "autoindicator":case "indicator":case "default":if(i==0){new_hscrollbartype=arr[i];}else if(i==1){new_vscrollbartype=arr[i];}break;default:break;}}if(!new_hscrollbartype&&!new_vscrollbartype){this._hscrollbartype=undefined;this._vscrollbartype=undefined;}else{if(!new_hscrollbartype||new_hscrollbartype=="default"){this._hscrollbartype=new_hscrollbartype=undefined;}else{this._hscrollbartype=new_hscrollbartype;}if(!new_vscrollbartype){this._vscrollbartype=new_hscrollbartype;}else if(new_vscrollbartype=="default"){this._vscrollbartype=undefined;}else{this._vscrollbartype=new_vscrollbartype;}}if(this._is_created&&new_hscrollbartype!="fixed"){var wordWrap=this.wordWrap||this._getCSSStyleValue("wordWrap");var bWordWrap=(wordWrap&&wordWrap!="none"&&wordWrap!="undefined");if(bWordWrap){this._hscrollbartype="none";}}this.on_apply_scrollbartype();return v;};_pTextArea.set_acceptstab=function(v){v=nexacro._toBoolean(v);if(this.acceptstab!=v){this.acceptstab=v;}};_pTextArea.set_dragscrolltype=function(v){nexacro.Form.prototype.set_dragscrolltype.call(this,v);};_pTextArea.set_usecontextmenu=function(v){v=nexacro._toBoolean(v);if(this.usecontextmenu!=v){this.usecontextmenu=v;}};_pTextArea.set_cursor=function(v){this.cursor=v;if(v){if(this._cursor==null||this._cursor.value!=v){if(this.enable&&v=="auto"){v="text";}var cursor=nexacro.CursorObject(v);this._cursor=cursor;this.on_apply_cursor(cursor);}}else{if(this._cursor){this._cursor=null;this.on_apply_cursor(null);}}};_pTextArea.on_apply_textAlign=function(halign){var input_elem=this._input_element;if(input_elem){input_elem.setElementTextAlign(halign);}};_pTextArea.on_apply_padding=function(padding){var input_elem=this._input_element;if(input_elem){input_elem.setElementPadding(padding);this._onRecalcScrollSize();}};_pTextArea.on_apply_textDecoration=function(textDecoration){var input_elem=this._input_element;if(input_elem){input_elem.setElementTextDecoration(textDecoration);}};_pTextArea.getLength=function(v){return (this.value?this.value.length:0);};_pTextArea.getCaretPos=function(){if(this.readonly){return  -1;}var input_elem=this._input_element;if(input_elem){var pos=input_elem.getElementCaretPos();if(pos&&pos!= -1){return pos.begin;}}return  -1;};_pTextArea.setCaretPos=function(v){var input_elem=this._input_element;if(input_elem){if(!this._onlydisplay){if(arguments.length==0){v=0;}else{v=nexacro._toInt(v);if(v== -1){if(v){v=this.text.length;}else{v=0;}}}input_elem.setElementSetSelect(v,v);if(v===0){this._setHscrollPos(0);this._setVscrollPos(0);}}return true;}return false;};_pTextArea.getSelect=function(){var input_elem=this._input_element;if(input_elem){if(!this._onlydisplay){return input_elem.getElementSelectionRange();}}return [0,0];};_pTextArea.setSelect=function(start,end){var input_elem=this._input_element;if(input_elem){if(!this._onlydisplay){var txt=this.text?this.text:"";var txt_len=txt.length;if(nexacro._isNull(start)||start===""){start=0;}if(nexacro._isNull(end)||end===""){end= -1;}if(!nexacro._isNumber(start)){start=nexacro._toInt(start);}if(!nexacro._isNumber(end)){end=nexacro._toInt(end);}if(start== -1){start=txt_len;}if(end== -1){end=txt_len;}if(start>end){var tmp=start;start=end;end=tmp;}input_elem.setElementSetSelect(start,end);}return true;}return false;};_pTextArea.getSelectedText=function(){var input_elem=this._input_element;if(input_elem){if(!this._onlydisplay){var sel=input_elem.getElementSelectionRange();var start=sel[0],end=sel[1];var text=this.text;if(text&&(start!=end)){return text.substring(start,end);}}}return "";};_pTextArea.setSelectedText=function(v){if(/\r\n|\n\r/.test(v)){v=v.replace(/\r\n|\n\r/g,"\n");}if(/\r/.test(v)){v=v.replace(/\r/g,"");}var input_elem=this._input_element;if(input_elem){if(!this._onlydisplay){var sel=input_elem.getElementSelectionRange();var start=sel[0],end=sel[1];if(start==end){return "";}var insertlen=v.length;var src=this.text.substring(start,end);var newtext=this.text;var newlen=newtext.length-(end-start)+insertlen;if(this.maxlength>0&&newlen>this.maxlength){v=v.substring(0,this.maxlength-insertlen);}newtext=newtext.substring(0,start)+v+newtext.substring(end);if(this.text!=newtext){this._setValue(newtext);input_elem.setElementSetSelect(start,start+insertlen);}return src;}}return "";};_pTextArea.insertText=function(insert_text,position){insert_text=nexacro._toString(insert_text);if(insert_text==null||insert_text==""){return;}var text=this.value||"";if(nexacro._isNull(position)||position===""){position=text.length;}else{position=nexacro._toInt(position);}if(position<0||position>text.length){position=text.length;}var input_elem=this._input_element;if(input_elem){if(insert_text!=""){if(/\r\n|\n\r/.test(insert_text)){insert_text=insert_text.replace(/\r\n|\n\r/g,"\n");}if(/\r/.test(insert_text)){insert_text=insert_text.replace(/\r/g,"");}}text=text.substring(0,position)+insert_text+text.substring(position);if(!this._onlydisplay){this._setValue(text);}else{}}};_pTextArea.deleteText=function(start,count){if(nexacro._isNull(start)){start=0;}else{start=nexacro._toInt(start);}if(nexacro._isNull(count)){count= -1;}else{count=nexacro._toInt(count);}var input_value=this.value||"";var len=input_value.length;if(count== -1){count=len-start;}if(count<0||start<0||start>=len){return;}var input_elem=this._input_element;if(input_elem){if(!this._onlydisplay){var text=input_value.substring(0,start)+input_value.substring(start+count);this._setValue(text);}else{}}};_pTextArea.find=function(text,start){start=nexacro._toInt(start)|0;text=nexacro._toString(text);if(start== -1){var input_elem=this._input_element;if(input_elem){if(!this._onlydisplay){var pos=input_elem.getElementCaretPos();if(pos&&pos!= -1){start=pos.begin;}}}}if(start<0){return  -1;}return text?this.text.indexOf(text,start): -1;};_pTextArea.replace=function(oldText,newText){if(newText==null){newText="";}oldText=nexacro._toString(oldText);newText=nexacro._toString(newText);var cur_text=this.value||"";var input_elem=this._input_element;if(input_elem&&oldText){var split_buf=cur_text.split(oldText);if(split_buf.length>1){cur_text=split_buf.join(newText);split_buf.pop();var newpos=split_buf.join(newText).length;if(!this._onlydisplay){if(cur_text!=""){if(/\r\n|\n\r/.test(cur_text)){cur_text=cur_text.replace(/\r\n|\n\r/g,"\n");}if(/\r/.test(cur_text)){cur_text=cur_text.replace(/\r/g,"");}}this._setValue(cur_text||"");if(input_elem._is_focused){this.setCaretPos(newpos);}}else{}}}return this.value;};_pTextArea.updateToDataset=function(){if(this._result_updateToDataset=this.applyto_bindSource("value",this.value)){this._default_value=this.value;this._default_text=this.text;}this._processing_updateToDataset=true;return this._result_updateToDataset;};_pTextArea.on_deactivate_process=function(){var input_elem=this._input_element;if(input_elem){input_elem.setCompositionComplete();}};_pTextArea._on_deactivate=function(){if(!this._is_alive){return;}if(!this._isSelected()){this._changeStatus("focused",false);}this.on_deactivate_process.call(this);};_pTextArea._on_value_change=function(pretext,prevalue,posttext,postvalue){if(!this.on_fire_canchange(this,pretext,prevalue,posttext,postvalue)){return false;}this._default_value=postvalue;this._default_text=posttext;var input_elem=this._input_element;var pos=input_elem.getElementCaretPos();if(pos&&pos!= -1){this._caret_pos=pos;}if(this._processing_updateToDataset&&!this._result_updateToDataset&&prevalue===postvalue){this._processing_updateToDataset=false;this._result_updateToDataset=true;return false;}else if(!this.applyto_bindSource("value",postvalue)){return false;}this.on_fire_onchanged(this,pretext,prevalue,posttext,postvalue);return true;};_pTextArea._on_input_undo=function(item){if(this.readonly||!this._isEnable()){return;}var input_elem=this._input_element;if(input_elem){if(item){var caret=item.end;if(item.value&&item.value.length>caret){caret=item.value.length;}input_elem.updateElementText(item.value,caret);input_elem.setElementSetSelect(item.start,item.end);return true;}}};_pTextArea._on_input_redo=function(item){if(this.readonly||!this._isEnable()){return;}var input_elem=this._input_element;if(input_elem){if(item){input_elem.updateElementText(item.value,item.end);input_elem.setElementSetSelect(item.start,item.end);return true;}}};_pTextArea.on_keydown_basic_before_process=function(keycode,alt_key,ctrl_key,shift_key,refer_comp){return true;};_pTextArea.on_keydown_basic_specialkey_process=function(keycode,alt_key,ctrl_key,shift_key,refer_comp){var input_elem=this._input_element;if(keycode==nexacro.KeyCode_ImeInput&&this._imedisable){input_elem.stopSysEvent();return;}else if(!alt_key&&!shift_key&&ctrl_key&&keycode==90){if(input_elem.isComposing()){input_elem.setCompositionComplete();}if(this._undostack){this._undostack.undo();input_elem._applyMaxlength();input_elem.stopSysEvent();return;}}else if(!alt_key&&!shift_key&&ctrl_key&&keycode==89){if(this._undostack){this._undostack.redo();input_elem.stopSysEvent();return;}}else if(keycode==nexacro.Event.KEY_TAB){if(!alt_key&&!shift_key&&((this.acceptstab&&!ctrl_key)||(!this.acceptstab&&ctrl_key))){var pos=input_elem.getElementCaretPos();var text=input_elem.getElementText();text=text.substring(0,pos.begin)+nexacro.TextArea._TAB_CHAR+text.substring(pos.end);var newpos=pos.begin+nexacro.TextArea._TAB_CHAR.length;nexacro._OnceCallbackTimer.callonce(this,function(){input_elem.updateElementText(text,newpos);},0);input_elem.stopSysEvent();}else{this._want_tab=false;}}return true;};_pTextArea.on_keydown_basic_process=function(keycode,alt_key,ctrl_key,shift_key,refer_comp){var input_elem=this._input_element;if(this._undostack&&!input_elem.isComposing()){var pos=input_elem.getElementCaretPos();if(pos&&pos!= -1){this._undostack.update(pos.begin,pos.end);}}return true;};_pTextArea.on_keydown_basic_action=function(keycode,alt_key,ctrl_key,shift_key,refer_comp){if(this.readonly||!this._isEnable()){return;}var input_elem=this._input_element;if(input_elem){if(!this.on_keydown_basic_before_process.call(this,keycode,alt_key,ctrl_key,shift_key,refer_comp)){return;}if(!this.on_keydown_basic_specialkey_process.call(this,keycode,alt_key,ctrl_key,shift_key,refer_comp)){return;}this.on_keydown_basic_process.call(this,keycode,alt_key,ctrl_key,shift_key,refer_comp);}};_pTextArea.on_keydown_default_before_process=function(keycode,alt_key,ctrl_key,shift_key,refer_comp){return true;};_pTextArea.on_keydown_default_specialkey_process=function(keycode,alt_key,ctrl_key,shift_key,refer_comp){if(keycode>=nexacro.Event.KEY_LEFT&&keycode<=nexacro.Event.KEY_DOWN){this._onRecalcScrollSize();}return true;};_pTextArea.on_keydown_default_process=function(keycode,alt_key,ctrl_key,shift_key,refer_comp){return true;};_pTextArea.on_keydown_default_action=function(keycode,alt_key,ctrl_key,shift_key,refer_comp){if(this.readonly||!this._isEnable()){return;}var input_elem=this._input_element;if(input_elem){if(!this.on_keydown_default_before_process.call(this,keycode,alt_key,ctrl_key,shift_key,refer_comp)){return;}if(!this.on_keydown_default_specialkey_process.call(this,keycode,alt_key,ctrl_key,shift_key,refer_comp)){return;}this.on_keydown_default_process.call(this,keycode);}};_pTextArea.on_keypress_basic_before_process=function(keycode,charcode,alt_key,ctrl_key){return true;};_pTextArea.on_keypress_basic_specialkey_process=function(keycode,charcode,alt_key,ctrl_key){if(keycode==nexacro.Event.KEY_ENTER||keycode==nexacro.Event.KEY_ESC){return false;}return true;};_pTextArea.on_keypress_basic_process=function(keycode,charcode,alt_key,ctrl_key){if(nexacro._OS=="iOS"){return true;}var input_elem=this._input_element;charcode=charcode||keycode;if(!ctrl_key&&!alt_key&&charcode&&!input_elem.isComposing()){var inputChar=String.fromCharCode(charcode);if(inputChar.length>0&&this._isFilterChar(inputChar)){input_elem.stopSysEvent();return false;}}return true;};_pTextArea.on_keypress_basic_action=function(keycode,charcode,alt_key,ctrl_key,shift_key){var input_elem=this._input_element;if(input_elem){if(keycode!==0&&charcode===0){return true;}else{if(!this.on_keypress_basic_before_process.call(this,keycode,charcode,alt_key,ctrl_key,shift_key)){return;}if(!this.on_keypress_basic_specialkey_process.call(this,keycode,charcode,alt_key,ctrl_key,shift_key)){return;}if(!this.on_keypress_basic_process.call(this,keycode,charcode,alt_key,ctrl_key,shift_key)){return false;}}return true;}};_pTextArea.on_keyup_basic_before_process=function(keycode,alt_key,ctrl_key,shift_key,refer_comp){return true;};_pTextArea.on_keyup_basic_specialkey_process=function(keycode,alt_key,ctrl_key,shift_key,refer_comp){return true;};_pTextArea.on_keyup_default_process=function(keycode,alt_key,ctrl_key,shift_key,refer_comp){this._onRecalcScrollSize();return true;};_pTextArea.on_keyup_default_action=function(keycode,alt_key,ctrl_key,shift_key,refer_comp){if(!this.on_keyup_basic_before_process.call(this,keycode,alt_key,ctrl_key,shift_key,refer_comp)){return;}if(!this.on_keyup_basic_specialkey_process.call(this,keycode,alt_key,ctrl_key,shift_key,refer_comp)){return;}if(!this.on_keyup_default_process.call(this,keycode,alt_key,ctrl_key,shift_key,refer_comp)){return false;}};_pTextArea.on_beforekeyinput_basic_action=function(value,status,begin,end,inputType){if(this.readonly||!this._isEnable()){return 0;}var input_elem=this._input_element;if(input_elem){if(input_elem._use_event_beforeinput){return this._beforeinput_process_with_HTMLEvent(value,status,begin,end,inputType);}else{return this._beforeinput_process_with_NexacroInputEvent(value,status,begin,end);}}};_pTextArea.on_keyinput_basic_before_process=function(input_text){return true;};_pTextArea.on_keyinput_basic_process=function(input_text){var input_elem=this._input_element;var input_value=input_elem.value===null?undefined:input_elem.value;input_text=input_text===undefined?input_elem._getInputValue():input_text;this.value=input_value;this.text=input_text;if(this._undostack&&!input_elem.isComposing()){var pos=input_elem.getElementCaretPos();if(pos&&pos!= -1){this._undostack.push(input_value,pos.begin,pos.end);}else{this._undostack.push(input_value,0,0);}}return true;};_pTextArea.on_keyinput_basic_action=function(input_text){if(this.readonly||!this._isEnable()){return false;}var input_elem=this._input_element;if(input_elem){if(!this.on_keyinput_basic_before_process.call(this,input_text)){return false;}if(!this.on_keyinput_basic_process.call(this,input_text)){return false;}this._onRecalcScrollSize();nexacro._OnceCallbackTimer.callonce(this,function(){this._onResetScrollBar();});}this._updateAccessibilityLabel();return true;};_pTextArea.on_killfocus_basic_process=function(){var input_elem=this._input_element;var cur_text;if(!this._onlydisplay){if(input_elem.isComposing()){cur_text=this.text;var filter_text=this.text;if(this._inputtype_obj){filter_text=this._inputtype_obj.apply(cur_text);}if(this._inputfilter_obj){filter_text=this._inputfilter_obj.apply(cur_text);}if(cur_text!=filter_text){input_elem.setCompositionCancel();}else{input_elem.setCompositionComplete();}}}var pre_value=this._default_value;var pre_text=this._default_text;var cur_value=this.value;cur_text=cur_value?cur_value:"";if(pre_value!=cur_value){var pos=input_elem.getElementCaretPos();if(!this._on_value_change(pre_text,pre_value,cur_text,cur_value)){var cur_text_len=cur_text?cur_text.length:0;var pre_text_len=pre_text?pre_text.length:0;if(pos!= -1){if(cur_text_len-pre_text_len>=0){pos.begin=pos.end=pos.begin-(cur_text_len-pre_text_len);}if(pos.begin<0){pos.begin=pos.end=0;}this._caret_pos=pos;}else{this._caret_pos.begin=this._caret_pos.end=pre_value?pre_value.length:0;}this.value=pre_value;this.text=pre_text;if(!this._onlydisplay){input_elem.setElementValue(pre_value);}else{input_elem.setElementText(pre_value);}input_elem.setElementSetSelect(this._caret_pos.begin,this._caret_pos.end);}}else{this._caret_pos=input_elem.getElementCaretPos();}if(!this._onlydisplay){if(nexacro._isNull(this.value)){this._changeUserStatus("nulltext",true);}this._adjust_scrollPosition(input_elem);var _win=this._getRootWindow();var idx=_win._indexOfCurrentFocusPaths(this);if(idx<0){input_elem.setElementBlur();}}};_pTextArea.on_killfocus_basic_action=function(new_focus,new_refer_focus){var input_elem=this._input_element;if(input_elem){if(!this._onlydisplay){var _sel=input_elem.getElementSelectionRange();if(_sel[0]==_sel[1]){input_elem._setElementLastSelectionRange();}}if(!this.on_killfocus_basic_process.call(this)){return;}}};_pTextArea.on_click_basic_action=function(elem,button,alt_key,ctrl_key,shift_key,canvasX,canvasY,screenX,screenY){var input_elem=this._input_element;if(input_elem){var _window=this._getWindow();if(_window&&this._track_capture){var capture_comp=_window._getCaptureComp(true,false,this);if(!this._onlydisplay&&(!capture_comp||capture_comp==this)){input_elem.setElementFocus(button,true);}}}};_pTextArea.on_fire_onclick=function(button,alt_key,ctrl_key,shift_key,screenX,screenY,canvasX,canvasY,clientX,clientY,from_comp,from_refer_comp){if(this.oneditclick&&this.oneditclick._has_handlers){var caretpos=this.getCaretPos();var evt=new nexacro.EditClickEventInfo(this,"oneditclick",caretpos,button,alt_key,ctrl_key,shift_key,screenX,screenY,canvasX,canvasY,clientX,clientY,this,this);return this.oneditclick._fireEvent(this,evt);}return true;};_pTextArea.on_fire_canchange=function(obj,bText,bValue,aText,aValue){if(this.canchange&&this.canchange._has_handlers){var evt=new nexacro.ChangeEventInfo(obj,"canchange",bText,bValue,aText,aValue);return this.canchange._fireCheckEvent(this,evt);}return true;};_pTextArea.on_fire_onchanged=function(obj,pretext,prevalue,posttext,postvalue){if(this.onchanged&&this.onchanged._has_handlers){var evt=new nexacro.ChangeEventInfo(obj,"onchanged",pretext,prevalue,posttext,postvalue);return this.onchanged._fireEvent(this,evt);}};_pTextArea.on_fire_oninput=function(){if(this.oninput&&this.oninput._has_handlers){var evt=new nexacro.InputEventInfo(this,"oninput");return this.oninput._fireEvent(this,evt);}return true;};_pTextArea._convertValueType=function(v,bapplyrule){var ret;if(bapplyrule){ret=nexacro.Component.prototype._convertValueType.call(this,v);}else{ret=nexacro._isNull(v)?v:nexacro._toString(v);}return ret;};_pTextArea._setValue=function(v){this.text=nexacro._toString(v);this.value=v;this.on_apply_value(this.value);};_pTextArea._setDefaultCaret=function(){this.setCaretPos(0);};_pTextArea._setFocusToNextComponent=function(){var root_comp=this._getRootComponent(this);var next_comp=this._getForm().getNextComponent(root_comp,true);if(next_comp){next_comp.setFocus();if(next_comp._is_editable_control){next_comp._setDefaultCaret();}}};_pTextArea._setHscrollPos=function(v){this._hscroll_pos=nexacro._toInt(v);var input_elem=this._input_element;if(input_elem){input_elem.setElementHScrollPos(v);}};_pTextArea._setVscrollPos=function(v){this._vscroll_pos=nexacro._toInt(v);var input_elem=this._input_element;if(input_elem){input_elem.setElementVScrollPos(v);}};_pTextArea._setVScrollDefaultAction=function(wheelDelta){var control_elem=this.getElement();if(control_elem){if(this.scrolltype=="none"||this.scrolltype=="horizontal"){return false;}var wheelline= -3;var lineheight=20;if(wheelDelta>=0){wheelline=3;}wheelDelta=lineheight*wheelline;var old_value=this._vscroll_pos;var value=old_value-wheelDelta;var vscroll_limit=control_elem.vscroll_limit;if(value>vscroll_limit){value=vscroll_limit;}this._scrollTo(this._hscroll_pos,value,true,true,undefined,"mousewheel_v");if(old_value!=this._vscroll_pos){return true;}}return false;};_pTextArea._getLineCount=function(){var line=0;var input_elem=this._input_element;if(input_elem){if(!this._onlydisplay){line=input_elem.getElementTextLineCount(true);}}return line;};_pTextArea._getCaretLine=function(){var line=0;var input_elem=this._input_element;if(input_elem){if(!this._onlydisplay){line=input_elem.getElementCaretLine();}}return line;};_pTextArea._isFilterChar=function(ch){if(ch!=""){if(this._inputfilter_obj&&this._inputfilter_obj.test(ch)){return true;}if(this._inputtype_obj&&!this._inputtype_obj.test(ch)){return true;}}return false;};_pTextArea._isWheelScrollable=function(delta){if(this._onlydisplay){return true;}var input_elem=this._input_element;if(!input_elem){return false;}var scroll_top=input_elem.getElementVScrollPos();var scroll_height=input_elem.getElementScrollHeight();var client_height=this._getClientHeight();if((scroll_top+client_height>=scroll_height&&delta<0)||(scroll_top==0&&delta>0)){return false;}return true;};_pTextArea.on_beforeinput_process_with_HTMLEvent=function(value,status,begin,end,inputType){var input_elem=this._input_element;var update_value=value;var input_value=input_elem._getInputValue();var ret=[input_elem._BeforeinputState.PASS];var update_value_len=update_value?update_value.length:0;if(inputType=="deleteContentBackward"||inputType=="deleteContentForward"||inputType=="deleteByCut"){return ret;}if(this._inputtype_obj){update_value=this._inputtype_obj.apply(update_value);if(value!=update_value){if(update_value&&inputType=="insertFromPaste"){update_value_len=update_value.length;input_elem._beforeinput_result_data=update_value;input_elem._beforeinput_result_pos={begin:begin+update_value_len,end:begin+update_value_len};ret.push(input_elem._BeforeinputState.REPLACE);}else{ret.push(input_elem._BeforeinputState.CANCEL);}}}if(this._inputfilter_obj){update_value=this._inputfilter_obj.apply(update_value);if(value!=update_value){if(update_value&&inputType=="insertFromPaste"){update_value_len=update_value.length;input_elem._beforeinput_result_data=update_value;input_elem._beforeinput_result_pos={begin:begin+update_value_len,end:begin+update_value_len};ret.push(input_elem._BeforeinputState.REPLACE);}else{ret.push(input_elem._BeforeinputState.CANCEL);}}}if(inputType=="insertFromPaste"){if(update_value){var maxlength=this.maxlength;update_value=update_value.replace(/&quot;/g,"\"");if(update_value.indexOf("\r\n")!= -1||update_value.indexOf("\n\r")!= -1){update_value=update_value.replace(/\r\n|\n\r/g,"\n");}if(update_value.indexOf("\r")!= -1){update_value=update_value.replace(/\r/g,"");}if(maxlength&&begin+(input_value.length-end)+update_value_len>maxlength){update_value=update_value.substring(0,maxlength-(begin+input_value.length-end));}input_elem._beforeinput_result_insert_data=update_value;update_value_len=update_value.length;update_value=input_value.substring(0,begin)+update_value+input_value.substring(end);input_elem._beforeinput_result_data=update_value;var pos=begin+update_value_len;input_elem._beforeinput_result_pos={begin:pos,end:pos};ret.push(input_elem._BeforeinputState.REPLACE);}}if(status==0||status==3){if(update_value){switch(this.inputmode){case "upper":ret.push(input_elem._BeforeinputState.CONVERT_UPPER);break;case "lower":ret.push(input_elem._BeforeinputState.CONVERT_LOWER);break;}}}if(this.maxlength>0&&(status==0||status==3)){input_value=input_value?input_value:input_elem._getInputValue();var check=input_elem._checkMaxLength(input_value+(update_value?update_value:""),end);if(check&&check.ismax){ret.push(input_elem._BeforeinputState.MAXLENGTH);}}if(this.maxlength>0&&(status==1||status==2)){input_value=input_value?input_value:input_elem._getInputValue();if(begin!=end){input_value=input_value.substring(0,begin);}if(inputType!="insertFromPaste"){update_value=input_value+update_value;}if(update_value.length>this.maxlength){ret.push(input_elem._BeforeinputState.CANCEL);ret.push(input_elem._BeforeinputState.MAXLENGTH);}}return ret;};_pTextArea._beforeinput_process_with_HTMLEvent=function(value,status,begin,end,inputType){var input_elem=this._input_element;if(input_elem){return this.on_beforeinput_process_with_HTMLEvent.call(this,value,status,begin,end,inputType);}};_pTextArea.on_beforeinput_process_with_NexacroInputEvent=function(value,status,begin,end){var input_elem=this._input_element;var bPaste=input_elem._paste_caret_pos?true:false;var pre_value=input_elem.value;var input_text=value.substring(begin,end);if(input_text){var update_value=input_text;if((nexacro._is_hangul(update_value)||(status==nexacro._CompositionState.NONE||status==nexacro._CompositionState.END))){if(this._inputtype_obj){update_value=this._inputtype_obj.apply(update_value);}if(this._inputfilter_obj){update_value=this._inputfilter_obj.apply(update_value);}if(this.inputmode=="upper"){update_value=update_value.toUpperCase();}else if(this.inputmode=="lower"){update_value=update_value.toLowerCase();}}if(update_value!=input_text){if(bPaste&&!update_value){var pre_value_length=pre_value?pre_value.length:0;var pos=begin+(input_text.length-(value.length-pre_value_length));input_elem.updateElementText(pre_value,pos);}else{input_elem.replaceElementText(update_value,begin,end);}}}};_pTextArea._beforeinput_process_with_NexacroInputEvent=function(value,status,begin,end){var input_elem=this._input_element;if(input_elem){return this.on_beforeinput_process_with_NexacroInputEvent.call(this,value,status,begin,end);}};_pTextArea._adjust_scrollPosition=function(input_elem,evt_name){var h_pos=this.hscrollbar?this.hscrollbar.pos:0;var v_pos=this.vscrollbar?this.vscrollbar.pos:0;if(this._is_set_value&&(evt_name=="tabkey"||evt_name=="shifttabkey"||(this.taborder==0&&!this._is_subcontrol&&evt_name!="lbuttondown"&&evt_name!="lbutton"))){if(!this.autoselect){this.setCaretPos(this.value?this.value.length:0);input_elem._setElementLastSelectionRange();}if(this.vscrollbar){v_pos=nexacro._getTextAreaElementVscrollPos(input_elem);}if(this.hscrollbar){h_pos=nexacro._getTextAreaElementHscrollPos(input_elem);}}var pThis=this;nexacro._OnceCallbackTimer.callonce(pThis,function(){if(pThis.hscrollbar){pThis.hscrollbar.set_pos(h_pos);}if(pThis.vscrollbar){pThis.vscrollbar.set_pos(v_pos);}});this._is_set_value=false;};_pTextArea._on_input_compositionend=function(value){var input_elem=this._input_element;if(input_elem){if(this._undostack){var pos=input_elem.getElementCaretPos();if(pos&&pos!= -1){this._undostack.push(value,pos.begin,pos.end);}else{this._undostack.push(value,0,0);}}}};_pTextArea.on_apply_imeSet=function(){var input_elem=this._input_element;if(input_elem){var i,len;var _locale=input_elem._imelocale.getLocale();if(_locale&&nexacro._cache_textarea_set[_locale]){for(var prop in nexacro._cache_textarea_set[_locale]){this[prop]=nexacro._cache_textarea_set[_locale][prop];}for(i=0,len=nexacro._edit_user_override_func.length;i<len;i++ ){if(!nexacro._cache_textarea_set[_locale][nexacro._edit_user_override_func[i]]){this[nexacro._edit_user_override_func[i]]=nexacro.TextArea.prototype[nexacro._edit_user_override_func[i]];}}}else{for(i=0,len=nexacro._edit_user_override_func.length;i<len;i++ ){this[nexacro._edit_user_override_func[i]]=nexacro.TextArea.prototype[nexacro._edit_user_override_func[i]];}}}};_pTextArea=null;}
if(nexacro.Edit){nexacro._defineImeLocaleEdit("ko",{"Edit":{on_killfocus_basic_process:function(){var input_elem=this._input_element;var cur_text;if(!this._onlydisplay){if(input_elem.isComposing()){cur_text=this.text;var filter_text=this.text;if(this._inputtype_obj){filter_text=this._inputtype_obj.apply(cur_text);}if(this._inputfilter_obj){filter_text=this._inputfilter_obj.apply(cur_text);}if(cur_text!=filter_text){input_elem.setCompositionCancel();}else{input_elem.setCompositionComplete();}}var pre_value=this._default_value;var pre_text=this._default_text;var cur_value=input_elem.value;cur_text=cur_value?cur_value:"";var pos=input_elem.getElementCaretPos();if(pre_value!=cur_value){if(!this._on_value_change(pre_text,pre_value,cur_text,cur_value)){var cur_text_len=cur_text?cur_text.length:0;var pre_text_len=pre_text?pre_text.length:0;if(pos!= -1){if(cur_text_len-pre_text_len>=0){pos.begin=pos.end=pos.begin-(cur_text_len-pre_text_len);}if(pos.begin<0){pos.begin=pos.end=0;}this._caret_pos=pos;}else{this._caret_pos.begin=this._caret_pos.end=pre_value?pre_value.length:0;}this.value=pre_value;this.text=pre_text;input_elem.setElementValue(pre_value);input_elem.setElementSetSelect(this._caret_pos.begin,this._caret_pos.end);}}else{this._caret_pos=input_elem.getElementCaretPos();}if(nexacro._isNull(this.value)){this._changeUserStatus("nulltext",true);}if(nexacro._enableaccessibility&&nexacro._Browser=="Runtime"&&nexacro._accessibilitytype==5){this._setAccessibilityStatKillFocus();}var _win=this._getRootWindow();var idx=_win._indexOfCurrentFocusPaths(this);if(idx<0){input_elem.setElementBlur();}}else{if(nexacro._isNull(this.value)){this._changeUserStatus("nulltext",true);}}if((nexacro._Browser=="IE"&&nexacro._BrowserType!="Edge")&&this._inputtype_obj&&this._inputtype_obj._imedisable){this.on_apply_imemode(this.imemode);}return true;},on_keypress_basic_process:function(keycode,charcode,alt_key,ctrl_key,shift_key){var input_elem=this._input_element;charcode=charcode||keycode;if(!ctrl_key&&!alt_key&&charcode&&!input_elem.isComposing()){var inputChar=String.fromCharCode(charcode);if(nexacro._OS=="iOS"&&(charcode>=12593&&charcode<=12643)){if(inputChar.length>0&&this._isFilterChar(inputChar)){input_elem.stopSysEvent();return false;}return true;}}return nexacro.Edit.prototype.on_keypress_basic_process.call(this,keycode,charcode,alt_key,ctrl_key,shift_key);}},"TextArea":{on_keydown_default_specialkey_process:function(keycode,alt_key,ctrl_key,shift_key,refer_comp){var input_elem=this._input_element;if(keycode==nexacro.Event.KEY_RETURN){if(input_elem.isComposing()){input_elem.setCompositionComplete();}}return nexacro.TextArea.prototype.on_keydown_default_specialkey_process.call(this,keycode,alt_key,ctrl_key,shift_key,refer_comp);},on_keypress_basic_process:function(keycode,charcode,alt_key,ctrl_key,shift_key){var input_elem=this._input_element;charcode=charcode||keycode;if(!ctrl_key&&!alt_key&&charcode&&!input_elem.isComposing()){var inputChar=String.fromCharCode(charcode);if(nexacro._OS=="iOS"&&(charcode>=12593&&charcode<=12643)){if(inputChar.length>0&&this._isFilterChar(inputChar)){input_elem.stopSysEvent();return false;}return true;}}return nexacro.TextArea.prototype.on_keypress_basic_process.call(this,keycode,charcode,alt_key,ctrl_key,shift_key);},on_killfocus_basic_process:function(){var ret=nexacro.TextArea.prototype.on_killfocus_basic_process.call(this);if((nexacro._Browser=="IE"&&nexacro._BrowserType!="Edge")&&this._inputtype_obj&&this._inputtype_obj._imedisable){this.on_apply_imemode(this.imemode);}return ret;}}});}if(nexacro._Browser!="Runtime"){if(nexacro.InputElement){nexacro._defineImeLocaleEdit("ko",{"InputElement":{on_sys_keyup_specialkey_process:function(evt){var input_handle=(evt.target||evt.srcElement);var pThis=input_handle._linked_element;var keycode=nexacro._getSysEventKey(evt);var ctrlkey=evt.ctrlKey;var pos=pThis.getElementCaretPos();var is_composing=pThis._composer.isComposing();if(is_composing){var value=pThis._getInputValue();if(keycode==nexacro.Event.KEY_RETURN||keycode==nexacro.Event.KEY_ESC||(ctrlkey&&keycode==77)||(ctrlkey&&keycode==90)){pThis._composer.setStatus(nexacro._CompositionState.END,pos.end);pThis._updateInputValue(value,true);}}return true;},on_sys_compositionend_process:function(evt){var input_handle=(evt.target||evt.srcElement);var pThis=input_handle._linked_element;var comp=pThis.parent_elem.linkedcontrol;var value=pThis._getInputValue();var pos=pThis.getElementCaretPos();pThis._composer.setStatus(nexacro._CompositionState.END,pos.end);if(pThis._evtorder_compositionend_is_last){setTimeout(function(){pThis._updateInputValue(value,true);},0);}if(pThis._use_event_beforeinput&&nexacro._OS=="Android"){var beforeinput_data=evt.data;var beforeinput_type=evt.type;var input_value=pThis._getInputValue();var composing_status=pThis.getCompositionStatus();var beginOffset=pos.begin;var endOffset=pos.end;if(pThis._composing_start!==undefined&&pThis._composing_end!==undefined){beginOffset=pThis._composing_start;}if(endOffset==undefined){if(pThis.maxlength>0){endOffset=Math.min(beginOffset+beforeinput_data.length,pThis.maxlength);}else{endOffset=beginOffset+beforeinput_data.length;}}beforeinput_data=beforeinput_data.substr(0,endOffset-beginOffset);input_value=input_value.substring(0,beginOffset)+input_value.substring(endOffset,Math.min(input_value.length,(pThis.maxlength>0?pThis.maxlength:input_value.length)));pThis._beforeinput_result=comp._on_beforekeyinput(pThis,beforeinput_data,composing_status,beginOffset,endOffset,beforeinput_type);if(pThis._beforeinput_result){pThis._beforeinput_result.forEach(function(state){var caret_after_convert;switch(state){case pThis._BeforeinputState.PASS:break;case pThis._BeforeinputState.CANCEL:pThis._beforeinput_result_data=input_value;pThis._beforeinput_result_pos={begin:null,end:null};break;case pThis._BeforeinputState.CONVERT_UPPER:caret_after_convert=endOffset;pThis._beforeinput_result_data=input_value.substring(0,beginOffset)+beforeinput_data.toUpperCase()+input_value.substring(endOffset,input_value.length);pThis._beforeinput_result_pos={begin:caret_after_convert,end:caret_after_convert};break;case pThis._BeforeinputState.CONVERT_LOWER:caret_after_convert=endOffset+beforeinput_data.length;pThis._beforeinput_result_data=input_value.substring(0,beginOffset)+beforeinput_data.toLowerCase()+input_value.substring(endOffset);pThis._beforeinput_result_pos={begin:caret_after_convert,end:caret_after_convert};break;case pThis._BeforeinputState.MAXLENGTH:break;case pThis._BeforeinputState.REPLACE:break;default:break;}},pThis);}pThis._on_sys_keyinput(evt);}pThis._composing_start=pThis._composing_end=undefined;comp=pThis.parent.linkedcontrol;if(comp){comp._on_input_compositionend(value);}pThis._setElementLastSelectionRange();return true;},_on_sys_keyinput_process_use_event_beforeinput:function(evt){var input_handle=(evt.target||evt.srcElement);var pThis=input_handle._linked_element;if(pThis._skip_sys_keyinput){pThis._skip_sys_keyinput=false;return;}var comp=pThis.parent_elem.linkedcontrol;var ismax=false;var value=pThis._getInputValue();var pos;if(pThis._beforeinput_result){var bcancle=false;pThis._beforeinput_result.forEach(function(state){switch(state){case nexacro.InputElement.prototype._BeforeinputState.PASS:break;case nexacro.InputElement.prototype._BeforeinputState.CANCEL:pThis._updateInputValue(pThis._beforeinput_result_data,false,pThis._beforeinput_result_pos.end,pThis._beforeinput_result_pos.end);bcancle=true;break;case nexacro.InputElement.prototype._BeforeinputState.CONVERT_UPPER:case nexacro.InputElement.prototype._BeforeinputState.CONVERT_LOWER:case nexacro.InputElement.prototype._BeforeinputState.REPLACE:if(pThis._beforeinput_result_data!=null){pThis._updateInputValue(pThis._beforeinput_result_data,false,pThis._beforeinput_result_pos.begin,pThis._beforeinput_result_pos.end);}break;case nexacro.InputElement.prototype._BeforeinputState.MAXLENGTH:ismax=true;break;}},pThis);if(pThis.autoskip&&ismax){if(pThis.value&&value.length>=pThis.maxlength){pThis._go_next_focus();}}if(bcancle){return;}}value=pThis._getInputValue();pos=pThis.getElementCaretPos();if(pThis._composer.isComposing()){pThis._composer.setStatus(nexacro._CompositionState.COMPOSING,pos.end);}var old_value=pThis.value;pThis._updateElementValue(value);if(comp._on_keyinput){comp._on_keyinput(pThis);}if(pThis.getInputStatusPseudoClass("AUTOFILL")){nexacro.__changeInputDOMNodeType(input_handle,pThis.inputtype);}var prev_status=pThis._composer._prev_status;var cur_status=pThis._composer.status;if(prev_status==cur_status&&pThis.value==old_value){if(comp._on_input_autoskip){comp._on_input_autoskip();}}pThis._composer._prev_status=cur_status;return true;},_on_sys_keyinput_process_no_use_event_beforeinput:function(evt){if(nexacro._Browser=="Gecko"){var input_handle=evt?(evt.target||evt.srcElement):this.handle;var pThis=input_handle?input_handle._linked_element:this;var comp=pThis.parent_elem.linkedcontrol;var _win=comp._getRootWindow();if(_win&&_win._keydown_element){if(_win._keydown_element!==pThis){var old_value=pThis.value;pThis._updateInputValue(old_value);return false;}}}return nexacro.InputElement.prototype.on_sys_keyinput_process.call(this,evt);},on_sys_keyinput_process:function(evt){if(this._use_event_beforeinput&&nexacro._is_hangul(evt.data)){return this._on_sys_keyinput_process_use_event_beforeinput(evt);}else{return this._on_sys_keyinput_process_no_use_event_beforeinput(evt);}},on_apply_ime_environment_process:function(evt){var input_handle=evt?(evt.target||evt.srcElement):this.handle;var pThis=input_handle?input_handle._linked_element:this;if(!pThis._apple_default_browser){pThis._setElementUseMaxLength(true);}else{pThis._setElementUseMaxLength(false);}if(this._use_html_maxlength){nexacro.__setDOMNode_MaxLength(input_handle,pThis.maxlength);}else{nexacro.__setDOMNode_MaxLength(input_handle,0);}pThis.on_updateEvtOrder_process();return true;},on_apply_force_imeSet:function(evt){if(nexacro._Browser=="IE"){var input_handle=evt?(evt.target||evt.srcElement):this.handle;var pThis=input_handle?input_handle._linked_element:this;var comp=pThis.parent_elem.linkedcontrol;var pos=pThis.getElementCaretPos();if(comp._inputtype_obj&&comp._inputtype_obj._imedisable){if(nexacro._Browser=="IE"&&nexacro._BrowserType!="Edge"){var is_change_evtorder=false;if(pThis._evtorder_compositionend_is_last){is_change_evtorder=true;pThis._evtorder_compositionend_is_last=false;}comp.on_apply_imemode("alpha");input_handle.blur();input_handle.focus();if(is_change_evtorder){pThis._evtorder_compositionend_is_last=true;}}pThis.setCompositionCancel();var new_val=this.value;if(new_val===null||new_val===undefined){new_val="";}pThis._updateInputValue(new_val);var begin=pos.begin;if(nexacro._Browser=="IE"&&(nexacro._BrowserVersion<11||nexacro._BrowserType=="Edge")&&begin>0){begin-=1;}pThis.setElementSetSelect(begin,begin);return false;}}return true;}},"TextAreaElement":{on_reset_update_value:function(resetpos){if(this._need_reset_update_value){this._need_reset_update_value=false;var save=this._processing_oninput;this._processing_oninput=true;var pos;if(resetpos){pos=this.getElementCaretPos();}var val=nexacro.__getDOMNodeValue(this.handle);if(val==''){nexacro.__setDOMNode_Value(this.handle,' ');}nexacro.__setDOMNode_Value(this.handle,val);if(resetpos&&pos){this.setElementSetSelect(pos.begin,pos.end);}this._processing_oninput=save;}}}});}}else{if(nexacro.InputElement){nexacro._defineImeLocaleEdit("ko",{"InputElement":{on_sys_compositionstart_process:function(){var pos=this.getElementCaretPos();this._composer.setStatus(nexacro._CompositionState.START,pos.begin);return false;},on_sys_compositionupdate_process:function(){if(this._inputtype==""){return true;}var pos=this.getElementCaretPos();this._composer.setStatus(nexacro._CompositionState.COMPOSING,pos.end);return false;},on_sys_compositionend_process:function(){if(this._inputtype==""){return true;}var pos=this.getElementCaretPos();this._composer.setStatus(nexacro._CompositionState.END,pos.end);var value=this._getInputValue();var comp=this.parent.linkedcontrol;if(comp){comp._on_input_compositionend(value);}return false;}}});}}{var regexp_ko="[\\uac00-\\ud7af\\u3130-\\u318f\\u1100-\\u11ff]";nexacro._addImeLocaleInfo("ko",regexp_ko);}
if(nexacro.Edit){nexacro._defineImeLocaleEdit("ja",{"Edit":{on_deactivate_process:function(){var input_elem=this._input_element;if(input_elem){if(!this._onlydisplay&&input_elem.isComposing()){this._killfocus_fix_composition();}}return true;},on_keydown_basic_specialkey_process:function(keycode,alt_key,ctrl_key,shift_key){var input_elem=this._input_element;if(keycode==nexacro.KeyCode_ImeInput&&this._imedisable){this._killfocus_fix_composition();var input_handle=input_elem.handle;if(nexacro._Browser=="Chrome"){input_handle.blur();input_handle.focus();}else if(nexacro._Browser=="Runtime"){input_elem.setCompositionComplete();}return;}else if(((ctrl_key&&keycode==86)||(shift_key&&keycode==45))&&input_elem.isComposing()){input_elem.stopSysEvent();return;}else if(!alt_key&&!shift_key&&ctrl_key&&keycode==90){if(input_elem.isComposing()){input_elem.setCompositionComplete();}if(this._undostack){this._undostack.undo();input_elem._applyMaxlength();input_elem.stopSysEvent();return;}}else if(!alt_key&&!shift_key&&ctrl_key&&keycode==89){if(this._undostack){this._undostack.redo();input_elem.stopSysEvent();return;}}return true;},on_keydown_basic_process:function(keycode,alt_key,ctrl_key,shift_key){var input_elem=this._input_element;if(this._undostack&&!input_elem.isComposing()){var pos=input_elem.getElementCaretPos();if(pos&&pos!= -1){this._undostack.update(pos.begin,pos.end);}}if(nexacro._Browser=="IE"&&input_elem.isComposing()&&(keycode==37||keycode==39)){input_elem.stopSysEvent();return false;}return true;},on_keyinput_basic_before_process:function(input_text){var input_elem=this._input_element;var input_value=input_elem.value===null?undefined:input_elem.value;input_text=input_text===undefined?input_elem._getInputValue():input_text;if(this.value===input_value&&this.text===input_text){return false;}return true;},on_beforeinput_process_with_HTMLEvent:function(value,status,begin,end,inputType){var input_elem=this._input_element;var update_value=value?value.replace(/\r\n/g,""):value;var input_value=input_elem._getInputValue();var update_value_len=update_value?update_value.length:0;var ret=[input_elem._BeforeinputState.PASS];if(inputType=="deleteContentBackward"||inputType=="deleteContentForward"||inputType=="deleteByCut"){return ret;}if(this._inputtype_obj){update_value=this._inputtype_obj.apply(update_value);if(value!=update_value){if(update_value){update_value_len=update_value.length;input_elem._beforeinput_result_insert_data=update_value;input_elem._beforeinput_result_pos={begin:begin+update_value_len,end:begin+update_value_len};ret.push(input_elem._BeforeinputState.REPLACE);}else{ret.push(input_elem._BeforeinputState.CANCEL);}}}if(this._inputfilter_obj){update_value=this._inputfilter_obj.apply(update_value);if(value!=update_value){if(update_value){update_value_len=update_value.length;input_elem._beforeinput_result_insert_data=update_value;input_elem._beforeinput_result_pos={begin:begin+update_value_len,end:begin+update_value_len};ret.push(input_elem._BeforeinputState.REPLACE);}else{ret.push(input_elem._BeforeinputState.CANCEL);}}}if(status==0||status==3){switch(this.inputmode){case "upper":update_value=update_value.toUpperCase();input_elem._beforeinput_result_insert_data=update_value;input_elem._beforeinput_result_pos={begin:begin+update_value_len,end:begin+update_value_len};ret.push(input_elem._BeforeinputState.CONVERT_UPPER);break;case "lower":update_value=update_value.toLowerCase();input_elem._beforeinput_result_insert_data=update_value;input_elem._beforeinput_result_pos={begin:begin+update_value_len,end:begin+update_value_len};ret.push(input_elem._BeforeinputState.CONVERT_LOWER);break;}}if(this.maxlength>0&&((status==0||status==3)||inputType=="insertFromPaste")){input_value=input_value?input_value:input_elem._getInputValue();var new_value=input_value.substring(0,begin)+(update_value?update_value:"")+input_value.substring(end);var caret_pos=inputType=="insertFromPaste"?begin+update_value.length:end-(value.length-update_value.length)+1;var check=input_elem._checkMaxLength(new_value,caret_pos);if(check&&check.ismax){var newpos=check.pos;update_value=update_value.substring(0,newpos-begin);input_elem._beforeinput_result_insert_data=update_value;input_elem._beforeinput_result_pos={begin:newpos,end:newpos};ret.push(input_elem._BeforeinputState.REPLACE);ret.push(input_elem._BeforeinputState.MAXLENGTH);}}return ret;},_killfocus_fix_composition:function(){var input_elem=this._input_element;var value=input_elem._getInputValue();var beginOffset=input_elem._composer.startOffset;var endOffset=input_elem._composer.endOffset;var new_value=this._fix_composition(value,beginOffset,endOffset);var caretpos=endOffset;var newpos= -1;var ismax=false;var check=input_elem._checkMaxLength(new_value,caretpos-(value.length-new_value.length),true);if(this.maxlength>0){if(check){ismax=check.ismax;newpos=check.pos;if(ismax){new_value=new_value.substring(0,newpos)+value.substring(caretpos);}}else{newpos=caretpos-(value.length-new_value.length);}}else{newpos=caretpos-(value.length-new_value.length);}value=new_value;input_elem._updateElementValue(value);if(!this._set_node_value){input_elem._updateInputValue(value);}else{nexacro.__setDOMNode_Value(input_elem.handle,value);}if(newpos!= -1&&beginOffset==newpos){input_elem.setCompositionCancel(newpos,true);}else{input_elem.setCompositionComplete(newpos,true);}input_elem.setElementSetSelect(newpos,newpos);value=input_elem._getInputValue();return value;},on_killfocus_basic_process:function(){var input_elem=this._input_element;if(!this._onlydisplay){var value=input_elem.value;if(input_elem.isComposing()){value=this._killfocus_fix_composition();}var pre_value=this._default_value;var pre_text=this._default_text;var cur_value=input_elem.value;var cur_text=cur_value?cur_value:"";var pos=input_elem.getElementCaretPos();if(pre_value!=cur_value){if(!this._on_value_change(pre_text,pre_value,cur_text,cur_value)){var cur_text_len=cur_text?cur_text.length:0;var pre_text_len=pre_text?pre_text.length:0;if(pos!= -1){pos.begin=pos.end=pos.begin-(cur_text_len-pre_text_len);if(pos.begin<0){pos.begin=pos.end=0;}this._caret_pos=pos;}else{this._caret_pos.begin=this._caret_pos.end=pre_value?pre_value.length:0;}this.value=pre_value;this.text=pre_text;value=pre_value;input_elem.setElementValue(pre_value);input_elem.setElementSetSelect(this._caret_pos.begin,this._caret_pos.end);}else{value=input_elem.value;}}else{this._caret_pos=input_elem.getElementCaretPos();}input_elem._updateElementValue(value);this._setValue(input_elem.value===null?undefined:input_elem.value);if(nexacro._isNull(this.value)){this._changeUserStatus("nulltext",true);}if(nexacro._enableaccessibility&&nexacro._Browser=="Runtime"&&nexacro._accessibilitytype==5){this._setAccessibilityStatKillFocus();}var _win=this._getRootWindow();var idx=_win._indexOfCurrentFocusPaths(this);if(idx<0){input_elem.setElementBlur();}}else{if(nexacro._isNull(this.value)){this._changeUserStatus("nulltext",true);}}return true;},_fix_composition:function(value,begin,end){var input_text=value.substring(begin,end);if(input_text){var update_value=input_text;if(this._inputtype_obj){update_value=this._inputtype_obj.apply(update_value);}if(this._inputfilter_obj){update_value=this._inputfilter_obj.apply(update_value);}if(this.inputmode=="upper"){update_value=update_value.toUpperCase();}else if(this.inputmode=="lower"){update_value=update_value.toLowerCase();}return value.substring(0,begin)+update_value+value.substring(end);}else{return value;}}},"TextArea":{on_deactivate_process:function(){var input_elem=this._input_element;if(input_elem){if(!this._onlydisplay&&input_elem.isComposing()){this._killfocus_fix_composition();}}return true;},on_keydown_basic_specialkey_process:function(keycode,alt_key,ctrl_key,shift_key){var input_elem=this._input_element;if(keycode==nexacro.KeyCode_ImeInput&&this._imedisable){this._killfocus_fix_composition();var input_handle=input_elem.handle;if(nexacro._Browser=="Chrome"){input_handle.blur();input_handle.focus();}else if(nexacro._Browser=="Runtime"){input_elem.setCompositionComplete();}return;}else if(((ctrl_key&&keycode==86)||(shift_key&&keycode==45))&&input_elem.isComposing()){input_elem.stopSysEvent();return;}else if(!alt_key&&!shift_key&&ctrl_key&&keycode==90){if(input_elem.isComposing()){input_elem.setCompositionComplete();}if(this._undostack){this._undostack.undo();input_elem._applyMaxlength();input_elem.stopSysEvent();return;}}else if(!alt_key&&!shift_key&&ctrl_key&&keycode==89){if(this._undostack){this._undostack.redo();input_elem.stopSysEvent();return;}}else if(keycode==nexacro.Event.KEY_TAB){if(!alt_key&&!shift_key&&((this.acceptstab&&!ctrl_key)||(!this.acceptstab&&ctrl_key))){var pos=input_elem.getElementCaretPos();var text=input_elem.getElementText();text=text.substring(0,pos.begin)+nexacro.TextArea._TAB_CHAR+text.substring(pos.end);var newpos=pos.begin+nexacro.TextArea._TAB_CHAR.length;nexacro._OnceCallbackTimer.callonce(this,function(){input_elem.updateElementText(text,newpos);},0);input_elem.stopSysEvent();}else{this._want_tab=false;}}return true;},on_keydown_basic_process:function(keycode,alt_key,ctrl_key,shift_key){var input_elem=this._input_element;if(this._undostack&&!input_elem.isComposing()){var pos=input_elem.getElementCaretPos();if(pos&&pos!= -1){this._undostack.update(pos.begin,pos.end);}}if(nexacro._Browser=="IE"&&input_elem.isComposing()&&(keycode==37||keycode==39)){input_elem.stopSysEvent();return false;}return true;},on_keydown_default_specialkey_process:function(keycode,alt_key,ctrl_key,shift_key,refer_comp){var input_elem=this._input_element;if(keycode==nexacro.Event.KEY_RETURN){if(input_elem.isComposing()){var pos=input_elem.getElementCaretPos();var beginOffset=input_elem._composer.startOffset;var endOffset=pos.end;if(endOffset===undefined){endOffset=input_elem._composer.endOffset;}var value=input_elem._getInputValue();var new_value=this._fix_composition(value,beginOffset,endOffset);var caretpos=endOffset;var newpos= -1;var ismax=false;var check=input_elem._checkMaxLength(new_value,caretpos-(value.length-new_value.length),true);if(this.maxlength>0){if(check){ismax=check.ismax;newpos=check.pos;if(ismax){new_value=new_value.substring(0,newpos)+value.substring(caretpos);}}else{newpos=caretpos-(value.length-new_value.length);}}else{newpos=caretpos-(value.length-new_value.length);}value=new_value;input_elem._updateElementValue(value);if((nexacro._Browser=="IE"&&nexacro._BrowserType!="Edge")||nexacro._Browser=="Runtime"){input_elem._updateInputValue(value);}else{nexacro.__setDOMNode_Value(input_elem.handle,value);}if(newpos!= -1&&beginOffset==newpos&&nexacro._Browser=="IE"&&nexacro._BrowserVersion==9){input_elem.setCompositionCancel(newpos);}else if(newpos!= -1&&beginOffset==newpos){input_elem.setCompositionCancel(newpos,true);}else if(nexacro._Browser=="IE"&&nexacro._BrowserVersion==9){input_elem.setCompositionComplete(newpos);}else{input_elem.setCompositionComplete(newpos,true);}input_elem.setElementSetSelect(newpos,newpos);value=input_elem._getInputValue();if(ismax){if(input_elem.autoskip){if(input_elem.value&&value.length>=input_elem.maxlength){input_elem._go_next_focus();}}if(this._on_input_autoskip){this._on_input_autoskip();}}}}return nexacro.TextArea.prototype.on_keydown_default_specialkey_process.call(this,keycode,alt_key,ctrl_key,shift_key,refer_comp);},on_keyinput_basic_before_process:function(input_text){var input_elem=this._input_element;var input_value=input_elem.value===null?undefined:input_elem.value;input_text=input_text===undefined?input_elem._getInputValue():input_text;if(this.value===input_value&&this.text===input_text){return false;}return true;},on_killfocus_basic_process:function(){var input_elem=this._input_element;var cur_text;if(!this._onlydisplay){var pos=null;var value=input_elem.value;if(input_elem.isComposing()){pos=[input_elem._composer.startOffset,input_elem._composer.endOffset];value=input_elem._getInputValue();var new_value=this._killfocus_fix_composition();pos[0]=pos[1]=pos[1]-(value.length-new_value.length);value=new_value;}else{var caretpos=input_elem.getElementCaretPos();if(caretpos&&caretpos!= -1){pos=caretpos;}}var pre_value=this._default_value;var pre_text=this._default_text;var cur_value=input_elem.value;cur_text=cur_value?cur_value:"";if(!pos){pos=input_elem.getElementCaretPos();}if(pre_value!=cur_value){if(!this._on_value_change(pre_text,pre_value,cur_text,cur_value)){var cur_text_len=cur_text?cur_text.length:0;var pre_text_len=pre_text?pre_text.length:0;if(pos!= -1){if(cur_text_len-pre_text_len>=0){pos.begin=pos.end=pos.begin-(cur_text_len-pre_text_len);}if(pos.begin<0){pos.begin=pos.end=0;}this._caret_pos=pos;}else{this._caret_pos.begin=this._caret_pos.end=pre_value?pre_value.length:0;}this.value=pre_value;this.text=pre_text;value=pre_value;if(!this._onlydisplay){input_elem.setElementValue(pre_value);}else{input_elem.setElementText(pre_value);}input_elem.setElementSetSelect(this._caret_pos.begin,this._caret_pos.end);input_elem._need_reset_update_value=true;}else{value=input_elem.value;}}else{this._caret_pos=input_elem.getElementCaretPos();}input_elem._updateElementValue(value);this._setValue(input_elem.value===null?undefined:input_elem.value);if(nexacro._isNull(this.value)){this._changeUserStatus("nulltext",true);}var _win=this._getRootWindow();var idx=_win._indexOfCurrentFocusPaths(this);if(idx<0){input_elem.setElementBlur();}}return true;},on_beforeinput_process_with_HTMLEvent:function(value,status,begin,end,inputType){var input_elem=this._input_element;var update_value=value;var input_value=input_elem._getInputValue();var update_value_len=update_value?update_value.length:0;var ret=[input_elem._BeforeinputState.PASS];if(inputType=="deleteContentBackward"||inputType=="deleteContentForward"||inputType=="deleteByCut"){return ret;}if(/\r\n|\n\r/.test(update_value)){update_value=update_value.replace(/\r\n|\n\r/g,"\n");}if(/\r/.test(update_value)){update_value=update_value.replace(/\r/g,"");}if(this._inputtype_obj){update_value=this._inputtype_obj.apply(update_value);if(value!=update_value){if(update_value){update_value_len=update_value.length;input_elem._beforeinput_result_insert_data=update_value;input_elem._beforeinput_result_pos={begin:begin+update_value_len,end:begin+update_value_len};ret.push(input_elem._BeforeinputState.REPLACE);}else{ret.push(input_elem._BeforeinputState.CANCEL);}}}if(this._inputfilter_obj){update_value=this._inputfilter_obj.apply(update_value);if(value!=update_value){if(update_value){update_value_len=update_value.length;input_elem._beforeinput_result_insert_data=update_value;input_elem._beforeinput_result_pos={begin:begin+update_value_len,end:begin+update_value_len};ret.push(input_elem._BeforeinputState.REPLACE);}else{ret.push(input_elem._BeforeinputState.CANCEL);}}}if(status==0||status==3){switch(this.inputmode){case "upper":update_value=update_value.toUpperCase();input_elem._beforeinput_result_insert_data=update_value;input_elem._beforeinput_result_pos={begin:begin+update_value_len,end:begin+update_value_len};ret.push(input_elem._BeforeinputState.CONVERT_UPPER);break;case "lower":update_value=update_value.toLowerCase();input_elem._beforeinput_result_insert_data=update_value;input_elem._beforeinput_result_pos={begin:begin+update_value_len,end:begin+update_value_len};ret.push(input_elem._BeforeinputState.CONVERT_LOWER);break;}}if(this.maxlength>0&&((status==0||status==3)||inputType=="insertFromPaste")){input_value=input_value?input_value:input_elem._getInputValue();var new_value=input_value.substring(0,begin)+(update_value?update_value:"")+input_value.substring(end);var caret_pos=inputType=="insertFromPaste"?begin+update_value.length:end-(value.length-update_value.length)+1;var check=input_elem._checkMaxLength(new_value,caret_pos);if(check&&check.ismax){var newpos=check.pos;update_value=update_value.substring(0,newpos-begin);input_elem._beforeinput_result_insert_data=update_value;input_elem._beforeinput_result_pos={begin:newpos,end:newpos};ret.push(input_elem._BeforeinputState.REPLACE);ret.push(input_elem._BeforeinputState.MAXLENGTH);}}return ret;},_killfocus_fix_composition:function(){var input_elem=this._input_element;var value=input_elem._getInputValue();var beginOffset=input_elem._composer.startOffset;var endOffset=input_elem._composer.endOffset;var new_value=this._fix_composition(value,beginOffset,endOffset);var caretpos=endOffset;var newpos= -1;var ismax=false;var check=input_elem._checkMaxLength(new_value,caretpos-(value.length-new_value.length),true);if(this.maxlength>0){if(check){ismax=check.ismax;newpos=check.pos;if(ismax){new_value=new_value.substring(0,newpos)+value.substring(caretpos);}}else{newpos=caretpos-(value.length-new_value.length);}}else{newpos=caretpos-(value.length-new_value.length);}value=new_value;input_elem._updateElementValue(value);if((nexacro._Browser=="IE"&&nexacro._BrowserType!="Edge")||nexacro._Browser=="Runtime"){input_elem._updateInputValue(value);}else{nexacro.__setDOMNode_Value(input_elem.handle,value);}if(newpos!= -1&&beginOffset==newpos&&nexacro._Browser=="IE"&&nexacro._BrowserVersion==9){input_elem.setCompositionCancel(newpos);}else if(newpos!= -1&&beginOffset==newpos){input_elem.setCompositionCancel(newpos,true);}else if(nexacro._Browser=="IE"&&nexacro._BrowserVersion==9){input_elem.setCompositionComplete(newpos);}else{input_elem.setCompositionComplete(newpos,true);}input_elem.setElementSetSelect(newpos,newpos);value=input_elem._getInputValue();return value;},_fix_composition:function(value,begin,end){var input_text=value.substring(begin,end);if(input_text){if(/\r\n|\n\r/.test(input_text)){input_text=input_text.replace(/\r\n|\n\r/g,"\n");}if(/\r/.test(input_text)){input_text=input_text.replace(/\r/g,"");}var update_value=input_text;if(this._inputtype_obj){update_value=this._inputtype_obj.apply(update_value);}if(this._inputfilter_obj){update_value=this._inputfilter_obj.apply(update_value);}if(this.inputmode=="upper"){update_value=update_value.toUpperCase();}else if(this.inputmode=="lower"){update_value=update_value.toLowerCase();}return value.substring(0,begin)+update_value+value.substring(end);}else{return value;}}}});}if(nexacro._Browser!="Runtime"){if(nexacro.InputElement){nexacro._defineImeLocaleEdit("ja",{"InputElement":{_ignore_input_event_once:false,setCompositionComplete_process:function(end_pos,is_composing){var value=this._getInputValue();var _is_composing=is_composing||this._composer.isComposing();if(_is_composing){var offset=this._composer.getOffset();end_pos=end_pos===undefined?offset.end:end_pos;this._composer.setStatus(nexacro._CompositionState.END,end_pos);this._updateInputValue(value,!this._processing_oninput,end_pos);}return true;},setCompositionCancel_process:function(end_pos,is_composing){var _is_composing=is_composing||this._composer.isComposing();if(_is_composing){var value=this._getInputValue();var offset=this._composer.getOffset();end_pos=end_pos===undefined?offset.end:end_pos;this._composer.setStatus(nexacro._CompositionState.END,offset.begin);this._updateInputValue(value.substring(0,offset.begin)+value.substring(end_pos),!this._processing_oninput,offset.begin);}return true;},on_sys_keydown_before_process:function(evt){var input_handle=evt.srcElement;var pThis=input_handle._linked_element;if(input_handle){if(pThis){pThis._ignore_input_event_once=false;}}return nexacro.InputElement.prototype.on_sys_keydown_before_process.call(pThis,evt);},on_sys_keyup_before_process:function(evt){var input_handle=evt.srcElement;var pThis=input_handle._linked_element;if(input_handle){if(pThis){pThis._ignore_input_event_once=false;}}return nexacro.InputElement.prototype.on_sys_keyup_before_process.call(pThis,evt);},on_sys_keyup_specialkey_process:function(evt){var pThis=this;var is_composing=pThis._composer.isComposing();if(is_composing){var ctrlkey=evt.ctrlKey;var keycode=nexacro._getSysEventKey(evt);var value=pThis._getInputValue();if(keycode==nexacro.Event.KEY_RETURN||(ctrlkey&&keycode==77)||(ctrlkey&&keycode==90)){var pos=pThis.getElementCaretPos();var beginOffset=pThis._composer.startOffset;pThis._composer.setStatus(nexacro._CompositionState.END,pos.end);var comp=pThis.parent_elem.linkedcontrol;var endOffset=pos.end;var ismax=false;if(pThis._composing_start!==undefined&&pThis._composing_end!==undefined){beginOffset=pThis._composing_start;}var newpos= -1;var new_value=comp._fix_composition(value,beginOffset,endOffset);var caretpos=endOffset;if(comp.maxlength>0){var check=pThis._checkMaxLength(new_value,caretpos-(value.length-new_value.length));if(check){ismax=check.ismax;newpos=check.pos;if(ismax){new_value=new_value.substring(0,newpos)+value.substring(caretpos);}}else{newpos=caretpos-(value.length-new_value.length);}}else{newpos=caretpos-(value.length-new_value.length);}value=new_value;pThis._updateInputValue(value,true,newpos);value=pThis._getInputValue();if(ismax){pThis.setCompositionComplete();if(pThis.autoskip&&pThis._is_focused){if(pThis.value&&value.length>=pThis.maxlength){pThis._go_next_focus();}}if(comp._on_input_autoskip){comp._on_input_autoskip();}}pThis._composing_start=pThis._composing_end=undefined;comp=pThis.parent.linkedcontrol;if(comp){comp._on_input_compositionend(value);}pThis._setElementLastSelectionRange();}}return true;},on_sys_propertychange_process:function(evt){var input_handle=evt.srcElement;if(input_handle){var pThis=input_handle._linked_element;if(pThis){var sel=pThis.getElementSelectionRange();if(!pThis._processing_oninput){if(pThis._ignore_input_event_once){pThis._ignore_input_event_once=false;return false;}else if(sel[0]==sel[1]&&pThis.isComposing()){pThis._ignore_input_event_once=true;}}}return nexacro.InputElement.prototype.on_sys_propertychange_process.call(pThis,evt);}},on_sys_beforeinput_forward_process:function(evt){var pThis=this;var comp=pThis.parent_elem.linkedcontrol;var beforeinput_data=evt.data;var beforeinput_type=evt.inputType;var input_value=pThis._getInputValue();var input_pos=pThis.getElementCaretPos();var composing_status=pThis.getCompositionStatus();var beginOffset=input_pos.begin;var endOffset=input_pos.end;var _win=comp._getWindow();var capture_comp;if(comp){capture_comp=_win._getCaptureComp(false,true,comp);}if(capture_comp&&capture_comp!=comp){pThis._beforeinput_result=[pThis._BeforeinputState.CANCEL];pThis._beforeinput_result_data=input_value;pThis._beforeinput_result_pos={begin:beginOffset,end:endOffset};pThis._b_beforeinput_forcedcancle=true;return false;}else{pThis._b_beforeinput_forcedcancle=false;}if(!pThis._composer.isComposing()||evt.inputType=="insertFromPaste"){{if(beforeinput_data==null&&beforeinput_type=="insertLineBreak"){beforeinput_data="\n";}else if(beforeinput_type=="insertCompositionText"){pThis._composing_start=beginOffset;pThis._composing_end=endOffset;}pThis._beforeinput_result=comp._on_beforekeyinput(pThis,beforeinput_data,composing_status,beginOffset,endOffset,beforeinput_type);if(pThis._beforeinput_result){pThis._beforeinput_result.forEach(function(state){switch(state){case pThis._BeforeinputState.PASS:break;case pThis._BeforeinputState.CANCEL:pThis._beforeinput_result_data=input_value;pThis._beforeinput_result_pos={begin:beginOffset,end:endOffset};break;case pThis._BeforeinputState.MAXLENGTH:break;case pThis._BeforeinputState.REPLACE:case pThis._BeforeinputState.CONVERT_UPPER:case pThis._BeforeinputState.CONVERT_LOWER:pThis._beforeinput_result_data=input_value.substring(0,beginOffset)+pThis._beforeinput_result_insert_data+input_value.substring(endOffset);break;default:break;}},pThis);}}}return true;},_on_sys_keyinput_process_use_event_beforeinput:function(evt){var pThis=this;var comp=pThis.parent_elem.linkedcontrol;var value;var pos;var ismax=false;if(pThis._beforeinput_result&&(pThis._b_beforeinput_forcedcancle||(!pThis._composer.isComposing()||evt.inputType=="insertFromPaste"))){var bcancle=false;pThis._beforeinput_result.forEach(function(state){switch(state){case nexacro.InputElement.prototype._BeforeinputState.PASS:break;case nexacro.InputElement.prototype._BeforeinputState.CANCEL:pThis._updateInputValue(pThis._beforeinput_result_data,false,pThis._beforeinput_result_pos.end,pThis._beforeinput_result_pos.end);bcancle=true;break;case nexacro.InputElement.prototype._BeforeinputState.CONVERT_UPPER:case nexacro.InputElement.prototype._BeforeinputState.CONVERT_LOWER:case nexacro.InputElement.prototype._BeforeinputState.REPLACE:if(pThis._beforeinput_result_data!=null){pThis._updateInputValue(pThis._beforeinput_result_data,false,pThis._beforeinput_result_pos.begin,pThis._beforeinput_result_pos.end);}break;case nexacro.InputElement.prototype._BeforeinputState.MAXLENGTH:ismax=true;break;}},pThis);if(bcancle){return;}}value=pThis._getInputValue();pos=pThis.getElementCaretPos();if(pThis._composer.isComposing()){pThis._composer.setStatus(nexacro._CompositionState.COMPOSING,pos.end);}else{pThis._updateElementValue(value);}if(comp._on_keyinput&&evt.inputType!="deleteCompositionText"){comp._on_keyinput(pThis);}var cur_status=pThis._composer.status;pThis._setElementLastSelectionRange();if(pThis.autoskip&&pThis._is_focused){if(ismax){if(pThis.value&&value.length>=pThis.maxlength){pThis._go_next_focus();}}if(comp._on_input_autoskip){comp._on_input_autoskip();}}pThis._composer._prev_status=cur_status;return true;},_on_sys_keyinput_process_no_use_event_beforeinput:function(evt){var input_handle=(evt.target||evt.srcElement);var pThis=this;var comp=pThis.parent_elem.linkedcontrol;var composing_status=pThis._composer.status;var value=pThis._getInputValue();var pos=pThis.getElementCaretPos();if(pos&&pos!= -1){var beginOffset,endOffset;beginOffset=pThis._paste_caret_pos?pThis._paste_caret_pos.begin:pThis._composer.startOffset;endOffset=pThis._paste_caret_pos?pThis._paste_caret_pos.end:pos.end;if(beginOffset>endOffset){beginOffset=endOffset;}var bBackspace=pThis._checkBackspaceKeyInKeyInput(pThis.value,value,beginOffset,endOffset);var bSelect=pThis._checkSelectionInKeyInput(pThis.value,value,beginOffset,endOffset);if(bBackspace){nexacro.__fireHTMLEvent(input_handle,"keydown","onkeydown");}if(bSelect!==false){beginOffset=bSelect;}if(comp._on_beforekeyinput&&!pThis._composer.isComposing()){comp._on_beforekeyinput(pThis,value,composing_status,beginOffset,endOffset);if(pThis._event_stop){nexacro._stopSysEvent(evt);pThis._event_stop=false;return false;}}}var new_value=pThis._getInputValue();pos=pThis.getElementCaretPos();if(nexacro._OS=="Android"&&nexacro._Browser=="Chrome"&&nexacro._BrowserVersion>"34"){if(comp instanceof nexacro.MaskEdit){pThis._beforeinput_result_pos={begin:pos.begin,end:pos.end};}}var ismax=false;if(pThis.maxlength>0&&!pThis._composer.isComposing()){var caretpos=pThis._paste_caret_pos?pThis._paste_caret_pos.end-(value.length-new_value.length):pos.end;var check=pThis._checkMaxLength(new_value,caretpos);if(check){ismax=check.ismax;var newpos=check.pos;if(ismax){if(caretpos!=newpos){new_value=new_value.substring(0,newpos)+new_value.substring(caretpos);pThis._updateInputValue(new_value,false,newpos);pos=pThis.getElementCaretPos();}pThis.setCompositionComplete();}}}value=new_value;if(pThis._composer.isComposing()){pThis._composer.setStatus(nexacro._CompositionState.COMPOSING,pos.end);}else{pThis._updateElementValue(value);}var cur_status=pThis._composer.status;if(ismax){if(comp._on_input_autoskip&&pThis._is_focused){comp._on_input_autoskip();}}pThis._composer._prev_status=cur_status;if(comp._on_keyinput&&evt.inputType!="deleteCompositionText"){comp._on_keyinput(pThis);}if(pThis._event_stop){nexacro._stopSysEvent(evt);pThis._event_stop=false;return false;}pThis._setElementLastSelectionRange();if(pThis.autoskip&&pThis._is_focused){if(ismax){if(nexacro._Browser=="Safari"){setTimeout(function(){if(pThis._is_focused){pThis._go_next_focus();}},0);}else{pThis._go_next_focus();}}}return true;},on_sys_keyinput_process:function(evt){if(this._use_event_beforeinput){return this._on_sys_keyinput_process_use_event_beforeinput(evt);}else{return this._on_sys_keyinput_process_no_use_event_beforeinput(evt);}},on_sys_compositionupdate_process:function(evt){var _skip_caret=false;if(nexacro._Browser=="Chrome"||nexacro._Browser=="Gecko"||nexacro._OS=="iOS"||(nexacro._Browser=="IE"&&nexacro._BrowserVersion==9)){_skip_caret=true;}var pos=this.getElementCaretPos();this._composer.setStatus(nexacro._CompositionState.COMPOSING,pos.end,_skip_caret);return true;},on_sys_compositionend_process:function(evt){var input_handle=(evt.target||evt.srcElement);var pThis=input_handle._linked_element;if(pThis._is_focused){var value=pThis._getInputValue();var pos=pThis.getElementCaretPos();var beginOffset=pThis._composer.startOffset;pThis._composer.setStatus(nexacro._CompositionState.END,pos.end);var comp=pThis.parent_elem.linkedcontrol;var beforeinput_data=evt.data;var endOffset=pos.end;var ismax=false;var check;if(pThis._composing_start!==undefined&&pThis._composing_end!==undefined){beginOffset=pThis._composing_start;}if(endOffset==undefined){endOffset=beginOffset+beforeinput_data.length;}var caretpos=endOffset;var newpos= -1;var new_value;if(nexacro._Browser=="IE"&&nexacro._BrowserVersion==9){new_value=comp._fix_composition(value,beginOffset,endOffset);if(comp.maxlength>0){check=pThis._checkMaxLength(new_value,caretpos-(value.length-new_value.length));if(check){ismax=check.ismax;newpos=check.pos;if(ismax){if(caretpos!=newpos){new_value=new_value.substring(0,newpos)+value.substring(caretpos);}}}else{newpos=caretpos-(value.length-new_value.length);}}else{newpos=caretpos-(value.length-new_value.length);}var changed=false;if(value!==new_value){changed=true;}value=new_value;pThis._updateElementValue(value);if((changed||pThis.value!==value)&&comp._on_keyinput){comp._on_keyinput(pThis,value);}if(!ismax||!pThis.autoskip){setTimeout(function(){pThis._updateInputValue(value,true,newpos);},0);}}else{new_value=comp._fix_composition(value,beginOffset,endOffset);if(comp.maxlength>0){caretpos=pThis._paste_caret_pos?pThis._paste_caret_pos.end:endOffset;check=pThis._checkMaxLength(new_value,caretpos-(value.length-new_value.length));if(check){ismax=check.ismax;newpos=check.pos;if(ismax){new_value=new_value.substring(0,newpos)+value.substring(caretpos);}}else{newpos=caretpos-(value.length-new_value.length);}}else{newpos=caretpos-(value.length-new_value.length);}value=new_value;var old_value=pThis.value;if(nexacro._Browser=="IE"){pThis._updateElementValue(value);}if(!pThis._evtfire_oninput_after_compositionend||pThis._evtorder_compositionend_is_last||pThis._use_event_beforeinput){pThis._updateInputValue(value,true,newpos);}else{pThis._updateInputValue(value,false,newpos);}if(nexacro._Browser=="IE"&&nexacro._BrowserVersion==10&&old_value!=value&&comp._on_keyinput){comp._on_keyinput(pThis);}if(ismax){pThis.setCompositionComplete();}}pThis._composing_start=pThis._composing_end=undefined;comp=pThis.parent.linkedcontrol;if(comp){comp._on_input_compositionend(value);}pThis._setElementLastSelectionRange();if(pThis.autoskip&&pThis._is_focused){if(ismax){if(nexacro._Browser=="Chrome"||(nexacro._Browser=="IE"&&(nexacro._BrowserType=="Edge"||nexacro._BrowserVersion==11))){pThis._go_next_focus();}else{setTimeout(function(){if(nexacro._Browser=="IE"&&nexacro._BrowserVersion==9){pThis._updateInputValue(value,true,newpos);}if(pThis._is_focused){pThis._go_next_focus();}},0);}}if(comp._on_input_autoskip){comp._on_input_autoskip();}}}return true;},on_sys_touchend_process:function(evt){return false;},on_sys_paste_before_process:function(evt){if(nexacro._OS=="iOS"&&this.isComposing()){nexacro._stopSysEvent(evt);return false;}return true;},on_complete_composition_value_process:function(){if(nexacro._Browser==="Gecko"||nexacro._Browser==="IE"){if(this.handle){this.handle.blur();this.handle.focus();if(nexacro._Browser==="IE"&&nexacro._BrowserVersion<=8){var comp=this.parent_elem.linkedcontrol;var beginOffset=this._composer.startOffset;var endOffset=this._composer.endOffset;var newpos= -1;var value=this._getInputValue();var new_value=comp._fix_composition(value,beginOffset,endOffset);var caretpos=endOffset;if(comp.maxlength>0){var check=this._checkMaxLength(new_value,endOffset-(value.length-new_value.length));if(check){newpos=check.pos;if(check.ismax){new_value=new_value.substring(0,newpos)+value.substring(caretpos);}}else{newpos=endOffset-(value.length-new_value.length);}}else{newpos=endOffset-(value.length-new_value.length);}this._updateInputValue(new_value,false,newpos);this.setCompositionComplete(newpos,true);}}}return true;},on_updateEvtOrder_process:function(){if(nexacro._Browser=="IE"&&nexacro._BrowserVersion==11){this._evtorder_compositionend_is_last=true;}else{this._evtorder_compositionend_is_last=false;}},on_apply_ime_environment_process:function(evt){var input_handle=evt?(evt.target||evt.srcElement):this.handle;var pThis=input_handle?input_handle._linked_element:this;pThis._use_html_maxlength=false;nexacro.__setDOMNode_MaxLength(input_handle,0);pThis.on_updateEvtOrder_process();return true;}},"TextAreaElement":{on_reset_update_value:function(resetpos){if(this._need_reset_update_value){this._need_reset_update_value=false;var save=this._processing_oninput;this._processing_oninput=true;var pos;if(resetpos){pos=this.getElementCaretPos();}var val=nexacro.__getDOMNodeValue(this.handle);if(val==''){nexacro.__setDOMNode_Value(this.handle,' ');}nexacro.__setDOMNode_Value(this.handle,val);if(resetpos&&pos){this.setElementSetSelect(pos.begin,pos.end);}this._processing_oninput=save;}}}});}}else{if(nexacro.InputElement){nexacro._defineImeLocaleEdit("ja",{"InputElement":{setCompositionComplete_process:function(end_pos,is_composing){var pos=this.getElementCaretPos();var value=this._getInputValue();var _is_composing=is_composing||this._composer.isComposing();if(_is_composing){this._composer.setStatus(nexacro._CompositionState.END,pos.end);this._updateInputValue(value,!this._processing_oninput);}return true;},setCompositionCancel_process:function(end_pos,is_composing){var _is_composing=is_composing||this._composer.isComposing();if(_is_composing){var value=this._getInputValue();var offset=this._composer.getOffset();this._composer.setStatus(nexacro._CompositionState.END,offset.begin);this._updateInputValue(value.substring(0,offset.begin),!this._processing_oninput);}return true;},on_sys_keyup_specialkey_process:function(keycode,altkey,ctrlkey){var pos=this.getElementCaretPos();var is_composing=this._composer.isComposing();if(is_composing){if(keycode==nexacro.Event.KEY_RETURN||(ctrlkey&&keycode==77)||(ctrlkey&&keycode==90)){this._composer.setStatus(nexacro._CompositionState.END,pos.end);var value=this._getInputValue();this._updateInputValue(value,true);}}return true;},on_sys_keyinput_process:function(){var composing_status=this._composer.status;var beginOffset,endOffset;var value=this._getInputValue();var pos=this.getElementCaretPos();var paste_pos=this._paste_caret_pos;beginOffset=this._paste_caret_pos?this._paste_caret_pos.begin:this._composer.startOffset;endOffset=this._paste_caret_pos?this._paste_caret_pos.end:pos.end;if(beginOffset>endOffset){beginOffset=endOffset;}var comp=this.parent_elem.linkedcontrol;if(comp._on_beforekeyinput&&!this._composer.isComposing()){comp._on_beforekeyinput(this,value,composing_status,beginOffset,endOffset);if(this._event_stop){this._event_stop=false;return false;}}var new_value=this._getInputValue();pos=this.getElementCaretPos();var ismax=false;if(this.maxlength>0&&!this._composer.isComposing()){var caretpos=paste_pos?paste_pos.end:pos.end;var check=this._checkMaxLength(value,caretpos);if(check){ismax=check.ismax;var newpos=check.pos;if(ismax&&caretpos!=newpos){new_value=value.substring(0,newpos)+value.substring(caretpos);this._updateInputValue(new_value);this.setElementSetSelect(newpos,newpos);pos=this.getElementCaretPos();}this.setCompositionComplete();}}value=new_value;if(this._composer.isComposing()){this._composer.setStatus(nexacro._CompositionState.COMPOSING,pos.end);}else{this._updateElementValue(value);}var cur_status=this._composer.status;if(ismax){if(comp._on_input_autoskip&&this._is_focused){comp._on_input_autoskip();}}this._composer._prev_status=cur_status;if(comp._on_keyinput){comp._on_keyinput(this);}if(this._event_stop){this._event_stop=false;return false;}this._setElementLastSelectionRange();if(this.autoskip&&this._is_focused&&ismax){this._go_next_focus();}return true;},on_sys_compositionend_process:function(){if(this._is_focused){var value=this._getInputValue();var pos=this.getElementCaretPos();var beginOffset=this._composer.startOffset;this._composer.setStatus(nexacro._CompositionState.END,pos.end);var comp=this.parent_elem.linkedcontrol;var endOffset=pos.end;var ismax=false;if(this._composing_start!==undefined&&this._composing_end!==undefined){beginOffset=this._composing_start;}if(endOffset==undefined){endOffset=beginOffset;}var newpos= -1;var new_value=comp._fix_composition(value,beginOffset,endOffset);var caretpos=endOffset;if(comp.maxlength>0){var check=this._checkMaxLength(new_value,caretpos-(value.length-new_value.length));if(check){ismax=check.ismax;newpos=check.pos;if(ismax){new_value=new_value.substring(0,newpos)+value.substring(caretpos);}}else{newpos=caretpos-(value.length-new_value.length);}}else{newpos=caretpos-(value.length-new_value.length);}value=new_value;this._updateInputValue(value,false,newpos);if(newpos!= -1&&caretpos!=newpos){this.setElementSetSelect(newpos,newpos);value=this._getInputValue();pos=this.getElementCaretPos();}if(ismax){this.setCompositionComplete();}this._composer.setStatus(nexacro._CompositionState.END,pos.end);comp=this.parent.linkedcontrol;if(comp){comp._on_input_compositionend(value);}}return;},on_complete_composition_value_process:function(){this.setCompositionComplete();return true;}}});}}{var regexp_nipon="[\u0000-\u007F]|[\u0370-\u03FF]|[\u3040-\u309F]|[\u30A0-\u30FF]|[\u31F0-\u31FF]|[\uFF01-\uFFEF]|[\u3000-\u3002]|[\u300C]|[\u300D]|[\u309B]|[\u309C]|[\u2010-\u201F]";nexacro._addImeLocaleInfo("ja",regexp_nipon);}
if(!nexacro.ImageViewer){nexacro.ImageViewer=function(id,left,top,width,height,right,bottom,minwidth,maxwidth,minheight,maxheight,parent){nexacro.Component.call(this,id,left,top,width,height,right,bottom,minwidth,maxwidth,minheight,maxheight,parent);};var _pImageViewer=nexacro._createPrototype(nexacro.Component,nexacro.ImageViewer);nexacro.ImageViewer.prototype=_pImageViewer;_pImageViewer._type_name="ImageViewer";_pImageViewer._image=null;_pImageViewer._imagetext=null;_pImageViewer.text="";_pImageViewer.image=undefined;_pImageViewer.imagealign="center middle";_pImageViewer.imagewidth=0;_pImageViewer.imageheight=0;_pImageViewer.stretch="none";_pImageViewer.accessibilityrole="image";_pImageViewer._event_list={"onclick":1,"ondblclick":1,"onkillfocus":1,"onsetfocus":1,"oninput":1,"onkeydown":1,"onkeyup":1,"onlbuttondown":1,"onlbuttonup":1,"onrbuttondown":1,"onrbuttonup":1,"onmousedown":1,"onmouseup":1,"onmouseenter":1,"onmouseleave":1,"onmousemove":1,"onmousewheel":1,"ondrag":1,"ondragenter":1,"ondragleave":1,"ondragmove":1,"ondrop":1,"onload":1,"onmove":1,"onsize":1,"oncontextmenu":1,"ontouchstart":1,"ontouchmove":1,"ontouchend":1};_pImageViewer.on_create_contents=function(){var control_elem=this.getElement();if(control_elem){if(this.image){this._createImageControl();}if(this._displaytext){this._createImageTextControl();}}};_pImageViewer.on_created_contents=function(win){this.on_apply_stretch();if(this._image){this._image.on_created(win);}if(this._imagetext){this._imagetext.on_created(win);}};_pImageViewer.on_create_contents_command=function(){this.on_apply_stretch();var str="";if(this._image){str+=this._image.createCommand();}if(this._imagetext){str+=this._imagetext.createCommand();}return str;};_pImageViewer.on_attach_contents_handle=function(win){if(this._image){this._image.attachHandle(win);}if(this._imagetext){this._imagetext.attachHandle(win);}};_pImageViewer.on_destroy_contents=function(){if(this._image){this._image.destroy();this._image=null;}if(this._imagetext){this._imagetext.destroy();this._imagetext=null;}};_pImageViewer.on_change_containerRect=function(width,height){if(this._image){this._image.resize(width,height);}if(this._imagetext){this._imagetext.resize(width,height);}};_pImageViewer._on_getFitSize=function(){var elem=this.getElement();if(elem){var text_size=[0,0];var img_size=[0,0];var total_w=0;var total_h=0;var border=this._getCurrentStyleBorder();if(border){total_w+=border._getBorderWidth();total_h+=border._getBorderHeight();}var padding=this._getCurrentStylePadding();if(padding){total_w+=padding.left+padding.right;total_h+=padding.top+padding.bottom;}var text=this.text;if(text&&this._imagetext){text_size=this._imagetext._on_getFitSize();}var image=this._image;if(image){img_size=image.getOriginalImageSize();}total_w+=Math.ceil(Math.max(text_size[0],img_size[0]));total_h+=Math.ceil(Math.max(text_size[1],img_size[1]));return [total_w,total_h];}return [this._adjust_width,this._adjust_height];};_pImageViewer.set_imagewidth=nexacro._emptyFn;_pImageViewer.set_imageheight=nexacro._emptyFn;_pImageViewer.on_apply_text=function(){var text=this._displaytext;var text_control=this._imagetext;var control_elem=this.getElement();if(control_elem&&text){this._createImageTextControl(false);}if(text_control){text_control.set_text(text);if(!text){text_control.set_visible(false);}else{text_control.set_visible(true);}}};_pImageViewer.set_image=function(v){v=this._convertImageValue(v);if(this.image!=v){this.image=v;this.on_apply_image();}};_pImageViewer.on_apply_image=function(){var control_elem=this.getElement();if(control_elem&&this.image){if(!this._image){this._createImageControl(false);}}if(this._image){this._image.set_image(this.image);}};_pImageViewer.set_stretch=function(v){var stretch_enum=["none","fit","fixaspectratio"];if(stretch_enum.indexOf(v)== -1){return;}if(this.stretch!=v){this.stretch=v;this.on_apply_stretch();}};_pImageViewer.on_apply_stretch=function(){var image=this._image;if(image){image.set_stretch(this.stretch);}};_pImageViewer.set_imagealign=function(v){if(this.imagealign!=v){this.imagealign=v;this.on_apply_imagealign();}};_pImageViewer.on_apply_imagealign=function(){var image=this._image;if(image){image.set_imagealign(this.imagealign);}};_pImageViewer.on_apply_textAlign=function(halign){if(this._imagetext){this._imagetext.set_textAlign(halign);}};_pImageViewer.on_apply_verticalAlign=function(valign){if(this._imagetext){this._imagetext.set_verticalAlign(valign);}};_pImageViewer.getImageCount=function(){var image_control=this._image;if(image_control){return image_control.getImageCount();}return 0;};_pImageViewer.setImageIndex=function(nIndex){var image_control=this._image;if(image_control){image_control.setImageIndex(parseInt(nIndex)|0);}};_pImageViewer._on_element_swap=function(){var control_elem=this.getElement();if(control_elem){var text_elem=this._imagetext?this._imagetext.getElement():null;var image_elem=this._image?this._image.getElement():null;if(text_elem&&image_elem){control_elem.sendToBackElement(image_elem);}}};_pImageViewer._on_image_onclick=function(obj,e){return this.on_fire_onclick(e.button,e.altkey,e.ctrlkey,e.shiftkey,e.screenx,e.screeny,e.canvasx,e.canvasy,e.clientx,e.clienty,this,obj);};_pImageViewer.on_fire_onload=function(obj,url){if(this.onload&&this.onload._has_handlers){var evt=new nexacro.LoadEventInfo(obj,"onload",url);var ret=this.onload._fireEvent(this,evt);return ret;}return true;};_pImageViewer.on_fire_sys_onkeydown=function(key_code,alt_key,ctrl_key,shift_key,from_comp,from_refer_comp){var ret=nexacro.Component.prototype.on_fire_sys_onkeydown.call(this,key_code,alt_key,ctrl_key,shift_key,from_comp,from_refer_comp);var window=this._getWindow();this._cur_ldown_elem=window._cur_ldown_elem||window._keydown_element;return ret;};_pImageViewer.on_fire_sys_onkeyup=function(key_code,alt_key,ctrl_key,shift_key,from_comp,from_refer_comp){var ret=nexacro.Component.prototype.on_fire_sys_onkeyup.call(this,key_code,alt_key,ctrl_key,shift_key,from_comp,from_refer_comp);var window=this._getWindow();var elem=window._cur_ldown_elem||window._keydown_element;if(!this._is_subcontrol){if(elem==this._cur_ldown_elem){if(key_code==13||key_code==32){this.on_fire_onclick("none",alt_key,ctrl_key,shift_key, -1, -1, -1, -1, -1, -1,this,this);}}}this._cur_ldown_elem=null;return ret;};_pImageViewer._createImageControl=function(bCreateOnly){var image_control=this._image;if(!image_control){image_control=this._image=new nexacro._ImageAreaControl("imagearea",0,0,this._getClientWidth(),this._getClientHeight(),null,null,null,null,null,null,this);image_control.set_image(this.image);image_control.set_imagealign(this.imagealign);image_control.set_stretch(this.stretch);image_control._setNotifyFn(this,this._setImageSize);image_control.createComponent(bCreateOnly);image_control._setEventHandler("onclick",this._on_image_onclick,this);}return image_control;};_pImageViewer._createImageTextControl=function(bCreateOnly){var imagetext_control=this._imagetext;if(!imagetext_control){imagetext_control=this._imagetext=new nexacro.Static("imagetext",0,0,this._getClientWidth(),this._getClientHeight(),null,null,null,null,null,null,this);imagetext_control._setControl();imagetext_control.set_accessibilityrole("image");imagetext_control.set_text(this._displaytext);imagetext_control.createComponent(bCreateOnly);imagetext_control._setEventHandler("onclick",this._on_image_onclick,this);}return imagetext_control;};_pImageViewer._convertImageValue=function(v){if(v){if(v instanceof nexacro.Image){v=v._base64str;}else{v=v.toString();var isBase64=nexacro._checkBase64String(v);if(isBase64){if(v.substring(0,10).toLowerCase()=="data:image"){if(v.substring(0,17).toLowerCase()!="data:image;base64"){var comma_idx=v.indexOf(",");if(comma_idx> -1){var tmp=v.slice(comma_idx+1,v.legnth);v="data:image;base64,"+tmp;}}}else{v="data:image;base64,"+v;}}}}return v;};_pImageViewer._setImageSize=function(width,height){this.imagewidth=width;this.imageheight=height;};delete _pImageViewer;nexacro._ImageAreaControl=function(id,left,top,width,height,right,bottom,minwidth,maxwidth,minheight,maxheight,parent){nexacro.Component.call(this,id,left,top,width,height,right,bottom,minwidth,maxwidth,minheight,maxheight,parent);};var _pImageAreaControl=nexacro._createPrototype(nexacro.Component,nexacro._ImageAreaControl);nexacro._ImageAreaControl.prototype=_pImageAreaControl;_pImageAreaControl._type_name="ImageAreaControl";_pImageAreaControl._is_subcontrol=true;_pImageAreaControl.image="";_pImageAreaControl.imagealign="center middle";_pImageAreaControl.imagewidth=0;_pImageAreaControl.imageheight=0;_pImageAreaControl.stretch="none";_pImageAreaControl._img_elem=null;_pImageAreaControl._imagealign=null;_pImageAreaControl._notifyTarget=null;_pImageAreaControl._notifyFn=null;_pImageAreaControl._orgwidth=0;_pImageAreaControl._orgheight=0;_pImageAreaControl._is_simple_control=true;_pImageAreaControl._is_focus_accept=false;_pImageAreaControl.on_create_contents=function(){var control_elem=this.getElement();if(control_elem){this._img_elem=new nexacro.ImageElement(control_elem,"image");}};_pImageAreaControl.on_created_contents=function(win){if(this._img_elem){this._img_elem.create(win);}this.on_apply_image();};_pImageAreaControl.on_create_contents_command=function(){var ret="";var img_elem=this._img_elem;if(img_elem){this.on_apply_image();ret=img_elem.createCommand();}return ret;};_pImageAreaControl.on_attach_contents_handle=function(win){var img_elem=this._img_elem;if(img_elem){img_elem.attachHandle(win);}};_pImageAreaControl.on_destroy_contents=function(){if(this._img_elem){this._img_elem.destroy();this._img_elem=null;}this._imagealign=null;this._notifyTarget=null;this._notifyFn=null;};_pImageAreaControl.on_change_containerRect=function(){if(this._img_elem){this._updateElementPositions();}};_pImageAreaControl.set_image=function(v){v=this._convertImageValue(v);if(this.image!=v){this.image=v;this.on_apply_image();}};_pImageAreaControl.on_apply_image=function(){this._load_image();};_pImageAreaControl.set_imagealign=function(v){if(this.imagealign!=v){this.imagealign=v;this.on_apply_imagealign();}};_pImageAreaControl.on_apply_imagealign=function(){this._imagealign=nexacro.AlignObject(this.imagealign);if(this._img_elem){this._updateElementPositions();}};_pImageAreaControl.set_stretch=function(v){if(this.stretch!=v){this.stretch=v;this.on_apply_stretch();}};_pImageAreaControl.on_apply_stretch=function(){this._updateElementPositions();};_pImageAreaControl._convertImageValue=function(v){if(v){if(v instanceof nexacro.Image){v=v._base64str;}else{v=v.toString();var isBase64=nexacro._checkBase64String(v);if(isBase64){if(v.substring(0,10).toLowerCase()=="data:image"){if(v.substring(0,17).toLowerCase()!="data:image;base64"){var comma_idx=v.indexOf(",");if(comma_idx> -1){var tmp=v.slice(comma_idx+1,v.legnth);v="data:image;base64,"+tmp;}}}else{v="data:image;base64,"+v;}}}}return v;};_pImageAreaControl._on_load_image=function(imgurl,w,h){this._orgwidth=w;this._orgheight=h;this._setImageSize(w,h);this._load_image_completed(imgurl);};_pImageAreaControl._load_image=function(){var control_elem=this.getElement();if(control_elem){var v=nexacro._toString(this.image);var img_elem=this._img_elem;if(v){if(this._getImageType()=="url"){v=nexacro._getURIValue(v);v=nexacro._getImageLocation(v,this._getRefFormBaseUrl());}var image_size=nexacro._getImageSize(v,this._on_load_image,this,undefined,this.image);if(image_size){this._orgwidth=image_size.width;this._orgheight=image_size.height;this._load_image_completed(v);}}else{if(img_elem){img_elem.setElementVisible(false);img_elem.setElementImage("");this._updateElementPositions();this._setImageSize(0,0);}}}};_pImageAreaControl._load_image_completed=function(url){var img_elem=this._img_elem;if(img_elem){var bChange=true;var v=this.image;if(!v){img_elem.setElementVisible(false);img_elem.setElementImage("");this._updateElementPositions();this._setImageSize(0,0);}else{v=v.toString();if(this._getImageType()=="url"){if(v.substring(0,4).toLowerCase()=="url("){v=v.substring(5,v.length-2);}v=nexacro._getImageLocation(v,this._getRefFormBaseUrl());if(v!=url){bChange=false;nexacro._releaseImageUrl(url);}}if(bChange){url=nexacro.UrlObject(url);img_elem.setElementVisible(true);img_elem.setElementImage(url);this._updateElementPositions();}}}var imageviewer=this.parent;if(imageviewer instanceof nexacro.ImageViewer){imageviewer._on_element_swap();imageviewer.on_fire_onload(imageviewer,url);}};_pImageAreaControl._updateElementPositions=function(){var img_elem=this._img_elem;if(img_elem){this._recalcImageSize();var halign=this._imagealign?this._imagealign.halign:"center";var valign=this._imagealign?this._imagealign.valign:"middle";var client_width=this._getClientWidth();var client_height=this._getClientHeight();var imgw=this.imagewidth;var imgh=this.imageheight;var imgpos_x,imgpos_y;switch(halign){case "left":imgpos_x=0;break;case "right":imgpos_x=client_width-imgw;break;default:imgpos_x=Math.floor((client_width-imgw)/2);break;}switch(valign){case "top":imgpos_y=0;break;case "bottom":imgpos_y=client_height-imgh;break;default:imgpos_y=Math.floor((client_height-imgh)/2);break;}img_elem.setElementPosition(imgpos_x,imgpos_y);img_elem.setElementSize(imgw,imgh);}};_pImageAreaControl._recalcImageSize=function(){var stretch=this.stretch;if(!stretch){return;}var width=0,height=0;var image_width=0,image_height=0;var span_width=this._getClientWidth();var span_height=this._getClientHeight();if(stretch=="fit"){width=span_width;height=span_height;}else if(stretch=="fixaspectratio"){image_width=this._orgwidth;image_height=this._orgheight;if(image_width||image_height){var widthPer=image_width?(span_width/image_width):image_width;var heightPer=image_height?(span_height/image_height):image_height;if(widthPer<=heightPer){width=span_width;height=Math.floor(image_height*widthPer);}else{width=Math.floor(image_width*heightPer);height=span_height;}}else{width=image_width;height=image_height;}}else{width=this._orgwidth;height=this._orgheight;}this._setImageSize(width,height);};_pImageAreaControl._setNotifyFn=function(target,fn){this._notifyTarget=target;this._notifyFn=fn;};_pImageAreaControl._setImageSize=function(w,h){this.imagewidth=w;this.imageheight=h;if(this._notifyTarget&&this._notifyFn){this._notifyFn.call(this._notifyTarget,w,h);}};_pImageAreaControl._getImageType=function(){var ret="url";var v=this.image;if(v){if(v.substring(0,17).toLowerCase()=="data:image;base64"){ret="base64";}}return ret;};_pImageAreaControl.getImageCount=function(){var img_elem=this._img_elem;if(img_elem){return img_elem.getImageCount();}return 0;};_pImageAreaControl.getOriginalImageSize=function(){return [this._orgwidth,this._orgheight];};_pImageAreaControl.setImageIndex=function(nIndex){var img_elem=this._img_elem;if(img_elem){img_elem.setImageIndex(parseInt(nIndex)|0);}};delete _pImageAreaControl;}
if(!nexacro.CheckBox){nexacro.CheckBoxChangedEventInfo=function(obj,id,prevalue,postvalue){this.id=this.eventid=id||"onchanged";this.prevalue=prevalue;this.postvalue=postvalue;this.fromobject=this.fromreferenceobject=obj;};var _pCheckBoxChangedEventInfo=nexacro._createPrototype(nexacro.ChangedEventInfo,nexacro.CheckBoxChangedEventInfo);nexacro.CheckBoxChangedEventInfo.prototype=_pCheckBoxChangedEventInfo;_pCheckBoxChangedEventInfo._type_name="CheckBoxChangedEventInfo";delete _pCheckBoxChangedEventInfo;nexacro.CheckBox=function(id,left,top,width,height,right,bottom,minwidth,maxwidth,minheight,maxheight,parent){nexacro._IconText.call(this,id,left,top,width,height,right,bottom,minwidth,maxwidth,minheight,maxheight,parent);};var _pCheckBox=nexacro._createPrototype(nexacro._IconText,nexacro.CheckBox);nexacro.CheckBox.prototype=_pCheckBox;_pCheckBox._type_name="CheckBox";_pCheckBox.value=false;_pCheckBox.readonly=false;_pCheckBox.falsevalue=null;_pCheckBox.truevalue=null;_pCheckBox.tabstop=true;_pCheckBox._is_focus_accept=true;_pCheckBox._use_selected_status=true;_pCheckBox._use_readonly_status=true;_pCheckBox.accessibilityrole="checkbox";_pCheckBox._event_list={"canchange":1,"onchanged":1,"onclick":1,"ondrag":1,"ondragenter":1,"ondragmove":1,"ondragleave":1,"ondrop":1,"onkeydown":1,"onkeyup":1,"onkillfocus":1,"onsetfocus":1,"onlbuttondown":1,"onlbuttonup":1,"onrbuttondown":1,"onrbuttonup":1,"onmousedown":1,"onmouseup":1,"onmouseenter":1,"onmousemove":1,"onmouseleave":1,"onmove":1,"onsize":1,"oncontextmenu":1,"ontouchstart":1,"ontouchmove":1,"ontouchend":1};_pCheckBox.on_created_contents=function(win){nexacro._IconText.prototype.on_created_contents.call(this,win);this._setAccessibilityStatChecked(this.isChecked());};_pCheckBox.on_attach_contents_handle=function(win){nexacro._IconText.prototype.on_attach_contents_handle.call(this,win);this._setAccessibilityStatChecked(this.isChecked());};_pCheckBox.on_destroy_contents=function(){nexacro._IconText.prototype.on_destroy_contents.call(this);this.falsevalue=null;this.truevalue=null;};_pCheckBox.on_init_bindSource=function(columnid,propid,ds){if(propid=="value"){this._setValue(this._changeValue(undefined));this.on_apply_value();}};_pCheckBox.on_change_bindSource=function(propid,ds,row,col,index){if(propid=="value"){this._setValue(this._changeValue(ds.getColumn(row,col)));this.on_apply_value();}};_pCheckBox.on_getBindableProperties=function(){return "value";};_pCheckBox.on_get_accessibility_label=function(){return this.text?this.text:"";};_pCheckBox._on_hotkey=function(key_code,alt_key,ctrl_key,shift_key){this.on_fire_onclick("",alt_key,ctrl_key,shift_key, -1, -1, -1, -1, -1, -1,this,this);};_pCheckBox._isFocusAcceptable=function(){return this._is_focus_accept;};_pCheckBox.set_value=function(v){v=this._changeValue(v);if(this.value!=v){if(this.applyto_bindSource("value",v)){this._setValue(v);this.on_apply_value();}}};_pCheckBox.on_apply_value=function(){if(this.isChecked()){this._changeUserStatus("selected",true);}else{this._changeUserStatus("selected",false);}};_pCheckBox.set_truevalue=function(v){if(v!=undefined){v=v.toString();}if(this.truevalue!==v){if(this.isChecked()){if(this.applyto_bindSource("value",v)){this._setValue(v);}}this.truevalue=v;}};_pCheckBox.set_falsevalue=function(v){if(v!=undefined){v=v.toString();}if(this.falsevalue!==v){if(!this.isChecked()){if(this.applyto_bindSource("value",v)){this._setValue(v);}}this.falsevalue=v;}};_pCheckBox.set_readonly=function(v){v=nexacro._toBoolean(v);if(v!=this.readonly){this.readonly=v;this.on_apply_readonly(v);}};_pCheckBox.on_apply_readonly=function(readonly){this._changeStatus("readonly",readonly);};_pCheckBox.isChecked=function(){return this._isChecked(this.value);};_pCheckBox.on_keyup_basic_action=function(key_code,alt_key,ctrl_key,shift_key,refer_comp){if(key_code==nexacro.Event.KEY_SPACE){this.on_fire_onclick("",alt_key,ctrl_key,shift_key, -1, -1, -1, -1, -1, -1,refer_comp,refer_comp);}};_pCheckBox.on_fire_onclick=function(button,alt_key,ctrl_key,shift_key,screenX,screenY,canvasX,canvasY,clientX,clientY,from_comp,from_refer_comp){if(!this.enable||this.readonly){return false;}var pre_val=this.value;var post_val;if(this._isChecked(pre_val)){if(nexacro._isNull(this.falsevalue)){post_val=false;}else{post_val=this.falsevalue;}}else{if(nexacro._isNull(this.truevalue)){post_val=true;}else{post_val=this.truevalue;}}var ret=this.on_fire_canchange(this,pre_val,post_val);if(ret){if(this.applyto_bindSource("value",post_val)){this._setValue(post_val);}if(pre_val!==post_val){this.on_fire_onchanged(this,pre_val,post_val);}this.on_apply_value();}return nexacro.Component.prototype.on_fire_onclick.call(this,button,alt_key,ctrl_key,shift_key,screenX,screenY,canvasX,canvasY,clientX,clientY,from_comp,from_refer_comp);};_pCheckBox.on_fire_canchange=function(obj,prevalue,postvalue){if(this.canchange&&this.canchange._has_handlers){var evt=new nexacro.CheckBoxChangedEventInfo(this,"canchange",prevalue,postvalue);return this.canchange._fireCheckEvent(this,evt);}return true;};_pCheckBox.on_fire_onchanged=function(obj,prevalue,postvalue){if(this.onchanged&&this.onchanged._has_handlers){var evt=new nexacro.CheckBoxChangedEventInfo(this,"onchanged",prevalue,postvalue);return this.onchanged._fireEvent(this,evt);}};_pCheckBox._setValue=function(v){this.value=v;this._setAccessibilityStatChecked(this.isChecked());};_pCheckBox._isChecked=function(value){if(this.truevalue!=null){if(this.falsevalue!=null){if(value===this.falsevalue||value===undefined){return false;}if(value===this.truevalue||nexacro._toBoolean(value)){return true;}if(this.value===this.truevalue){return true;}return false;}else{if(value===this.truevalue||nexacro._toBoolean(value)){return true;}return false;}}else{if(this.falsevalue!=null){if(value===this.falsevalue){return false;}return true;}else{return nexacro._toBoolean(value);}}};_pCheckBox._changeValue=function(v){var use_truevalue=!nexacro._isNull(this.truevalue);var use_falsevalue=!nexacro._isNull(this.falsevalue);if(nexacro._isNull(v)){if(use_falsevalue){return this.falsevalue;}else{return false;}}v=v.toString();if(use_truevalue){if(v===this.truevalue){return v;}if(use_falsevalue){if(v===this.falsevalue){return v;}else{return this.value;}}else{if(parseInt(v)===0){return 0;}else if(!nexacro._toBoolean(v)){return false;}else{return this.value;}}}else{if(use_falsevalue){if(v===this.falsevalue){return v;}else if(parseInt(v)===1){return 1;}else if(nexacro._toBoolean(v)){return true;}else{return this.value;}}else{if(parseInt(v)===0){return 0;}else if(parseInt(v)===1){return 1;}else{return nexacro._toBoolean(v);}}}};delete _pCheckBox;}
if(!nexacro.Radio){nexacro.RadioClickEventInfo=function(obj,id,index,itemText,itemValue,button,alt_key,ctrl_key,shift_key,screenX,screenY,canvasX,canvasY,clientX,clientY){nexacro.ClickEventInfo.call(this,obj,id||"onradioclick",button,alt_key,ctrl_key,shift_key,screenX,screenY,canvasX,canvasY,clientX,clientY);this.index=index;this.itemtext=itemText;this.itemvalue=itemValue;};var _pRadioClickEventInfo=nexacro._createPrototype(nexacro.ClickEventInfo,nexacro.RadioClickEventInfo);nexacro.RadioClickEventInfo.prototype=_pRadioClickEventInfo;_pRadioClickEventInfo._type_name="RadioClickEventInfo";delete _pRadioClickEventInfo;nexacro.Radio=function(id,left,top,width,height,right,bottom,minwidth,maxwidth,minheight,maxheight,parent){nexacro.Component.call(this,id,left,top,width,height,right,bottom,minwidth,maxwidth,minheight,maxheight,parent);this._items=[];this._iconsize={};};var _pRadio=nexacro._createPrototype(nexacro.Component,nexacro.Radio);nexacro.Radio.prototype=_pRadio;_pRadio._type_name="Radio";_pRadio._text_elem=null;_pRadio.codecolumn="";_pRadio.columncount=0;_pRadio.datacolumn="";_pRadio.direction="horizontal";_pRadio.index= -1;_pRadio.innerdataset=null;_pRadio.readonly=false;_pRadio.rowcount=0;_pRadio.value=undefined;_pRadio.acceptvaluetype="allowinvalid";_pRadio._default_value=undefined;_pRadio._default_text="";_pRadio._default_index= -1;_pRadio._want_tab=false;_pRadio._want_arrow=true;_pRadio._is_listtype=true;_pRadio._use_readonly_status=true;_pRadio.accessibilityrole="radio";_pRadio._is_first_focus=false;_pRadio._accessibility_index= -1;_pRadio.accessibility=null;_pRadio.itemaccessibility=null;_pRadio.itemaccessibilityenable=true;_pRadio._event_list={"onclick":1,"ondblclick":1,"onkeypress":1,"onkeydown":1,"onkeyup":1,"onkillfocus":1,"onsetfocus":1,"ondrag":1,"ondrop":1,"ondragenter":1,"ondragleave":1,"ondragmove":1,"ondragend":1,"onlbuttondown":1,"onlbuttonup":1,"onrbuttondown":1,"onrbuttonup":1,"onmouseenter":1,"onmouseleave":1,"onmousemove":1,"onmove":1,"onsize":1,"onitemclick":1,"onitemchanged":1,"canitemchange":1,"oninnerdatachanged":1,"onmousedown":1,"onmouseup":1,"oncontextmenu":1,"ontouchstart":1,"ontouchmove":1,"ontouchend":1};_pRadio.on_create_contents=function(){var control_elem=this.getElement();if(control_elem){if(!this.innerdataset){this._createRadioTextElement();}else{this._redrawRadioItem();}}};_pRadio.on_created_contents=function(win){if(!this._innerdataset&&this.innerdataset){this._setInnerDatasetStr(this.innerdataset);}if(this.fittocontents!="none"){this._update_position();}var text_elem=this._text_elem;if(text_elem){text_elem.create(win);}var items=this._items;var item_len=items.length;for(var i=0;i<item_len;i++ ){items[i].on_created(win);}this._setEventHandler("onkeydown",this._on_radio_onkeydown,this);if(nexacro._enableaccessibility){this.on_apply_prop_accessibilitylabel();this.on_apply_prop_itemaccessibilityenable();}};_pRadio.on_destroy_contents=function(){this._destroyRadioTextElement();this._destroyRadioItemControl();this._removeEventHandlerToInnerDataset();};_pRadio._removeEventHandlerToInnerDataset=function(){if(this._innerdataset){this._innerdataset._removeEventHandler("onvaluechanged",this._on_dataset_onvaluechanged,this);this._innerdataset._removeEventHandler("onrowsetchanged",this._on_dataset_onrowsetchanged,this);this._innerdataset=null;}};_pRadio.on_create_contents_command=function(){if(!this._innerdataset&&this.innerdataset){this._setInnerDatasetStr(this.innerdataset);}var str="";var text_elem=this._text_elem;if(text_elem){str+=text_elem.createCommand();}var items=this._items;var item_len=items.length;for(var i=0;i<item_len;i++ ){str+=items[i].createCommand();}return str;};_pRadio.on_attach_contents_handle=function(win){var text_elem=this._text_elem;if(text_elem){text_elem.attachHandle(win);}var items=this._items;var item_len=items.length;for(var i=0;i<item_len;i++ ){items[i].attachHandle(win);}if(this.fittocontents!="none"){this._update_position();}this._setEventHandler("onkeydown",this._on_radio_onkeydown,this);if(nexacro._enableaccessibility){this.on_apply_prop_accessibilitylabel();this.on_apply_prop_itemaccessibilityenable();}};_pRadio.on_change_containerRect=function(width,height){if(this._is_created_contents){var textElem=this._text_elem;if(textElem){textElem.setElementSize(width,height);}else{this._recalcLayout();}}};_pRadio.on_change_containerPos=function(){};_pRadio.on_getBindableProperties=function(){return "value";};_pRadio.on_apply_prop_cssclass=function(){var radioitems=this._items;if(radioitems){var item_len=radioitems.length;for(var i=0;i<item_len;i++ ){radioitems[i].on_apply_cssclass();}}};_pRadio.on_apply_prop_enable=function(enable){var radioitems=this._items;if(radioitems){var item_len=radioitems.length;for(var i=0;i<item_len;i++ ){radioitems[i]._setEnable(enable);}}};_pRadio.on_init_bindSource=function(columnid,propid){if(propid=="value"){this.value=undefined;this.text="";this.index= -1;this._doDeselect(this.index);}};_pRadio.on_change_bindSource=function(propid,ds,row,col){if(propid=="value"){var val=ds.getColumn(row,col);val=this._convertValueType(val,true);this._setValue(val);var inner_ds=this._innerdataset;if(!inner_ds){return true;}var post_index=inner_ds.findRow(this.codecolumn,val);this._block_read_aria_stat=true;this._doDeselect(this.index);this._setIndex(post_index);this._doSelect(post_index);if(!this._select_act){this._default_value=val;this._default_index=post_index;}this._block_read_aria_stat=false;}};_pRadio._getDlgCode=function(keycode,altKey,ctrlKey,shiftKey){var want_tab,_want_arrow;if(keycode&&(keycode==nexacro.Event.KEY_TAB)){want_tab=this._getPreCalculateWantTab(keycode,shiftKey);}else{_want_arrow=this._want_arrow;}if(this._is_first_focus){this._is_first_focus=false;}return {want_tab:want_tab,want_return:false,want_escape:false,want_chars:false,want_arrows:_want_arrow};};_pRadio._setFocus=function(bResetScroll,dir){this._focus_direction=dir;var retn=this.setFocus(bResetScroll);this._focus_direction= -1;return retn;};_pRadio._on_focus=function(self_flag,evt_name,lose_focus,refer_lose_focus,new_focus,refer_new_focus){var retn=false;var focusdir=this._focus_direction;if(evt_name=="tabkey"){focusdir=0;}else if(evt_name=="shifttabkey"){focusdir=1;}else if(evt_name=="downkey"){focusdir=2;}else if(evt_name=="upkey"){focusdir=3;}if(self_flag==false){this._focus_direction= -1;if(this._isEnable()){this._want_arrow=true;}else{this._want_arrow=false;}}if(focusdir>=0){retn=nexacro.Component.prototype._on_focus.call(this,self_flag,evt_name,lose_focus,refer_lose_focus,new_focus,refer_new_focus);if(self_flag==false){var comp,items=this._items;if(focusdir<2){if(focusdir==0){this._accessibility_index= -1;}else{this._accessibility_index=items.length-1;}if(items.length>0){this._is_first_focus=true;if(this.index> -1){comp=items[this.index];if(comp){this._accessibility_index=this.index;comp._on_focus(true);comp._changeUserStatus("selected",true);}}}}else{if(nexacro._enableaccessibility){if(!this.readonly){if(focusdir==2){items=this._items;this._is_first_focus=true;if(!this._isAccessibilityEnable()){this._accessibility_index=0;comp=items[this._accessibility_index];if(comp){comp._on_focus(true);}}else{this._accessibility_index= -1;}}else if(focusdir==3){items=this._items;this._is_first_focus=true;this._accessibility_index=items.length-1;comp=items[this._accessibility_index];if(comp){comp._on_focus(true);}}}}}}}else{retn=nexacro.Component.prototype._on_focus.call(this,self_flag,evt_name,lose_focus,refer_lose_focus,new_focus,refer_new_focus);}return retn;};_pRadio._on_getAccessibilityAdditionalLabel=function(){if(this._isAccessibilityEnable()&&!this._is_first_focus){var count=0;var items=this._items;if(items){count=items.length;}return ( +this.index+1)+" "+count;}return "";};_pRadio._on_getAccessibilityAdditionalRole=function(){var _role="";if(!this._is_first_focus&&this._getAccessibilityRole(this.accessibility=="radio")){_role=" radio";}return _role;};_pRadio.on_get_accessibility_label=function(){var label="";if(!this._is_first_focus){label=this.text?this.text:this.value;}return label;};_pRadio._on_getFitSize=function(){var control_elem=this.getElement();if(control_elem){var total_w=0;var total_h=0;var border=this._getCurrentStyleBorder();if(border){total_w+=border._getBorderWidth();total_h+=border._getBorderHeight();}var padding=this._getCurrentStylePadding();if(padding){total_w+=padding.left+padding.right;total_h+=padding.top+padding.bottom;}var ds=this._innerdataset;var items=this._items;var item_len=items.length;if(ds&&item_len){var dir=this.direction;var priority_matrix;var radio_columncount=this.columncount;var radio_rowcount=this.rowcount;var ds_rowcount=ds.getRowCount();var apply_colcnt=0;var apply_rowcnt=0;var i,j;var item_size;var item_index=0;if(radio_columncount== -1&&radio_rowcount== -1){for(i=0;i<item_len;i++ ){item_size=items[i]._on_getFitSize();if(dir=="horizontal"){total_h=Math.max(total_h,item_size[1]);total_w+=item_size[0];}else{total_h+=item_size[1];total_w=Math.max(total_w,item_size[0]);}}}else{if(dir=="horizontal"){priority_matrix="col";if(radio_columncount>0){apply_colcnt=radio_columncount;}else if((radio_columncount== -1&&(radio_rowcount== -1||radio_rowcount==0))||(radio_columncount==0&&(radio_rowcount==0||radio_rowcount==ds_rowcount))){apply_colcnt=1;}else if(radio_columncount== -1&&radio_rowcount>1){apply_colcnt=Math.round(ds_rowcount/radio_rowcount);}else if(radio_rowcount>0){apply_colcnt=Math.ceil(ds_rowcount/radio_rowcount);if((apply_colcnt*radio_rowcount)<ds_rowcount){apply_colcnt++ ;}}else{apply_colcnt=ds_rowcount;}if(apply_colcnt>ds_rowcount){apply_colcnt=ds_rowcount;}apply_rowcnt=parseInt(ds_rowcount/apply_colcnt)|0;if((ds_rowcount>apply_colcnt)&&(ds_rowcount%apply_colcnt)>0){apply_rowcnt++ ;}}else{if(radio_rowcount>0){apply_rowcnt=radio_rowcount;}else if(radio_columncount>0){apply_rowcnt=parseInt(ds_rowcount/radio_columncount);if((radio_columncount*apply_rowcnt)<ds_rowcount){apply_rowcnt++ ;}}else{apply_rowcnt=1;}if(apply_rowcnt>0){priority_matrix="row";apply_colcnt=parseInt(ds_rowcount/apply_rowcnt)|0;}else{priority_matrix="col";apply_colcnt=radio_columncount;}if(apply_colcnt<=0){apply_colcnt=1;}if(priority_matrix=="row"&&(ds_rowcount>apply_rowcnt)&&(ds_rowcount%apply_rowcnt)>0){apply_colcnt++ ;}}var maxsize_col=[];for(i=0;i<apply_colcnt;i++ ){maxsize_col[i]=0;}if(priority_matrix=="col"){for(i=0;i<apply_rowcnt;i++ ){for(j=0;j<apply_colcnt;j++ ){if(ds_rowcount<=item_index){break;}item_size=items[item_index]._on_getFitSize();if(maxsize_col[j]<item_size[0]){maxsize_col[j]=item_size[0];}item_index++ ;}}}else{for(i=0;i<apply_colcnt;i++ ){for(j=0;j<apply_rowcnt;j++ ){if(ds_rowcount<=item_index){break;}item_size=items[item_index]._on_getFitSize();if(maxsize_col[i]<item_size[0]){maxsize_col[i]=item_size[0];}item_index++ ;}}}for(i=0;i<apply_colcnt;i++ ){total_w+=maxsize_col[i];}if(item_size){total_h+=item_size[1]*apply_rowcnt;}}}return [total_w,total_h];}return [this._adjust_width,this._adjust_height];};_pRadio.on_fire_sys_onaccessibilitygesture=function(direction){var ret=false;var items=this._items;if(items&&items.length>0){if(this._accessibility_index==undefined&&this.index> -1){this._accessibility_index=this.index;}if(direction>0){this._accessibility_index++ ;}else{this._accessibility_index-- ;}if(items[this._accessibility_index]){ret=true;items[this._accessibility_index]._setAccessibilityNotifyEvent();}}return ret;};_pRadio._setAccessibilityNotifyEvent=function(direction){var items=this._items;if(items&&items.length>0){var obj=null;this._accessibility_index= -1;if(this._accessibility_index<0||this._accessibility_index>=items.length){if(direction==undefined){direction=1;}if(direction>0){this._accessibility_index=0;}else{this._accessibility_index=items.length-1;}}obj=items[this._accessibility_index];if(obj){return obj._setAccessibilityNotifyEvent();}}else{return nexacro.Component.prototype._setAccessibilityNotifyEvent.call(this,direction);}};_pRadio._setAccessibilityInfoByHover=function(control){if(control){if(control.parent instanceof nexacro._RadioItemControl){control=control.parent;}this._accessibility_index=control._index;return control._setAccessibilityNotifyEvent();}else{return nexacro.Component.prototype._setAccessibilityNotifyEvent.call(this);}};_pRadio.set_text=nexacro._emptyFn;_pRadio._convertValueType=function(v,bapplyrule){var ret;if(bapplyrule){ret=nexacro.Component.prototype._convertValueType.call(this,v);}else{ret=nexacro._isNull(v)?v:nexacro._toString(v);}return ret;};_pRadio.set_value=function(v){v=this._convertValueType(v);if(this.value!=v){if(this.acceptvaluetype=="ignoreinvalid"){var ds=this._innerdataset;var code=this.codecolumn;var index= -1;if(ds&&code){index=ds.findRow(code,v);if(index<0){return;}}}this._select_act=true;if(!this.applyto_bindSource("value",v)){this._select_act=false;return;}this._select_act=false;this.value=v;this.on_apply_value(v);}};_pRadio.on_apply_value=function(value){var ds=this._innerdataset;var code=this.codecolumn;if(ds&&code){var index=ds.findRow(code,value);this._setIndex(index);this._block_read_aria_stat=true;this._doDeselect(this._default_index);this._doSelect(index);this._block_read_aria_stat=false;this._default_value=value;this._default_index=this.index;}};_pRadio.set_index=function(v){if(isNaN(v= +v)||v< -1){return;}if(this.index!=v){this.index=v;this.on_apply_index(v);}};_pRadio.on_apply_index=function(index){var ds=this._innerdataset;var code=this.codecolumn?this.codecolumn:this.datacolumn;var val;if(ds&&code){if(!nexacro._isNull(index)&&index>=0&&index<ds.getRowCount()){val=ds.getColumn(index,code);val=this._convertValueType(val,true);}else{index=this.index= -1;}if(this.value!=val){this._select_act=true;if(!this.applyto_bindSource("value",val)){this.index=this._default_index;this._select_act=false;return;}this._select_act=false;this._setValue(val);}this._doDeselect(this._default_index);this._doSelect(index);this._default_value=val;this._default_index=index;if(this._isAccessibilityEnable()){this.on_apply_accessibility();}}};_pRadio.set_readonly=function(v){v=nexacro._toBoolean(v);if(this.readonly!=v){this.readonly=v;this.on_apply_readonly(v);}};_pRadio.on_apply_readonly=function(readonly){var items=this._items;var item_len=items.length;var bReadonly=readonly?true:false;this._changeStatus("readonly",bReadonly);for(var i=0;i<item_len;i++ ){items[i]._changeStatus("readonly",bReadonly);}};_pRadio.set_datacolumn=function(v){if(this.datacolumn!=v){this.datacolumn=v;this.on_apply_datacolumn(v);}};_pRadio.on_apply_datacolumn=function(datacolumn){var control_elem=this.getElement();var ds=this._innerdataset;if(control_elem&&ds){var val;var data=datacolumn==""?this.codecolumn:datacolumn;var i,n;var items=this._items;for(i=0,n=items.length;i<n;i++ ){val=ds.getColumn(i,data);if(val){items[i].set_text(val);if(this.index==i){this._setText(val);}}else{items[i].set_text("");this._setText("");}}this._updateItemInfo();}};_pRadio.set_codecolumn=function(v){if(this.codecolumn!=v){this.codecolumn=v;this.on_apply_codecolumn(v);}};_pRadio.on_apply_codecolumn=function(codecolumn){var control_elem=this.getElement();var ds=this._innerdataset;if(control_elem&&ds){this.on_apply_index(this.index);if(!this.datacolumn){this.on_apply_datacolumn(this.datacolumn);}this._updateItemInfo();}};_pRadio.set_innerdataset=function(v){if(typeof v!="string"){this.setInnerDataset(v);return;}if(this.innerdataset!=v||(this.innerdataset&&!this._innerdataset)){this._setInnerDatasetStr(v);this.on_apply_innerdataset(this._innerdataset);}};_pRadio.on_apply_innerdataset=function(ds){if(ds){ds._setEventHandler("onvaluechanged",this._on_dataset_onvaluechanged,this);ds._setEventHandler("onrowsetchanged",this._on_dataset_onrowsetchanged,this);}var control_elem=this.getElement();if(control_elem){this._destroyRadioItemControl();if(ds){this._redrawRadioItem();}else{this._createRadioTextElement();}}};_pRadio.set_columncount=function(v){if(isNaN(v= +v)||v< -1){return;}if(this.columncount!=v){this.columncount=v;this.on_apply_columncount(v);}};_pRadio.on_apply_columncount=function(){this._recalcLayout();};_pRadio.set_rowcount=function(v){if(isNaN(v= +v)||v< -1){return;}if(this.rowcount!=v){this.rowcount=v;this.on_apply_rowcount(v);}};_pRadio.on_apply_rowcount=function(){this._recalcLayout();};_pRadio.set_direction=function(v){var direction_enum=["horizontal","vertical"];if(direction_enum.indexOf(v)== -1){return;}if(this.direction!=v){this.direction=v;this.on_apply_direction(v);}};_pRadio.on_apply_direction=function(){this._recalcLayout();};_pRadio.set_itemaccessibilityrole=function(val){if(val){this.itemaccessibilityrole=val;this.on_apply_itemaccessibilityrole(val);}else{this.itemaccessibilityrole="";this.on_apply_itemaccessibilityrole(" ");}};_pRadio.on_apply_itemaccessibilityrole=function(val){var items=this._items;if(items){var rowcount=items.length;for(var i=0;i<rowcount;i++ ){items[i].set_accessibilityrole(val?val:this.itemaccessibilityrole);}}};_pRadio.set_itemaccessibilitylabel=function(val){if(val){this.itemaccessibilitylabel=val;this.on_apply_itemaccessibilitylabel(val);}else{this.itemaccessibilitylabel="";this.on_apply_itemaccessibilitylabel(" ");}};_pRadio.on_apply_itemaccessibilitylabel=function(val){var items=this._items;if(items){var rowcount=items.length;for(var i=0;i<rowcount;i++ ){items[i].set_accessibilitylabel(val?val:this.itemaccessibilitylabel);}}};_pRadio.set_itemaccessibilitydescription=function(val){if(val){this.itemaccessibilitydescription=val;this.on_apply_itemaccessibilitydescription(val);}else{this.itemaccessibilitydescription="";this.on_apply_itemaccessibilitydescription(" ");}};_pRadio.on_apply_itemaccessibilitydescription=function(val){var items=this._items;if(items){var rowcount=items.length;for(var i=0;i<rowcount;i++ ){items[i].set_accessibilitydescription(val?val:this.itemaccessibilitydescription);}}};_pRadio.set_itemaccessibilityaction=function(val){if(val){this.itemaccessibilityaction=val;this.on_apply_itemaccessibilityaction(val);}else{this.itemaccessibilityaction="";this.on_apply_itemaccessibilityaction(" ");}};_pRadio.on_apply_itemaccessibilityaction=function(val){var items=this._items;if(items){var rowcount=items.length;for(var i=0;i<rowcount;i++ ){items[i].set_accessibilityaction(val?val:this.itemaccessibilityaction);}}};_pRadio.set_itemaccessibilitydesclevel=function(val){if(val){this.itemaccessibilitydesclevel=val;this.on_apply_itemaccessibilitydesclevel(val);}else{this.itemaccessibilitydesclevel="";this.on_apply_itemaccessibilitydesclevel(" ");}};_pRadio.on_apply_itemaccessibilitydesclevel=function(val){var items=this._items;if(items){var rowcount=items.length;for(var i=0;i<rowcount;i++ ){items[i].set_accessibilitydesclevel(val?val:this.itemaccessibilitydesclevel);}}};_pRadio.set_acceptvaluetype=function(v){var type_enum=["allowinvalid","ignoreinvalid"];if(type_enum.indexOf(v)== -1){return;}this.acceptvaluetype=v;};_pRadio.getCount=function(){return this._items.length;};_pRadio.getInnerDataset=function(){return this._innerdataset;};_pRadio.setInnerDataset=function(obj){this._removeEventHandlerToInnerDataset();if(!obj){this._innerdataset=null;this.innerdataset="";this.on_apply_innerdataset(this._innerdataset);}else if(obj instanceof nexacro.Dataset){this._innerdataset=obj;this.innerdataset=obj.id;this.on_apply_innerdataset(obj);}};_pRadio._on_radio_onkeydown=function(obj,e){var E=nexacro.Event;var keycode=e.keycode;if(nexacro._enableaccessibility){if(keycode==E.KEY_UP||keycode==E.KEY_DOWN){return false;}}if(keycode==nexacro.Event.KEY_TAB){this._want_tab=false;this._is_first_focus=false;}else if(keycode==E.KEY_LEFT||keycode==E.KEY_RIGHT||keycode==E.KEY_UP||keycode==E.KEY_DOWN){var ds=this._innerdataset;if(!ds||this.readonly){return false;}var row_cnt=ds.getRowCount();if(row_cnt<1){return false;}var pre_index=this._default_index;var pre_value=this._default_value;var pre_text=this._default_text;var op=(keycode==E.KEY_LEFT||keycode==E.KEY_UP)? -1:(keycode==E.KEY_RIGHT||keycode==E.KEY_DOWN)?1:0;var idx=this.index+op;if(idx>=row_cnt){idx=0;}else if(idx<0){idx=row_cnt-1;}var radioitem=this._getItem(idx);var ret=this.on_fire_canitemchange(obj,pre_index,pre_text,pre_value,idx,radioitem.text,radioitem._value);if(ret){this._accessibility_index=idx;if(row_cnt!=idx&&row_cnt>=idx&&0<=idx){this.set_index(idx);if(idx!=pre_index){this.on_fire_onitemchanged(obj,pre_index,pre_text,pre_value,idx,radioitem.text,radioitem._value);}}if(nexacro._enableaccessibility){radioitem._on_focus(true,op== -1?"keyleft":(op==1?"keyright":undefined));radioitem._changeUserStatus("selected",true);}}}return false;};_pRadio.on_fire_user_onkeydown=function(keycode,alt_key,ctrl_key,shift_key,fire_comp,refer_comp){var items=this._items;if(keycode==nexacro.Event.KEY_SPACE){if(!this.readonly){if(this._accessibility_index> -1){items[this._accessibility_index]._changeUserStatus("focus",true);this.set_index(this._accessibility_index);}}}else{if(nexacro._enableaccessibility){if(keycode==nexacro.Event.KEY_UP||keycode==nexacro.Event.KEY_DOWN){var accIdx=this._accessibility_index;var count=items.length;var comp;if(keycode==nexacro.Event.KEY_UP){if(accIdx<0){this._want_arrow=false;}else{this._accessibility_index=accIdx+= -1;comp=items[accIdx];if(comp){comp._on_focus(true,"keyup");}else{if(accIdx== -1){var last_focused=this._last_focused;if(last_focused){this._doDefocus(last_focused,true);}else{this._doDefocus(this);}this._on_focus(true,"keyup");}}}}else{if((accIdx+1)>=count){this._want_arrow=false;}else{this._accessibility_index=accIdx+=1;comp=items[accIdx];if(comp){comp._on_focus(true,"keydown");}}}}}}return nexacro.Component.prototype.on_fire_user_onkeydown.call(this,keycode,alt_key,ctrl_key,shift_key,fire_comp,refer_comp);};_pRadio._on_radioitem_onclick=function(obj){if(!this.enable||this.readonly==true){return false;}var pre_index=this._default_index;var pre_value=this._default_value;var pre_text=this._default_text;this.on_fire_onitemclick(obj,obj._index,obj.text,obj._value);if(this.index!=obj._index){var post_index=obj._index;var post_value=obj._value;var post_text=obj.text;var ret=this.on_fire_canitemchange(obj,pre_index,pre_text,pre_value,post_index,post_text,post_value);if(ret){this.set_index(post_index);if(this.index!=pre_index||pre_index== -1){this.on_fire_onitemchanged(obj,pre_index,pre_text,pre_value,post_index,post_text,post_value);}if(nexacro._enableaccessibility){this._accessibility_index=obj._index;obj._on_focus(true);}}}};_pRadio._on_icon_onload=function(){this._recalcLayout();};_pRadio._on_dataset_onvaluechanged=function(obj,e){if(this._is_created){this._redrawRadioItem();this.on_fire_oninnerdatachanged(obj,e.oldvalue,e.newvalue,e.columnid,e.col,e.row);}};_pRadio._on_dataset_onrowsetchanged=function(){this._redrawRadioItem();};_pRadio.on_fire_canitemchange=function(obj,preindex,pretext,prevalue,postindex,posttext,postvalue){if(this.canitemchange&&this.canitemchange._has_handlers){var evt=new nexacro.ItemChangeEventInfo(this,"canitemchange",preindex,pretext,prevalue,postindex,posttext,postvalue);return this.canitemchange._fireCheckEvent(this,evt);}return true;};_pRadio.on_fire_onitemchanged=function(obj,preindex,pretext,prevalue,postindex,posttext,postvalue){if(this.onitemchanged&&this.onitemchanged._has_handlers){var evt=new nexacro.ItemChangeEventInfo(this,"onitemchanged",preindex,pretext,prevalue,postindex,posttext,postvalue);return this.onitemchanged._fireEvent(this,evt);}};_pRadio.on_fire_onitemclick=function(obj,index,text,value){if(this.onitemclick&&this.onitemclick._has_handlers){var evt=new nexacro.ItemClickEventInfo(this,"onitemclick",index,text,value);return this.onitemclick._fireEvent(this,evt);}return false;};_pRadio.on_fire_oninnerdatachanged=function(obj,oldvalue,newvalue,columnid,col,row){if(this.oninnerdatachanged&&this.oninnerdatachanged._has_handlers){var evt=new nexacro.InnerdataChangedEventInfo(obj,"oninnerdatachanged",oldvalue,newvalue,columnid,col,row);return this.oninnerdatachanged._fireEvent(this,evt);}return true;};_pRadio._createRadioItemControl=function(){var ds=this._innerdataset;if(ds){var rows=ds.getRowCount();if(rows>0){var item,text,value;var create_only=this._is_created?false:true;var codecolumn=this.codecolumn;var datacolumn=this.datacolumn==""?codecolumn:this.datacolumn;for(var i=0;i<rows;i++ ){text=ds.getColumn(i,datacolumn);value=ds.getColumn(i,codecolumn);value=this._convertValueType(value,true);item=new nexacro._RadioItemControl("radioitem"+i,0,0,0,0,null,null,null,null,null,null,this);item.set_text(text);item._setItemInfo(i,value);item.createComponent(create_only);item._setEventHandler("onclick",this._on_radioitem_onclick,this);if(nexacro._enableaccessibility){item._setAccessibilityInfoIndex(i);item._setAccessibilityInfoCount(rows);}this._items[i]=item;}}}};_pRadio._updateItemInfo=function(){var ds=this._innerdataset;if(!ds){return;}var rows=ds.getRowCount();if(rows>0){var codecolumn=this.codecolumn;for(var i=0;i<rows;i++ ){var value=ds.getColumn(i,codecolumn);value=this._convertValueType(value,true);var item=this._items[i];item._setItemInfo(i,value);if(nexacro._enableaccessibility){item._setAccessibilityInfoIndex(i);item._setAccessibilityInfoCount(rows);}this._items[i]=item;}}};_pRadio._createRadioTextElement=function(){var control_elem=this.getElement();var text_elem=this._text_elem;if(!text_elem&&control_elem){text_elem=this._text_elem=new nexacro.TextBoxElement(control_elem);text_elem.setElementSize(this._getClientWidth(),this._getClientHeight());if(this.textAlign){text_elem.setElementTextAlign(this.textAlign);}if(this.verticalAlign){text_elem.setElementVerticalAlign(this.verticalAlign);}text_elem.setElementText(this.name);if(this._is_created){text_elem.create(this._getWindow());}}};_pRadio._destroyRadioItemControl=function(){var i,n;var items=this._items;for(i=0,n=items.length;i<n;i++ ){items[i].destroy();items[i]=null;}this._items=[];};_pRadio._destroyRadioTextElement=function(){var text_elem=this._text_elem;if(text_elem){text_elem.destroy();this._text_elem=null;}};_pRadio._recalcLayout=function(){var control_elem=this.getElement();if(control_elem){var ds=this._innerdataset;var items=this._items;var item_len=items.length;if(ds&&item_len){var priority_matrix;var fittocontents=this.fittocontents;var dir=this.direction;var radio_columncount=this.columncount;var radio_rowcount=this.rowcount;var ds_rowcount=ds.getRowCount();var apply_colcnt=1;var apply_rowcnt=ds_rowcount;var client_width=this._getClientWidth();var client_height=this._getClientHeight();var item_left=0;var item_top=0;var item_width,item_height;var i,j;var item,item_size,item_index=0;var max_columnsize=[];var max_rowsize=[];var max_col=1;if(radio_columncount== -1&&radio_rowcount== -1){apply_rowcnt=1;apply_colcnt=0;var sum_width=0;for(i=0;i<item_len;i++ ){item_size=items[i]._on_getFitSize();sum_width+=item_size[0];if(client_width<sum_width){apply_rowcnt++ ;sum_width=item_size[0];apply_colcnt=1;}else{apply_colcnt++ ;max_col=max_col>apply_colcnt?max_col:apply_colcnt;}}apply_colcnt=max_col;item_index=0;for(i=0;i<apply_rowcnt;i++ ){item_left=0;for(j=0;j<apply_colcnt;j++ ){if(ds_rowcount<=item_index){break;}item=items[item_index];item_size=item._on_getFitSize();item_height=client_height/apply_rowcnt;item.move(item_left,item_top,item_size[0],item_height);item_left+=item_size[0];if(item_left>client_width){break;}item_index++ ;}item_top+=item_height;}}else{if(dir=="horizontal"){if(radio_columncount>0){apply_colcnt=radio_columncount;}else if((radio_columncount<0&&radio_rowcount<0)||(radio_columncount<0&&radio_rowcount==0)||(radio_columncount==0&&radio_rowcount==0)||(radio_columncount==0&&radio_rowcount==ds_rowcount)){apply_colcnt=1;}else if(radio_columncount<0&&(radio_columncount<radio_rowcount)&&(radio_rowcount>1)){apply_colcnt=Math.round(apply_rowcnt/radio_rowcount);}else if(radio_rowcount>0){apply_colcnt=Math.ceil(apply_rowcnt/radio_rowcount);if((apply_colcnt*radio_rowcount)<apply_rowcnt){apply_colcnt++ ;apply_rowcnt=(((apply_colcnt*radio_rowcount)-apply_rowcnt)>=apply_colcnt)?radio_rowcount-1:radio_rowcount;}}else{apply_colcnt=apply_rowcnt;}if(apply_colcnt>apply_rowcnt){apply_colcnt=apply_rowcnt;}priority_matrix="col";apply_rowcnt=parseInt(ds_rowcount/apply_colcnt)|0;if((ds_rowcount>apply_colcnt)&&(ds_rowcount%apply_colcnt)>0){apply_rowcnt++ ;}}else{if(radio_rowcount>0){apply_rowcnt=radio_rowcount;}else if(radio_columncount>0){apply_rowcnt=parseInt(ds_rowcount/radio_columncount);if((radio_columncount*apply_rowcnt)<ds_rowcount){apply_rowcnt++ ;}}else{apply_rowcnt=1;}if(apply_rowcnt>0){priority_matrix="row";apply_colcnt=parseInt(ds_rowcount/apply_rowcnt)|0;}else{apply_colcnt=radio_columncount;priority_matrix="col";}if(apply_colcnt<=0){apply_colcnt=1;}if(priority_matrix=="row"&&(ds_rowcount>apply_rowcnt)&&(ds_rowcount%apply_rowcnt)>0){apply_colcnt++ ;}}item_width=client_width/apply_colcnt;item_height=client_height/apply_rowcnt;if(priority_matrix=="col"){if(fittocontents=="none"){for(i=0;i<apply_rowcnt;i++ ){for(j=0;j<apply_colcnt;j++ ){if(ds_rowcount<=item_index){break;}item=items[item_index];item.move((item_width*j),(item_height*i),item_width,item_height);item_index++ ;}item_top+=item_height;}}else{for(i=0;i<apply_rowcnt;i++ ){for(j=0;j<apply_colcnt;j++ ){if(ds_rowcount<=item_index){break;}item=items[item_index];item_size=item._on_getFitSize();max_columnsize[j]=max_columnsize[j]?Math.max(max_columnsize[j],item_size[0]):item_size[0];max_rowsize[i]=max_rowsize[i]?Math.max(max_rowsize[i],item_size[1]):item_size[1];item_index++ ;}}item_index=0;for(i=0;i<apply_rowcnt;i++ ){for(j=0;j<apply_colcnt;j++ ){if(ds_rowcount<=item_index){break;}item=items[item_index];if(fittocontents=="both"){item.move(item_left,item_top,max_columnsize[j],max_rowsize[i]);item_left+=max_columnsize[j];}else if(fittocontents=="width"){item.move(item_left,(item_height*i),max_columnsize[j],item_height);item_left+=max_columnsize[j];}else if(fittocontents=="height"){item.move((item_width*j),item_top,item_width,max_rowsize[i]);}item_index++ ;}item_left=0;if(fittocontents=="both"||fittocontents=="height"){item_top+=max_rowsize[i];}else{item_top+=item_height;}}}}else{if(fittocontents=="none"){for(i=0;i<apply_colcnt;i++ ){for(j=0;j<apply_rowcnt;j++ ){if(ds_rowcount<=item_index){break;}item=items[item_index];item.move((item_width*i),(item_height*j),item_width,item_height);item_index++ ;}item_top+=item_height;}}else{for(i=0;i<apply_colcnt;i++ ){for(j=0;j<apply_rowcnt;j++ ){if(ds_rowcount<=item_index){break;}item=items[item_index];item_size=item._on_getFitSize();max_columnsize[i]=max_columnsize[i]?Math.max(max_columnsize[i],item_size[0]):item_size[0];max_rowsize[j]=max_rowsize[j]?Math.max(max_rowsize[j],item_size[1]):item_size[1];item_index++ ;}}item_index=0;for(i=0;i<apply_colcnt;i++ ){for(j=0;j<apply_rowcnt;j++ ){if(ds_rowcount<=item_index){break;}item=items[item_index];if(fittocontents=="both"){item.move(item_left,item_top,max_columnsize[i],max_rowsize[j]);item_top+=max_rowsize[i];}else if(fittocontents=="width"){item.move(item_left,(item_height*j),max_columnsize[i],item_height);item_top+=max_rowsize[i];}else if(fittocontents=="height"){item.move((item_width*i),item_top,item_width,max_rowsize[j]);}item_index++ ;}item_top=0;if(fittocontents=="both"||fittocontents=="width"){item_left+=max_columnsize[i];}else{item_left+=item_width;}}}}}}}};_pRadio._redrawRadioItem=function(){this._destroyRadioTextElement();this._destroyRadioItemControl();this._createRadioItemControl();if(this.value!==undefined){this.on_apply_value(this.value);}else if(this.index> -1){this.on_apply_index(this.index);}this.on_apply_readonly(this.readonly);this._recalcLayout();};_pRadio._doSelect=function(index){var item=this._getItem(index);if(item){item._block_read_aria_stat=this._block_read_aria_stat;item._changeUserStatus("selected",true);item._block_read_aria_stat=false;this._setText(item.text);}else{this._setText("");}};_pRadio._doDeselect=function(index){var item=this._getItem(index);if(item){item._block_read_aria_stat=this._block_read_aria_stat;item._changeUserStatus("selected",false);item._block_read_aria_stat=false;}};_pRadio._doDefocus=function(target,bParent){var _window=this._getWindow();_window._removeFromCurrentFocusPath(target,true);if(bParent){_window._removeFromCurrentFocusPath(this,false);}};_pRadio._setContents=function(str){var doc=nexacro._parseXMLDocument(str);var node=doc.getElementsByTagName("Dataset")[0];if(!node){return false;}var idstr=node.attributes[0].value;var normalDataset=new nexacro.NormalDataset(idstr,this);if(node.firstChild){var childnode=node.firstChild;var strXML="";while(childnode){if(node.nodeType==1){strXML+=nexacro._documentToXml(childnode);}childnode=childnode.nextSibling;}normalDataset._setContents(strXML);}this.set_innerdataset(normalDataset);return true;};_pRadio._setValue=function(v){if(v===null){v="";}this.value=(v===undefined)?v:v.toString();};_pRadio._setIndex=function(v){if((v>0)&&(v>=this._items.length)){v= -1;}this.index=v;};_pRadio._setText=function(v){this.text=v;this._default_text=v;};_pRadio._setInnerDatasetStr=function(str){this._removeEventHandlerToInnerDataset();if(!str){this._innerdataset=null;this.innerdataset="";}else{str=str.replace("@","");this._innerdataset=this._findDataset(str);this.innerdataset=str;}};_pRadio._getItem=function(index){var ret;var items=this._items;if(items.length>0&&index>=0){ret=items[index];}return ret;};_pRadio._getPreCalculateWantTab=function(keycode,shift_key){var ds=this._innerdataset;if(ds){if(this.index> -1){var idx=this.index;if(idx==this._accessibility_index){return false;}}else{var index=this._accessibility_index;if(shift_key){if(index<0){return false;}}else{var totalcnt=ds.getRowCount();if(index+1>totalcnt){return false;}}}}return this._want_tab;};_pRadio._getPreCalculateWantArrow=function(keycode){if(!this._isEnable()){return false;}var ds=this._innerdataset;var index=nexacro._enableaccessibility?this._accessibility_index:this.index;if(ds){var totalcnt=ds.getRowCount();if(keycode==nexacro.Event.KEY_UP){if(!this._isAccessibilityEnable()){return false;}else if((index-1)<0){return false;}}else if(keycode==nexacro.Event.KEY_DOWN){if(!this._isAccessibilityEnable()){return false;}else if((index+1)>=totalcnt){return false;}}}else{return false;}return this._want_arrow;};delete _pRadio;}if(!nexacro._RadioItemControl){nexacro._RadioItemControl=function(id,left,top,width,height,right,bottom,minwidth,maxwidth,minheight,maxheight,parent){nexacro._IconText.call(this,id,left,top,width,height,right,bottom,minwidth,maxwidth,minheight,maxheight,parent);};var _pRadioItemControl=nexacro._createPrototype(nexacro._IconText,nexacro._RadioItemControl);nexacro._RadioItemControl.prototype=_pRadioItemControl;_pRadioItemControl._type_name="RadioItemControl";_pRadioItemControl._index= -1;_pRadioItemControl._value=undefined;_pRadioItemControl._is_subcontrol=true;_pRadioItemControl._use_selected_status=true;_pRadioItemControl._use_readonly_status=true;_pRadioItemControl.accessibilityrole="radioitem";_pRadioItemControl.on_getIDCSSSelector=function(){return "radioitem";};_pRadioItemControl._on_getAccessibilityAdditionalLabel=function(){if(this._isAccessibilityEnable()&&!this.parent._is_first_focus){if(this._index> -1){return ( +this._index+1)+" "+this.parent._items.length;}}return "";};_pRadioItemControl._getAccessibilityLabel=function(accessibility){var label="";if(this.parent._is_first_focus){var parent=this.parent;var p_accessibility=parent.accessibility;label=parent._getAccessibilityParentValue(p_accessibility);}label+=" "+nexacro.Component.prototype._getAccessibilityLabel.call(this,accessibility);return label;};_pRadioItemControl._setItemInfo=function(index,value){this._index=index;this._value=value;};delete _pRadioItemControl;}
if(!nexacro.ListBox){nexacro.ListBox=function(id,left,top,width,height,right,bottom,minwidth,maxwidth,minheight,maxheight,parent){nexacro.Component.call(this,id,left,top,width,height,right,bottom,minwidth,maxwidth,minheight,maxheight,parent);this._selectinfo={index: -1,text:"",value:undefined,obj:null};this._scroll_vpos_queue=[];this._select_multi={"items":[],"map":{},"keys":[],"length":0,"lastselected":null};this._selectinfo_list=[];this._buffer_pages=[];this._initInnerdatasetInfo();};var _pListBox=nexacro._createPrototype(nexacro.Component,nexacro.ListBox);nexacro.ListBox.prototype=_pListBox;_pListBox._type_name="ListBox";_pListBox._temp_item=null;_pListBox.codecolumn="";_pListBox.datacolumn="";_pListBox.multiselect=false;_pListBox.innerdataset=null;_pListBox.readonly=false;_pListBox.index= -1;_pListBox.text="";_pListBox.value=undefined;_pListBox.dragscrolltype="all";_pListBox.selectscrollmode="default";_pListBox.itemheight=undefined;_pListBox.acceptvaluetype="allowinvalid";_pListBox._innerdataset=null;_pListBox._contents_maxwidth=0;_pListBox._contents_maxheight=0;_pListBox._page_rowcount=0;_pListBox._page_rowcount_min=0;_pListBox._shiftKey=false;_pListBox._ctrlKey=false;_pListBox._altKey=false;_pListBox._lbtnDownIdx= -1;_pListBox._want_tab=false;_pListBox._want_arrow=true;_pListBox._shift_select_base_index=null;_pListBox._is_first_focus=false;_pListBox._calc_scroll=false;_pListBox._cnt_resetscroll=0;_pListBox._keep_scrolling=false;_pListBox._is_listtype=true;_pListBox._touch_scrolling=false;_pListBox._is_scrollable=true;_pListBox._use_readonly_status=true;_pListBox._accessibility_index= -1;_pListBox.accessibilityrole="listbox";_pListBox.accessibilityaction="";_pListBox.accessibilitydesclevel="all";_pListBox.accessibilitydescription="";_pListBox.accessibilityenable=true;_pListBox.accessibilitylabel="";_pListBox.itemaccessibilityrole="listboxitem";_pListBox.itemaccessibilityenable=true;_pListBox.itemaccessibilitylabel="";_pListBox.itemaccessibilitydescription="";_pListBox.itemaccessibilityaction="";_pListBox.itemaccessibilitydesclevel="all";_pListBox._event_list={"onclick":1,"ondblclick":1,"onkeypress":1,"onkeydown":1,"onkeyup":1,"onkillfocus":1,"onsetfocus":1,"ondrag":1,"ondragenter":1,"ondragleave":1,"ondragmove":1,"ondrop":1,"onlbuttondown":1,"onlbuttonup":1,"onlongpress":1,"onmouseenter":1,"onmouseleave":1,"onmousemove":1,"onmove":1,"onsize":1,"onrbuttondown":1,"onrbuttonup":1,"onitemclick":1,"onitemdblclick":1,"canitemchange":1,"onitemchanged":1,"oninnerdatachanged":1,"ontouchstart":1,"ontouchmove":1,"ontouchend":1,"onslidestart":1,"onslide":1,"onslideend":1,"onflingstart":1,"onfling":1,"onflingend":1,"oncontextmenu":1,"onitemmouseenter":1,"onvscroll":1,"onhscroll":1,"onmousedown":1,"onmouseup":1,"onmousewheel":1};_pListBox.on_create_contents=function(){this._temp_item=new nexacro._ListBoxItemControl("_temp_item",0,0,0,0,null,null,null,null,null,null,this);this._temp_item.createComponent();};_pListBox.on_created_contents=function(win){if(this.innerdataset){if(!this._innerdataset){this._setInnerDatasetStr(this.innerdataset);}this.on_apply_innerdataset(this._innerdataset);}this._redrawListBoxContents(true);var items=this._getContentsItem();var item_len=items.length;for(var i=0;i<item_len;i++ ){items[i].on_created(win);}this._selectinfo.obj=null;this._selectinfo.index=this.index;this._selectinfo.text=this.text;this._selectinfo.value=this.value;this._setEventHandler("onkeydown",this._on_onkeydown,this);if(nexacro._enableaccessibility){this._want_arrow=true;this.on_apply_prop_accessibilitylabel();}this._is_created=true;this._onRecalcScrollSize();};_pListBox.on_destroy_contents=function(){var item=this._temp_item;if(item){item.destroy();}this._temp_item=null;this._destroyListBoxContents();this._buffer_pages=null;this._removeEventHandlerToInnerDataset();this._removeEventHandler("onkeydown",this._on_onkeydown,this);this._selectinfo=null;this._select_multi=null;this._selectinfo_list.length=0;this._scroll_vpos_queue=null;};_pListBox._removeEventHandlerToInnerDataset=function(){if(this._innerdataset){this._innerdataset._removeEventHandler("onload",this._on_dataset_onload,this);this._innerdataset._removeEventHandler("onvaluechanged",this._on_dataset_onvaluechanged,this);this._innerdataset._removeEventHandler("onrowsetchanged",this._on_dataset_onrowsetchanged,this);this._innerdataset=null;}};_pListBox.on_create_contents_command=function(){if(this.innerdataset){if(!this._innerdataset){this._setInnerDatasetStr(this.innerdataset);}this._parseInnerDataset();}this._redrawListBoxContents(true);var str="";var items=this._getContentsItem();var item_len=items.length;for(var i=0;i<item_len;i++ ){str+=items[i].createCommand();}return str;};_pListBox.on_attach_contents_handle=function(win){var items=this._getContentsItem();var item_len=items.length;for(var i=0;i<item_len;i++ ){items[i].attachHandle(win);}this._selectinfo.obj=null;this._selectinfo.index=this.index;this._selectinfo.text=this.text;this._selectinfo.value=this.value;this._setEventHandler("onkeydown",this._on_onkeydown,this);if(nexacro._enableaccessibility){this.on_apply_prop_accessibilitylabel();}this._is_created=true;this._onRecalcScrollSize();};_pListBox.on_change_containerRect=function(){if(this._is_created_contents){var itemheight=this._getItemHeight();var client_h=this._getClientHeight();var page_rowcount=itemheight?client_h/itemheight:0;if(this._page_rowcount!=page_rowcount){this._redrawListBoxContents(false);}else{this._recalcLayout();}if(!this._calc_scroll){this._onRecalcScrollSize();}else{this._cnt_resetscroll++ ;this._onResetScrollBar();}}};_pListBox.on_change_containerPos=function(){};_pListBox.on_getBindableProperties=function(){return "value";};_pListBox.on_killfocus_basic_action=function(){if(nexacro._enableaccessibility){var accidx=this._accessibility_index;var rowobj=this._getItem(accidx);if(rowobj){rowobj._changeStatus("mouseover",false);}}};_pListBox.on_apply_prop_enable=function(enable){nexacro.Component.prototype.on_apply_prop_enable.call(this,enable);if(!enable){enable=this.enable;}var items=this._getContentsItem();var item_len=items.length;for(var i=0;i<item_len;i++ ){items[i]._setEnable(enable);}};_pListBox.on_apply_custom_class=function(){var items=this._getContentsItem();var itemlen=items.length;for(var i=0;i<itemlen;i++ ){items[i].on_apply_prop_class();}};_pListBox.on_apply_prop_cssclass=function(){var items=this._getContentsItem();var itemlen=items.length;for(var i=0;i<itemlen;i++ ){items[i].on_apply_cssclass();}};_pListBox.on_init_bindSource=function(columnid,propid,ds){if(this._is_created){this._redrawListBoxContents(true);this._onRecalcScrollSize();}if(propid=="value"){this.set_value(undefined);}};_pListBox.on_change_bindSource=function(propid,ds,row,col,index){if(propid=="value"){var val=ds.getColumn(row,col);val=this._convertValueType(val,true);if(this.value!=val){ds=this._innerdataset;var codecolumn=this.codecolumn;var datacolumn=this.datacolumn==""?codecolumn:this.datacolumn;if(ds&&codecolumn){index=ds.findRow(codecolumn,val);var text=val;if(index> -1){text=ds.getColumn(index,datacolumn);}else{this._do_not_change_value=true;}this._setValue(val);this._setIndex(index);this._setText(text);this._doSelect(index,false);this._do_not_change_value=false;}if(this._is_created){this._redrawListBoxContents(true);this._onRecalcScrollSize();}}}};_pListBox._onRecalcScrollSize=function(){var control_elem=this.getElement();if(control_elem){var client_w=this._getClientWidth();var client_h=this._getClientHeight();var scrollWidth=Math.max(this._contents_maxwidth,client_w);var scrollHeight=Math.max(this._contents_maxheight,client_h);this._calc_scroll=true;control_elem.setElementScrollMaxSize(scrollWidth,scrollHeight);if(!this._cnt_resetscroll){this._onResetScrollBar();}this._calc_scroll=false;this._cnt_resetscroll=0;}};_pListBox._getDlgCode=function(keycode,altKey,ctrlKey,shiftKey){var want_tab,_want_arrow;var hscrollbar=this.hscrollbar;var vscrollbar=this.vscrollbar;if(keycode&&(keycode==nexacro.Event.KEY_TAB)){want_tab=this._want_tab;}else{_want_arrow=this._want_arrow;}if(nexacro._enableaccessibility){this._want_arrow=true;}if(this._is_first_focus){this._is_first_focus=false;}if(ctrlKey){if(keycode==nexacro.Event.KEY_LEFT){if(hscrollbar){_want_arrow=hscrollbar.pos>hscrollbar.min?true:false;}else{_want_arrow=false;}}else if(keycode==nexacro.Event.KEY_UP){if(vscrollbar){_want_arrow=vscrollbar.pos>vscrollbar.min?true:false;}else{_want_arrow=false;}}else if(keycode==nexacro.Event.KEY_RIGHT){if(hscrollbar){_want_arrow=hscrollbar.pos<hscrollbar.max?true:false;}else{_want_arrow=false;}}else if(keycode==nexacro.Event.KEY_DOWN){if(vscrollbar){_want_arrow=vscrollbar.pos<vscrollbar.max?true:false;}else{_want_arrow=false;}}}return {want_tab:want_tab,want_return:false,want_escape:false,want_chars:false,want_arrows:_want_arrow};};_pListBox._setFocus=function(bResetScroll,dir,bInner){this._focus_direction=dir;var retn=this.setFocus(bResetScroll,bInner);this._focus_direction= -1;return retn;};_pListBox._on_focus=function(self_flag,evt_name,lose_focus,refer_lose_focus,new_focus,refer_new_focus){var retn=false;var focusdir=this._focus_direction;if(evt_name=="tabkey"){focusdir=0;}else if(evt_name=="shifttabkey"){focusdir=1;}else if(evt_name=="downkey"){focusdir=2;}else if(evt_name=="upkey"){focusdir=3;}if(self_flag===false){this._focus_direction= -1;this._want_arrow=true;}if(focusdir>=0){retn=nexacro.Component.prototype._on_focus.call(this,self_flag,evt_name,lose_focus,refer_lose_focus,new_focus,refer_new_focus);if(self_flag==false){if(this._last_focused){this._do_defocus(this._last_focused,false);}var comp,item;var item_len=this._getInnerdatasetInfo("_rowcount");if(nexacro._enableaccessibility){this._accessibility_index= -1;if(item_len){if(focusdir<2){if(focusdir===0){this._accessibility_index=0;}else{this._accessibility_index=item_len-1;}this._is_first_focus=true;this._refreshScroll(this._accessibility_index,focusdir);item=this._getItem(this._accessibility_index);if(item){item._on_focus(true);}}else{if(focusdir==2){this._is_first_focus=true;if(!this._isAccessibilityEnable()){this._accessibility_index=0;comp=this._getItem(this._accessibility_index);if(comp){comp._on_focus(true);}}else{this._accessibility_index= -1;}}else if(focusdir==3){this._is_first_focus=true;this._accessibility_index=item_len-1;comp=this._getItem(this._accessibility_index);if(comp){comp._on_focus(true);}}}}this._shift_select_base_index=this._accessibility_index;}}}else{retn=nexacro.Component.prototype._on_focus.call(this,self_flag,evt_name,lose_focus,refer_lose_focus,new_focus,refer_new_focus);if(this._last_focused){this._do_defocus(this._last_focused,false);}else if(this._select_multi.lastselected===undefined&&this._accessibility_index> -1){this._getItem(this._accessibility_index)._changeStatus("focused",false);}}return retn;};_pListBox._on_getFitSize=function(){var control_elem=this.getElement();if(control_elem){var total_w=0;var total_h=0;var border=this._getCurrentStyleBorder();if(border){total_w+=border._getBorderWidth();total_h+=border._getBorderHeight();}var padding=this._getCurrentStylePadding();if(padding){total_w+=padding.left+padding.right;total_h+=padding.top+padding.bottom;}var rowcount=this._getInnerdatasetInfo("_rowcount");var data_maxwidth=this._getInnerdatasetInfo("_max_width");var data_maxheight=this._getInnerdatasetInfo("_max_height");total_w+=data_maxwidth;total_h+=data_maxheight*rowcount;return [total_w,total_h];}return [this._adjust_width,this._adjust_height];};_pListBox.on_get_accessibility_label=function(){var label="";if(!this._is_first_focus){label=this.text?this.text:this.value;}return label?label:"";};_pListBox.set_text=nexacro._emptyFn;_pListBox._convertValueType=function(v,bapplyrule){var ret;if(bapplyrule){ret=nexacro.Component.prototype._convertValueType.call(this,v);}else{ret=nexacro._isNull(v)?v:nexacro._toString(v);}return ret;};_pListBox.set_value=function(v){v=this._convertValueType(v);if(this.value!=v){if(this.acceptvaluetype=="ignoreinvalid"){var idx= -1;var ds=this._innerdataset;var codecolumn=this.codecolumn;if(ds){idx=ds.findRow(codecolumn,v);if(idx<0){return;}}}if(!this.applyto_bindSource("value",v)){return;}this.value=v;this.on_apply_value(v);if(this.value==undefined){this.value=v;}}};_pListBox.on_apply_value=function(value){var ds=this._innerdataset;var codecolumn=this.codecolumn;var datacolumn=this.datacolumn==""?codecolumn:this.datacolumn;if(ds&&codecolumn){var index=ds.findRow(codecolumn,value);var text="";if(index> -1){text=ds.getColumn(index,datacolumn);}this._setIndex(index);this._setText(text);this._doSelect(index,false);}};_pListBox.set_index=function(v){if(isNaN(v= +v)||v< -1){return;}var ds=this._innerdataset;if(ds&&(v>ds.getRowCount()-1)){v= -1;}if(this.index!=v){this.index=v;this.on_apply_index(v);}else{this.on_apply_index(v);this._on_last_selectfocuschanged(this.index,true);}};_pListBox.on_apply_index=function(index){var text="";var value;var data=this._getInnerdatasetInfo("_rows",index);if(data){value=data.value;text=data.text;}if(this.value!=value){if(!this.applyto_bindSource("value",value)){this.index=this._default_index;return;}this._setValue(value);this._setText(text);}if(this._innerdataset){this._doSelect(index,false);}};_pListBox.set_innerdataset=function(v){if(typeof v!="string"){this.setInnerDataset(v);return;}if(this.innerdataset!=v||(this.innerdataset&&!this._innerdataset)){this._setInnerDatasetStr(v);this.on_apply_innerdataset(this._innerdataset);}};_pListBox.on_apply_innerdataset=function(ds){if(ds){ds._setEventHandler("onload",this._on_dataset_onload,this);ds._setEventHandler("onvaluechanged",this._on_dataset_onvaluechanged,this);ds._setEventHandler("onrowsetchanged",this._on_dataset_onrowsetchanged,this);}this._parseInnerDataset();var control_elem=this.getElement();if(control_elem){this._redrawListBoxContents(!this._keep_scrolling);this._onRecalcScrollSize();}};_pListBox.set_codecolumn=function(v){if(this.codecolumn!=v){this.codecolumn=v;this.on_apply_codecolumn(v);}};_pListBox.on_apply_codecolumn=function(codecolumn){if(this._is_created){this._parseInnerDataset();this._redrawListBoxContents(!this._keep_scrolling);this._onRecalcScrollSize();}};_pListBox.set_datacolumn=function(v){if(this.datacolumn!=v){this.datacolumn=v;this.on_apply_datacolumn(v);}};_pListBox.on_apply_datacolumn=function(datacolumn){if(this._is_created){this._parseInnerDataset();this._redrawListBoxContents(!this._keep_scrolling);this._onRecalcScrollSize();}};_pListBox.set_visible=function(v){var vscroll=this.vscrollbar;var need_refreshDom=nexacro._Browser=="Chrome"&&v&&this.visible!=v&&vscroll;nexacro.Component.prototype.set_visible.call(this,v);if(need_refreshDom){var vscrollPos=vscroll.pos;vscroll.set_pos(vscrollPos-1);vscroll.set_pos(vscrollPos);}};_pListBox.set_multiselect=function(v){v=nexacro._toBoolean(v);if(this.multiselect!=v){this.multiselect=v;this.on_apply_multiselect(v);}};_pListBox.on_apply_multiselect=function(multiselect){var control_elem=this.getElement();if(control_elem){this._select_clear();this._shiftKey=false;this._ctrlKey=false;this.setSelect(this.index,true);}};_pListBox.set_readonly=function(v){v=nexacro._toBoolean(v);if(this.readonly!=v){this.readonly=v;this.on_apply_readonly(v);this._setAccessibilityFlagReadOnly(v);}};_pListBox.on_apply_readonly=function(readonly){this._changeStatus("readonly",readonly);var items=this._getContentsItem();var item_len=items.length;for(var i=0;i<item_len;i++ ){items[i].set_readonly(readonly);}};_pListBox.set_itemheight=function(v){if(v!==undefined){if(isNaN(v= +v)){return;}}if(this.itemheight!=v){this.itemheight=v;this.on_apply_itemheight(v);}};_pListBox.on_apply_itemheight=function(itemheight){var control_elem=this.getElement();if(control_elem){this._redrawListBoxContents(false);this._onRecalcScrollSize();}};_pListBox.set_dragscrolltype=function(v){var dragscrolltype_enum=["none","vert","horz","both","all"];if(dragscrolltype_enum.indexOf(v)== -1){return;}if(this.dragscrolltype!=v){this.dragscrolltype=v;}};_pListBox.set_selectscrollmode=function(v){var selectscrollmode_enum=["default","scroll","select"];if(selectscrollmode_enum.indexOf(v)== -1){return;}if(this.selectscrollmode!=v){this.selectscrollmode=v;}};_pListBox.set_itemaccessibilityrole=function(val){if(val){this.itemaccessibilityrole=val;this.on_apply_itemaccessibilityrole(val);}else{this.itemaccessibilityrole="";this.on_apply_itemaccessibilityrole(" ");}};_pListBox.on_apply_itemaccessibilityrole=function(val){var items=this._getContentsItem();var item_len=items.length;for(var i=0;i<item_len;i++ ){items[i].set_accessibilityrole(val?val:this.itemaccessibilityrole);}};_pListBox.set_itemaccessibilitylabel=function(val){if(val){this.itemaccessibilitylabel=val;this.on_apply_itemaccessibilitylabel(val);}else{this.itemaccessibilitylabel="";this.on_apply_itemaccessibilitylabel(" ");}};_pListBox.on_apply_itemaccessibilitylabel=function(val){var items=this._getContentsItem();var item_len=items.length;for(var i=0;i<item_len;i++ ){items[i].set_accessibilitylabel(val?val:this.itemaccessibilitylabel);}};_pListBox.set_itemaccessibilityenable=function(val){if(val){this.itemaccessibilityenable=val;this.on_apply_itemaccessibilityenable(val);}else{this.itemaccessibilityenable=true;this.on_apply_itemaccessibilityenable(true);}};_pListBox.on_apply_itemaccessibilityenable=function(val){var items=this._getContentsItem();var item_len=items.length;for(var i=0;i<item_len;i++ ){items[i].set_accessibilityenable(val?val:this.itemaccessibilityenable);}};_pListBox.set_itemaccessibilitydescription=function(val){if(val){this.itemaccessibilitydescription=val;this.on_apply_itemaccessibilitydescription(val);}else{this.itemaccessibilitydescription="";this.on_apply_itemaccessibilitydescription(" ");}};_pListBox.on_apply_itemaccessibilitydescription=function(val){var items=this._getContentsItem();var item_len=items.length;for(var i=0;i<item_len;i++ ){items[i].set_accessibilitydescription(val?val:this.itemaccessibilitydescription);}};_pListBox.set_itemaccessibilityaction=function(val){if(val){this.itemaccessibilityaction=val;this.on_apply_itemaccessibilityaction(val);}else{this.itemaccessibilityaction="";this.on_apply_itemaccessibilityaction(" ");}};_pListBox.on_apply_itemaccessibilityaction=function(val){var items=this._getContentsItem();var item_len=items.length;for(var i=0;i<item_len;i++ ){items[i].set_accessibilityaction(val?val:this.itemaccessibilityaction);}};_pListBox.set_itemaccessibilitydesclevel=function(val){if(val){this.itemaccessibilitydesclevel=val;this.on_apply_itemaccessibilitydesclevel(val);}else{this.itemaccessibilitydesclevel="";this.on_apply_itemaccessibilitydesclevel(" ");}};_pListBox.on_apply_itemaccessibilitydesclevel=function(val){var items=this._getContentsItem();var item_len=items.length;for(var i=0;i<item_len;i++ ){items[i].set_accessibilitydesclevel(val?val:this.itemaccessibilitydesclevel);}};_pListBox.set_acceptvaluetype=function(v){var type_enum=["allowinvalid","ignoreinvalid"];if(type_enum.indexOf(v)== -1){return;}this.acceptvaluetype=v;};_pListBox.getCount=function(){return this._getInnerdatasetInfo("_rowcount");};_pListBox.getSelectedCount=function(){return this._select_multi.length;};_pListBox.getSelect=function(v){if(v<0||v>=this.getCount()){return false;}var selectedItems=this._select_multi.items;var selectedCount=this._select_multi.length;for(var i=0;i<selectedCount;i++ ){if(selectedItems[i]==v){return true;}}return false;};_pListBox.getSelectedItems=function(){if(this._select_multi&&this._select_multi.length>0){var obj=this._select_multi.items;var objsorted=[];for(var i=0,len=obj.length;i<len;i++ ){objsorted[i]=obj[i];}objsorted.sort(function(a,b){return a-b;});return objsorted;}else{return [];}};_pListBox.clearSelect=function(){if(this._select_multi&&this._select_multi.length>0){this._selectinfo.index= -1;if(this._changeIndex( -1)){this.on_apply_index( -1);}this._select_clear();}};_pListBox.redraw=function(){this._redrawListBoxContents(true);this._onRecalcScrollSize();};_pListBox.setSelect=function(index,select){select=nexacro._toBoolean(select);index=parseInt(index)|0;var item=this._getItem(index);if(index>=0){if(select==true){if(!this.multiselect){if(this._changeIndex(index)){this._deselect_all(true);if(!item){this._clearListBoxBufferPage();}this.on_apply_index(index);}else{this._doSelect(index,false);}}else{if(item){item.set_selected(select);}this._select_add(index);this._changeIndex(index);}}else{if(item){item.set_selected(false);}this._select_remove(index);if(this._select_multi&&this._select_multi.length==0){this._changeIndex( -1);}}}else{if(this._changeIndex( -1)){this.on_apply_index( -1);}this._select_clear();}};_pListBox.updateToDataset=function(){return this.applyto_bindSource("value",this.value);};_pListBox.setInnerDataset=function(obj){this._removeEventHandlerToInnerDataset();if(!obj){this._innerdataset=null;this.innerdataset="";this.on_apply_innerdataset(this._innerdataset);}else if(obj instanceof nexacro.Dataset||(typeof obj=="object"&&obj._type_name=="Dataset")){this._innerdataset=obj;this.innerdataset=obj.id;this._keep_scrolling=(this.innerdataset!=obj.id)?false:true;this.on_apply_innerdataset(this._innerdataset);}};_pListBox.getInnerDataset=function(){return this._innerdataset;};_pListBox._on_onkeydown=function(obj,e){if(this.readonly){return;}var rowcount=this._getInnerdatasetInfo("_rowcount");if(!rowcount){return;}this._shiftKey=e.shiftkey;this._ctrlKey=e.ctrlkey;this._altKey=e.altkey;if(!this._shiftKey){this._shift_select_base_index=obj.index;}var nextidx;var multi_info=this._select_multi;var keycode=e.keycode;this._last_keydown_keycode=keycode;if(keycode==nexacro.Event.KEY_UP){if(e.ctrlkey){this._do_scroll("up");return true;}if(!nexacro._enableaccessibility){if(this.multiselect){this._select_withkeyupevent(e);nextidx=multi_info.items[multi_info.length-1];if(nextidx!=null){if(nextidx> -1){if(this._last_focused){this._do_defocus(this._last_focused);}this._changeIndex(nextidx);}}}else{nextidx= +this.index-1;if(nextidx<0){nextidx=rowcount-1;}else if(nextidx>=rowcount){nextidx=0;}if(nextidx> -1){if(this._changeIndex(nextidx)){if(this._last_focused){this._do_defocus(this._last_focused);}this.on_apply_index(nextidx);}}}}}else if(keycode==nexacro.Event.KEY_DOWN){if(e.ctrlkey){this._do_scroll("down");return true;}if(!nexacro._enableaccessibility){if(this.multiselect){this._select_withkeydownevent(e);nextidx=multi_info.items[multi_info.length-1];if(nextidx!=null){if(nextidx<rowcount){this._changeIndex(nextidx);}}}else{nextidx= +this.index+1;if(nextidx<0){nextidx=rowcount-1;}else if(nextidx>=rowcount){nextidx=0;}if(nextidx<rowcount){if(this._changeIndex(nextidx)){this.on_apply_index(nextidx);}}}}}else if(keycode===nexacro.Event.KEY_SPACE){if(this.multiselect){var cur_item=this._getItem(this._select_multi.lastselected);var is_same=false;this._sellist=this._select_multi.items;var len=this._sellist.length;var del_idx,iv;for(var i=0;i<len;i++ ){iv=this._sellist[i];if(this._select_multi.lastselected==iv){is_same=true;cur_item=this._getItem(iv);del_idx=iv;}}if(is_same!==true){if(cur_item){cur_item.set_selected(true);}this._select_add(this._select_multi.lastselected);}else{this._do_deselect(del_idx,true);}}else{nextidx=this._accessibility_index;if(nextidx> -1){if(this._changeIndex(nextidx)){if(this._last_focused){this._do_defocus(this._last_focused);}this.on_apply_index(nextidx);}}}}};_pListBox._on_dataset_onload=function(obj,e){if(e.reason==0){this._redrawListBoxContents(true);this._onRecalcScrollSize();if(this.index> -1){if(this._changeIndex(this.index)){this.on_apply_index(this.index);}}else if(this.value!==""){var row=this._innerdataset.findRow(this.codecolumn,this.value);if(this._changeIndex(row)){this.on_apply_index(row);}}}};_pListBox._on_dataset_onvaluechanged=function(obj,e){this._parseInnerDataset();if(this._is_created){this._redrawListBoxContents(true);this._onRecalcScrollSize();this.on_fire_oninnerdatachanged(obj,e.oldvalue,e.newvalue,e.columnid,e.col,e.row);}};_pListBox._on_dataset_onrowsetchanged=function(obj,e){this._parseInnerDataset();if(this._is_created){this._redrawListBoxContents(true);this._onRecalcScrollSize();}};_pListBox._on_item_onlbuttondown=function(obj,e){if(this.readonly){return false;}if(nexacro._enableaccessibility){if(this._accessibility_index> -1){var item=this._getItem(this._accessibility_index);if(item._status=="focused"){item._changeStatus("focused",false);}}}var focused=this._statusmap?this._statusmap['focused']:false;obj._changeUserStatus("selected",true);if(focused){obj._changeStatus("focused",true);}this._shiftKey=e.shiftkey;this._ctrlKey=e.ctrlkey;this._altKey=e.altkey;this._selectinfo.obj=obj;this._selectinfo.index=obj.index;this._selectinfo.text=obj.text;this._selectinfo.value=obj.value;if(nexacro._isTouchInteraction){this._selectinfo_list[this._selectinfo_list.length]=this._selectinfo;}if(!this._shiftKey){this._shift_select_base_index=obj.index;}this._lbtnDownIdx=obj.index;};_pListBox._on_item_ondblclick=function(obj,e){if(this.readonly||!this.enableevent){return false;}return this.on_fire_onitemdblclick(this,this.index,this.text,this.value,e.button,e.altkey,e.ctrlkey,e.shiftkey,e.screenx,e.screeny,e.canvasx,e.canvasy,e.clientx,e.clienty);};_pListBox._on_beforescroll=function(prehpos,prevpos,posthpos,postvpos,evttype,evtkind){if(evttype=="trackstart"||evttype=="tracklastover"||evttype=="trackfirstover"){return true;}if(nexacro._Browser=="Runtime"||(navigator.userAgent.indexOf("Android 4.1")> -1||navigator.userAgent.indexOf("Android 4.2")> -1||navigator.userAgent.indexOf("Android 4.3")> -1)){this._adjustScrollRows_callback(true,postvpos);}else{if(evtkind=="fling"||evtkind=="slide"||evttype=="track"){if(!this._aniframe_rowscroll){var pThis=this;this._scroll_vpos_queue=[];this._aniframe_rowscroll=new nexacro.AnimationFrame(this,function(){pThis._adjustScrollRows_callback();});}var cnt=this._scroll_vpos_queue.push(postvpos);if(cnt==1){this._aniframe_rowscroll.start();}}else{this._adjustScrollRows_callback(true,postvpos);}}return true;};_pListBox._adjustScrollRows_callback=function(no_ani,pos){if(pos==undefined){pos=this.vscrollbar?this.vscrollbar._pos:0;}if(no_ani){this._scroll_vpos_queue=[];}else{this._scroll_vpos_queue.pop();if(this._scroll_vpos_queue.length>0){this._aniframe_rowscroll.start();}}var itemheight=this._getItemHeight();var rowcount=this._getInnerdatasetInfo("_rowcount");var visible_start=itemheight?Math.floor(pos/itemheight):0;var visible_end=visible_start+this._page_rowcount;if(visible_end>=rowcount){visible_end=rowcount-1;}if(this._touch_scrolling){this._createListBoxContents(visible_start,visible_end,true);this._control_element.setElementVScrollPos(pos);}else{this._createListBoxContents(visible_start,visible_end);this._control_element.setElementVScrollPos(pos);}if(this.index> -1){if(this.multiselect){var selectindex=this._selectinfo.index;var pages=this._buffer_pages;for(var i=0;i<pages.length;i++ ){for(var j=0;j<pages[i].length;j++ ){var index=pages[i][j].index;if(index==selectindex){this._doSelect(this.index,true);}}}}else{this._doSelect(this.index,false);}}};_pListBox._setVScrollDefaultAction=function(wheelDeltaY){if(this.scrolltype=="none"||this.scrolltype=="horizontal"){return false;}var control_elem=this.getElement();if(control_elem){var itemheight=this._getItemHeight();var old_value=this._vscroll_pos;var value=old_value+itemheight;if(wheelDeltaY>0){value=old_value-itemheight;if(value<0){value=0;}}if(value>control_elem.vscroll_limit){value=control_elem.vscroll_limit;}this._scrollTo(this._hscroll_pos,value,true,true,undefined,"mousewheel_v");if(old_value!=this._vscroll_pos){return true;}}return false;};_pListBox.on_fire_user_onkeydown=function(keycode,alt_key,ctrl_key,shift_key,fire_comp,refer_comp){if(keycode==nexacro.Event.KEY_UP||keycode==nexacro.Event.KEY_DOWN){if(nexacro._enableaccessibility){var item;var accIdx=this._accessibility_index;var rowcount=this._getInnerdatasetInfo("_rowcount");if(keycode==nexacro.Event.KEY_UP){if(accIdx<0){this._want_arrow=false;}else{this._accessibility_index=accIdx+= -1;this._refreshScroll(accIdx,shift_key?1:0);item=this._getItem(accIdx);if(item){item._on_focus(true);}else{if(accIdx== -1){if(this._isAccessibilityEnable()){var last_focused=this._last_focused;if(last_focused){this._do_defocus(last_focused,true);}else{this._do_defocus(this);}this._on_focus(true);}else{this._want_arrow=false;}}}}}else{if((accIdx+1)>=rowcount){this._want_arrow=false;}else{this._accessibility_index=accIdx+=1;this._refreshScroll(accIdx,shift_key?1:0);item=this._getItem(accIdx);if(item){item._on_focus(true);}}}}}return nexacro.Component.prototype.on_fire_user_onkeydown.call(this,keycode,alt_key,ctrl_key,shift_key,fire_comp,refer_comp);};_pListBox.on_fire_user_onlbuttonup=function(button,alt_key,ctrl_key,shift_key,screenX,screenY,canvasX,canvasY,clientX,clientY,from_comp,from_refer_comp){if(!this._is_alive){return;}return nexacro.Component.prototype.on_fire_user_onlbuttonup.call(this,button,alt_key,ctrl_key,shift_key,screenX,screenY,canvasX,canvasY,clientX,clientY,from_comp,from_refer_comp);};_pListBox.on_fire_sys_ontouchend=function(touchinfos,changedtouchinfos,from_comp,from_refer_comp){if(from_refer_comp&&(from_refer_comp instanceof nexacro.ScrollBarControl||(from_refer_comp.parent&&from_refer_comp.parent instanceof nexacro.ScrollBarControl))){return;}var up_obj=this._getWindow().findComponent(touchinfos[0].target);var sel_info_list=this._selectinfo_list;var ret=nexacro.Component.prototype.on_fire_sys_ontouchend.call(this,touchinfos,changedtouchinfos,from_comp,from_refer_comp);while(sel_info_list.length){var down_item=sel_info_list[0].obj;if(down_item){var change_item;if(this._contains(up_obj)){var evt=touchinfos[0];var canvasX=evt.canvasx;var canvasY=evt.canvasy;var elem=this.getElement();if(elem){var border=this._getCurrentStyleBorder();var c_l_border=border?border._getBorderLeftWidth():0;var c_t_border=border?border._getBorderTopWidth():0;canvasX=canvasX-((elem.scroll_left?elem.scroll_left:0)-c_l_border);canvasY=canvasY-((elem.scroll_top?elem.scroll_top:0)-c_t_border);if(canvasX<0){canvasX=c_l_border;}if(canvasY<0){canvasY=c_t_border;}}var clientXY=this._getClientXY(canvasX,canvasY);this.on_fire_onitemclick(this,up_obj.index,up_obj.text,up_obj.value,evt._current_state,this._altKey,this._ctrlKey,this._shiftKey,evt.screenx,evt.screeny,canvasX,canvasY,clientXY[0],clientXY[1]);change_item=down_item;var change_index=change_item.index;if(this.multiselect){if(this._shiftKey===true||this._ctrlKey===true){this._select_withmouseevent(change_index);}else{this._do_select(change_index,false);}}else{if(this._changeIndex(change_index)){this.on_apply_index(change_index);}else{if(!down_item.selected){down_item._changeUserStatus("selected",false);}}}}else{if(!down_item.selected){down_item._changeUserStatus("selected",false);}}}sel_info_list.shift();}return ret;};_pListBox.on_fire_sys_onlbuttonup=function(button,alt_key,ctrl_key,shift_key,screenX,screenY,canvasX,canvasY,clientX,clientY,from_comp,from_refer_comp,from_elem){if(from_refer_comp&&(from_refer_comp instanceof nexacro.ScrollBarControl||(from_refer_comp.parent&&from_refer_comp.parent instanceof nexacro.ScrollBarControl))){return;}var up_obj=this._getWindow().findComponent(from_elem);var sel_info=this._selectinfo;var ret=nexacro.Component.prototype.on_fire_sys_onlbuttonup.call(this,button,alt_key,ctrl_key,shift_key,screenX,screenY,canvasX,canvasY,clientX,clientY,from_comp,from_refer_comp,from_elem);var down_item=sel_info.obj;if(down_item){var change_item;if(this._contains(from_elem)){this.on_fire_onitemclick(this,up_obj.index,up_obj.text,up_obj.value,button,alt_key,ctrl_key,shift_key,screenX,screenY,canvasX,canvasY,clientX,clientY);if(nexacro._enableaccessibility){if(this._accessibility_index> -1){var sel_item=this._getItem(this._accessibility_index);if(sel_info.index!=this._accessibility_index&&sel_item&&sel_item._selected==true){this._deselect_all(true);sel_item._changeUserStatus("selected",false);}}else{if(sel_info){this._accessibility_index=sel_info.index;}}}change_item=down_item;var change_index=change_item.index;if(this.multiselect){if(this._shiftKey==true||this._ctrlKey==true){this._select_withmouseevent(change_index);}else{this._do_select(change_index,false);}}else{if(this._changeIndex(change_index)){this.on_apply_index(change_index);}else{down_item._changeUserStatus("selected",false);}if(down_item!=up_obj){down_item._changeStatus("mouseover",false);}}}else{if(!down_item.selected){down_item._changeUserStatus("selected",false);}}}return ret;};_pListBox.on_fire_sys_onslidestart=function(elem,touch_manager,touchinfos,xaccvalue,yaccvalue,xdeltavalue,ydeltavalue,from_comp,from_refer_comp){this._touch_scrolling=true;return nexacro.Component.prototype.on_fire_sys_onslidestart.call(this,elem,touch_manager,touchinfos,xaccvalue,yaccvalue,xdeltavalue,ydeltavalue,from_comp,from_refer_comp);};_pListBox.on_fire_sys_onslide=function(elem,touch_manager,touchinfos,xaccvalue,yaccvalue,xdeltavalue,ydeltavalue,from_comp,from_refer_comp){var ret=nexacro.Component.prototype.on_fire_sys_onslide.call(this,elem,touch_manager,touchinfos,xaccvalue,yaccvalue,xdeltavalue,ydeltavalue,from_comp,from_refer_comp);if(this.selectscrollmode=="select"&&this.multiselect){if(this._innerdataset){var idx= -1;if(touchinfos[0].target&&touchinfos[0].target.parent){idx=touchinfos[0].target.parent.index;}if(this._lbtnDownIdx> -1&&idx> -1){this._deselect_all(true);var startRow=this._lbtnDownIdx;var endRow=idx;var finalRow=idx;if(!nexacro._isNumber(startRow)){startRow=0;}if(!nexacro._isNumber(endRow)){endRow=this._getInnerdatasetInfo("_rowcount");}if(startRow>endRow){var tmp=endRow;endRow=startRow;startRow=tmp;finalRow=tmp;}var rows=[];for(var i=startRow;i<=endRow;i++ ){rows.push(i);}this._doMultiSelect(rows,true);this._changeIndex(finalRow);}}return true;}return ret;};_pListBox.on_fire_sys_onslideend=function(elem,touch_manager,touchinfos,xaccvalue,yaccvalue,xdeltavalue,ydeltavalue,from_comp,from_refer_comp){this._touch_scrolling=false;return nexacro.Component.prototype.on_fire_sys_onslideend.call(this,elem,touch_manager,touchinfos,xaccvalue,yaccvalue,xdeltavalue,ydeltavalue,from_comp,from_refer_comp);};_pListBox.on_fire_sys_onflingstart=function(elem,touch_manager,touchinfos,xaccvalue,yaccvalue,xdeltavalue,ydeltavalue,from_comp,from_refer_comp){this._touch_scrolling=true;return nexacro.Component.prototype.on_fire_sys_onflingstart.call(this,elem,touch_manager,touchinfos,xaccvalue,yaccvalue,xdeltavalue,ydeltavalue,from_comp,from_refer_comp);};_pListBox.on_fire_sys_onflingend=function(elem,touch_manager,touchinfos,xaccvalue,yaccvalue,xdeltavalue,ydeltavalue,from_comp,from_refer_comp){this._touch_scrolling=false;return nexacro.Component.prototype.on_fire_sys_onflingend.call(this,elem,touch_manager,touchinfos,xaccvalue,yaccvalue,xdeltavalue,ydeltavalue,from_comp,from_refer_comp);};_pListBox.on_fire_onitemclick=function(obj,index,itemtext,itemvalue,button,alt_key,ctrl_key,shift_key,screenX,screenY,canvasX,canvasY,clientX,clientY){if(this.readonly){return false;}if(this.onitemclick&&this.onitemclick._has_handlers){var evt=new nexacro.ItemClickEventInfo(obj,"onitemclick",index,itemtext,itemvalue,button,alt_key,ctrl_key,shift_key,screenX,screenY,canvasX,canvasY,clientX,clientY);var ret=this.onitemclick._fireEvent(this,evt);return nexacro._toBoolean(ret);}return false;};_pListBox.on_fire_canitemchange=function(obj,preindex,pretext,prevalue,postindex,posttext,postvalue){if(this.canitemchange&&this.canitemchange._has_handlers){var evt=new nexacro.ItemChangeEventInfo(this,"canitemchange",preindex,pretext,prevalue,postindex,posttext,postvalue);var ret=this.canitemchange._fireCheckEvent(this,evt);return nexacro._toBoolean(ret);}return true;};_pListBox.on_fire_onitemchanged=function(obj,preindex,pretext,prevalue,postindex,posttext,postvalue){if(!this._selectinfo){return false;}this._selectinfo.obj=null;this._selectinfo.index=obj.index;this._selectinfo.text=obj.text;this._selectinfo.value=obj.value;var sel_info=this._selectinfo;sel_info.index=postindex;sel_info.text=posttext;sel_info.value=postvalue;if(this.onitemchanged&&this.onitemchanged._has_handlers){var evt=new nexacro.ItemChangeEventInfo(this,"onitemchanged",preindex,pretext,prevalue,postindex,posttext,postvalue);var ret=this.onitemchanged._fireEvent(this,evt);return nexacro._toBoolean(ret);}return false;};_pListBox.on_fire_onitemdblclick=function(obj,index,itemtext,itemvalue,button,alt_key,ctrl_key,shift_key,screenX,screenY,canvasX,canvasY,clientX,clientY){if(this.readonly){return false;}if(this.onitemdblclick&&this.onitemdblclick._has_handlers){var evt=new nexacro.ItemClickEventInfo(obj,"onitemdblclick",index,itemtext,itemvalue,button,alt_key,ctrl_key,shift_key,screenX,screenY,canvasX,canvasY,clientX,clientY);var ret=this.onitemdblclick._fireEvent(this,evt);return nexacro._toBoolean(ret);}return false;};_pListBox.on_fire_oninnerdatachanged=function(obj,oldvalue,newvalue,columnid,col,row){if(this.oninnerdatachanged&&this.oninnerdatachanged._has_handlers){var evt=new nexacro.InnerdataChangedEventInfo(obj,"oninnerdatachanged",oldvalue,newvalue,columnid,col,row);return this.oninnerdatachanged._fireEvent(this,evt);}return true;};_pListBox.on_fire_sys_onaccessibilitygesture=function(direction,fire_comp,refer_comp){var ret=false;var items=this._getContentsItem();if(items&&items.length>0){var obj=null;if(direction>0){this._overeditemindex++ ;}else{this._overeditemindex-- ;}obj=this._getItemByRealIdx(items,this._overeditemindex).obj;if(obj){ret=true;obj._setAccessibilityNotifyEvent();}}return ret;};_pListBox._redrawListBoxContents=function(bScrollChange){this._redrawListBoxContentsBefore();var rowcount=this._getInnerdatasetInfo("_rowcount");if(rowcount){var itemheight=this._getItemHeight();var client_h=this._getClientHeight();var page_rowcount=itemheight?client_h/itemheight:0;if(nexacro._enableaccessibility&&(nexacro._isMobile&&nexacro._isMobile())){page_rowcount=rowcount;}this._page_rowcount=Math.ceil(page_rowcount);this._page_rowcount_min=Math.floor(page_rowcount);var start_index=0;var end_index=0;if(bScrollChange){end_index=rowcount-1;if(end_index>=this._page_rowcount){end_index=this._page_rowcount>0?this._page_rowcount-1:0;}}else{start_index=this._get_first_visible_row();end_index=this._get_last_visible_row(true);}this._recalcContentsMaxSize();this._createListBoxContents(start_index,end_index);if(this.value!==undefined){this.on_apply_value(this.value);}else if(this.index> -1){this.on_apply_index(this.index);}}this._redrawListBoxContentsAfter();};_pListBox._redrawListBoxContentsBefore=function(){this._destroyListBoxContents();};_pListBox._redrawListBoxContentsAfter=function(){if(this._status=="focused"){var comp=this._getItem(this._accessibility_index);if(comp){comp._on_focus(true);}}};_pListBox._createListBoxContents=function(start,end,createonly){var buffer_state=this._isRange(start,end);var rowcount=this._getInnerdatasetInfo("_rowcount");var page_rowcount=this._page_rowcount;var pages=this._buffer_pages;var page,index;var firstitem,lastitem;var i,len;var max_index=rowcount-1;if(createonly){switch(buffer_state){case 0:if(page_rowcount==0){return;}if(end==max_index||(end<page_rowcount-1)){len=1;}else{len=2;}for(i=0;i<len;i++ ){index=start+(i*page_rowcount);if(index+page_rowcount>max_index){page_rowcount=max_index-index+1;}this._addListBoxBufferPage(page_rowcount,index);}break;case 1:do{page=pages[0];firstitem=page[0];if(firstitem.index<page_rowcount){index=0;page_rowcount=firstitem.index;}else{index=firstitem.index-page_rowcount;}this._insertListBoxBufferPage(0,page_rowcount,index);}while(index>start)break;case 2:page=pages[pages.length-1];lastitem=page[page.length-1];index=lastitem.index+1;if(index+page_rowcount>max_index){page_rowcount=max_index-lastitem.index;}this._addListBoxBufferPage(page_rowcount,index);break;}}else{switch(buffer_state){case 0:if(page_rowcount==0){return;}if(end==max_index||(end<page_rowcount-1)){len=1;}else{len=2;}this._clearListBoxBufferPage();for(i=0;i<len;i++ ){index=start+(i*page_rowcount);if(index+page_rowcount>max_index){page_rowcount=max_index-index+1;}this._addListBoxBufferPage(page_rowcount,index);}break;case 1:page=pages[0];firstitem=page[0];index=start-page_rowcount+1;if(index<0){index=0;page_rowcount=firstitem.index;}if(pages.length==2){this._removeListBoxBufferPage(this._buffer_pages.length-1);this._insertListBoxBufferPage(0,page_rowcount,index);this._adjustListBoxBufferPage(0);}else if(pages.length==1){this._insertListBoxBufferPage(0,page_rowcount,index);this._adjustListBoxBufferPage(0);}break;case 2:if(pages.length==2){this._removeListBoxBufferPage(0);page=pages[0];lastitem=page[page.length-1];index=lastitem.index+1;if(index+page_rowcount>max_index){page_rowcount=max_index-lastitem.index;}this._addListBoxBufferPage(page_rowcount,index);}break;case 3:this._resetListBoxBufferPage(start,end);break;}}};_pListBox._destroyListBoxContents=function(){this._clearListBoxBufferPage();this._contents_maxwidth=0;this._contents_maxheight=0;};_pListBox._createListItemControl=function(index){var data=this._getInnerdatasetInfo("_rows",index);if(data){var itemheight=this._getItemHeight();var client_w=this._getClientWidth();var item=this._createListItem("item_"+index,0,index*itemheight,Math.max(this._contents_maxwidth,client_w),itemheight,null,null,null,null,null,null,this);item.set_value(data.value);item.set_text(data.text);item.set_index(index);item.set_selected(false);item.set_readonly(this.readonly);if(nexacro._enableaccessibility){this._setItemAccessibility(item);}item._setEventHandler("onlbuttondown",this._on_item_onlbuttondown,this);item._setEventHandler("ontouchstart",this._on_item_onlbuttondown,this);item._setEventHandler("ondblclick",this._on_item_ondblclick,this);item.createComponent(this._is_created?false:true);if(this.multiselect){var selItems=this._select_multi.items;var len=this._select_multi.length;for(var i=0;i<len;i++ ){if(index==selItems[i]){item.set_selected(true);break;}}}else{if(this.index==index){item.set_selected(true);this._set_last_selectfocused(index);}}return item;}};_pListBox._createListItem=function(id,left,top,width,height,right,bottom,minwidth,maxwidth,minheight,maxheight,parent){return new nexacro._ListBoxItemControl(id,left,top,width,height,right,bottom,minwidth,maxwidth,minheight,maxheight,parent);};_pListBox._addListBoxBufferPage=function(itemcount,itemindex){var i,item;var page=[];for(i=0;i<itemcount;i++ ){item=this._createListItemControl(itemindex);page.push(item);itemindex++ ;}this._buffer_pages.push(page);};_pListBox._insertListBoxBufferPage=function(pageindex,itemcount,itemindex){var i,item;var page=[];for(i=0;i<itemcount;i++ ){item=this._createListItemControl(itemindex);page.push(item);itemindex++ ;}this._buffer_pages.splice(pageindex,0,page);};_pListBox._adjustListBoxBufferPage=function(pageindex){var curr_page=this._buffer_pages[pageindex];var prev_page=this._buffer_pages[pageindex-1];var next_page=this._buffer_pages[pageindex+1];var prev_page_firstidx,prev_page_lastidx;var curr_page_firstidx,curr_page_lastidx;var next_page_firstidx;if(prev_page){curr_page_firstidx=curr_page[0].index;prev_page_lastidx=prev_page[prev_page.length-1].index;if(curr_page_firstidx-1!=prev_page_lastidx){prev_page_firstidx=curr_page_firstidx-this._page_rowcount;this._removeListBoxBufferPage(pageindex-1);this._insertListBoxBufferPage(pageindex-1,this._page_rowcount,prev_page_firstidx);}}if(next_page){curr_page_lastidx=curr_page[curr_page.length-1].index;next_page_firstidx=next_page[0].index;if(curr_page_lastidx+1!=next_page_firstidx){this._removeListBoxBufferPage(pageindex+1);this._insertListBoxBufferPage(pageindex+1,this._page_rowcount,curr_page_lastidx+1);}}};_pListBox._removeListBoxBufferPage=function(pageindex){if(this._buffer_pages[pageindex]){var del_page=this._buffer_pages.splice(pageindex,1)[0];for(var i in del_page){if(del_page.hasOwnProperty(i)){if(del_page[i]){del_page[i].destroy();del_page[i]=null;}}}}};_pListBox._clearListBoxBufferPage=function(){var i,j;var pages=this._buffer_pages;for(i in pages){if(pages.hasOwnProperty(i)){for(j in pages[i]){if(pages[i].hasOwnProperty(j)){if(pages[i][j]){pages[i][j].destroy();pages[i][j]=null;}}}}pages[i]=null;}this._buffer_pages=[];};_pListBox._resetListBoxBufferPage=function(startindex,endindex){var page;var pages=this._buffer_pages;var pages_len=pages.length;if(pages_len>2){var i;var startpage,endpage;for(i=0;i<pages_len;i++ ){page=pages[i];if(page[0].index<=startindex&&page[page.length-1].index>=startindex){startpage=i;}if(page[0].index<=endindex&&page[page.length-1].index>=endindex){endpage=i;}}if(startpage==endpage){if(startpage==0){endpage+=1;}else{if(endpage==(pages_len-1)){startpage-=1;}}}while(pages_len){pages_len-- ;if(startpage!=pages_len&&endpage!=pages_len){this._removeListBoxBufferPage(pages_len);}}}};_pListBox._recalcLayout=function(){var itemheight=this._getItemHeight();var client_w=this._getClientWidth();var item;var items=this._getContentsItem();var item_len=items.length;for(var i=0;i<item_len;i++ ){item=items[i];if(item){item.move(0,item.index*itemheight,Math.max(this._contents_maxwidth,client_w),itemheight);}}};_pListBox._recalcContentsMaxSize=function(){var client_w=this._getClientWidth();var client_h=this._getClientHeight();if(client_w==0||client_h==0){this._contents_maxwidth=0;this._contents_maxheight=0;return;}var itemheight=this._getItemHeight();var rowcount=this._getInnerdatasetInfo("_rowcount");var data_maxwidth=this._getInnerdatasetInfo("_max_width");var data_maxheight=this._getInnerdatasetInfo("_max_height");this._scroll_default_value=data_maxheight;if(this._contents_maxwidth!=data_maxwidth||this._contents_maxheight!=(itemheight*rowcount)){this._contents_maxwidth=data_maxwidth;this._contents_maxheight=itemheight*rowcount;if(this._is_created){this._onRecalcScrollSize();}}};_pListBox._parseInnerDataset=function(){this._initInnerdatasetInfo();var ds=this._innerdataset;if(ds){var codecolumn=this.codecolumn;var datacolumn=this.datacolumn;var rowcount=ds.getRowCount();if(rowcount&&(codecolumn||datacolumn)){codecolumn=codecolumn==""?datacolumn:codecolumn;datacolumn=datacolumn==""?codecolumn:datacolumn;var tmp_item=this._temp_item;var font=tmp_item?tmp_item._getCurrentStyleInheritValue("font"):null;var max_text="";var max_width=0;var text_size=[0,0];for(var i=0,text,value;i<rowcount;i++ ){text=ds.getColumn(i,datacolumn);value=ds.getColumn(i,codecolumn);value=this._convertValueType(value,true);this._setInnerdatasetInfoRowData({text:text,value:value});if(font){text_size=nexacro._getTextSize(text,font);}if(max_width<text_size[0]){max_width=text_size[0];max_text=text;}}if(tmp_item){tmp_item.set_text(max_text);text_size=tmp_item._on_getFitSize();max_width=text_size[0];this._setInnerdatasetInfoMaxSize(max_width,text_size[1]);}this._setInnerdatasetInfoRowCount(rowcount);}}};_pListBox._doSelect=function(rows,keepExisting,isNotFireEvent){if(this.readonly){return false;}if(!this.multiselect){this._doSingleSelect(rows,isNotFireEvent);}else{if(typeof rows==="number"){rows=[rows];}this._doMultiSelect(rows,keepExisting,isNotFireEvent);}};_pListBox._doSingleSelect=function(idx,isNotFireEvent){var params=[false];this._on_select_change(idx,true,"singleselect",params,isNotFireEvent);if(params[0]){if(!isNotFireEvent){this._set_last_selectfocused(idx);}}};_pListBox._doMultiSelect=function(rows,keepExisting,isNotFireEvent){var sel_row=rows[0];var len=rows.length;var info=this._select_multi;var info_len=info.length;if(!keepExisting&&info_len){var items=info.items;var range=[];var start=0;var end=info.length-1;if(start<=end){for(;start<=end;start++ ){range[range.length]=items[start];}}else{for(;start>=end;start-- ){range[range.length]=items[start];}}if(this._do_deselect(range,isNotFireEvent)===false){return;}}var params=[false];var i=0,idx;for(;i<len;i++ ){idx=rows[i];if(keepExisting&&this._is_selected(idx)){continue;}this._on_select_change(idx,true,"multiselect",params,isNotFireEvent);}this._set_last_selectfocused(sel_row,isNotFireEvent);};_pListBox._select_withmouseevent=function(idx){var str_multiselect=this.multiselect?"multi":"single";switch(str_multiselect){case 'multi':var sel=this._select_multi;var len=sel?sel.length:0;if(this._shiftKey){if(!this._ctrlKey){this._deselect_all(true);}this._select_range(this._shift_select_base_index,idx,this._shiftKey);}else if(this._ctrlKey){var item=this._getItem(idx);if(item){item.set_selected(!item.selected);}if(item.selected===false){for(var i=0;i<len;i++ ){if(idx===sel.items[i]){this._select_remove(idx);}}}else{this._select_add(idx);}this._set_last_selectfocused(idx);}else if(this._is_selected(idx)&&!this._shiftKey&&!this._ctrlKey&&len>1){this._do_select(idx,false);}else{this._do_select(idx,false);}break;case 'single':this._do_select(idx,false);break;}};_pListBox._select_withkeyupevent=function(e){var lastidx=this._select_multi.lastselected==null?nexacro._enableaccessibility?this._accessibility_index:this._select_multi.lastselected:this._select_multi.lastselected;if(lastidx>0){var idx=lastidx-1;if(e.shiftkey&&lastidx){if(this._is_selected(lastidx)&&this._is_selected(idx)){this._do_deselect(lastidx,true);this._set_last_selectfocused(idx);if(this._isAccessibilityEnable()){var item=this._getItem(idx);if(item){item._setFocus(true);}}}else if(!this._is_selected(lastidx)){this._do_select(lastidx,true);this._do_select(idx,true);}else{this._do_select(idx,true);}}else{this._shift_select_base_index=null;this._deselect_all(true);this._do_select(idx,false);}}};_pListBox._select_withkeydownevent=function(e){var lastidx=this._select_multi.lastselected==null?nexacro._enableaccessibility?this._accessibility_index:this._select_multi.lastselected:this._select_multi.lastselected;var rowcount=this._getInnerdatasetInfo("_rowcount");if(lastidx+1<rowcount){var idx=lastidx+1;if(e.shiftkey&&lastidx>=0){if(this._shift_select_base_index==lastidx){this._deselect_all(true);this._do_select(this._shift_select_base_index,true);}if(this._is_selected(lastidx)&&this._is_selected(idx)){this._do_deselect(lastidx,true);this._set_last_selectfocused(idx);}else if(!this._is_selected(lastidx)){this._do_select(lastidx,true);this._do_select(idx,true);}else{this._do_select(idx,true);}}else{this._shift_select_base_index=null;this._deselect_all(true);this._do_select(idx,false);}}};_pListBox._do_scroll=function(dir){var visible_start=this._get_first_visible_row();var rowheight=this._getItemHeight();var vscrollbar=this.vscrollbar;var vscroll_pos=this._vscroll_pos;if(vscrollbar){var idx=visible_start;if(dir=="down"){idx+=1;}else{if(vscroll_pos<=idx*rowheight){idx-=1;}}if(idx> -1){this._scrollTo(null,idx*rowheight);}}};_pListBox._select_add=function(selectIdx){if(selectIdx<0||selectIdx>this._innerdataset.getRowCount()-1){return;}var k=selectIdx+"";var info=this._select_multi;var old=info.map[k];if(typeof old!='undefined'){return this._select_replace(k,selectIdx);}info.map[k]=selectIdx;info.length++ ;info.items.push(selectIdx);info.keys.push(k);this._changeIndex(selectIdx);};_pListBox._select_replace=function(k,selectIdx){var idx=this._select_indexOfkey(k);var info=this._select_multi;info.items[idx]=selectIdx;info.map[k]=selectIdx;};_pListBox._select_indexOfkey=function(k){k+="";return nexacro._indexOf(this._select_multi.keys,k);};_pListBox._select_remove=function(selectIdx){var idx=this._select_indexOfkey(selectIdx);var info=this._select_multi;if(idx<info.length&&idx>=0){info.length-- ;info.items.splice(idx,1);var k=info.keys[idx];if(typeof k!='undefined'){info.map[k]=undefined;}info.keys.splice(idx,1);if(!this.multiselect&&info.length==0){this.index= -1;this.text="";if(!this._do_not_change_value){this.value=undefined;}}return selectIdx;}return false;};_pListBox._select_indexOf=function(selectIdx){if(!this.multiselect){return this._selectinfo?this._selectinfo.index==selectIdx: -1;}else{return nexacro._indexOf(this._select_multi.items,selectIdx);}};_pListBox._select_clear=function(){var items=this._getContentsItem();var item_len=items.length;for(var i=0;i<item_len;i++ ){items[i].set_selected(false);}this._select_multi={"items":[],"map":{},"keys":[],"length":0,"lastselected":null};};_pListBox._select_range=function(startRow,endRow,keepExisting,dir){if(!keepExisting){this._deselect_all(true);}var selectedCount=0,i,tmp,dontdeselect,rows=[],FinalRow=endRow;if(!nexacro._isNumber(startRow)){startRow=0;}if(!nexacro._isNumber(endRow)){endRow=this._getInnerdatasetInfo("_rowcount");}if(startRow>endRow){tmp=endRow;endRow=startRow;startRow=tmp;FinalRow=tmp;}for(i=startRow;i<=endRow;i++ ){if(this._is_selected(i)){selectedCount++ ;}}if(!dir){dontdeselect= -1;}else{dontdeselect=(dir=='up')?startRow:endRow;}for(i=startRow;i<=endRow;i++ ){if(selectedCount==(endRow-startRow+1)){if(i!=dontdeselect){this._do_deselect(i,true);}}else{rows.push(i);}}this._doMultiSelect(rows,true);this._changeIndex(FinalRow);};_pListBox._deselect_all=function(isNotFireEvent){var rowcount=this._getInnerdatasetInfo("_rowcount");for(var i=0;i<rowcount;i++ ){this._do_deselect(i,isNotFireEvent);}};_pListBox._do_select=function(rows,keepExisting,isNotFireEvent){if(this.readonly){return false;}if(typeof rows==="number"){rows=[rows];}if(!this.multiselect&&rows){var idx=rows.length?rows[0]:rows;this._doSingleSelect(idx,isNotFireEvent);}else{this._doMultiSelect(rows,keepExisting,isNotFireEvent);}};_pListBox._do_deselect=function(rows,isNotFireEvent){if(nexacro._isNumber(rows)){rows=[rows];}else if(!nexacro._isArray(rows)){rows=[rows];}var len=rows.length;var idx,i=0,attempted=0;var params=[0];for(;i<len;i++ ){idx=rows[i];if(this._is_selected(idx)){ ++attempted;this._on_select_change(idx,false,"deselect",params,isNotFireEvent);}}return params[0]===attempted;};_pListBox._select_commit=function(jobgbn,row,params){var info=this._select_multi;var len=info.length;switch(jobgbn){case "deselect": ++(params[0]);this._select_remove(row);break;case "singleselect":var last_select_row=info.lastselected;this._select_add(row);if(last_select_row!=row&&len>0&&this._do_deselect(last_select_row)===false){return false;}params[0]=true;break;case "multiselect":this._select_add(row);params[0]=true;break;}};_pListBox._set_last_selectfocused=function(idx,isNotFireEvent){var rowBeforeLast=this._select_multi.lastselected;this._select_multi.lastselected=idx;if(idx!==rowBeforeLast){this._on_last_selectfocuschanged(idx,isNotFireEvent);}};_pListBox._on_select_change=function(idx,isSelected,jobgbn,params,isNotFireEvent){if(this._select_commit(jobgbn,idx,params)!==false){var rowobj=this._getItem(idx);if(rowobj){if(isSelected){rowobj.set_selected(true);}else{rowobj.set_selected(false);}if(nexacro._enableaccessibility){rowobj._setAccessibilityInfoIndex(idx+1);rowobj._setAccessibilityInfoCount(this._getInnerdatasetInfo("_rowcount"));}}}};_pListBox._on_last_selectfocuschanged=function(newFocused,isNotFireEvent){if(newFocused> -1){var control_elem=this.getElement();if(control_elem){var visible_start=this._get_first_visible_row();var visible_end=this._get_last_visible_row(true);var vscrollbar=this.vscrollbar;if(vscrollbar){var new_pos=vscrollbar.pos;if(newFocused<=visible_start){new_pos=newFocused*this._getItemHeight();}else if(newFocused>=visible_end){new_pos=(newFocused+1)*this._getItemHeight()-control_elem.client_height;}if(vscrollbar.pos!=new_pos){vscrollbar.set_pos(new_pos);}}else{var item=this._getItem(newFocused);if(item){var item_control_elem=item.getElement();if(item_control_elem){item_control_elem.setElementFocus();}}}}}};_pListBox._do_defocus=function(target,bParent){var _window=this._getWindow();_window._removeFromCurrentFocusPath(target,true);if(bParent){_window._removeFromCurrentFocusPath(this,true);}};_pListBox._changeIndex=function(v,change_by_script){if(this.index!=v){var dataset=this._innerdataset;var postindex=parseInt(v,10)|0;var preidx=this.index;var pretext=this.text;var prevalue=this.value;var column=(this.codecolumn||this.datacolumn);if(dataset&&column){var datavalue=dataset.getColumn(postindex,this.datacolumn||this.codecolumn);var codevalue=dataset.getColumn(postindex,this.codecolumn||this.datacolumn);codevalue=this._convertValueType(codevalue,true);var posttext=datavalue==undefined?"":datavalue;var postvalue=codevalue;if(change_by_script!=true){if(this.on_fire_canitemchange(this,preidx,pretext,prevalue,postindex,posttext,postvalue)!=false){this._accessibility_index=this.index=postindex;this.text=posttext;if(!this._is_value_setting){this.value=postvalue;}this.applyto_bindSource("value",codevalue);this.on_fire_onitemchanged(this,preidx,pretext,prevalue,postindex,posttext,postvalue);return true;}}else{this._accessibility_index=this.index=postindex;this.text=posttext;if(!this._is_value_setting){this.value=postvalue;}this.applyto_bindSource("value",codevalue);return true;}}}return false;};_pListBox._setContents=function(str){var doc=nexacro._parseXMLDocument(str);var node=doc.getElementsByTagName("Dataset")[0];if(!node){return false;}var idstr=node.attributes[0].value;var normalDataset=new nexacro.NormalDataset(idstr,this);if(node.firstChild){var childnode=node.firstChild;var strXML="";while(childnode){if(node.nodeType==1){strXML+=nexacro._documentToXml(childnode);}childnode=childnode.nextSibling;}normalDataset._setContents(strXML);}this.set_innerdataset(normalDataset);return true;};_pListBox._setValue=function(v){if(v===null){v="";}this.value=(v===undefined)?v:v.toString();};_pListBox._setIndex=function(v){this.index=v;};_pListBox._setText=function(v){this.text=v;};_pListBox._setInnerDatasetStr=function(str){this._removeEventHandlerToInnerDataset();if(!str){this._innerdataset=null;this.innerdataset="";}else{str=str.replace("@","");this._innerdataset=this._findDataset(str);this.innerdataset=str;}};_pListBox._setItemAccessibility=function(item){var role;if(nexacro._Browser=="Runtime"){role=this._getAccessibilityRole();}else{role=this.itemaccessibilityrole;}if(role){item.set_accessibilityrole(role);}var enable=this.itemaccessibilityenable;if(enable!==undefined){item.set_accessibilityenable(enable);}var label=this.itemaccessibilitylabel;if(label!==undefined){item.set_accessibilitylabel(label);}var description=this.itemaccessibilitydescription;if(description){item.set_accessibilitydescription(description);}var action=this.itemaccessibilityaction;if(action){item.set_accessibilityaction(action);}var desclevel=this.itemaccessibilitydesclevel;if(desclevel){item.set_accessibilitydesclevel(desclevel);}};_pListBox._getItem=function(index){var pages=this._buffer_pages;var page,item;var i,j;for(i in pages){page=pages[i];for(j in page){item=page[j];if(item&&(item.index==index)){return item;}}}return null;};_pListBox._getItemHeight=function(){var itemheight=this.itemheight;if(itemheight!==undefined){return itemheight;}var item=this._temp_item;if(item){return item._on_getFitSize()[1];}return 0;};_pListBox._getContentsItem=function(){var ret=[];var pages=this._buffer_pages;for(var i in pages){if(pages[i]&&pages.hasOwnProperty(i)){ret=ret.concat(pages[i]);}}return ret;};_pListBox._getContentsCount=function(){var ret=0;var pages=this._buffer_pages;for(var i in pages){if(pages[i]){ret+=pages[i].length;}}return ret;};_pListBox._isRange=function(start,end){var ret=0;var page,item;var pages=this._buffer_pages;for(var i in pages){page=pages[i];for(var j in page){item=page[j];if(item){if(item.index==end){ret+=1;}if(item.index==start){ret+=2;}}}}return ret;};_pListBox._get_first_visible_row=function(){var itemheight=this._getItemHeight();var scrollTop=(this.vscrollbar)?this.vscrollbar.pos:0;return itemheight?Math.floor(scrollTop/itemheight):0;};_pListBox._get_last_visible_row=function(bPrecision){var rowcount=this._getInnerdatasetInfo("_rowcount");var change_idnex=bPrecision?this._page_rowcount-1:this._page_rowcount_min-1;var last_index=this._get_first_visible_row()+change_idnex;var max_index=rowcount-1;if(last_index>=max_index){last_index=max_index;}return last_index;};_pListBox._get_page_from_rowidx=function(rowidx){var row_count=this._page_rowcount;return row_count?Math.floor(rowidx/this._page_rowcount)+1:1;};_pListBox._refreshScroll=function(rowidx,direction){var control_elem=this.getElement();if(control_elem){var currVScrollTopPos=control_elem.scroll_top==undefined?0:control_elem.scroll_top;var vpos,nextTopPos,nextBottom;var itemheight=this._getItemHeight();var rowcount=this._getInnerdatasetInfo("_rowcount");if(rowidx>=rowcount){return;}nextTopPos=(rowidx<0?0:rowidx)*itemheight;nextBottom=nextTopPos+itemheight;if((nextBottom>this._getClientHeight()+currVScrollTopPos)&&direction===0){vpos=currVScrollTopPos+itemheight;}else if(nextTopPos<currVScrollTopPos){vpos=nextTopPos;}if(this.vscrollbar&&vpos>=0){this.vscrollbar.set_pos(vpos);}}};_pListBox._getNextAccessibilityOrderIndex=function(direction){var rowcount=this._getInnerdatasetInfo("_rowcount");var next_idx=this._accessibility_index+direction;if(next_idx<0||next_idx>=rowcount){next_idx= -1;}return next_idx;};_pListBox._is_selected=function(idx){return this._select_indexOf(idx)!== -1;};_pListBox._initInnerdatasetInfo=function(){this._innerdataset_info={_rowcount:0,_rows:[],_max_width:0,_max_height:0};};_pListBox._getInnerdatasetInfo=function(prop){if(this._innerdataset_info&&this._innerdataset_info[prop]){if(prop=="_rows"){if(arguments.length==2){return this._innerdataset_info["_rows"][arguments[1]];}}else{return this._innerdataset_info[prop];}}return null;};_pListBox._setInnerdatasetInfoRowCount=function(v){this._innerdataset_info._rowcount=v;};_pListBox._setInnerdatasetInfoRowData=function(v){this._innerdataset_info._rows.push(v);};_pListBox._setInnerdatasetInfoMaxSize=function(w,h){this._innerdataset_info._max_width=w;this._innerdataset_info._max_height=h;};nexacro._ListBoxItemControl=function(id,left,top,width,height,right,bottom,minwidth,maxwidth,minheight,maxheight,parent){nexacro.Static.call(this,id,left,top,width,height,right,bottom,minwidth,maxwidth,minheight,maxheight,parent);};var _pListBoxItemControl=nexacro._createPrototype(nexacro.Static,nexacro._ListBoxItemControl);nexacro._ListBoxItemControl.prototype=_pListBoxItemControl;_pListBoxItemControl._type_name="ListBoxItemControl";_pListBoxItemControl.index="";_pListBoxItemControl.value=undefined;_pListBoxItemControl.selected=false;_pListBoxItemControl.wordWrap="none";_pListBoxItemControl._is_subcontrol=true;_pListBoxItemControl._use_selected_status=true;_pListBoxItemControl._use_readonly_status=true;_pListBoxItemControl.accessibilityrole="listboxitem";_pListBoxItemControl._event_list={"onclick":1,"ondblclick":1,"onflingstart":1,"onfling":1,"onflingend":1,"onlbuttondown":1,"onlbuttonup":1,"onlongpress":1,"onmouseenter":1,"onmouseleave":1,"onmousemove":1,"onmove":1,"onmousedown":1,"onmouseup":1,"ontouchstart":1,"ontouchmove":1,"ontouchend":1,"oncontextmenu":1,"onrbuttondown":1,"onrbuttonup":1};_pListBoxItemControl.on_getIDCSSSelector=function(){return "listboxitem";};_pListBoxItemControl._apply_setfocus=function(evt_name){if(!this.parent._is_subcontrol&&this.parent._status=="focused"){nexacro.Component.prototype._apply_setfocus.call(this,evt_name);}};_pListBoxItemControl.on_get_accessibility_label=function(){return this.text?this.text:"";};_pListBoxItemControl._isFocusAcceptable=function(){return nexacro._enableaccessibility;};_pListBoxItemControl._getAccessibilityLabel=function(){var flag=this.parent._is_first_focus;var label="";if(flag&&this._isAccessibilityEnable()){var parent=this.parent;var p_accessibility=parent.accessibility;label=parent._getAccessibilityParentValue(p_accessibility);}label+=" "+nexacro.Component.prototype._getAccessibilityLabel.call(this);return label;};_pListBoxItemControl._getAccessibilityRole=function(){var role="";if(this._isAccessibilityEnable()){var parent=this.parent;if(parent._is_first_focus){return parent._getAccessibilityRole();}else{role=nexacro.Component.prototype._getAccessibilityRole.call(this);}}return role;};_pListBoxItemControl._setAccessibilityStatFocus=function(evt_name){var list=this.parent;if(!list._is_subcontrol){if(list.multiselect&&list._shift_select_base_index&&list._shift_select_base_index!=this.index){var item=list._getItem(list._shift_select_base_index);if(item&&item._status=="selected"){var label=item._getAccessibilityLabel();label+=" "+this._getAccessibilityLabel();this._setAccessibilityLabel(label);}}if(!evt_name){var keycode=list._last_keydown_keycode;switch(keycode){case nexacro.Event.KEY_DOWN:evt_name="downkey";break;case nexacro.Event.KEY_UP:evt_name="upkey";break;case nexacro.Event.KEY_TAB:evt_name="tabkey";break;case nexacro.Event.KEY_SHIFT:evt_name="shiftkey";break;}}return nexacro.Component.prototype._setAccessibilityStatFocus.call(this,evt_name);}};_pListBoxItemControl._on_getFitSize=function(){var control_elem=this.getElement();if(control_elem){var total_w=0;var total_h=0;var border=this._getCurrentStyleBorder();if(border){total_w+=border._getBorderWidth();total_h+=border._getBorderHeight();}var padding=this._getCurrentStylePadding();if(padding){total_w+=padding.left+padding.right;total_h+=padding.top+padding.bottom;}var text=this.text;var font=this._getCurrentStyleInheritValue("font");var wordspace=this._getCurrentStyleInheritValue("wordSpacing");var letterspace=this._getCurrentStyleInheritValue("letterSpacing");var text_size=nexacro._getTextSize(text?text:"<",font,false,undefined,"none",wordspace,letterspace);total_w+=Math.ceil(this.textwidth!=null?this.textwidth:text_size[0]);total_h+=Math.ceil(text_size[1]);return [total_w,total_h];}return [this._adjust_width,this._adjust_height];};_pListBoxItemControl.set_index=function(v){if(v!==this.index){this.index=parseInt(v,10);}};_pListBoxItemControl.set_value=function(v){if(v!==this.value){this.value=v;}};_pListBoxItemControl.set_selected=function(v){if(v!=this.selected){this.selected=v;this.on_apply_selected();}};_pListBoxItemControl.on_apply_selected=function(){var bfocused=this.parent._statusmap?this.parent._statusmap['focused']:false;if(this.selected){this._changeUserStatus("selected",true);if(bfocused){this._changeStatus("focused",true);}}else{if(this._status=="focused"){this._changeStatus("focused",false);}this._changeUserStatus("selected",false);}};_pListBoxItemControl.set_readonly=function(v){v=nexacro._toBoolean(v);if(v!=this.readonly){this.readonly=v;this.on_apply_readonly(v);}};_pListBoxItemControl.on_apply_readonly=function(readonly){this._changeStatus("readonly",readonly);};_pListBoxItemControl.on_fire_sys_onflingstart=function(elem,touch_manager,xstartvalue,ystartvalue,xdeltavalue,ydeltavalue,touchlen,from_comp,from_refer_comp){return false;};delete _pListBoxItemControl;}
if(!nexacro.Combo){nexacro.ComboCloseUpEventInfo=function(obj,id,beforeIndex,beforeText,beforeValue,afterIndex,afterText,afterValue,isSelect){this.id=this.eventid=id||"oncloseup";this.fromobject=this.fromreferenceobject=obj;this.preindex=beforeIndex;this.postindex=afterIndex;this.pretext=beforeText;this.posttext=afterText;this.prevalue=beforeValue;this.postvalue=afterValue;this.isselect=isSelect;};var _pComboCloseUpEventInfo=nexacro._createPrototype(nexacro.Event,nexacro.ComboCloseUpEventInfo);nexacro.ComboCloseUpEventInfo.prototype=_pComboCloseUpEventInfo;_pComboCloseUpEventInfo._type_name="ComboCloseUpEventInfo";delete _pComboCloseUpEventInfo;nexacro.Combo=function(id,left,top,width,height,right,bottom,minwidth,maxwidth,minheight,maxheight,parent,onlydisplay){nexacro.Component.call(this,id,left,top,width,height,right,bottom,minwidth,maxwidth,minheight,maxheight,parent);this._onlydisplay=onlydisplay;};var _pCombo=nexacro._createPrototype(nexacro.Component,nexacro.Combo);nexacro.Combo.prototype=_pCombo;_pCombo._type_name="Combo";_pCombo.comboedit=null;_pCombo.dropbutton=null;_pCombo.combolist=null;_pCombo._popupcontrol=null;_pCombo.value=undefined;_pCombo.index= -1;_pCombo.text="";_pCombo.codecolumn="";_pCombo.datacolumn="";_pCombo.innerdataset="";_pCombo.autoselect=false;_pCombo.autoskip=false;_pCombo.usesoftkeyboard=true;_pCombo.displaynulltext="";_pCombo.imemode="none";_pCombo.readonly=false;_pCombo.usecontextmenu=true;_pCombo.displayrowcount=undefined;_pCombo.buttonsize=undefined;_pCombo.itemheight=undefined;_pCombo.type="dropdown";_pCombo.popuptype="normal";_pCombo.popupsize=undefined;_pCombo.acceptvaluetype="allowinvalid";_pCombo._isSelect=false;_pCombo._isFiredOnInput=false;_pCombo._innerdataset="";_pCombo._filtereddataset="";_pCombo._default_value=undefined;_pCombo._default_text="";_pCombo._default_index= -1;_pCombo._has_inputElement=true;_pCombo._processing_keyfilter=false;_pCombo._use_readonly_status=true;_pCombo._is_editable_control=true;_pCombo._event_list={"oneditclick":1,"onitemclick":1,"onkeydown":1,"onkeyup":1,"onkillfocus":1,"onsetfocus":1,"ondrag":1,"ondragenter":1,"ondragleave":1,"ondragmove":1,"ondrop":1,"onlbuttondown":1,"onlbuttonup":1,"onrbuttondown":1,"onrbuttonup":1,"onmousedown":1,"onmouseup":1,"onmouseenter":1,"onmousemove":1,"onmouseleave":1,"onmove":1,"onsize":1,"canitemchange":1,"onitemchanged":1,"oninput":1,"onmousewheel":1,"oncontextmenu":1,"ondropdown":1,"oncloseup":1,"oninnerdatachanged":1,"ontouchstart":1,"ontouchmove":1,"ontouchend":1};_pCombo.accessibilityrole="combobox";_pCombo.on_create_contents=function(){var control=this.getElement();if(control){this.comboedit=new nexacro._ComboEditControl("comboedit",0,0,0,0,null,null,null,null,null,null,this,this._onlydisplay);this.dropbutton=new nexacro._ComboButtonControl("dropbutton",0,0,0,0,null,null,null,null,null,null,this);this.comboedit.createComponent();this.dropbutton.createComponent();}};_pCombo.on_created_contents=function(win){this.on_apply_autoskip(this.autoskip);this.on_apply_displaynulltext(this.displaynulltext);this.on_apply_imemode(this.imemode);this.on_apply_type(this.type);this.on_apply_autoselect(this.autoselect);this.on_apply_usecontextmenu(this.usecontextmenu);if(!this._onlydisplay){var init_comobovalue=(this.value==undefined&&this.index== -1);if(init_comobovalue){this.on_apply_value(this.value);}else{if(this.index> -1){this.on_apply_index(this.index);}else if(this.value!==undefined){this.on_apply_value(this.value);}else if(this.text!==""){this.on_apply_text(this.text);}}}this.redraw();this._recalcLayout();this._setEventHandlerToComboEdit();this._setEventHandlerToDropButton();this.comboedit.on_created(win);this.dropbutton.on_created(win);if(this.type=="dropdown"){this.comboedit._setReadonlyView(true);}if(nexacro._enableaccessibility){this._want_arrows=false;this._setAccessibilityStatAutoComplete("list");if(!nexacro._isDesktop()){this.comboedit._setAccessibilityStatHidden(true);this.dropbutton._setAccessibilityStatHidden(true);}if(this.type=="dropdown"&&!this.readonly){if(this.comboedit){this.comboedit._setAccessibilityReadOnly(false);}}}if(this.comboedit){this.comboedit.set_usesoftkeyboard(this.usesoftkeyboard,true);}this._default_value=this.value;this._default_text=this.text;this._default_index=this.index;};_pCombo.on_destroy_contents=function(){if(this.comboedit){this.comboedit.destroy();this.comboedit=null;}if(this.dropbutton){this.dropbutton.destroy();this.dropbutton=null;}if(this.combolist){this.combolist.destroy();this.combolist=null;}if(this._popupcontrol){this._popupcontrol.destroy();this._popupcontrol=null;}this._removeEventHandlerToInnerDataset();};_pCombo._removeEventHandlerToInnerDataset=function(){if(this._innerdataset){this._innerdataset._removeEventHandler("onvaluechanged",this._on_dataset_onvaluechanged,this);this._innerdataset._removeEventHandler("onrowsetchanged",this._on_dataset_onrowsetchanged,this);this._innerdataset=null;}if(this._filtereddataset){this._filtereddataset.destroy();this._filtereddataset=null;}};_pCombo.on_create_contents_command=function(){this.on_apply_autoskip(this.autoskip);this.on_apply_displaynulltext(this.displaynulltext);this.on_apply_imemode(this.imemode);this.on_apply_type(this.type);this.on_apply_autoselect(this.autoselect);this.on_apply_usecontextmenu(this.usecontextmenu);var init_comobovalue=(this.value==undefined&&this.index== -1);if(init_comobovalue){this.on_apply_value(this.value);}else{if(this.index> -1){this.on_apply_index(this.index);}else if(this.value!==undefined){this.on_apply_value(this.value);}else if(this.text!==""){this.on_apply_text(this.text);}}this.redraw();this._recalcLayout();this._setEventHandlerToComboEdit();this._setEventHandlerToDropButton();var str="";if(this.comboedit){str+=this.comboedit.createCommand();}if(this.dropbutton){str+=this.dropbutton.createCommand();}return str;};_pCombo.on_attach_contents_handle=function(win){if(this.comboedit){this.comboedit.attachHandle(win);if(nexacro._enableaccessibility&&!nexacro._isDesktop()){this.comboedit._setAccessibilityStatHidden(true);}if(this.type=="dropdown"){this.comboedit._setReadonlyView(true);}}if(this.dropbutton){this.dropbutton.attachHandle(win);this.dropbutton._setAccessibilityStatHidden(true);}if(nexacro._enableaccessibility){this._want_arrows=false;this._setAccessibilityStatAutoComplete("list");if(this.type=="dropdown"&&!this.readonly){if(this.comboedit){this.comboedit._setAccessibilityReadOnly(false);}}}this._default_value=this.value;this._default_text=this.text;this._default_index=this.index;};_pCombo.on_change_containerRect=function(width,height){this._recalcLayout();};_pCombo.on_change_containerPos=function(left,top){this._recalcLayout();};_pCombo._apply_setfocus=function(evt_name){var comboedit=this.comboedit;if(comboedit){comboedit._changeStatus("focused",true);if(nexacro._isTouchInteraction&&nexacro._SupportTouch){if(this.type=="dropdown"){var control_elem=this.getElement();if(control_elem){control_elem.setElementFocus(true);}else{comboedit._on_focus(true,evt_name);}}else{comboedit._on_focus(true,evt_name);}}else{comboedit._on_focus(true,evt_name);}}};_pCombo.on_apply_custom_class=function(){if(this.comboedit){this.comboedit.on_apply_prop_class();}if(this.dropbutton){this.dropbutton.on_apply_prop_class();}if(this.combolist){this.combolist.on_apply_prop_class();}};_pCombo.on_apply_prop_enable=function(v){if(this.comboedit){this.comboedit._setEnable(v);}if(this.dropbutton&&!this.readonly){this.dropbutton._setEnable(v);}if(this.combolist){this.combolist._setEnable(v);}};_pCombo.on_apply_prop_cssclass=function(){if(this.comboedit){this.comboedit.on_apply_cssclass();}if(this.dropbutton){this.dropbutton.on_apply_cssclass();}if(this.combolist){this.combolist.on_apply_cssclass();}};_pCombo.on_init_bindSource=function(columnid,propid,ds){if(this.type=="filter"||this.type=="filterlike"||this.type=="caseifilter"||this.type=="caseifilterlike"){this._createFilteredDataset();}this._setValue(undefined);this._setIndex( -1);this._setText("");this.redraw();};_pCombo.on_change_bindSource=function(propid,ds,row,col,Idx){if(propid=="value"){if(this.type=="filter"||this.type=="filterlike"||this.type=="caseifilter"||this.type=="caseifilterlike"){this._createFilteredDataset();}var idx= -1;var txt="";var val=ds.getColumn(row,col);val=this._convertValueType(val,true);if(this.value==val){return;}this._setValue(val);ds=this._selectDataset();if(ds){idx=this._getIndexFromValue(ds,val);if(idx> -1){txt=this._getItemText(idx);}this._setIndex(idx);this._setText(txt);}this.redraw();this._default_value=this.value;this._default_text=this.text;this._default_index=this.index;}};_pCombo.on_getBindableProperties=function(){return "value";};_pCombo._getDragData=function(){var comboedit=this.comboedit;if(comboedit){return comboedit.getSelectedText();}};_pCombo._getDlgCode=function(keycode,altKey,ctrlKey,shiftKey){if((keycode==nexacro.Event.KEY_UP||keycode==nexacro.Event.KEY_DOWN)&&(ctrlKey||altKey)){return {want_tab:false,want_return:false,want_escape:false,want_chars:false,want_arrows:true};}return {want_tab:false,want_return:false,want_escape:false,want_chars:false,want_arrows:this._want_arrows};};_pCombo.on_get_accessibility_label=function(){return "";};_pCombo._getAccessibilityReadLabel=function(bwholeread){var _readlabel=nexacro.Component.prototype._getAccessibilityReadLabel.call(this);if(bwholeread&&this.comboedit._input_element&&this._status!="focus"){if(!this.comboedit._input_element._wantAccessibilityAdditionalLabel||!this.comboedit._input_element._wantAccessibilityAdditionalLabel()){_readlabel=this.text+" "+_readlabel;}}return _readlabel;};_pCombo.set_text=function(v){v=nexacro._toString(v);if(this.text!=v){this.text=v;this.on_apply_text(v);}};_pCombo.on_apply_text=function(text){var control_elem=this.getElement();if(control_elem){var value=this.value;var ds=this._selectDataset();if(!ds||(!this.datacolumn&&!this.codecolumn)){if(value){this._setEditValue(text);}else{if(this.displaynulltext||text==""){this._setEditValue(undefined);}else{this._setEditValue(text);}}}else{var idx=this._getIndexFromText(ds,text);this._setIndex(idx);if(idx> -1){this._setValue(this._getItemValue(idx));}else{this._setValue(undefined);this._setText("");}this.redraw();}}};_pCombo.set_value=function(v){v=this._convertValueType(v);if(this.value!==v){if(this.acceptvaluetype=="ignoreinvalid"){var idx= -1;var ds=this._selectDataset();if(ds){idx=this._getIndexFromValue(ds,v);if(idx<0){return;}}}if(this.applyto_bindSource("value",v)){this.value=v;this.on_apply_value(v);this.redraw();}}};_pCombo.on_apply_value=function(value){var control_elem=this.getElement();if(control_elem){var idx= -1;var txt="";var ds=this._selectDataset();if(ds){idx=this._getIndexFromValue(ds,value);if(idx> -1){txt=this._getItemText(idx);}this._setIndex(idx);this._setText(txt);if(nexacro._enableaccessibility){this._updateAccessibilityLabel();}}}};_pCombo.set_index=function(v){if(isNaN(v= +v)||v< -1){return;}if(this.index!=v){this.index=v;this.on_apply_index(v);this.redraw();}};_pCombo.on_apply_index=function(idx){var control_elem=this.getElement();if(control_elem){var val;var txt="";var ds=this._innerdataset;if(ds){if(idx!==null&&idx>=0&&idx<ds.getRowCount()){val=this._getItemValue(idx);txt=this._getItemText(idx);}else{idx= -1;}if(this.applyto_bindSource("value",val)){this._setValue(val);this._setText(txt);if(this.index!=idx){this._setIndex( -1);}}else{var result="restore";var form=this._getForm();var item=form._bind_manager._findBindItem(this,"value");if(item){var bind_ds=item._dataset;if(bind_ds.rowcount>0){if(val==this.value){if(txt==this.text){result="change";}}}}if(result=="restore"){this._setIndex(this._default_index);this._setValue(this._default_value);this._setText(this._default_text);}else if(result=="change"){this._setIndex(idx);this._setValue(val);this._setText(txt);}}}else{this._setIndex( -1);this._setValue(undefined);this._setText("");}}};_pCombo.set_displaynulltext=function(v){v=nexacro._toString(v).replace(/&quot;/g,"\"");if(this.displaynulltext!=v){this.displaynulltext=v;this.on_apply_displaynulltext(v);}};_pCombo.on_apply_displaynulltext=function(displaynulltext){var comboedit=this.comboedit;if(comboedit){comboedit.set_displaynulltext(displaynulltext);}};_pCombo.set_readonly=function(v){v=nexacro._toBoolean(v);if(this.readonly!=v){this.readonly=v;this.on_apply_readonly(v);}};_pCombo.on_apply_readonly=function(readonly){this._changeStatus("readonly",readonly);var comboedit=this.comboedit;if(comboedit){if(!this._onlydisplay){comboedit.set_readonly(readonly);}else{comboedit._changeStatus("readonly",readonly);}if(this.type=="dropdown"){comboedit._setReadonlyView(true);if(nexacro._enableaccessibility){comboedit._setAccessibilityReadOnly(readonly);}}else{comboedit._setReadonlyView(false);}}var dropbutton=this.dropbutton;if(dropbutton){dropbutton._setEnable(this.enable&&!readonly);}var combolist=this.combolist;if(combolist){combolist.set_readonly(readonly);}};_pCombo.set_autoselect=function(v){v=nexacro._toBoolean(v);if(this.autoselect!=v){this.autoselect=v;this.on_apply_autoselect(v);}};_pCombo.on_apply_autoselect=function(autoselect){var comboedit=this.comboedit;if(comboedit){if(this.type!="dropdown"){comboedit.set_autoselect(autoselect);}else{comboedit.set_autoselect(false);}}};_pCombo.set_autoskip=function(v){v=nexacro._toBoolean(v);if(this.autoskip!=v){this.autoskip=v;this.on_apply_autoskip(v);}};_pCombo.on_apply_autoskip=function(autoskip){var comboedit=this.comboedit;if(comboedit){comboedit.set_autoskip(autoskip);}};_pCombo.set_usesoftkeyboard=function(v,bforce){v=nexacro._toBoolean(v);if(v!=this.usesoftkeyboard||bforce){this.usesoftkeyboard=v;this.on_apply_usesoftkeyboard(bforce);}};_pCombo.on_apply_usesoftkeyboard=function(bforce){if(this.comboedit){this.comboedit.set_usesoftkeyboard(this.usesoftkeyboard,bforce);}};_pCombo.set_imemode=function(v){var imemode_enum=["none","alpha","alpha,full","hangul","hangul,full","katakana","katakana,full","hiragana","direct"];if(imemode_enum.indexOf(v)== -1){return;}if(this.imemode!=v){this.imemode=v;this.on_apply_imemode(v);}};_pCombo.on_apply_imemode=function(imemode){var comboedit=this.comboedit;if(comboedit){comboedit.set_imemode(imemode);}};_pCombo.set_type=function(v){var type_enum=["dropdown","search","filter","filterlike","caseisearch","caseifilter","caseifilterlike"];if(type_enum.indexOf(v)== -1){return;}if(this.type!=v){this.type=v;this.on_apply_type(v);}};_pCombo.on_apply_type=function(type){if(this._filtereddataset){this._filtereddataset.filter("");}this.on_apply_readonly(this.readonly);this.on_apply_autoselect(this.autoselect);};_pCombo.set_popuptype=function(v){var popuptype_enum=["normal","center","system","none"];if(popuptype_enum.indexOf(v)== -1){return;}if(this.popuptype!=v){this.popuptype=v;this.on_apply_popuptype(v);}};_pCombo.on_apply_popuptype=function(popuptype){var popupcontrol=this._popupcontrol;if(popupcontrol){popupcontrol._setType(popuptype);}};_pCombo.set_popupsize=function(v){if(this.popupsize!=v){this.popupsize=v;}};_pCombo.set_usecontextmenu=function(v){v=nexacro._toBoolean(v);if(this.usecontextmenu!=v){this.usecontextmenu=v;this.on_apply_usecontextmenu(v);}};_pCombo.set_acceptvaluetype=function(v){var type_enum=["allowinvalid","ignoreinvalid"];if(type_enum.indexOf(v)== -1){return;}this.acceptvaluetype=v;};_pCombo.on_apply_usecontextmenu=function(usecontextmenu){var comboedit=this.comboedit;if(comboedit){comboedit.set_usecontextmenu(usecontextmenu);}};_pCombo.set_innerdataset=function(v){if(typeof v!="string"){this.setInnerDataset(v);return;}if(this.innerdataset!=v){this._removeEventHandlerToInnerDataset();if(!v){this._innerdataset=null;this.innerdataset="";}else{v=v.replace("@","");var _v=this._findDataset(v);this._innerdataset=_v?_v:"";this.innerdataset=v;}this.on_apply_innerdataset(this._innerdataset);}else if(this.innerdataset&&!this._innerdataset){this._setInnerDatasetStr(this.innerdataset);this.on_apply_innerdataset(this._innerdataset);}};_pCombo.on_apply_innerdataset=function(ds){if(this.combolist){this.combolist.setInnerDataset(ds);}if(ds){ds._setEventHandler("onvaluechanged",this._on_dataset_onvaluechanged,this);ds._setEventHandler("onrowsetchanged",this._on_dataset_onrowsetchanged,this);if(this.type=="filter"||this.type=="filterlike"||this.type=="caseifilter"||this.type=="caseifilterlike"){this._createFilteredDataset();}if(this.index> -1){this._recheckIndex();}else if(this.value!==undefined){this._recheckValue();}else if(this.text!==""){this._recheckText();}this.redraw();}};_pCombo.set_codecolumn=function(v){if(this.codecolumn!=v){this.codecolumn=v;this.on_apply_codecolumn(v);}};_pCombo.on_apply_codecolumn=function(codecolumn){if(this.combolist){this.combolist.set_codecolumn(codecolumn);}if(this.type=="filter"||this.type=="filterlike"||this.type=="caseifilter"||this.type=="caseifilterlike"){this._createFilteredDataset();}if(this._is_created){this._recheckIndex();this.redraw();}};_pCombo.set_datacolumn=function(v){if(this.datacolumn!=v){this.datacolumn=v;this.on_apply_datacolumn(v);}};_pCombo.on_apply_datacolumn=function(datacolumn){var combolist=this.combolist;if(combolist){combolist.set_datacolumn(this.datacolumn);}if(this.type=="filter"||this.type=="filterlike"||this.type=="caseifilter"||this.type=="caseifilterlike"){this._createFilteredDataset();}if(this._is_created){this._recheckIndex();this.redraw();}};_pCombo.set_buttonsize=function(v){if(this.buttonsize!=v){this.buttonsize=v;this.on_apply_buttonsize(v);}};_pCombo.on_apply_buttonsize=function(buttonsize){this._recalcLayout();};_pCombo.set_displayrowcount=function(v){if(v!==undefined){if(isNaN(v= +v)||v<0){return;}}if(this.displayrowcount!=v){this.displayrowcount=v;}};_pCombo.set_itemheight=function(v){if(v!==undefined){if(isNaN(v= +v)){return;}}if(this.itemheight!=v){this.itemheight=v;this.on_apply_itemheight(v);}};_pCombo.on_apply_itemheight=function(itemheight){var combolist=this.combolist;if(combolist){combolist.set_itemheight(itemheight);}};_pCombo.set_visible=function(v){nexacro.Component.prototype.set_visible.call(this,v);if(!this.visible&&this._isPopupVisible()){this._closePopup();}};_pCombo.set_scrollbarbarminsize=function(scrollbarbarminsize){if(scrollbarbarminsize!==undefined){scrollbarbarminsize=parseInt(scrollbarbarminsize);if(isNaN(scrollbarbarminsize)){return;}}if(this.scrollbarbarminsize!=scrollbarbarminsize){this.scrollbarbarminsize=scrollbarbarminsize;var combolist=this.combolist;if(combolist){combolist.set_scrollbarbarminsize(scrollbarbarminsize);}}};_pCombo.set_scrollbardecbuttonsize=function(scrollbardecbuttonsize){if(scrollbardecbuttonsize!==undefined){scrollbardecbuttonsize=parseInt(scrollbardecbuttonsize);if(isNaN(scrollbardecbuttonsize)){return;}}if(this.scrollbardecbuttonsize!=scrollbardecbuttonsize){this.scrollbardecbuttonsize=scrollbardecbuttonsize;var combolist=this.combolist;if(combolist){combolist.set_scrollbardecbuttonsize(scrollbardecbuttonsize);}}};_pCombo.set_scrollbarbaroutsize=function(scrollbarbaroutsize){if(scrollbarbaroutsize!==undefined){scrollbarbaroutsize=parseInt(scrollbarbaroutsize);if(isNaN(scrollbarbaroutsize)){return;}}if(this.scrollbarbaroutsize!=scrollbarbaroutsize){this.scrollbarbaroutsize=scrollbarbaroutsize;var combolist=this.combolist;if(combolist){combolist.set_scrollbarbaroutsize(scrollbarbaroutsize);}}};_pCombo.set_scrollbarincbuttonsize=function(scrollbarincbuttonsize){if(scrollbarincbuttonsize!==undefined){scrollbarincbuttonsize=parseInt(scrollbarincbuttonsize);if(isNaN(scrollbarincbuttonsize)){return;}}if(this.scrollbarincbuttonsize!=scrollbarincbuttonsize){this.scrollbarincbuttonsize=scrollbarincbuttonsize;var combolist=this.combolist;if(combolist){combolist.set_scrollbarincbuttonsize(scrollbarincbuttonsize);}}};_pCombo.set_scrollbarsize=function(scrollbarsize){if(scrollbarsize!==undefined){scrollbarsize=parseInt(scrollbarsize);if(isNaN(scrollbarsize)){return;}}if(this.scrollbarsize!=scrollbarsize){this.scrollbarsize=scrollbarsize;var combolist=this.combolist;if(combolist){combolist.set_scrollbarsize(scrollbarsize);}}};_pCombo.set_scrollbartrackbarsize=function(scrollbartrackbarsize){if(scrollbartrackbarsize!==undefined){scrollbartrackbarsize=parseInt(scrollbartrackbarsize);if(isNaN(scrollbartrackbarsize)){return;}}if(this.scrollbartrackbarsize!=scrollbartrackbarsize){this.scrollbartrackbarsize=scrollbartrackbarsize;var combolist=this.combolist;if(combolist){combolist.set_scrollbartrackbarsize(scrollbartrackbarsize);}}};_pCombo.dropdown=function(){var ds;if(!this.enable||this.readonly||!this.visible){return false;}if(!this.isDropdown()){ds=this._selectDataset(true);if((this.type=="filter"||this.type=="filterlike"||this.type=="caseifilter"||this.type=="caseifilterlike")&&ds.rowcount==0){ds=this._innerdataset;}}else{return false;}this.setFocus(false);this._showPopup(ds,this.index);};_pCombo.isDropdown=function(){return this._isPopupVisible();};_pCombo.getCaretPos=function(){if(this.readonly){return  -1;}var comboedit=this.comboedit;if(comboedit){return comboedit.getCaretPos();}return  -1;};_pCombo.getSelect=function(){if(this.getElement()&&this.comboedit){return this.comboedit.getSelect();}return [this.getCaretPos(),this.getCaretPos()];};_pCombo.setSelect=function(start,end){var comboedit=this.comboedit;if(comboedit){return this.comboedit.setSelect(start,end);}return false;};_pCombo.getSelectedText=function(){if(this.getElement()&&this.comboedit){return this.comboedit.getSelectedText();}return "";};_pCombo.setSelectedText=function(v){if(this.getElement()&&this.comboedit){return this.comboedit.setSelectedText(v);}};_pCombo.getInnerDataset=function(){return this._innerdataset;};_pCombo.setInnerDataset=function(obj){this._removeEventHandlerToInnerDataset();if(!obj){this._innerdataset=null;this.innerdataset="";this.on_apply_innerdataset(null);}else if(obj instanceof nexacro.Dataset||(typeof obj=="object"&&obj._type_name=="Dataset")){this._innerdataset=obj;this.innerdataset=obj.id;this.on_apply_innerdataset(obj);if(this._is_created){this._recheckIndex();this.redraw();}}};_pCombo.getCount=function(){if(this.getElement()){if(this.combolist){return this.combolist.getCount();}else if(this._innerdataset){return this._innerdataset.getRowCount();}}return 0;};_pCombo.redraw=function(){if(this.text){this._setEditValue(this.text);}else{this._setEditValue(undefined);}this._setDefaultCaret();};_pCombo.updateToDataset=function(){return this.applyto_bindSource("value",this.value);};_pCombo._on_activate=function(){nexacro.Component.prototype._on_activate.call(this);var comboedit=this.comboedit;if(comboedit){nexacro.Edit.prototype._on_activate.call(comboedit);}};_pCombo._on_dropdown=function(){if(this.readonly){return;}var ds=this._selectDataset(true);var idx=this.index;if(this._isPopupVisible()){this._closePopup();this._setEditValue(this._getItemText(this.index));}else{var comboedit=this.comboedit;if(comboedit){comboedit.setSelect(0,0);}if(this.type=="filter"||this.type=="filterlike"||this.type=="caseifilter"||this.type=="caseifilterlike"){this._clearFilteredDataset();}this._showPopup(ds,idx);}};_pCombo._on_value_change=function(preindex,pretext,prevalue,postindex,posttext,postvalue){if(!this.on_fire_canitemchange(this,preindex,pretext,prevalue,postindex,posttext,postvalue)){return false;}var ds=this._selectDataset();var before_index=ds?this._getIndexFromValue(ds,postvalue):this.index;var bind_applied=this.applyto_bindSource("value",postvalue);if(bind_applied){var after_index=ds?this._getIndexFromValue(ds,postvalue):this.index;if(before_index==after_index){this.value=postvalue;this.text=posttext;this.index=postindex;}}else{if(prevalue==postvalue){if(preindex!=postindex){this.value=postvalue;this.text=posttext;this.index=postindex;}}else{return false;}}if(nexacro._enableaccessibility){this._updateAccessibilityLabel();}this.on_fire_onitemchanged(this,preindex,pretext,prevalue,postindex,posttext,postvalue);return true;};_pCombo._on_dataset_onvaluechanged=function(obj,e){if(this.type=="filter"||this.type=="filterlike"||this.type=="caseifilter"||this.type=="caseifilterlike"){this._createFilteredDataset();}this._recheckValue();this.redraw();if(this._is_created){this.on_fire_oninnerdatachanged(obj,e.oldvalue,e.newvalue,e.columnid,e.col,e.row);}};_pCombo._on_dataset_onrowsetchanged=function(obj,e){if(e.reason==nexacro.NormalDataset.REASON_FILTER){if(this.type=="filter"||this.type=="filterlike"||this.type=="caseifilter"||this.type=="caseifilterlike"){this._createFilteredDataset();}this._recheckValue();this.redraw();return;}else if(e.reason==nexacro.NormalDataset.REASON_ASSIGN){this.set_index( -1);this._recheckIndex();this.redraw();}else if(e.reason==nexacro.NormalDataset.REASON_COPY||e.reason==nexacro.NormalDataset.REASON_ENABLEEVENT){if(this.index> -1){this._recheckIndex();}else if(this.value!==undefined){this._recheckValue();}else if(this.text!==""){this._recheckText();}this.redraw();this._default_value=this.value;this._default_text=this.text;this._default_index=this.index;}};_pCombo._on_edit_onlbuttondown=function(obj,e){if(this.readonly||(nexacro._isTouchInteraction&&nexacro._SupportTouch)){return;}var ds=this._selectDataset(true);var idx=this.index;if(this._isPopupVisible()){this._closePopup();this._setEditValue(this._getItemText(this.index));}else{if(this.type=="dropdown"){this._showPopup(ds,idx);}}};_pCombo._on_edit_onkeydown=function(obj,e){var combolist=this.combolist;if(this.readonly){return false;}var ds=this._selectDataset();var datacol=this.datacolumn;var codecol=this.codecolumn;if(!ds||(!datacol&&!codecol)){return;}var keycode=e.keycode;var pre_value=this._default_value;var pre_text=this._default_text;var pre_index=this._default_index;var cur_value=this.value;var cur_text=this.text;var cur_index=this.index;var nextidx;var rawidx;var curobj=null;var text="";var rowcnt=ds.getRowCount();var enableaccessibility=nexacro._enableaccessibility;if(this._isPopupVisible()){curobj=combolist._get_rowobj_status("mouseover","status")||combolist._get_rowobj_status("selected","userstatus");if(curobj){cur_index=curobj.index;}}if(keycode==nexacro.Event.KEY_ESC){if(this._isPopupVisible()){text=this._getItemText(this.index);this._closePopup();this._setEditValue(text);}}else if(keycode==nexacro.Event.KEY_UP){nextidx=cur_index-1;if(this._isPopupVisible()){if(!e.altkey){if(nextidx<0){nextidx=0;}text=ds.getColumn(nextidx,datacol||codecol);this._setEditValue(text);combolist._refreshScroll(nextidx,1);combolist._change_status_item_from_key(cur_index,nextidx);}}else{if(!enableaccessibility||e.ctrlkey){if(nextidx<0){nextidx=0;}if(this.type=="filter"||this.type=="filterlike"||this.type=="caseifilter"||this.type=="caseifilterlike"){rawidx=this._getRawIndex(ds,nextidx);rawidx=(rawidx== -1)?nextidx:rawidx;this._clearFilteredDataset();nextidx=rawidx;}if(this.index!=nextidx){cur_value=this._getItemValue(nextidx);cur_text=this._getItemText(nextidx);cur_index=nextidx;if(!this._on_value_change(pre_index,pre_text,pre_value,cur_index,cur_text,cur_value)){cur_value=pre_value;cur_text=pre_text;cur_index=pre_index;}this.redraw();}}}}else if(keycode==nexacro.Event.KEY_DOWN){nextidx=cur_index+1;if(this._isPopupVisible()){if(!e.altkey){if(nextidx<rowcnt){text=ds.getColumn(nextidx,datacol||codecol);text=text==undefined?"":text;this._setEditValue(text);combolist._refreshScroll(nextidx,0);combolist._change_status_item_from_key(cur_index,nextidx);}}}else{if(e.altkey){this._showPopup(ds,cur_index);}else{if(!enableaccessibility||e.ctrlkey){if(nextidx>=rowcnt){nextidx=rowcnt-1;}if(this.type=="filter"||this.type=="filterlike"||this.type=="caseifilter"||this.type=="caseifilterlike"){rawidx=this._getRawIndex(ds,nextidx);rawidx=(rawidx== -1)?nextidx:rawidx;this._clearFilteredDataset();nextidx=rawidx;}if(this.index!=nextidx){cur_value=this._getItemValue(nextidx);cur_text=this._getItemText(nextidx);cur_index=nextidx;if(!this._on_value_change(pre_index,pre_text,pre_value,cur_index,cur_text,cur_value)){cur_value=pre_value;cur_text=pre_text;cur_index=pre_index;}this.redraw();}}}}}else if(keycode==nexacro.Event.KEY_ENTER){if(cur_index>=0){if(this.type=="filter"||this.type=="filterlike"||this.type=="caseifilter"||this.type=="caseifilterlike"){rawidx=this._getRawIndex(ds,cur_index);rawidx=(rawidx== -1)?cur_index:rawidx;ds.set_filterstr("");}else{rawidx=cur_index;}}else{rawidx=cur_index;}if(this.index!=rawidx){this._isSelect=true;cur_value=this._getItemValue(rawidx);cur_text=this._getItemText(rawidx);cur_index=rawidx;if(!this._on_value_change(pre_index,pre_text,pre_value,cur_index,cur_text,cur_value)){this._setEditValue(this.text);this._isSelect=false;cur_value=pre_value;cur_text=pre_text;cur_index=pre_index;}}this.redraw();if(this._isPopupVisible()){this._closePopup();if(this.autoskip){this._setFocusToNextComponent();}}}else{cur_index=this.index;}this._default_value=cur_value;this._default_text=cur_text;this._default_index=cur_index;};_pCombo._on_edit_oninput=function(obj,e){if(this.readonly||!this._isEnable()){return false;}this._isFiredOnInput=true;this.on_fire_oninput();var comboedit=this.comboedit;var ds=this._selectDataset();if(ds&&comboedit._processing_keyfilter){var col=this.datacolumn||this.codecolumn;var edit_val=comboedit.text;var type=this.type;if(type!="dropdown"){if(!this.combolist){this._createPopupListBoxControl(ds);}}switch(type){case "search":case "caseisearch":var index;if(this.type=="caseisearch"){edit_val=new nexacro.ExprParser()._transferWhitespace(edit_val);index=ds.findRowExpr(col+".match(/^"+edit_val+"/i)");}else{index=ds.findRowAs(col,edit_val);}if(index>=0){this._showPopup(ds,index);}else{if(this._isPopupVisible()){this._closePopup();}}break;case "filter":case "filterlike":case "caseifilter":case "caseifilterlike":var regExp;var parse_val="";var trans_val="";var edit_val_len=edit_val.length;for(var i=0;i<edit_val_len;i++ ){regExp=/[\{\}\[\]\/?.,;:|\)*~`!^\-_+<>@\#$%&\\\=\(\'\"]/gi;var c=edit_val.charAt(i);if(regExp.test(c)){parse_val+="\\";}parse_val+=c;}trans_val=new nexacro.ExprParser()._transferWhitespace(parse_val);if(this.type=="filter"){ds.set_filterstr(col+".match(/^("+trans_val+")/)");}else if(this.type=="filterlike"){ds.set_filterstr(col+".indexOf('"+parse_val+"') > -1");}else if(this.type=="caseifilter"){ds.set_filterstr(col+".match(/^("+trans_val+")/i)");}else{ds.set_filterstr(col+".match(/("+trans_val+")/i)");}if(edit_val&&ds.getRowCount()>0){this._showPopup(ds,0);var win=this._getWindow();if(win){if(nexacro._Browser=="Runtime"&&(nexacro._SystemType.toLowerCase()=="win32"||nexacro._SystemType.toLowerCase()=="win64")){nexacro._flushCommand(win);}}}else{if(this._isPopupVisible()){this._closePopup();}}break;default:break;}}};_pCombo._on_edit_oneditclick=function(obj,e){this.on_fire_oneditclick(obj,e.caretpos,e.button,e.altkey,e.ctrlkey,e.shiftkey,e.screenx,e.screeny,e.canvasx,e.canvasy,e.clientx,e.clienty,obj,obj);};_pCombo._on_edit_mobile_oneditclick=function(obj,e){this.on_fire_oneditclick(obj,e.caretpos,e.button,e.altkey,e.ctrlkey,e.shiftkey,e.screenx,e.screeny,e.canvasx,e.canvasy,e.clientx,e.clienty,obj,obj);};_pCombo._on_drop_onlbuttondown=function(obj,e){this._on_dropdown();};_pCombo._on_drop_mobile_onclick=function(obj,e){this._on_dropdown();};_pCombo._on_drop_onclick=function(obj,e){};_pCombo._on_list_onitemclick=function(obj,e){if(!this.combolist||!this.comboedit){return false;}var pre_value=this.value;var pre_text=this.text;var pre_index=this.index;var cur_index=e.index;var cur_text=e.itemtext;var cur_value=e.itemvalue;this.on_fire_onitemclick(obj,cur_index,cur_text,cur_value,e.button,e.altkey,e.ctrlkey,e.shiftkey,e.screenx,e.screeny,e.canvasx,e.canvasy,e.clientx,e.clienty);if(this.type=="filter"||this.type=="filterlike"||this.type=="caseifilter"||this.type=="caseifilterlike"){var ds=this._selectDataset();cur_index=this._getRawIndex(ds,e.index);if(cur_index!=this.index){cur_text=this._getItemText(cur_index);cur_value=this._getItemValue(cur_index);}}if(cur_index!=this.index){if(!this._on_value_change(pre_index,pre_text,pre_value,cur_index,cur_text,cur_value)){this.value=cur_value=pre_value;this.text=cur_text=pre_text;this.index=cur_index=pre_index;}this.redraw();if(this._isPopupVisible()){this._closePopup();if(this.autoskip){this._setFocusToNextComponent();}}this._default_value=cur_value;this._default_text=cur_text;this._default_index=cur_index;}else{this.redraw();if(this._isPopupVisible()){this._closePopup();}}};_pCombo._on_list_oncloseup=function(obj,e){var _window=this._getWindow();if(_window&&this._track_capture){_window._releaseCaptureLock(this);}if(!this._isFiredOnInput){if(this.displaynulltext!=""&&nexacro._isNull(this.value)){this._setEditValue(undefined);}else{this._setEditValue(this.text);}}this._isFiredOnInput=false;this._changeStatus("mouseover",false);this.comboedit._changeStatus("mouseover",false);this.dropbutton._changeStatus("mouseover",false);this.on_fire_oncloseup(this,this._default_index,this._default_text,this._default_value,this.index,this.text,this.value,this._isSelect);};_pCombo.on_focus_basic_action=function(self_flag,evt_name,lose_focus,refer_lose_focus,new_focus,refer_new_focus){this._changeStatus("focused",true);if(nexacro._enableaccessibility){this._setAccessibilityStatFocus(evt_name);}this._apply_setfocus(evt_name);};_pCombo.on_killfocus_basic_action=function(new_focus,new_refer_focus){var comboedit=this.comboedit;if(comboedit){comboedit._changeStatus("focused",false);if(nexacro._enableaccessibility){if(nexacro._Browser=="Runtime"){comboedit._is_subfocused=false;}}if(this.text!=this.comboedit.text){comboedit.setCaretPos(0);}}this.redraw();if(this._isPopupVisible()){this._closePopup();}};_pCombo.on_fire_sys_onmousewheel=function(wheelDeltaX,wheelDeltaY,button,alt_key,ctrl_key,shift_key,screenX,screenY,canvasX,canvasY,clientX,clientY,comp,refer_comp){if(this.readonly){return false;}var ds=this._selectDataset();if(!ds){return false;}var last_focus=this._find_lastFocused();if((!this._is_subcontrol&&this!=last_focus)||(this._is_subcontrol&&this._getRootComponent(this)!=last_focus)){return false;}var popupcontrol=this._popupcontrol;if(!popupcontrol||!popupcontrol._is_popup()){var curidx=this.index;var nextidx=0;if(wheelDeltaY>0){if(curidx>0){nextidx=curidx-1;}}else{nextidx=curidx+1;}if(this.index!=nextidx&&nextidx<ds.getRowCount()){var pre_index=this.index;var pre_text=this.text;var pre_value=this.value;var cur_index=nextidx;var cur_text=this._getItemText(nextidx);var cur_value=this._getItemValue(nextidx);var ret=this.on_fire_canitemchange(this,pre_index,pre_text,pre_value,cur_index,cur_text,cur_value);if(ret){this.set_index(nextidx);this.on_fire_onitemchanged(this,pre_index,pre_text,pre_value,cur_index,cur_text,cur_value);}}}return true;};_pCombo.on_fire_sys_onaccessibilitygesture=function(direction,fire_comp,refer_comp){var ret=false;if(this._isPopupVisible()){var combolist=this.combolist;var item=null;var item_len=combolist._getContentsCount();if(item_len){if(direction){combolist._overeditemindex++ ;}else{combolist._overeditemindex-- ;}if(combolist._overeditemindex<0||combolist._overeditemindex>item_len-1){if(this._isPopupVisible()){this._closePopup();}combolist._overeditemindex= -1;}else{item=combolist._getItem(combolist._overeditemindex);}}if(item){ret=true;item._setAccessibilityNotifyEvent();}}return ret;};_pCombo.on_fire_sys_onslide=function(elem,touch_manager,touchinfos,xaccvalue,yaccvalue,xdeltavalue,ydeltavalue,from_comp,from_refer_comp){nexacro.Component.prototype.on_fire_sys_onslide.call(this,elem,touch_manager,touchinfos,xaccvalue,yaccvalue,xdeltavalue,ydeltavalue,from_comp,from_refer_comp);return (this._popupcontrol&&this._popupcontrol._is_popup())?true:false;};_pCombo.on_fire_sys_onfling=function(elem,fling_handler,xstartvalue,ystartvalue,xdeltavalue,ydeltavalue,touchlen,from_comp,from_refer_comp){nexacro.Component.prototype.on_fire_sys_onfling.call(this,elem,fling_handler,xstartvalue,ystartvalue,xdeltavalue,ydeltavalue,touchlen,from_comp,from_refer_comp);return (this._popupcontrol&&this._popupcontrol._is_popup())?true:false;};_pCombo.on_fire_oneditclick=function(obj,caretpos,button,alt_key,ctrl_key,shift_key,screenX,screenY,canvasX,canvasY,clientX,clientY,from_comp,from_refer_comp){if(this.oneditclick&&this.oneditclick._has_handlers){var evt=new nexacro.EditClickEventInfo(obj,"oneditclick",caretpos,button,alt_key,ctrl_key,shift_key,screenX,screenY,canvasX,canvasY,clientX,clientY,this,from_refer_comp);return this.oneditclick._fireEvent(this,evt);}return true;};_pCombo.on_fire_onitemclick=function(obj,index,itemtext,itemvalue,button,alt_key,ctrl_key,shift_key,screenX,screenY,canvasX,canvasY,clientX,clientY){if(this.onitemclick&&this.onitemclick._has_handlers){var evt=new nexacro.ItemClickEventInfo(obj,"onitemclick",index,itemtext,itemvalue,button,alt_key,ctrl_key,shift_key,screenX,screenY,canvasX,canvasY,clientX,clientY);this.onitemclick._fireEvent(this,evt);}return false;};_pCombo.on_fire_canitemchange=function(obj,preindex,pretext,prevalue,postindex,posttext,postvalue){if(this.canitemchange&&this.canitemchange._has_handlers){var evt=new nexacro.ItemChangeEventInfo(this,"canitemchange",preindex,pretext,prevalue,postindex,posttext,postvalue);var ret=this.canitemchange._fireCheckEvent(this,evt);return nexacro._toBoolean(ret);}return true;};_pCombo.on_fire_onitemchanged=function(obj,preindex,pretext,prevalue,postindex,posttext,postvalue){if(this.onitemchanged&&this.onitemchanged._has_handlers){var evt=new nexacro.ItemChangeEventInfo(this,"onitemchanged",preindex,pretext,prevalue,postindex,posttext,postvalue);this.onitemchanged._fireEvent(this,evt);}};_pCombo.on_fire_oncloseup=function(obj,preindex,pretext,prevalue,postindex,posttext,postvalue,isSelect){var ret;if(this.oncloseup&&this.oncloseup._has_handlers){var evt=new nexacro.ComboCloseUpEventInfo(this,"oncloseup",preindex,pretext,prevalue,postindex,posttext,postvalue,isSelect);ret=this.oncloseup._fireEvent(this,evt);ret=nexacro._toBoolean(ret);}return ret;};_pCombo.on_fire_ondropdown=function(obj){if(this.ondropdown&&this.ondropdown._has_handlers){var evt=new nexacro.EventInfo(this,"ondropdown");return this.ondropdown._fireCheckEvent(this,evt);}return true;};_pCombo.on_fire_oninput=function(){if(this.oninput&&this.oninput._has_handlers){var evt=new nexacro.InputEventInfo(this,"oninput");return this.oninput._fireEvent(this,evt);}return true;};_pCombo.on_fire_oninnerdatachanged=function(obj,oldvalue,newvalue,columnid,col,row){if(this.oninnerdatachanged&&this.oninnerdatachanged._has_handlers){var evt=new nexacro.InnerdataChangedEventInfo(obj,"oninnerdatachanged",oldvalue,newvalue,columnid,col,row);return this.oninnerdatachanged._fireEvent(this,evt);}return true;};_pCombo.on_fire_sys_onrbuttonup=function(button,alt_key,ctrl_key,shift_key,screenX,screenY,canvasX,canvasY,clientX,clientY,from_comp,from_refer_comp,from_elem){if(this.isDropdown()){var sel_info_list=this.combolist._selectinfo_list;if(this._scroll_proc){if(sel_info_list.length){var last=sel_info_list.length-1;var info=sel_info_list[last];if(info.index!=this.index){info.obj._stat_change("notselect","normal");sel_info_list.splice(last,1);}}return;}while(sel_info_list.length){var down_item=sel_info_list[0].obj;if(down_item){if(!down_item.selected){down_item._stat_change("notselect","normal");}}sel_info_list.shift();}}return;};_pCombo._createListBoxControl=function(ds){if(!this._isUsableDataset(ds)){return;}var datacol=this.datacolumn;var codecol=this.codecolumn;var combolist=this.combolist;if(!combolist){combolist=this.combolist=new nexacro._ComboListControl("combolist",0,0,0,0,null,null,null,null,null,null,this);combolist.set_scrolltype("vertical");var vscrollbartype=this._getVScrollBarType()||"auto";combolist.set_scrollbartype("none "+vscrollbartype);combolist.setInnerDataset(ds);combolist.set_codecolumn(codecol);combolist.set_datacolumn(datacol);combolist.set_index(this.index);combolist.set_itemheight(this.itemheight);combolist.set_cssclass(this.cssclass);combolist.set_scrollbarbarminsize(this.scrollbarbarminsize);combolist.set_scrollbardecbuttonsize(this.scrollbardecbuttonsize);combolist.set_scrollbarbaroutsize(this.scrollbarbaroutsize);combolist.set_scrollbarincbuttonsize(this.scrollbarincbuttonsize);combolist.set_scrollbarsize(this.scrollbarsize);combolist.set_scrollbartrackbarsize(this.scrollbartrackbarsize);combolist._setPopupContains(true);combolist.createComponent(true);}else{if(combolist._is_created){if(combolist._innerdataset!=ds){combolist.setInnerDataset(ds);}combolist._redrawListBoxContents(!this._keep_scrolling);combolist._onRecalcScrollSize();}}};_pCombo._createdListBoxControl=function(ds){var combolist=this.combolist;if(combolist&&!combolist._is_created){combolist._setEventHandler("oncloseup",this._on_list_oncloseup,this);combolist._setEventHandler("onitemclick",this._on_list_onitemclick,this);combolist.on_created();}};_pCombo._createPopupControl=function(){var popupcontrol=this._popupcontrol;if(!popupcontrol){popupcontrol=this._popupcontrol=new nexacro._ComboPopupControl("combopopup",0,0,0,0,null,null,null,null,null,null,this);popupcontrol._setType(this.popuptype);popupcontrol.createComponent(true);}};_pCombo._createdPopupControl=function(attach_comp){var popupcontrol=this._popupcontrol;if(popupcontrol&&!popupcontrol._is_created){popupcontrol._attach(attach_comp);popupcontrol.on_created();}};_pCombo._createPopupListBoxControl=function(ds){if(!this._isUsableDataset(ds)){return;}this._createPopupControl();this._createListBoxControl(ds);this._createdPopupControl(this.combolist);this._createdListBoxControl();};_pCombo._createFilteredDataset=function(){var ids=this._innerdataset;var fds=this._filtereddataset;var codecol=this.codecolumn;var datacol=this.datacolumn;var combolist=this.combolist;if(ids&&(!(codecol in ids.colinfos)||!(datacol in ids.colinfos))){return;}if(!this._isUsableDataset(ids)){return;}if(!fds){fds=this._filtereddataset=new nexacro.Dataset("filter_"+this.id);}fds.set_enableevent(false);fds.clear();fds.addColumn(codecol,"string");fds.addColumn(datacol,"string");for(var i=0,cnt=ids.getRowCount();i<cnt;i++ ){fds.insertRow(i);fds.setColumn(i,codecol,ids.getColumn(i,codecol));fds.setColumn(i,datacol,ids.getColumn(i,datacol));}fds.set_enableevent(true);if(combolist){combolist._redrawListBoxContents(false);combolist._onRecalcScrollSize();}};_pCombo._recalcLayout=function(){if(this._is_created_contents){var comboedit=this.comboedit;var dropbutton=this.dropbutton;var client_left=this._getClientLeft();var client_top=this._getClientTop();var client_width=this._getClientWidth();var client_height=this._getClientHeight();var buttonsize=this.buttonsize;var buttonsize_w,buttonsize_h;if(buttonsize==undefined){buttonsize_w=client_height;buttonsize_h=client_height;}else{if(typeof (buttonsize)=="number"){buttonsize_w=buttonsize_h=buttonsize;}else{buttonsize=buttonsize.split(" ");buttonsize_w= +buttonsize[0];buttonsize_h=(buttonsize[1])? +buttonsize[1]:client_height;}}if(buttonsize_w>client_width){buttonsize_w=client_width;}if(buttonsize_h>client_height){buttonsize_h=client_height;}if(dropbutton){var btn_left=client_width-buttonsize_w;var btn_top=client_top;if(buttonsize_h<client_height){btn_top=(client_height-buttonsize_h)/2;}dropbutton.move(btn_left,btn_top,buttonsize_w,buttonsize_h,null,null);}if(comboedit){var edit_width=client_width-buttonsize_w;comboedit.move(client_left,client_top,edit_width,client_height,null,null);}}};_pCombo._recheckIndex=function(){var idx=this.index;var txt="";var val;var ds=this._innerdataset;if(ds){var rowcount=ds.getRowCount();if(idx> -1&&rowcount>0&&idx<rowcount){val=this._getItemValue(idx);txt=this._getItemText(idx);}else{idx= -1;}}else{idx= -1;}this._setValue(val);this._setText(txt);this._setIndex(idx);};_pCombo._recheckValue=function(){var idx= -1;var txt="";var val=this.value;var ds=this._innerdataset;if(ds){var rowcount=ds.getRowCount();if(rowcount>0){for(var i=0;i<rowcount;i++ ){if(val==this._getItemValue(i)){idx=i;txt=this._getItemText(i);break;}}}}else{val=undefined;}this._setValue(val);this._setText(txt);this._setIndex(idx);};_pCombo._recheckText=function(){var idx= -1;var txt=this.text;var val;var ds=this._innerdataset;if(ds){var rowcount=ds.getRowCount();if(rowcount>0){for(var i=0;i<rowcount;i++ ){if(txt==this._getItemText(i)){idx=i;val=this._getItemValue(i);break;}}}else{txt="";}}else{txt="";}this._setValue(val);this._setText(txt);this._setIndex(idx);};_pCombo._selectDataset=function(bInit){if(this.type=="filter"||this.type=="filterlike"||this.type=="caseifilter"||this.type=="caseifilterlike"){if(!this._filtereddataset){this._createFilteredDataset();}else{if(bInit){this._clearFilteredDataset();}}return this._filtereddataset;}else{return this._innerdataset;}};_pCombo._showPopup=function(ds,index){if(this._isPopupVisible()){this._closePopup();}var rowcnt=this._innerdataset.rowcount;var ret=this.on_fire_ondropdown(this);if(ret){var popuptype=this._getPopupType();if((this.ondropdown&&this.dropdown.preventable&&this.ondropdown.defaultprevented)||!this._isUsableDataset(ds)||popuptype=="none"){return;}if(rowcnt!=this._innerdataset.rowcount){index=this.index;}this._createPopupListBoxControl(ds);var popupcontrol=this._popupcontrol;if(popupcontrol){popupcontrol._popupAuto();}var combolist=this.combolist;if(combolist){combolist.set_index(index);combolist._refreshScroll(index,1);var win=this._getWindow();if(win){win._setCaptureLock(this,true,false);}if(nexacro._enableaccessibility){this._setAccessibilityStatExpanded(true);if(nexacro._accessibilitytype==4){combolist.setFocus(false);}else if(nexacro._accessibilitytype==5){this._want_arrows=true;combolist._setAccessibilityNotifyEvent();}if(nexacro._Browser=="Runtime"){var comboedit=this.comboedit;if(comboedit){comboedit._setAccessibilityLabel(this.text);comboedit._setAccessibilityDescription("");comboedit._setAccessibilityAction("");comboedit.setFocus(true);}}}}}};_pCombo._applyZoomPopup=function(){if(this._popupcontrol&&this._popupcontrol._is_popup()){if(this.enable===false||this.readonly===true||this.visible===false){return;}var ds=this._selectDataset();if(ds){if(ds.getRowCount()<=0){ds=this._innerdataset;}this._showPopup(ds,this.index);}}};_pCombo._closePopup=function(){var _window=this._getWindow();if(_window){_window._releaseCaptureLock(this);}var popupcontrol=this._popupcontrol;if(popupcontrol){popupcontrol._closePopup();nexacro._refreshWindow(_window.handle);}if(nexacro._enableaccessibility){this._want_arrows=false;this._setAccessibilityStatExpanded(false);var combolist=this.combolist;if(combolist){combolist._overeditemindex= -1;}if(nexacro._Browser=="Runtime"){var comboedit=this.comboedit;if(comboedit){comboedit.on_apply_accessibility();}}}};_pCombo._setContents=function(str){var doc=nexacro._parseXMLDocument(str);var node=doc.getElementsByTagName("Dataset")[0];if(!node){return false;}var idstr=node.attributes[0].value;var normalDataset=new nexacro.NormalDataset(idstr,this);if(node.firstChild){var childnode=node.firstChild;var strXML="";while(childnode){if(node.nodeType==1){strXML+=nexacro._documentToXml(childnode);}childnode=childnode.nextSibling;}normalDataset._setContents(strXML);}this.set_innerdataset(normalDataset);return true;};_pCombo._convertValueType=function(v,bapplyrule){var ret;if(bapplyrule){ret=nexacro.Component.prototype._convertValueType.call(this,v);}else{ret=nexacro._isNull(v)?v:nexacro._toString(v);}return ret;};_pCombo._setValue=function(v){this.value=v;};_pCombo._setEditValue=function(v){var comboedit=this.comboedit;if(comboedit){var text=comboedit.text;if(text!=v){comboedit._setValue(v);if(nexacro._enableaccessibility){comboedit._updateAccessibilityLabel();if(v){if(nexacro._Browser=="Runtime"&&comboedit._status=="focused"){comboedit._setAccessibilityLabel(v);comboedit._notifyAccessibility(v,"notify");}}}}}};_pCombo._setIndex=function(v){this.index=v;};_pCombo._setText=function(v){this.text=v;};_pCombo._setEventHandlerToComboEdit=function(){var comboedit=this.comboedit;if(comboedit){var bMobile=(nexacro._isTouchInteraction&&nexacro._SupportTouch);if(bMobile){comboedit._setEventHandler("oneditclick",this._on_edit_mobile_oneditclick,this);}else{comboedit._setEventHandler("onlbuttondown",this._on_edit_onlbuttondown,this);comboedit._setEventHandler("oneditclick",this._on_edit_oneditclick,this);}comboedit._setEventHandler("onkeydown",this._on_edit_onkeydown,this);comboedit._setEventHandler("oninput",this._on_edit_oninput,this);}};_pCombo._setEventHandlerToDropButton=function(){var dropbutton=this.dropbutton;if(dropbutton){if(nexacro._isTouchInteraction&&nexacro._SupportTouch){dropbutton._setEventHandler("onclick",this._on_drop_mobile_onclick,this);}else{dropbutton._setEventHandler("onclick",this._on_drop_onclick,this);dropbutton._setEventHandler("onlbuttondown",this._on_drop_onlbuttondown,this);}}};_pCombo._setEventHandlerToListBox=function(){var combolist=this.combolist;if(combolist){combolist._setEventHandler("onitemclick",this._on_list_onitemclick,this);combolist._setEventHandler("canitemchange",this.on_notify_list_canitemchange,this);combolist._setEventHandler("onitemchanged",this.on_notify_list_onitemchanged,this);}};_pCombo._setInnerDatasetStr=function(str){this._removeEventHandlerToInnerDataset();if(str){str=str.replace("@","");this._innerdataset=this._findDataset(str);this.innerdataset=str;}else{this._innerdataset=null;this.innerdataset="";}};_pCombo._setDefaultCaret=function(){var edit=this.comboedit;if(edit){if(this.type=="dropdown"){edit.setCaretPos(0);}}};_pCombo._setFocusToNextComponent=function(){var root_comp=this._getRootComponent(this);var next_comp=this._getForm().getNextComponent(root_comp,true);if(next_comp){next_comp.setFocus();if(next_comp._is_editable_control){next_comp._setDefaultCaret();}}};_pCombo._getItemValue=function(index){var ds=this._innerdataset;var column=this.codecolumn||this.datacolumn;if(ds&&column){var rtn=ds.getColumn(index,column);if(rtn==undefined&&(this.type=="filter"||this.type=="filterlike"||this.type=="caseifilter"||this.type=="caseifilterlike")&&this._filtereddataset){rtn=this._filtereddataset.getColumn(index,column);}return this._convertValueType(rtn,true);}return null;};_pCombo._getItemText=function(index){var ds=this._innerdataset;var column=this.datacolumn||this.codecolumn;if(ds&&column){var rtn=ds.getColumn(index,column);if(rtn==undefined&&(this.type=="filter"||this.type=="filterlike"||this.type=="caseifilter"||this.type=="caseifilterlike")&&this._filtereddataset){rtn=this._filtereddataset.getColumn(index,column);}return nexacro._toString(rtn);}return null;};_pCombo._getIndexFromValue=function(ds,value){if(value instanceof nexacro.Decimal){value=value.toString();}var row_count=ds.getRowCount();for(var i=0;i<row_count;i++ ){var v=this._getItemValue(i);if(v instanceof nexacro.Decimal){v=v.toString();}if(value==v){var newval=value;var preval=v;if(newval===0){newval=newval+"";}if(preval===0){preval=preval+"";}if(newval==preval){return i;}}}return  -1;};_pCombo._getIndexFromText=function(ds,text){var row_count=ds.getRowCount();for(var i=0;i<row_count;i++ ){if(this._getItemText(i)==this.text){return i;}}return  -1;};_pCombo._getRawToListindex=function(idx){if(this.type=="filter"||this.type=="filterlike"||this.type=="caseifilter"||this.type=="caseifilterlike"){var fds=this._getFilteredDataset();var fdsArr=fds._viewRecords;var row_count=fdsArr.length;for(var i=0;i<row_count;i++ ){if(fdsArr[i]._rawidx==idx){return i;}}}return idx;};_pCombo._getRawIndex=function(fds,idx){var ids=this._innerdataset;if(idx== -1||(fds._viewRecords.length<=idx)){return  -1;}var rawidx=fds._viewRecords[idx]._rawidx;var idsArr=ids._rawRecords;var row_count=idsArr.length;for(var i=0;i<row_count;i++ ){if(idsArr[i]._rawidx==rawidx){return rawidx;}}return  -1;};_pCombo._getPopupType=function(){return this.popuptype?this.popuptype:"normal";};_pCombo._isUsableDataset=function(ds){if(!ds){return false;}else{if(ds.getRowCount<=0){return false;}if(!this.datacolumn&&!this.codecolumn){return false;}}return true;};_pCombo._isPopupVisible=function(){var popupcontrol=this._popupcontrol;if(popupcontrol){return popupcontrol._is_popup();}return false;};_pCombo._clearFilteredDataset=function(){if(this._filtereddataset){this._filtereddataset.set_filterstr("");}};_pCombo._setAccessibilityInfoByHover=function(control){if(this._isPopupVisible()){var combolist=this.combolist;return combolist._setAccessibilityInfoByHover(control);}else{return this._setAccessibilityNotifyEvent();}};_pCombo._clearAccessibilityInfoByHover=function(){var combolist=this.combolist;if(combolist){combolist._clearAccessibilityInfoByHover();}};_pCombo._getPopupSizeArr=function(){var size=this.popupsize;if(!size){return;}size=size.split(/\s+/);var width= +size[0];var height=size[1]? +size[1]:undefined;return {width:width,height:height};};_pCombo._cancelEvent=function(){this._processing_keyfilter=false;};delete _pCombo;nexacro._ComboEditControl=function(id,left,top,width,height,right,bottom,minwidth,maxwidth,minheight,maxheight,parent,onlydisplay){nexacro.Edit.call(this,id,left,top,width,height,right,bottom,minwidth,maxwidth,minheight,maxheight,parent,onlydisplay);};var _pComboEditControl=nexacro._createPrototype(nexacro.Edit,nexacro._ComboEditControl);nexacro._ComboEditControl.prototype=_pComboEditControl;_pComboEditControl._type_name="EditControl";_pComboEditControl._is_subcontrol=true;_pComboEditControl._is_subfocused=false;_pComboEditControl.accessibilityrole="combobox";_pComboEditControl._getFromComponent=function(comp){var parent=comp.parent;if(parent&&parent._isPopupVisible()){return parent;}else{return nexacro.Component.prototype._getFromComponent.call(this,comp);}};_pComboEditControl.on_keydown_basic_action=function(keycode,alt_key,ctrl_key,shift_key){if(this.readonly||!this._isEnable()){return;}var input_elem=this._input_element;if(input_elem){this._processing_keyfilter=true;if(nexacro._enableaccessibility){if(nexacro._Browser=="Runtime"){this._is_subfocused=true;}}if(keycode==nexacro.KeyCode_ImeInput&&this._imedisable){input_elem.stopSysEvent();return;}else if(!alt_key&&!shift_key&&ctrl_key&&keycode==90){if(input_elem.isComposing()){input_elem.setCompositionComplete();}if(this._undostack&&this.parent.type!="dropdown"){this._undostack.undo();input_elem.stopSysEvent();return;}}else if(!alt_key&&!shift_key&&ctrl_key&&keycode==89){if(this._undostack){this._undostack.redo();input_elem.stopSysEvent();return;}}if(this._undostack){var pos=input_elem.getElementCaretPos();if(pos&&pos!= -1){this._undostack.update(pos.begin,pos.end);}}}};_pComboEditControl.on_keyup_basic_action=function(){this._processing_keyfilter=true;};_pComboEditControl.set_value=function(v){nexacro.Edit.prototype.set_value.call(this,v);this._setAccessibilityValue(this.text,false);};_pComboEditControl.on_fire_ondblclick=function(button,alt_key,ctrl_key,shift_key,screenX,screenY,canvasX,canvasY,clientX,clientY,from_comp,from_refer_comp){return this.parent.on_fire_ondblclick(button,alt_key,ctrl_key,shift_key,screenX,screenY,canvasX,canvasY,clientX,clientY,this.parent,from_refer_comp);};delete _pComboEditControl;nexacro._ComboButtonControl=function(id,left,top,width,height,right,bottom,minwidth,maxwidth,minheight,maxheight,parent){nexacro.Button.call(this,id,left,top,width,height,right,bottom,minwidth,maxwidth,minheight,maxheight,parent);};var _pComboButtonControl=nexacro._createPrototype(nexacro.Button,nexacro._ComboButtonControl);nexacro._ComboButtonControl.prototype=_pComboButtonControl;_pComboButtonControl._type_name="ButtonControl";_pComboButtonControl._is_subcontrol=true;_pComboButtonControl._is_focus_accept=false;_pComboButtonControl.on_focus_basic_action=function(self_flag,evt_name,lose_focus,refer_lose_focus,new_focus,refer_new_focus){var combo=this.parent;if(combo){var bMobile=(nexacro._isTouchInteraction&&nexacro._SupportTouch);if(bMobile){nexacro.Component.prototype.on_focus_basic_action.call(this,self_flag,evt_name,lose_focus,refer_lose_focus,new_focus,refer_new_focus);}else{combo._apply_setfocus(evt_name);}}if(nexacro._enableaccessibility){this._setAccessibilityStatFocus(evt_name);}};_pComboButtonControl._on_click=function(elem,button,alt_key,ctrl_key,shift_key,canvasX,canvasY,screenX,screenY){if(!this._is_alive){return;}if(this.visible&&this.parent._isEnable()&&this.enableevent){var clientXY=this._getClientXY(canvasX,canvasY);this.on_fire_onclick(button,alt_key,ctrl_key,shift_key,screenX,screenY,canvasX,canvasY,clientXY[0],clientXY[1],this,this);this.on_click_basic_action(elem,button,alt_key,ctrl_key,shift_key,canvasX,canvasY,screenX,screenY);}};delete _pComboButtonControl;nexacro._ComboListControl=function(id,left,top,width,height,right,bottom,minwidth,maxwidth,minheight,maxheight,parent){nexacro.ListBox.call(this,id,left,top,width,height,right,bottom,minwidth,maxwidth,minheight,maxheight,parent);this._overedItem=null;};var _pComboListControl=nexacro._createPrototype(nexacro.ListBox,nexacro._ComboListControl);nexacro._ComboListControl.prototype=_pComboListControl;_pComboListControl._type_name="ListBoxControl";_pComboListControl._is_subcontrol=true;_pComboListControl._overeditemindex= -1;_pComboListControl._event_list={"onitemclick":1,"onitemdblclick":1,"onkeydown":1,"onkeyup":1,"onkillfocus":1,"onsetfocus":1,"ondrag":1,"ondragenter":1,"ondragleave":1,"ondragmove":1,"ondrop":1,"onlbuttondown":1,"onlbuttonup":1,"onrbuttondown":1,"onrbuttonup":1,"onmousedown":1,"onmouseup":1,"onmouseenter":1,"onmouseleave":1,"onmousemove":1,"onmove":1,"onsize":1,"canitemchange":1,"onitemchanged":1,"oncloseup":1,"ontouchstart":1,"ontouchmove":1,"ontouchend":1,"onvscroll":1,"onhscroll":1};_pComboListControl.on_notify_item_onlbuttondown=function(obj,e){this._do_select(obj.index,false);};_pComboListControl.on_notify_item_onlbuttonup=function(obj,e){var up_item=this._upitem;if(up_item){var rowobj;if(nexacro._isTouchInteraction&&nexacro._SupportTouch){var win=this._getWindow();var touch_manager=win?win._gesture_manager:null;if(touch_manager&&touch_manager._is_ondrag){rowobj=this._get_rowobj_status("selected","userstatus");if(rowobj){this._do_deselect(rowobj.index);}return;}}if((up_item.index>=0)&&this._contains(up_item)){obj=up_item;}else{rowobj=this._get_rowobj_status("selected","userstatus");if(rowobj){this._do_deselect(rowobj.index);}return;}this.on_fire_onitemclick(obj,obj.index,obj.text,obj.value,e.button,e.altkey,e.ctrlkey,e.shiftkey,e.screenx,e.screeny,e.canvasx,e.canvasy,e.clientx,e.clienty);}};_pComboListControl.on_notify_item_ontouchstart=function(obj,e){this._do_select(obj.index,false);};_pComboListControl.on_notify_item_ontouchend=function(obj,e){var info=(e.changedtouchinputinfos&&e.changedtouchinputinfos[0])?e.changedtouchinputinfos[0]:null;if(info){e.button="lbutton";e.altkey=false;e.ctrlkey=false;e.shiftkey=false;e.screenx=info.screenx;e.screeny=info.screeny;e.canvasx=info.canvasx;e.canvasy=info.canvasy;e.clientx=info.clientx;e.clienty=info.clienty;}this.on_notify_item_onlbuttonup(obj,e);};_pComboListControl.on_notify_listbox_onkeydown=function(obj,e){};_pComboListControl.on_notify_item_onmouseenter=function(obj,e){};_pComboListControl.on_notify_item_onmouseleave=function(obj,e){};_pComboListControl.on_notify_item_onmousemove=function(obj,e){if(this._overeditemindex> -1){var rowobj=this._getItem(this._overeditemindex);if(rowobj){rowobj._changeStatus("mouseover",false);}}};_pComboListControl.on_focus_basic_action=function(self_flag,evt_name,lose_focus,refer_lose_focus,new_focus,refer_new_focus){var combo=this.parent;if(combo){if(nexacro._enableaccessibility){combo._setAccessibilityStatFocus(evt_name);}combo._apply_setfocus(evt_name);}};_pComboListControl.on_fire_user_onkeydown=function(keycode,alt_key,ctrl_key,shift_key,fire_comp,refer_comp){return nexacro.Component.prototype.on_fire_user_onkeydown.call(this,keycode,alt_key,ctrl_key,shift_key,fire_comp,refer_comp);};_pComboListControl.on_fire_user_onlbuttonup=function(button,alt_key,ctrl_key,shift_key,screenX,screenY,canvasX,canvasY,clientX,clientY,from_comp,from_refer_comp){return nexacro.Component.prototype.on_fire_user_onlbuttonup.call(this,button,alt_key,ctrl_key,shift_key,screenX,screenY,canvasX,canvasY,clientX,clientY,from_comp,from_refer_comp);};_pComboListControl.on_fire_sys_onlbuttonup=function(button,alt_key,ctrl_key,shift_key,screenX,screenY,canvasX,canvasY,clientX,clientY,from_comp,from_refer_comp,from_elem){nexacro.Component.prototype.on_fire_sys_onlbuttonup.call(this,button,alt_key,ctrl_key,shift_key,screenX,screenY,canvasX,canvasY,clientX,clientY,from_comp,from_refer_comp,from_elem);};_pComboListControl.on_fire_sys_ontouchstart=function(touchinfos,changedtouchinfos,from_comp,from_refer_comp){nexacro.Component.prototype.on_fire_sys_ontouchstart.call(this,touchinfos,changedtouchinfos,from_comp,from_refer_comp);};_pComboListControl.on_fire_sys_ontouchend=function(touchinfos,changedtouchinfos,from_comp,from_refer_comp){nexacro.Component.prototype.on_fire_sys_ontouchend.call(this,touchinfos,changedtouchinfos,from_comp,from_refer_comp);};_pComboListControl.on_fire_sys_ontouchcancel=function(touchinfos,changedtouchinfos,from_comp,from_refer_comp){};_pComboListControl.on_fire_oncloseup=function(obj){var rowobj=this._get_rowobj_status("mouseover","status");if(rowobj){rowobj._changeStatus("mouseover",false);}if(this.oncloseup&&this.oncloseup._has_handlers){return this.oncloseup._fireEvent(this);}return false;};_pComboListControl._redrawListBoxContentsAfter=nexacro._emptyFn;_pComboListControl._createListItem=function(id,left,top,width,height,right,bottom,minwidth,maxwidth,minheight,maxheight,parent){return new nexacro._ComboListItemControl(id,left,top,width,height,right,bottom,minwidth,maxwidth,minheight,maxheight,parent);};_pComboListControl._createListItemControl=function(index){var ds=this._innerdataset;if(!ds){return null;}var dataCol=this.datacolumn?this.datacolumn:this._datacolumn;var codeCol=this.codecolumn?this.codecolumn:this._codecolumn;var txt=ds.getColumn(index,dataCol);txt=nexacro._toString(txt);var val=ds.getColumn(index,codeCol);val=this._convertValueType(val,true);var itemheight=this._getItemHeight();var client_w=this._getClientWidth();var item=this._createListItem("item_"+index,0,index*itemheight,Math.max(this._contents_maxwidth,client_w),itemheight,null,null,null,null,null,null,this);item.set_value(val);item.set_text(txt);item.set_index(index);item.set_selected(false);item.set_readonly(this.readonly);if(nexacro._enableaccessibility){this._setItemAccessibility(item);}item._setEventHandler("onlbuttondown",this.on_notify_item_onlbuttondown,this);item._setEventHandler("onlbuttonup",this.on_notify_item_onlbuttonup,this);item._setEventHandler("ontouchstart",this.on_notify_item_ontouchstart,this);item._setEventHandler("ontouchend",this.on_notify_item_ontouchend,this);item._setEventHandler("onmouseenter",this.on_notify_item_onmouseenter,this);item._setEventHandler("onmouseleave",this.on_notify_item_onmouseleave,this);item._setEventHandler("onmousemove",this.on_notify_item_onmousemove,this);item.createComponent(this._is_created?false:true);if(this.index==index){item.set_selected(true);}return item;};_pComboListControl._change_status_item_from_key=function(curidx,nextidx){var currowobj=this._getItem(curidx);var rowobj=this._getItem(nextidx);if(currowobj){currowobj._changeStatus("mouseover",false);}if(rowobj){rowobj._changeStatus("mouseover",true);this._overeditemindex=rowobj.index;}};_pComboListControl._setAccessibilityNotifyEvent=function(direction){if(this._is_accessibility_changeIdx){this._is_accessibility_changeIdx=false;return this.parent._setAccessibilityNotifyEvent(direction);}else{return nexacro.ListBox.prototype._setAccessibilityNotifyEvent.call(this,direction);}};_pComboListControl._changeIndex=function(v){if(this.index!=v){var dataset=this._innerdataset;var postindex=parseInt(v,10)|0;if(dataset&&(this.codecolumn||this.datacolumn)){var datavalue=dataset.getColumn(postindex,this.datacolumn||this.codecolumn);var codevalue=dataset.getColumn(postindex,this.codecolumn||this.datacolumn);var posttext=datavalue==undefined?"":nexacro._toString(datavalue);var postvalue=codevalue;this._accessibility_index=this.index=postindex;this.text=posttext;this.value=postvalue;this._selectinfo.obj=null;this._selectinfo.index=postindex;this._selectinfo.text=posttext;this._selectinfo.value=postvalue;return true;}}return false;};_pComboListControl._get_rowobj_status=function(status,flag){var buffer_pages=this._buffer_pages;if(buffer_pages){var rowobjs,rowobj;for(var i=0,n=buffer_pages.length;i<n;i++ ){rowobjs=buffer_pages[i];if(rowobjs){for(var j=0,jlen=rowobjs.length;j<jlen;j++ ){rowobj=rowobjs[j];if(rowobj&&((flag=="status"&&rowobj._status==status)||(flag=="userstatus"&&rowobj._userstatus==status))){return rowobj;}}}}}return null;};_pComboListControl._get_all_rowobj_status=function(status,flag){var ret=[];var buffer_pages=this._buffer_pages;if(buffer_pages){var rowobjs,rowobj;for(var i=0,n=buffer_pages.length;i<n;i++ ){rowobjs=buffer_pages[i];if(rowobjs){for(var j=0,jlen=rowobjs.length;j<jlen;j++ ){rowobj=rowobjs[j];if(rowobj&&((flag=="status"&&rowobj._status==status)||(flag=="userstatus"&&rowobj._userstatus==status))){ret.push(rowobj);}}}}}return ret;};delete _pComboListControl;nexacro._ComboListItemControl=function(id,left,top,width,height,right,bottom,minwidth,maxwidth,minheight,maxheight,parent){nexacro._ListBoxItemControl.call(this,id,left,top,width,height,right,bottom,minwidth,maxwidth,minheight,maxheight,parent);};var _pComboListItemControl=nexacro._createPrototype(nexacro._ListBoxItemControl,nexacro._ComboListItemControl);nexacro._ComboListItemControl.prototype=_pComboListItemControl;_pComboListItemControl.on_fire_sys_onlbuttonup=function(button,alt_key,ctrl_key,shift_key,screenX,screenY,canvasX,canvasY,clientX,clientY,from_comp,from_refer_comp,from_elem){var list=this.parent;if(list){var window=this._getWindow();var comp=window.findComponent(from_elem);list._upitem=comp;}return nexacro.Component.prototype.on_fire_sys_onlbuttonup.call(this,button,alt_key,ctrl_key,shift_key,screenX,screenY,canvasX,canvasY,clientX,clientY,from_comp,from_refer_comp,from_elem);};_pComboListItemControl.on_fire_sys_ontouchend=function(touchinfos,changedtouchinfos,from_comp,from_refer_comp){var list=this.parent;if(list){var comp;var window=this._getWindow();var touchinfo=touchinfos?touchinfos[0]:null;if(touchinfo){var elem=touchinfo.target;comp=window.findComponent(elem);}else{comp=window.findComponent(from_comp);}list._upitem=comp;}return nexacro.Component.prototype.on_fire_sys_ontouchend.call(this,touchinfos,changedtouchinfos,from_comp,from_refer_comp);};delete _pComboListItemControl;nexacro._ComboPopupControl=function(id,left,top,width,height,right,bottom,minwidth,maxwidth,minheight,maxheight,parent){nexacro.PopupControl.call(this,id,left,top,width,height,right,bottom,minwidth,maxwidth,minheight,maxheight,parent);};var _pComboPopupControl=nexacro._createPrototype(nexacro.PopupControl,nexacro._ComboPopupControl);nexacro._ComboPopupControl.prototype=_pComboPopupControl;_pComboPopupControl._type_name="popupCombo";_pComboPopupControl._is_subcontrol=true;_pComboPopupControl._popupAuto=function(){var pos={};if(this._type=="center"){pos=this._getPopupPositionCenter();var root_frame=this._getRootFrame();if(root_frame){this._popupBy(root_frame,pos.left,pos.top,pos.width,pos.height,true);}}else{pos=this._getPopupPosition();this._popupBy(this.parent,pos.left,pos.top,pos.width,pos.height);}};_pComboPopupControl._setType=function(type){this._type=type;};_pComboPopupControl._getRootFrame=function(){var root_frame;var owner_frame=this._getOwnerFrame();if(owner_frame){var win=owner_frame._getWindow();if(win){root_frame=win.frame;}}return root_frame;};_pComboPopupControl._getElementPosition=function(){var combo=this.parent;if(combo){return nexacro._getElementPositionInFrame(combo.getElement());}return {};};_pComboPopupControl._getPopupParentPos=function(){var combo=this.parent;var combo_size=[combo._adjust_width,combo._adjust_height];var combo_elem_pos=nexacro._getElementPositionInFrame(combo.getElement());return {"x":combo_elem_pos.x,"y":combo_elem_pos.y,"width":combo_size[0],"height":combo_size[1],"xgap":0,"ygap":0};};_pComboPopupControl._getPopupPosition=function(){var popup_left=0;var popup_top=0;var popup_width=0;var popup_height=0;var combo=this.parent;var combolist=this._attached_comp;var rootframe=this._getRootFrame();if(combo&&combolist&&rootframe){var win=this._getWindow();var minimum_row=3;var screen_avail_height=nexacro._getScreenAvailHeight();var rootframe_elem_pos=nexacro._getElementPositionInFrame(rootframe.getElement());var combopos=this._getPopupParentPos();var combo_elem_pos={"x":combopos.x,"y":combopos.y};var combo_size=[combopos.width,combopos.height];var xgap=combopos.xgap;var ygap=combopos.ygap;var win_left=nexacro._allow_default_pinchzoom?nexacro._getWindowOffsetPosition(win).left:rootframe_elem_pos.x;var window_width=win?nexacro._getWindowHandleClientWidth(win.handle):0;var window_height=win?nexacro._getWindowHandleClientHeight(win.handle):0;var combo_vscrollsize=combo._getVScrollBarSize();var combo_displayrowcount=combo.displayrowcount;var combo_roucount=combo._selectDataset()?combo._selectDataset().getRowCount():0;var combo_popupsize=combo._getPopupSizeArr();var combolist_size=combolist._on_getFitSize();var combolist_itemheight=combolist._getItemHeight();var combolist_bordersize=combolist._getCurrentStyleBorder();combolist_bordersize=combolist_bordersize?combolist_bordersize._getBorderHeight():0;var combolist_paddingsize=combolist._getCurrentStylePadding();combolist_paddingsize=combolist_paddingsize?combolist_paddingsize.top+combolist_paddingsize.bottom:0;var combolist_stylesize=combolist_bordersize+combolist_paddingsize;var combolist_minimum_height;var combolist_height;var upper_space_height=combo_elem_pos.y;var below_space_height=window_height-(combo_elem_pos.y+combo_size[1]);if(screen_avail_height>window_height&&rootframe_elem_pos.y+window_height>screen_avail_height){below_space_height=screen_avail_height-rootframe_elem_pos.y-(combo_elem_pos.y+combo_size[1]);}popup_top=combo_size[1];if(combo_popupsize){popup_width=combo_popupsize.width;popup_height=combo_popupsize.height?combo_popupsize.height:popup_height;}else{popup_width=Math.max(combo_size[0],combolist_size[0]);}if(combo_displayrowcount==null){combolist_minimum_height=(combo_roucount<minimum_row?combo_roucount:minimum_row)*combolist_itemheight+combolist_stylesize;combolist_height=popup_height?popup_height:(combo_roucount*combolist_itemheight)+combolist_stylesize;if(below_space_height>combolist_minimum_height){if(below_space_height>combolist_height){popup_height=combolist_height;}else{popup_height=below_space_height;if(!combo_popupsize){popup_width+=combo_vscrollsize;}}}else{if(upper_space_height>combolist_minimum_height){if(upper_space_height>combolist_height){popup_top= -combolist_height;popup_height=combolist_height;}else{popup_top= -upper_space_height;popup_height=upper_space_height;}}else{if(below_space_height>upper_space_height){popup_height=below_space_height;}else{popup_top= -upper_space_height;popup_height=upper_space_height;}}}}else{if(combo_roucount>combo_displayrowcount){combo_roucount=combo_displayrowcount;if(!combo_popupsize&&popup_width<=combolist_size[0]+combo_vscrollsize){popup_width=combolist_size[0]+combo_vscrollsize;}}combolist_minimum_height=combo_roucount*combolist_itemheight+combolist_stylesize;if(below_space_height>combolist_minimum_height){popup_height=combolist_minimum_height;}else{if(upper_space_height>combolist_minimum_height){popup_top= -combolist_minimum_height;popup_height=combolist_minimum_height;}else{if(below_space_height>upper_space_height){popup_height=below_space_height;}else{popup_top= -upper_space_height;popup_height=upper_space_height;}}}}if(combo_elem_pos.x<win_left){popup_left+=win_left-combo_elem_pos.x;}else if(combo_elem_pos.x+popup_width>win_left+window_width){popup_left-=(combo_elem_pos.x+popup_width)-(win_left+window_width);if(popup_left<(win_left-combo_elem_pos.x)){popup_left=win_left-combo_elem_pos.x;}}}return {left:popup_left+xgap,top:popup_top+ygap,width:popup_width,height:popup_height};};_pComboPopupControl._getPopupPositionCenter=function(){var popup_left=0;var popup_top=0;var popup_width=0;var popup_height=0;var window_width=0;var window_height=0;var combo=this.parent;var combolist=this._attached_comp;if(combo&&combolist){var add_addressbar_height=0;var win=this._getWindow();if(win){if(nexacro._OS=="iOS"&&nexacro._Browser=="MobileSafari"){window_width=win.handle.innerWidth;window_height=win.handle.innerHeight;var body_scroll=nexacro._getWindowDestinationHandle(win.handle).scrollTop;if(body_scroll>0){add_addressbar_height+=body_scroll*2;}}else{window_width=nexacro._getWindowHandleClientWidth(win.handle);window_height=nexacro._getWindowHandleClientHeight(win.handle);}}var combo_vscrollsize=combo._getVScrollBarSize();var combo_displayrowcount=combo.displayrowcount;var combo_roucount=combo._selectDataset()?combo._selectDataset().getRowCount():0;var combo_popupsize=combo._getPopupSizeArr();var combolist_size=combolist._on_getFitSize();var combolist_itemheight=combolist._getItemHeight();var combolist_bordersize=combolist._getCurrentStyleBorder();combolist_bordersize=combolist_bordersize?combolist_bordersize._getBorderHeight():0;var combolist_paddingsize=combolist._getCurrentStylePadding();combolist_paddingsize=combolist_paddingsize?combolist_paddingsize.top+combolist_paddingsize.bottom:0;var combolist_stylesize=combolist_bordersize+combolist_paddingsize;popup_width=combo_popupsize?combo_popupsize.width:combolist_size[0];if(combo_popupsize&&combo_popupsize.height){popup_height=combo_popupsize.height;}else{popup_height=(combo_roucount*combolist_itemheight)+combolist_stylesize;}if(combo_displayrowcount==null){if(popup_height>window_height){popup_height=window_height;popup_width+=combo_vscrollsize;}}else{if(combo_roucount>combo_displayrowcount){popup_height=(combo_displayrowcount*combolist_itemheight)+combolist_stylesize;if(popup_height>window_height){popup_height=window_height;}popup_width+=combo_vscrollsize;}else{if(popup_height>window_height){popup_height=window_height;popup_width+=combo_vscrollsize;}}}popup_left=((window_width/2)-(popup_width/2));popup_top=((window_height/2)-(popup_height/2));popup_top=popup_top<0?0:popup_top;popup_top+=add_addressbar_height;}return {left:popup_left,top:popup_top,width:popup_width,height:popup_height};};_pComboPopupControl._setZoom=function(scale){var elem=this.getElement();if(elem.setElementZoom){elem.setElementZoom(scale*100);}else if(nexacro.ScrollableControlElement.prototype.setElementZoom){nexacro.ScrollableControlElement.prototype.setElementZoom.call(elem,scale*100);}};delete _pComboPopupControl;}
if(!nexacro.Div){nexacro.Div=function(id,left,top,width,height,right,bottom,minwidth,maxwidth,minheight,maxheight,parent){nexacro.Component.call(this,id,left,top,width,height,right,bottom,minwidth,maxwidth,minheight,maxheight,parent);this.form=new nexacro._InnerForm("form",0,0,width,height,null,null,null,null,null,null,this);};var _pDiv=nexacro._createPrototype(nexacro.Component,nexacro.Div);nexacro.Div.prototype=_pDiv;_pDiv._type_name="Div";_pDiv._cell_elem=null;_pDiv.async=true;_pDiv.url="";_pDiv.urlchangeeffect="";_pDiv.text="";_pDiv.textAlign="center";_pDiv.verticalAlign="middle";_pDiv.formscrollbarbarminsize=undefined;_pDiv.formscrollbarbaroutsize=undefined;_pDiv.formscrollbardecbuttonsize=undefined;_pDiv.formscrollbarincbuttonsize=undefined;_pDiv.formscrollbarsize=undefined;_pDiv.formscrollbartrackbarsize=undefined;_pDiv.formscrollbartype=undefined;_pDiv.formscrollindicatorsize=undefined;_pDiv.formscrolltype=undefined;_pDiv._urlchangeeffect=null;_pDiv._is_loadedform=false;_pDiv._apply_client_padding=false;_pDiv._is_simple_control=true;_pDiv._is_container=true;_pDiv.accessibilityrole="form";_pDiv._event_list={"onclick":1,"ondblclick":1,"onkillfocus":1,"onsetfocus":1,"onkeypress":1,"onkeydown":1,"onkeyup":1,"onlbuttondown":1,"onlbuttonup":1,"onrbuttondown":1,"onrbuttonup":1,"onmouseenter":1,"onmouseleave":1,"onmousemove":1,"onmousewheel":1,"ondrag":1,"ondragenter":1,"ondragleave":1,"ondragmove":1,"ondrop":1,"onmove":1,"onsize":1,"oncontextmenu":1,"onvscroll":1,"onhscroll":1,"onmouseup":1,"onmousedown":1,"ontouchstart":1,"ontouchmove":1,"ontouchend":1};_pDiv.on_create_contents=function(){if(!this.url){this.form.createComponent(true);}};_pDiv._applyElementVisible=function(v){this._control_element.setElementDisplay(v?"":"none");var len=0;var form=this.form;var compname;if(v==true&&form){len=form.components.length;for(var i=0;i<len;i++ ){compname=form.components.get_id(i);if(form[compname]._notifyParentDisplayOn){form[compname]._notifyParentDisplayOn();}}}};_pDiv.on_created_contents=function(win){var form=this.form;if(!this.url){form.on_created(win);}else{if(!form._url){if(this.parent&&this.parent instanceof nexacro.Tab&&this.parent.preload==false){}else{form.loadForm(this.url,this.async,true,this._url);}}if(form._is_loaded&&!form._is_created){form.createComponent();}}this.on_apply_text();this._recalcLayout();};_pDiv.on_destroy_contents=function(){this._destroyTextElement();this._destroyFormControl();this._user_property_list=null;};_pDiv.on_create_contents_command=function(){var str="";return str;};_pDiv.on_attach_contents_handle=function(win){var form=this.form;if(!this.url){form.on_created(win);}else{if(this.url&&form._is_loaded&&!form._is_created){form.createComponent();}}this.on_apply_text();this._recalcLayout();};_pDiv.on_change_containerRect=function(width,height){if(this._cell_elem){this._cell_elem.setElementSize(width,height);}this._recalcLayout();};_pDiv.on_change_containerPos=function(){};_pDiv.on_apply_prop_enable=function(v){if(this.form){this.form._setEnable(v);}};_pDiv.on_get_css_assumedtypename=function(){return this._type_name;};_pDiv.on_apply_text=function(text){var form=this.form;if(form&&((form._child_list&&form._child_list.length>0)||this.url)||!this._is_alive){return;}var control_elem=form.getElement();if(control_elem){if(!text){text=this._displaytext;}var cell_elem=this._cell_elem;if(!cell_elem&&text){var win=this._getWindow();cell_elem=this._cell_elem=new nexacro.TextBoxElement(control_elem);cell_elem.create(win);}if(cell_elem){cell_elem.setElementSize(this._getClientWidth(),this._getClientHeight());cell_elem.setElementVerticalAlign(this.verticalAlign);cell_elem.setElementTextAlign(this.textAlign);cell_elem.setElementText(text);}}};_pDiv.set_url=function(v){if(this.url!=v){this.url=v;this.on_apply_url();}};_pDiv.on_apply_url=function(reload){var form=this.form;if(!form){return;}var url=this.url;var confirm_message,pos;if(url&&url.length>0){nexacro._getLayoutManager().clearLayout(form);if(this._is_loadedform&&form._is_loaded&&reload!=true){confirm_message=form._on_beforeclose();if(form._checkAndConfirmClose(confirm_message)==false){return;}var async=form._async;form._on_close();form.set_tooltiptext("");this._destroyFormControl();pos=this._getFormPosition();form=this.form=new nexacro._InnerForm("form",pos.left,pos.top,pos.width,pos.height,null,null,null,null,null,null,this);form._async=async;form.createComponent();this._is_loadedform=false;}var _parent=this.parent;if(_parent!=null){while(!_parent._url){_parent=_parent.parent;}form.loadForm(url,this.async,true,_parent._url);}this._destroyTextElement();}else{if(form._is_loaded){confirm_message=form._on_beforeclose();if(form._checkAndConfirmClose(confirm_message)==false){return;}form._on_close();form.set_tooltiptext("");this._is_loadedform=false;}this._destroyFormControl();pos=this._getFormPosition();form=this.form=new nexacro._InnerForm("form",pos.left,pos.top,pos.width,pos.height,null,null,null,null,null,null,this);form.createComponent();this._destroyTextElement();this.on_apply_text();}};_pDiv.set_urlchangeeffect=function(v){this.urlchangeeffect=v;if(v){if(this._urlchangeeffect==null||this._urlchangeeffect.value!=v){var urlchangeeffect=nexacro.TransitionEffectObject(v);this._urlchangeeffect=urlchangeeffect;}}else{if(this._urlchangeeffect){this._urlchangeeffect=null;}}};_pDiv.set_async=function(v){v=nexacro._toBoolean(v);if(this.async!=v){this.async=v;if(this.form){this.form._async=v;}}};_pDiv._on_apply_formscroll=function(){if(this.formscrollbarbarminsize!==undefined){nexacro.Component.prototype.set_scrollbarbarminsize.call(this.form,this.formscrollbarbarminsize);}if(this.formscrollbarbaroutsize!==undefined){nexacro.Component.prototype.set_scrollbarbaroutsize.call(this.form,this.formscrollbarbaroutsize);}if(this.formscrollbardecbuttonsize!==undefined){nexacro.Component.prototype.set_scrollbardecbuttonsize.call(this.form,this.formscrollbardecbuttonsize);}if(this.formscrollbarincbuttonsize!==undefined){nexacro.Component.prototype.set_scrollbarincbuttonsize.call(this.form,this.formscrollbarincbuttonsize);}if(this.formscrollbarsize!==undefined){nexacro.Component.prototype.set_scrollbarsize.call(this.form,this.formscrollbarsize);}if(this.formscrollbartrackbarsize!==undefined){nexacro.Component.prototype.set_scrollbartrackbarsize.call(this.form,this.formscrollbartrackbarsize);}if(this.formscrollbartype!==undefined){nexacro.Component.prototype.set_scrollbartype.call(this.form,this.formscrollbartype);}if(this.formscrollindicatorsize!==undefined){nexacro.Component.prototype.set_scrollindicatorsize.call(this.form,this.formscrollindicatorsize);}if(this.formscrolltype!==undefined){nexacro.Component.prototype.set_scrolltype.call(this.form,this.formscrolltype);}};_pDiv.set_padding=nexacro._emptyFn;_pDiv.reload=function(){this.on_apply_url(true);};_pDiv.getFocus=function(){return this.parent?this.parent.getFocus():null;};_pDiv.getParentContext=function(){return this.parent;};_pDiv.getSetter=function(name,fnname){if(!this._user_property_list){this._user_property_list=[];}this._user_property_list[name]=1;if(!fnname){fnname="set_"+name;}var fn=this[fnname];if(fn){return new nexacro.SetterBinder(this,name,fn);}return new nexacro.PropBinder(this,name);};_pDiv.getOwnerFrame=function(){return this._getOwnerFrame();};_pDiv.addChild=function(id,obj){var form=this.form;var ret=form.addChild(id,obj);return ret;};_pDiv.insertChild=function(idx,id,obj){var form=this.form;var ret=form.insertChild(idx,id,obj);return ret;};_pDiv.removeChild=function(id){var obj=null;if(!this._is_alive&&id==="form"){obj=this.form;if(obj){var is_focused=false;var _window=this._getWindow();if(_window){is_focused=(_window._indexOfCurrentFocusPaths(obj)> -1);}if(obj._control_element){if(obj._control_element){obj._control_element._removeFromContainer();}if(is_focused){if(obj instanceof nexacro.Form){obj._on_deactivate();}_window._removeFromCurrentFocusPath(obj,true);}}}delete this[id];}else{var form=this.form;obj=form.removeChild(id);}return obj;};_pDiv.addLayout=function(name,obj){var form=this.form;if(form){form.addLayout(name,obj);}};_pDiv.setContents=function(str){var ret=this._setContents(str);return ret;};_pDiv.set_formscrollbarbarminsize=function(formscrollbarbarminsize){if(formscrollbarbarminsize!==undefined){formscrollbarbarminsize=parseInt(formscrollbarbarminsize);if(isNaN(formscrollbarbarminsize)){return;}}if(this.formscrollbarbarminsize!=formscrollbarbarminsize){this.formscrollbarbarminsize=formscrollbarbarminsize;nexacro.Component.prototype.set_scrollbarbarminsize.call(this.form,formscrollbarbarminsize);}};_pDiv.set_formscrollbarbaroutsize=function(formscrollbarbaroutsize){if(formscrollbarbaroutsize!==undefined){formscrollbarbaroutsize=parseInt(formscrollbarbaroutsize);if(isNaN(formscrollbarbaroutsize)){return;}}if(this.formscrollbarbaroutsize!=formscrollbarbaroutsize){this.formscrollbarbaroutsize=formscrollbarbaroutsize;nexacro.Component.prototype.set_scrollbarbaroutsize.call(this.form,formscrollbarbaroutsize);}};_pDiv.set_formscrollbardecbuttonsize=function(formscrollbardecbuttonsize){if(formscrollbardecbuttonsize!==undefined){formscrollbardecbuttonsize=parseInt(formscrollbardecbuttonsize);if(isNaN(formscrollbardecbuttonsize)){return;}}if(this.formscrollbardecbuttonsize!=formscrollbardecbuttonsize){this.formscrollbardecbuttonsize=formscrollbardecbuttonsize;nexacro.Component.prototype.set_scrollbardecbuttonsize.call(this.form,formscrollbardecbuttonsize);}};_pDiv.set_formscrollbarincbuttonsize=function(formscrollbarincbuttonsize){if(formscrollbarincbuttonsize!==undefined){formscrollbarincbuttonsize=parseInt(formscrollbarincbuttonsize);if(isNaN(formscrollbarincbuttonsize)){return;}}if(this.formscrollbarincbuttonsize!=formscrollbarincbuttonsize){this.formscrollbarincbuttonsize=formscrollbarincbuttonsize;nexacro.Component.prototype.set_scrollbarincbuttonsize.call(this.form,formscrollbarincbuttonsize);}};_pDiv.set_formscrollbarsize=function(formscrollbarsize){if(formscrollbarsize!==undefined){formscrollbarsize=parseInt(formscrollbarsize);if(isNaN(formscrollbarsize)){return;}}if(this.formscrollbarsize!=formscrollbarsize){this.formscrollbarsize=formscrollbarsize;nexacro.Component.prototype.set_scrollbarsize.call(this.form,formscrollbarsize);}};_pDiv.set_formscrollbartrackbarsize=function(formscrollbartrackbarsize){if(formscrollbartrackbarsize!==undefined){formscrollbartrackbarsize=parseInt(formscrollbartrackbarsize);if(isNaN(formscrollbartrackbarsize)){return;}}if(this.formscrollbartrackbarsize!=formscrollbartrackbarsize){this.formscrollbartrackbarsize=formscrollbartrackbarsize;nexacro.Component.prototype.set_scrollbartrackbarsize.call(this.form,formscrollbartrackbarsize);}};_pDiv.set_formscrollbartype=function(formscrollbartype){if(this.formscrollbartype!=formscrollbartype){this.formscrollbartype=nexacro.Component.prototype.set_scrollbartype.call(this.form,formscrollbartype);}};_pDiv.set_formscrollindicatorsize=function(formscrollindicatorsize){if(formscrollindicatorsize!==undefined){formscrollindicatorsize=parseInt(formscrollindicatorsize);if(isNaN(formscrollindicatorsize)){return;}}if(this.formscrollindicatorsize!=formscrollindicatorsize){this.formscrollindicatorsize=formscrollindicatorsize;nexacro.Component.prototype.set_scrollindicatorsize.call(this.form,formscrollindicatorsize);}};_pDiv.set_formscrolltype=function(formscrolltype){if(this.formscrolltype!=formscrolltype){this.formscrolltype=nexacro.Component.prototype.set_scrolltype.call(this.form,formscrolltype);}};_pDiv.scrollTo=function(x,y){if(this.form){this.form.scrollTo(x,y);}};_pDiv._on_activate=function(){nexacro.Component.prototype._on_activate.call(this);if(this.form){this.form._on_activate();}return true;};_pDiv._on_deactivate=function(){nexacro.Component.prototype._on_deactivate.call(this);if(this.form){this.form._on_deactivate();}return true;};_pDiv._on_bubble_beforeclose=function(root_closing_comp,event_bubbles,fire_comp,refer_comp){return this.parent._on_bubble_beforeclose(root_closing_comp,event_bubbles,fire_comp,refer_comp);};_pDiv._on_bubble_close=function(event_bubbles,fire_comp,refer_comp){return this.parent._on_bubble_close(event_bubbles,fire_comp,refer_comp);};_pDiv._clearUserFunctions=nexacro._emptyFn;_pDiv._loadedForm=function(){this._on_apply_formscroll();this._is_loadedform=true;};_pDiv._destroyTextElement=function(){if(this._cell_elem){this._cell_elem.destroy();this._cell_elem=null;}};_pDiv._destroyFormControl=function(){if(this.form){this.form._destroy();this.form=null;}};_pDiv._loadInclude=function(mainurl,url,notuseasync,service_url){var asyncmode=this.async;var parent_context=this.getParentContext();var is_async;if(asyncmode){while(parent_context&&parent_context._is_form){is_async=parent_context._getAsync();if(!parent_context._is_fired_onload&&is_async===false){asyncmode=false;break;}parent_context=parent_context.getParentContext();}}if(!this._is_created){}this._loadIncludeJS.call(this,mainurl,url,asyncmode,service_url);};_pDiv._loadIncludeJS=function(mainurl,url,asyncmode,service_url){var service;if(service_url&&service_url.length>0){service=nexacro._getServiceObject(service_url);}else{service=nexacro._getServiceObject(url);}this._load_manager.loadIncludeModule(url,null,asyncmode,service);};_pDiv._closeForm=function(){this._destroyFormControl();};_pDiv._recalcLayout=function(){var form=this.form;if(form){var pos=this._getFormPosition();form._setPos(pos.left,pos.top);form._setSize(pos.width,pos.height);}};_pDiv._on_orientationchange=function(orientation){if(this.form){this.form._on_orientationchange(orientation);}};_pDiv._setContents=function(str){var doc=nexacro._parseXMLDocument(str);var layouts=doc.getElementsByTagName("Layouts")[0];if(!layouts){layouts=doc;}var layout=layouts.getElementsByTagName("Layout")[0];if(!layout){return false;}var ret=true;var node=layout.firstChild;while(node){if(node.nodeType==1){var className=nexacro._getRegisterClass(node.tagName);if(!className){return false;}var fnConstructor=nexacro._executeGlobalEvalStr(className);if(!fnConstructor){return false;}if(fnConstructor.prototype&&fnConstructor.prototype._is_component){var attr={};var attr_props={};for(var i=0;i<node.attributes.length;i++ ){var name=node.attributes[i].name;if(/^(id|left|top|width|height|right|bottom|minwidth|maxwidth|minheight|maxheight|)$/.test(name)){attr[name]=node.attributes[i].value;}else{attr_props[name]=node.attributes[i].value;}}var obj=new fnConstructor(attr["id"],attr["left"],attr["top"],attr["width"],attr["height"],attr["right"],attr["bottom"],attr["minwidth"],attr["maxwidth"],attr["minheight"],attr["maxheight"],this.form);for(var v in attr_props){if(obj["set_"+v]){obj["set_"+v](attr_props[v]);}else{obj[v]=attr_props[v];}}if(node.firstChild){var childnode=node.firstChild;var strXML="";while(childnode){if(node.nodeType==1){strXML+=nexacro._documentToXml(childnode);}childnode=childnode.nextSibling;}ret=obj._setContents(strXML);}if(!ret){return ret;}this.form.addChild(obj.id,obj);obj.show();}}node=node.nextSibling;}return ret;};_pDiv._getFormPosition=function(){var left=0;var top=0;var width=0;var height=0;width=this._getClientWidth();height=this._getClientHeight();if(!this._is_initcssselector){this._initCSSSelector();}return {left:left,top:top,width:width,height:height};};_pDiv._getComponentsByTaborder=function(){if(!this.form._isEnable()||!this.form._child_list||this.form._child_list.length==0){return null;}return [this.form];};_pDiv._searchNextTabFocus=function(current,bSearchFromFirst,opt_force_cycle,filter_type){var ret=nexacro.FormBase.prototype._searchNextTabFocus.call(this,current,bSearchFromFirst,opt_force_cycle,filter_type);if(bSearchFromFirst&&ret&&ret[0]===this.form){return this.parent._searchNextTabFocus(this,undefined,undefined,filter_type);}return ret;};_pDiv._searchPrevTabFocus=function(current,bSearchFromLast,opt_force_cycle,filter_type){var ret=nexacro.FormBase.prototype._searchPrevTabFocus.call(this,current,bSearchFromLast,opt_force_cycle,filter_type);if(bSearchFromLast&&ret&&ret[0]===this.form){return [this];}return ret;};_pDiv._getTabOrderNext=function(current,direction,filter_type){return nexacro.FormBase.prototype._getTabOrderNext.call(this,current,direction,filter_type);};_pDiv._getTabOrderFirst=function(filter_type){return nexacro.FormBase.prototype._getTabOrderFirst.call(this,filter_type);};_pDiv._getTabOrderLast=function(filter_type){return nexacro.FormBase.prototype._getTabOrderLast.call(this,filter_type);};delete _pDiv;}
if(!nexacro.ProgressBar){nexacro.ProgressBar=function(id,left,top,width,height,right,bottom,minwidth,maxwidth,minheight,maxheight,parent){nexacro.Component.call(this,id,left,top,width,height,right,bottom,minwidth,maxwidth,minheight,maxheight,parent);this._progressbaritems=new Array();};var _pProgressBar=nexacro._createPrototype(nexacro.Component,nexacro.ProgressBar);nexacro.ProgressBar.prototype=_pProgressBar;_pProgressBar._type_name="ProgressBar";_pProgressBar.progressstartcap=null;_pProgressBar.progressendcap=null;_pProgressBar._progressbartext=null;_pProgressBar.smooth=false;_pProgressBar.direction="forward";_pProgressBar.pos=0;_pProgressBar.step=1;_pProgressBar.max=100;_pProgressBar.min=0;_pProgressBar.blocksize=undefined;_pProgressBar.blockgap=undefined;_pProgressBar._endcap_width=0;_pProgressBar._startcap_width=0;_pProgressBar._item_width=0;_pProgressBar._endcap_iconwidth=undefined;_pProgressBar._startcap_iconwidth=undefined;_pProgressBar._item_iconwidth=undefined;_pProgressBar._item_icon_url="";_pProgressBar._item_edge_url="";_pProgressBar.accessibilityrole="progressbar";_pProgressBar.on_apply_text=function(v){var control_elem=this.getElement();if(control_elem){if(!v){v=this.text;}if(v){var progressbartext=this._progressbartext;var client_width,client_height;if(!progressbartext){client_width=this._getClientWidth();client_height=this._getClientHeight();progressbartext=this._progressbartext=new nexacro.Static("progressbartext",0,0,client_width,client_height,null,null,null,null,null,null,this);progressbartext._setControl();progressbartext.set_text(v);progressbartext.createComponent();progressbartext._setEventHandler("onclick",this.on_notify_progressbar_onclick,this);}else{client_width=this._getClientWidth();client_height=this._getClientHeight();progressbartext.set_text(v);progressbartext.move(0,0,client_width,client_height,null,null);if(!progressbartext._is_created){progressbartext.on_created();}}}else{if(this._progressbartext){this._progressbartext.destroy();this._progressbartext=null;}}}};_pProgressBar.on_apply_prop_enable=function(v){if(this.progressstartcap){this.progressstartcap._setEnable(v);}if(this.progressendcap){this.progressendcap._setEnable(v);}var items=this._progressbaritems;var itemcnt=items.length;for(var i=0;i<itemcnt;i++ ){items[i]._setEnable(v);}};_pProgressBar.on_create_contents=function(){var control_elem=this.getElement();if(control_elem){this._createProgressBarItems(true);}};_pProgressBar.on_created_contents=function(_window){if(this.progressstartcap){this.progressstartcap.on_created(_window);}var itemlist=this._progressbaritems;var itemcnt=itemlist.length;for(var i=0;i<itemcnt;i++ ){itemlist[i].on_created(_window);}if(this.progressendcap){this.progressendcap.on_created(_window);}if(this._progressbartext){this._progressbartext.on_created(_window);}if(nexacro._enableaccessibility&&this._isAccessibilityEnable()){this._setAccessibilityInfoValueMin(this.min);this._setAccessibilityInfoValueMax(this.max);this._setAccessibilityInfoValueCur(this.pos);}};_pProgressBar.on_destroy_contents=function(){if(this.progressstartcap){this.progressstartcap.destroy();this.progressstartcap=null;}if(this.progressendcap){this.progressendcap.destroy();this.progressendcap=null;}if(this._progressbartext){this._progressbartext.destroy();this._progressbartext=null;}this._clearProgressBarItems(true);};_pProgressBar.on_create_contents_command=function(){var str="";if(this.progressstartcap){str+=this.progressstartcap.createCommand();}var itemlist=this._progressbaritems;var itemcnt=itemlist.length;for(var i=0;i<itemcnt;i++ ){str+=itemlist[i].createCommand();}if(this.progressendcap){str+=this.progressendcap.createCommand();}if(this._progressbartext){str+=this._progressbartext.createCommand();}return str;};_pProgressBar.on_attach_contents_handle=function(win){if(this.progressstartcap){this.progressstartcap.attachHandle(win);}var itemlist=this._progressbaritems;for(var i=0;i<itemlist.length;i++ ){itemlist[i].attachHandle(win);}if(this.progressendcap){this.progressendcap.attachHandle(win);}if(this._progressbartext){this._progressbartext.attachHandle(win);}if(nexacro._enableaccessibility&&this._isAccessibilityEnable()){this._setAccessibilityInfoValueMin(this.min);this._setAccessibilityInfoValueMax(this.max);this._setAccessibilityInfoValueCur(this.pos);}};_pProgressBar.on_change_containerRect=function(){this._update();};_pProgressBar._on_getAccessibilityAdditionalLabel=function(){var additional="";if(this._isAccessibilityEnable()){additional=(this.expr&&this.expr.length>0)?this._displaytext+" "+this.min+" "+this.max:this.pos+" "+this.min+" "+this.max;}return additional;};_pProgressBar._on_getAccessibilityAdditionalRole=function(){if(this._getAccessibilityRole()=="progressbar"){return " ProgressBar";}return "";};_pProgressBar.set_blockgap=function(v){if(v!==undefined){if(isNaN(v= +v)){return;}}if(this.blockgap!=v){this.blockgap=v;this._update();}};_pProgressBar.set_blocksize=function(v){if(v!==undefined){if(isNaN(v= +v)){return;}}if(v<1){v=1;}if(this.blocksize!=v){this.blocksize=v;this._update();}};_pProgressBar.set_min=function(v){if(isNaN(v= +v)){return;}v=(v<0)?0:v;if(this.min!=v){this.min=v;this.on_apply_min(v);this._update();}};_pProgressBar.on_apply_min=function(min){if(min>this.max){this.max=min;}if(min>this.pos){this.pos=min;}if(nexacro._enableaccessibility&&this._isAccessibilityEnable()){this._setAccessibilityInfoValueMin(min);}};_pProgressBar.set_max=function(v){if(isNaN(v= +v)){return;}v=(v<0)?0:v;if(this.max!=v){this.max=v;this.on_apply_max(v);this._update();}};_pProgressBar.on_apply_max=function(max){if(max<this.min){this.min=max;}if(max<this.pos){this.pos=max;}if(nexacro._enableaccessibility&&this._isAccessibilityEnable()){this._setAccessibilityInfoValueMax(max);}};_pProgressBar.set_pos=function(v){if(isNaN(v= +v)){return;}if(this.pos!=v){if(v>this.max){v=this.max;}else if(v<this.min){v=this.min;}this.pos=v;if(nexacro._enableaccessibility&&this._isAccessibilityEnable()){this._setAccessibilityInfoValueCur(v);}}this._update();};_pProgressBar.set_step=function(v){if(isNaN(v= +v)){return;}if(this.step!=v){this.step=v;this._update();}};_pProgressBar.set_smooth=function(v){v=nexacro._toBoolean(v);if(this.smooth!=v){this.smooth=v;this._update();}};_pProgressBar.set_direction=function(v){v=nexacro._toString(v);if(this.direction!=v){this.direction=v;this._update();}};_pProgressBar.stepIt=function(){this.set_pos(this.pos+this.step);};_pProgressBar._on_loadimage_start_icon=function(imgurl,width){this._startcap_iconwidth=width;this._update();};_pProgressBar._on_loadimage_end_icon=function(imgurl,width){this._endcap_iconwidth=width;this._update();};_pProgressBar._on_loadimage_item_icon=function(imgurl,width){this._item_iconwidth=width;this._update();};_pProgressBar.on_notify_progressbar_onclick=function(obj,e){this.on_fire_onclick(e.button,e.altkey,e.ctrlkey,e.shiftkey,e.screenx,e.screeny,e.canvasx,e.canvasy,e.clientx,e.clienty,this,this);};_pProgressBar._createProgressStartCap=function(iscreateonly){var control_elem=this.getElement();if(control_elem){var progressstartcap=this.progressstartcap;if(!progressstartcap){progressstartcap=new nexacro._Icon("progressstartcap",0,0,0,this._getClientHeight(),null,null,null,null,null,null,this);progressstartcap._setControl();progressstartcap.createComponent(iscreateonly);this.progressstartcap=progressstartcap;}var border=progressstartcap._getCurrentStyleBorder();var padding=progressstartcap._getCurrentStylePadding();this._startcap_width=border?(border.left._width+border.right._width):0;this._startcap_width+=padding?(padding.left+padding.right):0;if(this._startcap_iconwidth===undefined){var startcap_icon=progressstartcap._icon||progressstartcap._getCSSStyleValue("icon");if(startcap_icon instanceof Object){startcap_icon=startcap_icon.value;}var imagesize=nexacro._getImageSize(startcap_icon,this._on_loadimage_start_icon,this);if(imagesize){this._startcap_iconwidth=imagesize.width;}}}};_pProgressBar._createProgressEndCap=function(iscreateonly){var control_elem=this.getElement();if(control_elem){var progressendcap=this.progressendcap;if(!progressendcap){progressendcap=new nexacro._Icon("progressendcap",0,0,0,this._getClientHeight(),null,null,null,null,null,null,this);progressendcap._setControl();progressendcap.createComponent(iscreateonly);this.progressendcap=progressendcap;}var border=progressendcap._getCurrentStyleBorder();var padding=progressendcap._getCurrentStylePadding();this._endcap_width=border?(border.left._width+border.right._width):0;this._endcap_width+=padding?(padding.left+padding.right):0;if(this._endcap_iconwidth===undefined){var endcap_icon=progressendcap._icon||progressendcap._getCSSStyleValue("icon");if(endcap_icon instanceof Object){endcap_icon=endcap_icon.value;}var imagesize=nexacro._getImageSize(endcap_icon,this._on_loadimage_end_icon,this);if(imagesize){this._endcap_iconwidth=imagesize.width;}}}};_pProgressBar._createProgressBarItemTemp=function(){var control_elem=this.getElement();if(control_elem){var progressbaritem=new nexacro._ProgressBarItemControl("progressbaritem",0,0,0,this._getClientHeight(),null,null,null,null,null,null,this);progressbaritem._initCSSSelector();var border=progressbaritem._getCurrentStyleBorder();var padding=progressbaritem._getCurrentStylePadding();this._item_width=border?(border.left._width+border.right._width):0;this._item_width+=padding?(padding.left+padding.right):0;if(this._item_iconwidth===undefined){var item_icon=progressbaritem._icon||progressbaritem._getCSSStyleValue("icon");if(item_icon instanceof Object){item_icon=item_icon.value;}this._item_icon_url=item_icon;var imagesize=nexacro._getImageSize(item_icon,this._on_loadimage_item_icon,this);if(imagesize){this._item_iconwidth=imagesize.width;}}progressbaritem.destroy();}};_pProgressBar._createProgressBarItems=function(iscreateonly){var control_elem=this.getElement();if(control_elem){if(this.pos<=0){if(this.progressendcap){this.progressstartcap.destroy();this.progressstartcap=null;}if(this.progressendcap){this.progressendcap.destroy();this.progressendcap=null;}this._clearProgressBarItems(true);this.on_apply_text();return;}else{this._createProgressStartCap(iscreateonly);this._createProgressEndCap(iscreateonly);this._createProgressBarItemTemp();}this._setSizeInfo();var barinfo=this._getBarInfo();var barcurpos=barinfo[1];var barwidth=barinfo[2];var client_width=this._getClientWidth();var client_height=this._getClientHeight();var l,t=this._getClientTop(),w=0;var blockgap=this.blockgap;if(blockgap==null){blockgap=2;}else if(blockgap<0){blockgap=0;}var smooth=this.smooth;var direction=this.direction;var baritem;var itemlist=this._progressbaritems;this._clearProgressBarItems(false,barinfo);if(direction=="backward"){if(this._endcap_width){this.progressendcap.move(client_width-this._endcap_width,0,this._endcap_width,client_height);}}else{if(this._startcap_width){this.progressstartcap.move(0,0,this._startcap_width,client_height);}}if(smooth){if(direction=="backward"){w=barwidth|0;l=client_width-this._endcap_width-barwidth;if(this._startcap_width){this.progressstartcap.move(l-this._startcap_width,t,this._startcap_width,client_height);}}else{l=this._startcap_width;w=barwidth|0;if(this._endcap_width){this.progressendcap.move(l+w,t,this._endcap_width,client_height);}}baritem=itemlist[0];if(!baritem){baritem=new nexacro._ProgressBarItemControl("progressbaritem",l,t,w,client_height,null,null,null,null,null,null,this);baritem.createComponent(iscreateonly);baritem._setEventHandler("onclick",this.on_notify_progressbar_onclick,this);itemlist[0]=baritem;}else{baritem.move(l,t,w,client_height);}}else{var i,blocksize=barwidth+blockgap;if(direction=="backward"){l=client_width-this._endcap_width;for(i=0;i<barcurpos;i++ ){baritem=itemlist[i];l=client_width-this._endcap_width-(i*blocksize)-barwidth;w=barwidth;if(i==(barcurpos-1)&&(l-barwidth)<=0){w=client_width-this._startcap_width-this._endcap_width-(i*blocksize);l=this._startcap_width;}if(!baritem){baritem=new nexacro._ProgressBarItemControl("progressbaritem_"+i,l,t,w,client_height,null,null,null,null,null,null,this);baritem.createComponent(iscreateonly);baritem._setEventHandler("onclick",this.on_notify_progressbar_onclick,this);itemlist[i]=baritem;}else{baritem.move(l,t,w,client_height);}}if(this._startcap_width){this.progressstartcap.move(l-this._startcap_width,t,this._startcap_width,client_height);}}else{l=this._startcap_width;var progressitem_totalwidth=client_width-this._startcap_width-this._endcap_width;for(i=0;i<barcurpos;i++ ){baritem=itemlist[i];w=barwidth;l=(i*blocksize)+this._startcap_width;if(i==(barcurpos-1)&&(l+barwidth)>=(progressitem_totalwidth)){w=client_width-this._endcap_width-l;}if(!baritem){baritem=new nexacro._ProgressBarItemControl("progressbaritem_"+i,l,t,w,client_height,null,null,null,null,null,null,this);baritem.createComponent(iscreateonly);baritem._setEventHandler("onclick",this.on_notify_progressbar_onclick,this);itemlist[i]=baritem;}else{baritem.move(l,t,w,client_height);}}if(this._endcap_width){this.progressendcap.move(l+w,t,this._endcap_width,client_height);}}}this.on_apply_text(this.text);if(itemlist.length>0&&this._progressbartext){var progressbartext_elem=this._progressbartext.getElement();control_elem.moveToPrevElement(progressbartext_elem,itemlist[itemlist.length-1].getElement());}}};_pProgressBar._clearProgressBarItems=function(allclear,info){var olditemcnt=this._progressbaritems.length;if(olditemcnt<=0){return;}var deletecnt=0;if(!allclear){var newitemcnt=info[1];if(olditemcnt>newitemcnt){deletecnt=olditemcnt-newitemcnt;}}else{deletecnt=olditemcnt;}for(var i=0;i<deletecnt;i++ ){var item=this._progressbaritems.pop();if(item){item.destroy();}}};_pProgressBar._update=function(){this._createProgressBarItems(!this._is_created);};_pProgressBar._setSizeInfo=function(){if(this._startcap_iconwidth){this._startcap_width+=this._startcap_iconwidth;}if(this._endcap_iconwidth){this._endcap_width+=this._endcap_iconwidth;}if(this._item_iconwidth){this._item_width+=this._item_iconwidth;}};_pProgressBar._getBarInfo=function(){var rtn=null;var barcount=0;var barcurpos=0;var barwidth=0;var client_width=this._getClientWidth()-this._startcap_width-this._endcap_width;var pos=this.pos;var max=this.max;var per=pos/max;var smooth=this.smooth;var blocksize=this.blocksize;if(blocksize==null){blocksize=this._item_width?this._item_width:15;}var blockgap=this.blockgap;if(blockgap==null){blockgap=2;}else if(blockgap<0){blockgap=0;}if(smooth){barcount=1;barwidth=parseInt(client_width*per)|0;barcurpos=0;}else{barwidth=blocksize;barcount=Math.ceil(client_width/(barwidth+blockgap))|0;barcurpos=Math.floor(barcount*per);}rtn=[barcount,barcurpos,barwidth];try{return rtn;}finally{rtn=null;}};delete _pProgressBar;nexacro._ProgressBarItemControl=function(id,left,top,width,height,right,bottom,minwidth,maxwidth,minheight,maxheight,parent){nexacro._Icon.call(this,id,left,top,width,height,right,bottom,minwidth,maxwidth,minheight,maxheight,parent);};var _pProgressBarItemControl=nexacro._createPrototype(nexacro._Icon,nexacro._ProgressBarItemControl);nexacro._ProgressBarItemControl.prototype=_pProgressBarItemControl;_pProgressBarItemControl._type_name="IconControl";_pProgressBarItemControl._is_subcontrol=true;_pProgressBarItemControl._is_focus_accept=false;_pProgressBarItemControl.on_getIDCSSSelector=function(){return "progressbaritem";};delete _pProgressBarItemControl;}
if(!nexacro.PopupDiv){nexacro.PopupDiv=function(id,left,top,width,height,right,bottom,minwidth,maxwidth,minheight,maxheight,parent){nexacro.Div.call(this,id,left,top,width,height,right,bottom,minwidth,maxwidth,minheight,maxheight,parent);this._attached_comp=this;};var _pPopupDiv=nexacro._createPrototype(nexacro.Div,nexacro.PopupDiv);nexacro.PopupDiv.prototype=_pPopupDiv;_pPopupDiv._type_name="PopupDiv";_pPopupDiv.returnvalue="";_pPopupDiv.visible=false;_pPopupDiv._callbackfunction=null;_pPopupDiv._callbackcontext=null;_pPopupDiv._eventclear_flag=false;_pPopupDiv._default_zindex=nexacro._zindex_popup;_pPopupDiv._is_window=true;_pPopupDiv._is_popup_control=true;_pPopupDiv._is_selfclose=true;_pPopupDiv._is_trackpopup=false;_pPopupDiv._track_capture=true;_pPopupDiv._is_fired_onsize=false;_pPopupDiv.accessibilityrole="form";_pPopupDiv._event_list={"onclick":1,"ondblclick":1,"onkeypress":1,"onkeydown":1,"onkeyup":1,"onkillfocus":1,"onsetfocus":1,"ondrag":1,"ondragenter":1,"ondragleave":1,"ondragmove":1,"ondrop":1,"onlbuttondown":1,"onlbuttonup":1,"onload":1,"onmouseenter":1,"onmouseleave":1,"onmousemove":1,"onmove":1,"onsize":1,"onrbuttondown":1,"onrbuttonup":1,"oncloseup":1,"onpopup":1,"onlayoutchanged":1,"canlayoutchange":1,"onmousewheel":1,"onmousedown":1,"onmouseup":1,"onvscroll":1,"onhscroll":1,"oncontextmenu":1,"ontouchstart":1,"ontouchmove":1,"ontouchend":1};_pPopupDiv.on_create_control_element=function(parent_elem){var control_elem;if(this._is_scrollable){control_elem=this.on_create_popupscrollable_control_element(parent_elem);}else{control_elem=this.on_create_popup_control_element(parent_elem);}if(control_elem&&this._default_zindex>0){control_elem.setElementZIndex(this._default_zindex);}return control_elem;};_pPopupDiv.on_created=function(win){nexacro.Div.prototype.on_created.call(this,win);var control_elem=this._control_element;if(control_elem){control_elem.setElementPosition( -5000,0);}};_pPopupDiv.destroyComponent=function(){nexacro.PopupControl.prototype.destroyComponent.call(this);nexacro.Div.prototype.destroyComponent.call(this);this._callbackfunction=null;this._callbackcontext=null;return true;};_pPopupDiv.on_created_contents=function(win){nexacro.Div.prototype.on_created_contents.call(this,win);var control_elem=this._control_element;if(!this.visible&&control_elem){control_elem.setElementPosition( -5000,0);control_elem.setElementFont(this._getCurrentStyleInheritValue("font"));control_elem.setElementColor(this._getCurrentStyleInheritValue("color"));control_elem.setElementWordSpacing(this._getCurrentStyleInheritValue("wordSpacing"));control_elem.setElementLetterSpacing(this._getCurrentStyleInheritValue("letterSpacing"));}};_pPopupDiv.on_create_contents_command=function(){return "";};_pPopupDiv.on_attach_contents_handle=function(win){nexacro.Div.prototype.on_created.call(this,win);var control_elem=this._control_element;if(control_elem){control_elem.setElementPosition( -5000,0);}};_pPopupDiv._applyElementVisible=function(v){nexacro.Component.prototype._applyElementVisible.call(this,v);};_pPopupDiv.on_update_position=function(resize_flag,move_flag,update){if(this.visible||!nexacro._allow_default_pinchzoom){nexacro.Div.prototype.on_update_position.call(this,resize_flag,move_flag,update);}else{var control_elem=this._control_element;if(control_elem){control_elem.setElementPosition( -5000,0);if(move_flag){this.on_fire_onmove(this._adjust_left,this._adjust_top);}if(resize_flag){this.on_fire_onsize(this._adjust_width,this._adjust_height);}}}};_pPopupDiv._clearEventListener=function(evt_id){var application=nexacro.getApplication();if(this._eventclear_flag&&application&&application.getActiveForm()){var formEventList=application.getActiveForm()._event_list;if(!formEventList[evt_id]){return;}}nexacro._EventSinkObject.prototype._clearEventListener.apply(this,arguments);};_pPopupDiv.on_fire_user_onkeydown=function(keycode,alt_key,ctrl_key,shift_key,fire_comp,refer_comp){return nexacro.Form.prototype.on_fire_user_onkeydown.call(this,keycode,alt_key,ctrl_key,shift_key,fire_comp,refer_comp);};_pPopupDiv.set_visible=function(v){if(this._is_trackpopup){nexacro.PopupControl.prototype.set_visible.apply(this,arguments);}};_pPopupDiv.trackPopup=function(left,top,width,height,callbackfn,bcapture){this.returnvalue="";this._track_capture=bcapture===false?false:true;left= +left;top= +top;if(width==null){width=this._adjust_width;}else{width= +width;}if(height==null){height=this._adjust_height;}else{height= +height;}var win=this._getWindow();var frame_w=0;var frame_h=0;if(win){frame_w=win.frame._adjust_width;frame_h=win.frame._adjust_height;}var popup_r=left+width;if(popup_r>frame_w){if(width<=frame_w){left=frame_w-width;}else{left=0;width=frame_w;}}var popup_b=top+height;if(popup_b>frame_h){if(height<=frame_h){top=frame_h-height;}else{top=0;height=frame_h;}}if(this._is_fired_onsize==false&&this.form){this.form.on_fire_onsize(this._adjust_width,this._adjust_height);this._is_fired_onsize=true;}this._is_trackpopup=true;if(this._is_loading){this._wait_pop_position={obj:null,left:left,top:top,width:width,height:height};}else{this._popup(left,top,width,height);}if(callbackfn&&typeof callbackfn=="string"){var parent=this.parent;var callbackfunc=parent[callbackfn];while(!callbackfunc&&!(parent._is_form&&parent._is_loaded)){parent=parent.parent;callbackfunc=parent[callbackfn];}if(callbackfunc){this._callbackfunction=callbackfunc;this._callbackcontext=parent;}}else{this._callbackfunction=null;this._callbackcontext=null;}this.setFocus();this.on_fire_onpopup(this);return (this.async?true:this.returnvalue);};_pPopupDiv.trackPopupByComponent=function(obj,left,top,width,height,callbackfn,bcapture){this.returnvalue="";this._track_capture=bcapture===false?false:true;if(width==null&&height==null){width=this._adjust_width;height=this._adjust_height;}left= +left;top= +top;var p=nexacro._getElementPositionInFrame(obj.getElement());var win_left=p.x;var win_top=p.y;var _window=this._getWindow();var m_c_width=_window.clientWidth;var m_c_height=_window.clientHeight;if(win_left+left+width>m_c_width){var l_temp=m_c_width-width;if(l_temp<0){left= -win_left;if(width>m_c_width){width=m_c_width;}}else{left=l_temp-win_left;}}if(win_top+top+height>m_c_height){var t_temp=m_c_height-height;if(t_temp<0){top= -win_top;height=m_c_height;}else{top=t_temp-win_top;}}if(callbackfn&&typeof callbackfn=="string"){var parent=this.parent;var callbackfunc=parent[callbackfn];while(!callbackfunc&&!(parent._is_form&&parent._is_loaded)){parent=parent.parent;callbackfunc=parent[callbackfn];}if(callbackfunc){this._callbackfunction=callbackfunc;this._callbackcontext=parent;}}else{this._callbackfunction=null;this._callbackcontext=null;}if(this._is_fired_onsize==false&&this.form){this.form.on_fire_onsize(this._adjust_width,this._adjust_height);this._is_fired_onsize=true;}this._is_trackpopup=true;if(this._is_loading){this._wait_pop_position={obj:obj,left:left,top:top,width:width,height:height};}else{this._popupBy(obj,left,top,width,height,true);}this.setFocus();this.on_fire_onpopup(this);return (this.async?true:this.returnvalue);};_pPopupDiv.closePopup=function(retvalue){this.returnvalue=retvalue;if(this.visible){this._closePopup(true);return true;}return false;};_pPopupDiv._on_init=function(){this._eventclear_flag=true;nexacro.FormBase.prototype._on_init.apply(this,arguments);this._eventclear_flag=false;};_pPopupDiv._on_load=function(){var ret=nexacro.Form.prototype._on_load.apply(this,arguments);var popup_info=this._wait_pop_position;if(popup_info){if(popup_info.obj){this._popupBy(popup_info.obj,popup_info.left,popup_info.top,popup_info.width,popup_info.height);}else{this._popup(popup_info.left,popup_info.top,popup_info.width,popup_info.height);}delete this._wait_pop_position;}return ret;};_pPopupDiv._on_bubble_mousewheel=function(elem,wheelDeltaX,wheelDeltaY,button,alt_key,ctrl_key,shift_key,canvasX,canvasY,screenX,screenY,event_bubbles,fire_comp,refer_comp,bScroll){if(!this._is_alive){return;}var clientXY,pThis,ret,vscrollbar,old_vpos,new_vpos,hscrollbar,old_hpos,new_hpos;if(event_bubbles===undefined){if(!refer_comp){refer_comp=this;}if(this.visible&&this._isEnable()){clientXY=this._getClientXY(canvasX,canvasY);event_bubbles=this.on_fire_user_onmousewheel(wheelDeltaX,wheelDeltaY,button,alt_key,ctrl_key,shift_key,screenX,screenY,canvasX,canvasY,clientXY[0],clientXY[0],this,refer_comp);pThis=this._getFromComponent(this);if(event_bubbles!==true){if(!pThis.onmousewheel||(pThis.onmousewheel&&!pThis.onmousewheel.defaultprevented)){ret=this.on_fire_sys_onmousewheel(wheelDeltaX,wheelDeltaY,button,alt_key,ctrl_key,shift_key,screenX,screenY,canvasX,canvasY,clientXY[0],clientXY[0],this,refer_comp);if(ret){return;}if(!ctrl_key){if(wheelDeltaY){if(this.vscrollbar&&this.vscrollbar.enable){vscrollbar=this.vscrollbar;old_vpos=vscrollbar._pos;this._setVScrollDefaultAction(vscrollbar,wheelDeltaY);new_vpos=vscrollbar._pos;if(old_vpos!=new_vpos){return;}}}if(wheelDeltaX){if(nexacro._OSVersion=="Mac OS"){if(this.hscrollbar&&this.hscrollbar.enable){hscrollbar=this.hscrollbar;old_hpos=hscrollbar._pos;this._setHScrollDefaultAction(hscrollbar,wheelDeltaX);new_hpos=hscrollbar._pos;if(old_hpos!=new_hpos){return;}}}}}return;}if(event_bubbles===false){event_bubbles=undefined;}if(!pThis.onmousewheel||(pThis.onmousewheel&&!pThis.onmousewheel.stoppropagation)){if(this.parent&&!this.parent._is_application){var canvas=this._getRecalcCanvasXY(elem,canvasX,canvasY);canvasX=canvas[0];canvasY=canvas[1];if(this._is_subcontrol){return this.parent._on_bubble_mousewheel(elem,wheelDeltaX,wheelDeltaY,button,alt_key,ctrl_key,shift_key,canvasX,canvasY,screenX,screenY,event_bubbles,null,refer_comp,bScroll);}else{return this.parent._on_bubble_mousewheel(elem,wheelDeltaX,wheelDeltaY,button,alt_key,ctrl_key,shift_key,canvasX,canvasY,screenX,screenY,false,this,refer_comp,bScroll);}}}}}}else{if(this.visible&&this._isEnable()){clientXY=this._getClientXY(canvasX,canvasY);event_bubbles=this.on_fire_user_onmousewheel(wheelDeltaX,wheelDeltaY,button,alt_key,ctrl_key,shift_key,screenX,screenY,canvasX,canvasY,clientXY[0],clientXY[0],fire_comp,refer_comp);pThis=this._getFromComponent(this);if(event_bubbles!==true){if(!pThis.onmousewheel||(pThis.onmousewheel&&!pThis.onmousewheel.defaultprevented)){ret=this.on_fire_sys_onmousewheel(wheelDeltaX,wheelDeltaY,button,alt_key,ctrl_key,shift_key,screenX,screenY,canvasX,canvasY,clientXY[0],clientXY[0],fire_comp,refer_comp);if(ret){return;}if(!ctrl_key){if(wheelDeltaY){if(this._isWheelScrollable(wheelDeltaY)&&this.vscrollbar&&this.vscrollbar.enable){vscrollbar=this.vscrollbar;old_vpos=vscrollbar._pos;this._setVScrollbarDefaultAction(vscrollbar,wheelDeltaY);new_vpos=vscrollbar._pos;if(old_vpos!=new_vpos){return;}}}if(wheelDeltaX){if(nexacro._OSVersion=="Mac OS"){if(this._isWheelScrollable(wheelDeltaX)&&this.hscrollbar&&this.hscrollbar.enable){hscrollbar=this.hscrollbar;old_hpos=hscrollbar._pos;this._setHScrollDefaultAction(hscrollbar,wheelDeltaX);new_hpos=hscrollbar._pos;if(old_hpos!=new_hpos){return;}}}}}return;}if(!pThis.onmousewheel||(pThis.onmousewheel&&!pThis.onmousewheel.stoppropagation)){if(this.parent&&!this.parent._is_application){canvasX+=this._adjust_left-this._scroll_left||0;canvasY+=this._adjust_top-this._scroll_top||0;return this.parent._on_bubble_mousewheel(elem,wheelDeltaX,wheelDeltaY,button,alt_key,ctrl_key,shift_key,canvasX,canvasY,screenX,screenY,false,fire_comp,refer_comp,bScroll);}}}}}};_pPopupDiv.on_fire_onpopup=function(obj){if(this.onpopup&&this.onpopup._has_handlers){var evt=new nexacro.EventInfo(obj);evt.eventid="onpopup";return this.onpopup._fireEvent(this,evt);}return false;};_pPopupDiv.on_fire_onmove=function(left,top){if(this.onmove&&this.onmove._has_handlers){var evt=new nexacro.MoveEventInfo(this,"onmove",left,top);return this.onmove._fireEvent(this,evt);}return false;};_pPopupDiv.on_fire_oncloseup=function(obj){if(this._callbackfunction){this._callbackfunction.call(this._callbackcontext,this.id,this.returnvalue);}if(this.oncloseup&&this.oncloseup._has_handlers){var evt=new nexacro.EventInfo(obj);evt.eventid="oncloseup";return this.oncloseup._fireEvent(this,evt);}return false;};_pPopupDiv._detach=function(comp){this._attached_comp=null;};_pPopupDiv.isPopup=nexacro.PopupControl.prototype._is_popup;_pPopupDiv._popup=nexacro.PopupControl.prototype._popup;_pPopupDiv._popupBy=nexacro.PopupControl.prototype._popupBy;_pPopupDiv._closePopup=function(){nexacro.PopupControl.prototype._closePopup.apply(this,arguments);this._is_trackpopup=false;};_pPopupDiv._getWindow=nexacro.PopupControl.prototype._getWindow;_pPopupDiv._getWindowHandle=nexacro.PopupControl.prototype._getWindowHandle;_pPopupDiv._findOwnerElementHandle=nexacro.PopupControl.prototype._findOwnerElementHandle;_pPopupDiv._isPopupVisible=function(){return this.visible;};delete _pPopupDiv;}
if(!nexacro._MenuItemControl){nexacro._MenuItemControl=function(id,left,top,width,height,right,bottom,minwidth,maxwidth,minheight,maxheight,parent){nexacro.Static.call(this,id,left,top,width,height,right,bottom,minwidth,maxwidth,minheight,maxheight,parent);};var _pMenuItemControl=nexacro._createPrototype(nexacro.Static,nexacro._MenuItemControl);nexacro._MenuItemControl.prototype=_pMenuItemControl;_pMenuItemControl._type_name="MenuItemControl";_pMenuItemControl._is_subcontrol=true;_pMenuItemControl._use_selected_status=true;_pMenuItemControl.index=0;_pMenuItemControl.datarow=0;_pMenuItemControl._canExpand=true;_pMenuItemControl._id="";_pMenuItemControl.enable=true;_pMenuItemControl.level="";_pMenuItemControl.userdata=null;_pMenuItemControl.accessibilityrole="menuitem";_pMenuItemControl._is_simple_control=false;_pMenuItemControl.on_apply_accessibility=function(){nexacro.Component.prototype.on_apply_accessibility.call(this);this._updateAccessibilityLabel(this);};_pMenuItemControl.on_tap_basic_action=function(elem,canvasX,canvasY,screenX,screenY,refer_comp){var parent=this.parent;var popupmenu=parent._popupmenu;if(popupmenu){if(popupmenu._is_popup()){if(parent._previtemindex!=this.index){parent._previtemindex=this.index;}popupmenu.cancelPopup();parent._menuitemindex=this.index;parent._popupitemindex= -1;}}var rootComp=this._getRootComponent(this);if(this._canExpand&&this._isEnable()){parent._showPopup(this);if(rootComp instanceof nexacro.Menu){rootComp._popupitemindex=this.index;}}else{var popuptype=rootComp.popuptype;if(this.enable==false||popuptype=="none"){return;}if(rootComp.onmenuclick&&rootComp.onmenuclick._has_handlers){rootComp.on_fire_onitemclick(rootComp,this._id,this.userdata);rootComp._popupitemindex= -1;}rootComp._closePopup(true);}return nexacro.Component.prototype.on_tap_basic_action.call(this,elem,canvasX,canvasY,screenX,screenY,refer_comp);};_pMenuItemControl.on_getIDCSSSelector=function(){return "menuitem";};_pMenuItemControl._on_dragleave=function(elem,to_comp,src_comp,src_refer_comp,dragdata,userdata,button,alt_key,ctrl_key,shift_key,canvasX,canvasY,screenX,screenY,event_bubbles,fire_comp,refer_comp){var ret=nexacro.Component.prototype._on_dragleave.call(this,elem,to_comp,src_comp,src_refer_comp,dragdata,userdata,button,alt_key,ctrl_key,shift_key,canvasX,canvasY,screenX,screenY,event_bubbles,fire_comp,refer_comp);var rootComp=this._getRootComponent(this);if(rootComp.ondragleave){rootComp._last_mouseleave_iteminfo.index=this.index;rootComp._last_mouseleave_iteminfo.bindindex=this._bindindex;rootComp._last_mouseleave_iteminfo.level=this.parent.level;}return ret;};_pMenuItemControl._getTextSize=function(text){var font=this._getCurrentStyleInheritValue("font");return nexacro._getTextSize(text,font,undefined,undefined,this.wordWrap,this._getCurrentStyleInheritValue("wordSpacing"),this._getCurrentStyleInheritValue("letterSpacing"));};_pMenuItemControl._on_apply_mouseover=function(isovered){this._changeStatus("mouseover",isovered);};_pMenuItemControl._on_apply_selected=function(bflag){this._changeUserStatus("selected",bflag);};_pMenuItemControl._getWindowPosition=function(){var control_elem=this._control_element;if(control_elem){var elem_pos=nexacro._getElementXYInWindow(control_elem.handle);var windowLeft=elem_pos[0];var windowTop=elem_pos[1];return {x:windowLeft,y:windowTop};}return {x:0,y:0};};_pMenuItemControl._updateAccessibilityLabel=function(item){var rootComp=this._getRootComponent(this);if(rootComp&&rootComp._innerdataset){var dataLen=rootComp._innerdataset.getRowCount();item._setAccessibilityInfoIndex(item.datarow+1);item._setAccessibilityInfoCount(dataLen);item._setAccessibilityFlagHasPopup(item._canExpand?true:false);}};delete _pMenuItemControl;}if(!nexacro.Menu){nexacro.MenuClickEventInfo=function(obj,id,itemid,itemuserdata,index,level){this.eventid=id||"onmenuclick";this.id=itemid;this.fromobject=obj;this.fromreferenceobject=obj;this.index=index;this.level=level;this.userdata=itemuserdata;};var _pMenuClickEventInfo=nexacro._createPrototype(nexacro.Event,nexacro.MenuClickEventInfo);nexacro.MenuClickEventInfo.prototype=_pMenuClickEventInfo;_pMenuClickEventInfo._type_name="MenuClickEventInfo";delete _pMenuClickEventInfo;nexacro.MenuDragEventInfo=function(obj,id,itemid,dragdata,userdata,datatype,filelist,src_comp,src_refer_comp,from_comp,from_refer_comp,button,alt_key,ctrl_key,shift_key,screenX,screenY,canvasX,canvasY,clientX,clientY,level,index,bindindex){this.id=itemid;this.eventid=id||"onmenudrag";if(!from_refer_comp){from_refer_comp=from_comp;}this.cancelable=true;this.bubbles=true;this.dragdata=dragdata;this.userdata=userdata;this.datatype=datatype;this.filelist=filelist;this.sourceobject=src_comp;this.sourcereferenceobject=src_refer_comp;this.fromobject=from_comp;this.fromreferenceobject=from_refer_comp;this.altkey=alt_key||false;this.ctrlkey=ctrl_key||false;this.button=button||"";this.shiftkey=shift_key||false;this.screenx=screenX|| -1;this.screeny=screenY|| -1;this.canvasx=canvasX|| -1;this.canvasy=canvasY|| -1;this.clientx=clientX|| -1;this.clienty=clientY|| -1;this.level=level;this.index=index;this.bindindex=bindindex;};var _pEventMenuDragEventInfo=nexacro._createPrototype(nexacro.Event,nexacro.MenuDragEventInfo);nexacro.MenuDragEventInfo.prototype=_pEventMenuDragEventInfo;_pEventMenuDragEventInfo._type_name="MenuDragEventInfo";delete _pEventMenuDragEventInfo;nexacro.MenuMouseEventInfo=function(obj,id,itemid,strButton,altKey,ctrlKey,shiftKey,screenX,screenY,canvasX,canvasY,clientX,clientY,from_comp,from_refer_comp,level,index,bindindex){this.id=itemid;this.eventid=id||"onmenumouse";this.cancelable=true;this.bubbles=true;this.fromobject=from_comp;this.fromreferenceobject=from_refer_comp;this.altkey=altKey||false;this.ctrlkey=ctrlKey||false;this.button=strButton||"";this.shiftkey=shiftKey||false;this.screenx=screenX|| -1;this.screeny=screenY|| -1;this.canvasx=canvasX|| -1;this.canvasy=canvasY|| -1;this.clientx=clientX|| -1;this.clienty=clientY|| -1;this.level=level;this.index=index;this.bindindex=bindindex;};var _pEventMenuMouseEventInfo=nexacro._createPrototype(nexacro.Event,nexacro.MenuMouseEventInfo);nexacro.MenuMouseEventInfo.prototype=_pEventMenuMouseEventInfo;_pEventMenuMouseEventInfo._type_name="MenuMouseEventInfo";delete _pEventMenuMouseEventInfo;nexacro.Menu=function(id,left,top,width,height,right,bottom,minwidth,maxwidth,minheight,maxheight,parent){nexacro.Component.call(this,id,left,top,width,height,right,bottom,minwidth,maxwidth,minheight,maxheight,parent);this._items=[];this._hot_key_list=[];this._items_width=[];};var _pMenu=nexacro._createPrototype(nexacro.Component,nexacro.Menu);nexacro.Menu.prototype=_pMenu;_pMenu._type_name="Menu";_pMenu.autohotkey=false;_pMenu.captioncolumn="";_pMenu.checkboxcolumn="";_pMenu.enablecolumn="";_pMenu.hotkeycolumn="";_pMenu.iconcolumn="";_pMenu.idcolumn="";_pMenu.levelcolumn="";_pMenu.userdatacolumn="";_pMenu.level=0;_pMenu.innerdataset=null;_pMenu.popuptype="normal";_pMenu.popupitemheight=undefined;_pMenu.navigationbuttonsize=undefined;_pMenu.popupnavigationbuttonsize=undefined;_pMenu.buttonalign="auto";_pMenu.accessibilityrole="menubar";_pMenu.accessibilityenable=true;_pMenu.accessibilitylabel="";_pMenu.accessibilitydescription="";_pMenu.accessibilityaction="";_pMenu.accessibilitydesclevel="all";_pMenu._menuitemindex= -1;_pMenu._menuitemonmouseenter=null;_pMenu._popupitemLR= -1;_pMenu._popupitemindex= -1;_pMenu._popupitempreviousindex=0;_pMenu._previtemindex=0;_pMenu._clickitemindex=0;_pMenu._hotkeytextgap=20;_pMenu._icontextpadding=5;_pMenu._focus_obj=null;_pMenu._innerdataset="";_pMenu._popupmenu=null;_pMenu._want_tab=nexacro._enableaccessibility;_pMenu._want_arrow=true;_pMenu._items_total_width=0;_pMenu._start_navigation_index=0;_pMenu._end_navigation_index=0;_pMenu._is_navigationbutton_visible=false;_pMenu._last_mouseleave_iteminfo={bindindex: -1,index: -1,level: -1};_pMenu._event_list={"onclick":1,"ondblclick":1,"onkeypress":1,"onkeydown":1,"onkeyup":1,"onkillfocus":1,"onsetfocus":1,"ondrag":1,"ondragenter":1,"ondragleave":1,"ondragmove":1,"ondrop":1,"onlbuttondown":1,"onlbuttonup":1,"onmouseenter":1,"onmouseleave":1,"onmousemove":1,"onmove":1,"onsize":1,"onrbuttondown":1,"onrbuttonup":1,"onmenuclick":1,"onmousedown":1,"onmouseup":1,"oninnerdatachanged":1,"oncontextmenu":1,"ontouchstart":1,"ontouchmove":1,"ontouchend":1};_pMenu.on_create_contents=function(){this._createMenu(true);};_pMenu.on_created_contents=function(){var control=this.getElement();if(control){var i,len,items=this._items;if(items){len=this._items.length;for(i=0;i<len;i++ ){items[i].on_created();}}if(nexacro._enableaccessibility){this._setAccessibilityInfoLevel(this.level);}if(this._innerdataset&&this.enablecolumn){this.on_apply_enablecolumn();}var hotkey_list=this._hot_key_list;if(hotkey_list){for(i=0,len=hotkey_list.length;i<len;i++ ){this._registerItemHotkey(hotkey_list[i].key);}}this._relayout();}};_pMenu.on_create_contents_command=function(){var str="";var items=this._items;if(items){var len=this._items.length;for(var i=0;i<len;i++ ){str+=items[i].createCommand();}}return str;};_pMenu.on_attach_contents_handle=function(win){var i,len,items=this._items;if(items){len=this._items.length;for(i=0;i<len;i++ ){items[i].attachHandle(win);}}if(this._innerdataset&&this.enablecolumn){this.on_apply_enablecolumn();}var hotkey_list=this._hot_key_list;if(hotkey_list){for(i=0,len=hotkey_list.length;i<len;i++ ){this._registerItemHotkey(hotkey_list[i].key);}}this._relayout();};_pMenu.on_destroy_contents=function(){var popupmenu=this._popupmenu;if(popupmenu){popupmenu.destroy();}var i,len,items=this._items;if(items){len=items.length;for(i=0;i<len;i++ ){items[i].destroy();items[i]=null;}this._items=[];}var hotkey_list=this._hot_key_list;if(hotkey_list){for(i=hotkey_list.length-1;i> -1;i-- ){var item=hotkey_list[i];this._unregisterItemHotkey(item.key);}}if(this._items_width){this._items_width.length=0;this._items_width=null;}this._removeEventHandlerToInnerDataset();};_pMenu._removeEventHandlerToInnerDataset=function(){if(this._innerdataset){this._innerdataset._removeEventHandler("onload",this._callbackFromDataset,this);this._innerdataset._removeEventHandler("onrowposchanged",this._callbackFromDataset,this);this._innerdataset._removeEventHandler("oncolumnchanged",this._callbackFromDataset,this);this._innerdataset._removeEventHandler("onrowsetchanged",this._callbackFromDataset,this);this._innerdataset._removeEventHandler("onvaluechanged",this._callback_onvaluechanged,this);this._innerdataset=null;}};_pMenu.on_change_containerRect=function(width,height){var items=this._items;var len=items.length;var padding=this._getCSSStyleValue("padding",this._status);if(padding){height=height-padding.top-padding.bottom;}var navigation_visible=this._isNavigationVisible();if(navigation_visible){this._showNavigationButton(true);this._rearrangeMenuItems();}else{var move_flag=this._end_navigation_index|0;this._end_navigation_index=0;this._showNavigationButton(false);var items_width=this._items_width;var left=0;for(var i=0;i<len;i++ ){var item=items[i];var item_width=items_width[i];if(move_flag){item.move(left,0,item_width,height);left+=item_width;}else{item.resize(item_width,height);}}}};_pMenu.on_get_accessibility_label=function(){return this.text?this.text:this.id;};_pMenu._on_hotkey=function(keycode,altKey,ctrlKey,shiftKey){var list=this._hot_key_list;var len=list.length;var key=null;var modifykey=null;var hotkey=this._hotkey;if(hotkey){if(hotkey._keycode==keycode&&(((hotkey._modifierkey&0x02)==0x02)==altKey)&&(((hotkey._modifierkey&0x01)==0x01)==ctrlKey)&&(((hotkey._modifierkey&0x04)==0x04)==shiftKey)){this.setFocus();return;}}for(var i=0;i<len;i++ ){key=list[i].key;if(key._keycode==keycode){modifykey=key._modifierkey;if(altKey==((modifykey&0x02)==0x02)&&ctrlKey==((modifykey&0x01)==0x01)&&shiftKey==((modifykey&0x04)==0x04)){this.setFocus();this.on_fire_onitemclick(this,list[i].id,"");break;}}}};_pMenu._unregisterItemHotkey=function(hotkey){if(!hotkey||!hotkey._is_registered){return;}var _form=this._getMainForm();if(this._is_frame||this==_form){var owner_frame=this.getOwnerFrame();if(owner_frame){nexacro._unregisterHotkeyComp(owner_frame,this,hotkey);this._hot_key_list.pop();}}else{if(_form){nexacro._unregisterHotkeyComp(_form,this,hotkey);this._hot_key_list.pop();}}};_pMenu._registerItemHotkey=function(hotkey){if(!hotkey||hotkey._is_registered){return;}this._setAccessibilityHotKey(this.hotkey);var _form=this._getMainForm();if(this._is_frame||this==_form){var owner_frame=this.getOwnerFrame();if(owner_frame){nexacro._registerHotkeyComp(owner_frame,this,hotkey);}}else{if(_form){nexacro._registerHotkeyComp(_form,this,hotkey);}}};_pMenu.set_autohotkey=function(v){var val=nexacro._toBoolean(v);if(val!=this.autohotkey){this.autohotkey=val;this.on_apply_autohotkey(val);}};_pMenu.on_apply_autohotkey=function(autohotkey){var popupmenu=this._popupmenu;var i;if(popupmenu){popupmenu.set_autohotkey(autohotkey);}if(autohotkey==true){var ds=this._innerdataset;if(ds){var len=ds.getRowCount();for(i=0;i<len;i++ ){var id=ds.getColumn(i,this.idcolumn);var hotkey=ds.getColumn(i,this.hotkeycolumn);var level=ds.getColumn(i,this.levelcolumn);var is_expand=true;if(i==(len-1)||level>=ds.getColumn(i+1,this.levelcolumn)){is_expand=false;}if(this.autohotkey&&hotkey&&!is_expand){this._set_hotkey(id,hotkey);}}}}else{var hotkey_list=this._hot_key_list;if(hotkey_list&&hotkey_list.length> -1){for(i=hotkey_list.length-1;i> -1;i-- ){var item=hotkey_list[i];this._unregisterItemHotkey(item.key);}}}};_pMenu.set_popupitemheight=function(v){if(v!==undefined){if(isNaN(v= +v)){return;}}if(this.popupitemheight!=v){this.popupitemheight=v;this.on_apply_popupitemheight(v);}};_pMenu.on_apply_popupitemheight=function(popupitemheight){var popupmenu=this._popupmenu;if(popupmenu){popupmenu.set_itemheight(popupitemheight?popupitemheight:this.popupitemheight);}};_pMenu.set_popuptype=function(popuptype){var popuptype_enum=["center","none","normal","system"];if(popuptype_enum.indexOf(popuptype)== -1){return;}if(this.popuptype!=popuptype){this.popuptype=popuptype;this.on_apply_popuptype(popuptype);}};_pMenu.on_apply_popuptype=function(popuptype){var popupmenu=this._popupmenu;if(popupmenu){popupmenu.set_popuptype(popuptype);}};_pMenu.set_navigationbuttonsize=function(v){if(v!==undefined){if(isNaN(v= +v)){return;}}this.navigationbuttonsize=v;this.on_apply_navigationbuttonsize(v);};_pMenu.on_apply_navigationbuttonsize=function(){if(this._is_created_contents){this.on_change_containerRect();}};_pMenu.set_popupnavigationbuttonsize=function(v){if(v!==undefined){if(isNaN(v= +v)){return;}}this.popupnavigationbuttonsize=v;this.on_apply_popupnavigationbuttonsize(v);};_pMenu.on_apply_popupnavigationbuttonsize=function(){if(this._is_created_contents){this.on_change_containerRect();}};_pMenu.on_apply_prop_cssclass=function(){var popupemenu=this._popupmenu;if(popupemenu){popupemenu.on_apply_cssclass();}};_pMenu.set_captioncolumn=function(v){var val=v;var popupmenu=this._popupmenu;if(popupmenu){popupmenu.set_captioncolumn(val);}if(val!=this.captioncolumn){this.captioncolumn=val;this.on_apply_captioncolumn();}};_pMenu.on_apply_captioncolumn=function(){if(this._innerdataset){this._createMenu(false);var items=this._items;var len=items.length;for(var i=0;i<len;i++ ){var text=this._innerdataset.getColumn(items[i].datarow,this.captioncolumn);if(text){items[i].set_text(text);}else{items[i].set_text("");}}}};_pMenu.set_checkboxcolumn=function(v){var val=v;if(this._popupmenu){this._popupmenu.set_checkboxcolumn(val);}if(val!=this.checkboxcolumn){this.checkboxcolumn=val;this._createMenu(false);}};_pMenu.set_enablecolumn=function(v){if(v!=this.enablecolumn){this.enablecolumn=v;this.on_apply_enablecolumn();}};_pMenu.on_apply_enablecolumn=function(){if(this._innerdataset){this._createMenu(false);var items=this._items;var len=items.length;for(var i=0;i<len;i++ ){var enabletext=this._innerdataset.getColumn(items[i].datarow,this.enablecolumn);if(enabletext){items[i].set_enable(enabletext);}else{items[i].set_enable(true);}}}if(this._popupmenu){this._popupmenu.set_enablecolumn(this.enablecolumn);}};_pMenu.set_hotkeycolumn=function(v){var popupmenu=this._popupmenu;if(popupmenu){popupmenu.set_hotkeycolumn(v);}if(v!=this.hotkeycolumn){this.hotkeycolumn=v;this._createMenu(false);}};_pMenu.set_iconcolumn=function(v){var popupmenu=this._popupmenu;if(popupmenu){popupmenu.set_iconcolumn(v);}if(v!=this.iconcolumn){this.iconcolumn=v;this._createMenu(false);}};_pMenu.set_idcolumn=function(v){var popupmenu=this._popupmenu;if(popupmenu){popupmenu.set_idcolumn(v);}if(v!=this.idcolumn){this.idcolumn=v;this.on_apply_idcolumn();}};_pMenu.on_apply_idcolumn=function(){if(this._innerdataset){this._createMenu(false);var items=this._items;var len=items.length;for(var i=0;i<len;i++ ){var id=this._innerdataset.getColumn(items[i].datarow,this.idcolumn);items[i]._id=id?id:"";}}};_pMenu.set_levelcolumn=function(v){var val=v;var popupmenu=this._popupmenu;if(popupmenu){popupmenu.set_levelcolumn(val);}if(val!=this.levelcolumn){this.levelcolumn=val;this.on_apply_levelcolumn();}};_pMenu.on_apply_levelcolumn=function(){if(this._innerdataset){this._createMenu(false);var items=this._items;var len=items.length;for(var i=0;i<len;i++ ){var level=this._innerdataset.getColumn(items[i].datarow,this.levelcolumn);items[i].level=level?level: -1;}}};_pMenu.set_userdatacolumn=function(v){var val=v;var popupmenu=this._popupmenu;if(popupmenu){popupmenu.set_userdatacolumn(val);}if(val!=this.userdatacolumn){this.userdatacolumn=val;this.on_apply_userdatacolumn();}};_pMenu.on_apply_userdatacolumn=function(){if(this._innerdataset){this._createMenu(false);var items=this._items;var len=items.length;for(var i=0;i<len;i++ ){var userdata=this._innerdataset.getColumn(items[i].datarow,this.userdatacolumn);if(userdata){items[i].userdata=userdata;}}}};_pMenu.setInnerDataset=function(obj){this._removeEventHandlerToInnerDataset();if(!obj){this._innerdataset=null;this.innerdataset="";this.on_apply_innerdataset();}else if(obj instanceof nexacro.Dataset){this._innerdataset=obj;this.innerdataset=obj.id;this.on_apply_innerdataset();}};_pMenu._setInnerDatasetStr=function(str){this._removeEventHandlerToInnerDataset();if(!str){this._innerdataset=null;this.innerdataset="";}else{str=str.replace("@","");this._innerdataset=this._findDataset(str);this.innerdataset=str;}};_pMenu.getInnerDataset=function(){return this._innerdataset;};_pMenu.set_innerdataset=function(str){if(typeof str!="string"){this.setInnerDataset(str);return;}if(str!=this.innerdataset){this._removeEventHandlerToInnerDataset();if(!str){this._innerdataset=null;this.innerdataset="";}else{str=str.replace("@","");this._innerdataset=this._findDataset(str);this.innerdataset=str;}this.on_apply_innerdataset();}else if(this.innerdataset&&!this._innerdataset){this._setInnerDatasetStr(this.innerdataset);this.on_apply_innerdataset();}};_pMenu.on_apply_innerdataset=function(){var popupmenu=this._popupmenu;if(popupmenu){popupmenu.set_innerdataset(this.innerdataset);}var ds=this._innerdataset;if(ds){var callback=this._callbackFromDataset;ds._setEventHandler("onload",callback,this);ds._setEventHandler("onrowposchanged",callback,this);ds._setEventHandler("oncolumnchanged",callback,this);ds._setEventHandler("onrowsetchanged",callback,this);ds._setEventHandler("onvaluechanged",this._callback_onvaluechanged,this);}var control=this.getElement();if(control&&this.innerdataset){this._createMenu(true);this._last_focused=null;}};_pMenu.set_icontextpadding=function(v){this._icontextpadding=v;this.on_apply_icontextpadding();};_pMenu.on_apply_icontextpadding=function(){if(this._popupmenu){this._popupmenu.set_icontextpadding(this._icontextpadding);}};_pMenu.set_hotkeytextgap=function(v){this._hotkeytextgap=v;this.on_apply_hotkeytextgap();};_pMenu.on_apply_wordSpacing=function(wordSpacing){nexacro.Component.prototype.on_apply_wordSpacing.call(this,wordSpacing);this._createMenu();};_pMenu.on_apply_letterSpacing=function(letterSpacing){nexacro.Component.prototype.on_apply_letterSpacing.call(this,letterSpacing);this._createMenu();};_pMenu.isPopup=function(){return this._isPopupVisible();};_pMenu.trackPopup=function(index,x,y,bcapture){index=parseInt(index);this._track_capture=bcapture==undefined?true:nexacro._toBoolean(bcapture);var items=this._items;if(items){this._showPopup(items[index],x,y,bcapture);this._menuitemindex=items[index].index;return true;}return false;};_pMenu.cancelPopup=function(){var popupmenu=this._popupmenu;if(popupmenu){if(popupmenu.isPopup()){popupmenu.cancelPopup();}}return true;};_pMenu.on_fire_user_onlbuttondown=function(button,alt_key,ctrl_key,shift_key,screenX,screenY,canvasX,canvasY,clientX,clientY,from_comp,from_refer_comp){if(this.onlbuttondown&&this.onlbuttondown._has_handlers){var evtinfo_control=this._getEventInfoComponent(from_refer_comp);var evt=new nexacro.MenuMouseEventInfo(this,"onlbuttondown",evtinfo_control.id,button,alt_key,ctrl_key,shift_key,screenX,screenY,canvasX,canvasY,clientX,clientY,from_comp,evtinfo_control,evtinfo_control.level,evtinfo_control.index,evtinfo_control._bindindex);return this.onlbuttondown._fireUserEvent(this,evt);}return false;};_pMenu.on_fire_user_onlbuttonup=function(button,alt_key,ctrl_key,shift_key,screenX,screenY,canvasX,canvasY,clientX,clientY,from_comp,from_refer_comp){if(this.onlbuttonup&&this.onlbuttonup._has_handlers){var evtinfo_control=this._getEventInfoComponent(from_refer_comp);var evt=new nexacro.MenuMouseEventInfo(this,"onlbuttonup",evtinfo_control.id,button,alt_key,ctrl_key,shift_key,screenX,screenY,canvasX,canvasY,clientX,clientY,from_comp,evtinfo_control,evtinfo_control.level,evtinfo_control.index,evtinfo_control._bindindex);return this.onlbuttonup._fireUserEvent(this,evt);}return false;};_pMenu.on_fire_user_onrbuttondown=function(button,alt_key,ctrl_key,shift_key,screenX,screenY,canvasX,canvasY,clientX,clientY,from_comp,from_refer_comp){if(this.onrbuttondown&&this.onrbuttondown._has_handlers){var evtinfo_control=this._getEventInfoComponent(from_refer_comp);var evt=new nexacro.MenuMouseEventInfo(this,"onrbuttondown",evtinfo_control.id,button,alt_key,ctrl_key,shift_key,screenX,screenY,canvasX,canvasY,clientX,clientY,from_comp,evtinfo_control,evtinfo_control.level,evtinfo_control.index,evtinfo_control._bindindex);return this.onrbuttondown._fireUserEvent(this,evt);}return false;};_pMenu.on_fire_user_onrbuttonup=function(button,alt_key,ctrl_key,shift_key,screenX,screenY,canvasX,canvasY,clientX,clientY,from_comp,from_refer_comp){if(this.onrbuttonup&&this.onrbuttonup._has_handlers){var evtinfo_control=this._getEventInfoComponent(from_refer_comp);var evt=new nexacro.MenuMouseEventInfo(this,"onrbuttonup",evtinfo_control.id,button,alt_key,ctrl_key,shift_key,screenX,screenY,canvasX,canvasY,clientX,clientY,from_comp,evtinfo_control,evtinfo_control.level,evtinfo_control.index,evtinfo_control._bindindex);return this.onrbuttonup._fireUserEvent(this,evt);}return false;};_pMenu.on_fire_user_onmouseup=function(button,alt_key,ctrl_key,shift_key,screenX,screenY,canvasX,canvasY,clientX,clientY,from_comp,from_refer_comp){if(this.onmouseup&&this.onmouseup._has_handlers){var evtinfo_control=this._getEventInfoComponent(from_refer_comp);var evt=new nexacro.MenuMouseEventInfo(this,"onmouseup",evtinfo_control.id,button,alt_key,ctrl_key,shift_key,screenX,screenY,canvasX,canvasY,clientX,clientY,from_comp,evtinfo_control,evtinfo_control.level,evtinfo_control.index,evtinfo_control._bindindex);return this.onmouseup._fireUserEvent(this,evt);}return false;};_pMenu.on_fire_user_onmousedown=function(button,alt_key,ctrl_key,shift_key,screenX,screenY,canvasX,canvasY,clientX,clientY,from_comp,from_refer_comp){if(this.onmousedown&&this.onmousedown._has_handlers){var evtinfo_control=this._getEventInfoComponent(from_refer_comp);var evt=new nexacro.MenuMouseEventInfo(this,"onmousedown",evtinfo_control.id,button,alt_key,ctrl_key,shift_key,screenX,screenY,canvasX,canvasY,clientX,clientY,from_comp,evtinfo_control,evtinfo_control.level,evtinfo_control.index,evtinfo_control._bindindex);return this.onmousedown._fireUserEvent(this,evt);}return false;};_pMenu.on_fire_user_onmouseenter=function(button,alt_key,ctrl_key,shift_key,screenX,screenY,canvasX,canvasY,clientX,clientY,from_comp,from_refer_comp){if(this.onmouseenter&&this.onmouseenter._has_handlers){var evtinfo_control=this._getEventInfoComponent(from_refer_comp);var evt=new nexacro.MenuMouseEventInfo(this,"onmouseenter",evtinfo_control.id,button,alt_key,ctrl_key,shift_key,screenX,screenY,canvasX,canvasY,clientX,clientY,from_comp,evtinfo_control,evtinfo_control.level,evtinfo_control.index,evtinfo_control._bindindex);return this.onmouseenter._fireUserEvent(this,evt);}return false;};_pMenu.on_fire_user_onmouseleave=function(button,alt_key,ctrl_key,shift_key,screenX,screenY,canvasX,canvasY,clientX,clientY,from_comp,from_refer_comp){if(this.onmouseleave&&this.onmouseleave._has_handlers){var evtinfo_control=this._getEventInfoComponent(from_refer_comp);var evt=new nexacro.MenuMouseEventInfo(this,"onmouseleave",evtinfo_control.id,button,alt_key,ctrl_key,shift_key,screenX,screenY,canvasX,canvasY,clientX,clientY,from_comp,evtinfo_control,this._last_mouseleave_iteminfo.level,this._last_mouseleave_iteminfo.index,this._last_mouseleave_iteminfo.bindindex);return this.onmouseleave._fireUserEvent(this,evt);}return false;};_pMenu.on_fire_user_onmousemove=function(button,alt_key,ctrl_key,shift_key,screenX,screenY,canvasX,canvasY,clientX,clientY,from_comp,from_refer_comp){if(this.onmousemove&&this.onmousemove._has_handlers){var evtinfo_control=this._getEventInfoComponent(from_refer_comp);var evt=new nexacro.MenuMouseEventInfo(this,"onmousemove",evtinfo_control.id,button,alt_key,ctrl_key,shift_key,screenX,screenY,canvasX,canvasY,clientX,clientY,from_comp,evtinfo_control,evtinfo_control.level,evtinfo_control.index,evtinfo_control._bindindex);return this.onmousemove._fireUserEvent(this,evt);}return false;};_pMenu.on_fire_user_ondrag=function(button,alt_key,ctrl_key,shift_key,screenX,screenY,canvasX,canvasY,clientX,clientY,from_comp,refer_comp,self_refer_comp){if(this.ondrag&&this.ondrag._has_handlers){var dragData=this._getDragData();var evtinfo_control=this._getEventInfoComponent(self_refer_comp);var evt=new nexacro.MenuDragEventInfo(this,"ondrag",evtinfo_control.id,dragData,null,"text",null,this,self_refer_comp,from_comp,refer_comp,button,alt_key,ctrl_key,shift_key,screenX,screenY,canvasX,canvasY,clientX,clientY,evtinfo_control.level,evtinfo_control.index,evtinfo_control._bindindex);return [this.ondrag._fireUserEvent(this,evt),this,self_refer_comp,dragData,evt.userdata];}return [false];};_pMenu._getEventInfoComponent=function(refer_comp){while(!refer_comp._is_eventinfo_control){refer_comp=refer_comp.parent;}return refer_comp;};_pMenu.on_fire_user_ondrop=function(src_comp,src_refer_comp,dragdata,userdata,datatype,filelist,button,alt_key,ctrl_key,shift_key,screenX,screenY,canvasX,canvasY,clientX,clientY,from_comp,from_refer_comp){if(this.ondrop&&this.ondrop._has_handlers){var evtinfo_control=this._getEventInfoComponent(from_refer_comp);var evt=new nexacro.MenuDragEventInfo(this,"ondrop",evtinfo_control.id,dragdata,userdata,datatype,filelist,src_comp,src_refer_comp,from_comp,evtinfo_control,button,alt_key,ctrl_key,shift_key,screenX,screenY,canvasX,canvasY,clientX,clientY,evtinfo_control.level,evtinfo_control.index,evtinfo_control._bindindex);return this.ondrop._fireUserEvent(this,evt);}return false;};_pMenu.on_fire_user_ondragenter=function(src_comp,src_refer_comp,dragdata,userdata,datatype,filelist,button,alt_key,ctrl_key,shift_key,screenX,screenY,canvasX,canvasY,clientX,clientY,from_comp,from_refer_comp){if(this.ondragenter&&this.ondragenter._has_handlers){var evtinfo_control=this._getEventInfoComponent(from_refer_comp);var evt=new nexacro.MenuDragEventInfo(this,"ondragenter",evtinfo_control.id,dragdata,userdata,datatype,filelist,src_comp,src_refer_comp,from_comp,evtinfo_control,button,alt_key,ctrl_key,shift_key,screenX,screenY,canvasX,canvasY,clientX,clientY,evtinfo_control.level,evtinfo_control.index,evtinfo_control._bindindex);return this.ondragenter._fireUserEvent(this,evt);}return false;};_pMenu.on_fire_user_ondragleave=function(src_comp,src_refer_comp,dragdata,userdata,datatype,filelist,button,alt_key,ctrl_key,shift_key,screenX,screenY,canvasX,canvasY,clientX,clientY,from_comp,from_refer_comp){if(this.ondragleave&&this.ondragleave._has_handlers){var evtinfo_control=this._getEventInfoComponent(from_refer_comp);var evt=new nexacro.MenuDragEventInfo(this,"ondragleave",evtinfo_control.id,dragdata,userdata,datatype,filelist,src_comp,src_refer_comp,from_comp,evtinfo_control,button,alt_key,ctrl_key,shift_key,screenX,screenY,canvasX,canvasY,clientX,clientY,this._last_mouseleave_iteminfo.level,this._last_mouseleave_iteminfo.index,this._last_mouseleave_iteminfo.bindindex);return this.ondragleave._fireUserEvent(this,evt);}return false;};_pMenu.on_fire_user_ondragmove=function(src_comp,src_refer_comp,dragdata,userdata,datatype,filelist,button,alt_key,ctrl_key,shift_key,screenX,screenY,canvasX,canvasY,clientX,clientY,from_comp,from_refer_comp){if(this.ondragmove&&this.ondragmove._has_handlers){var evtinfo_control=this._getEventInfoComponent(from_refer_comp);var evt=new nexacro.MenuDragEventInfo(this,"ondragmove",evtinfo_control.id,dragdata,userdata,datatype,filelist,src_comp,src_refer_comp,from_comp,evtinfo_control,button,alt_key,ctrl_key,shift_key,screenX,screenY,canvasX,canvasY,clientX,clientY,evtinfo_control.level,evtinfo_control.index,evtinfo_control._bindindex);return this.ondragmove._fireUserEvent(this,evt);}return false;};_pMenu.on_fire_sys_onkeydown=function(keycode,alt_key,ctrl_key,shift_key,fire_comp,refer_comp){var pThis=this._popupmenu_find(this);var item;var popupvisible=this._is_popupmenu_visible(this);var menuitem=this._items;var menuexpand;if(menuitem[this._menuitemindex]){menuexpand=this._popupmenuitem_extend(menuitem[this._menuitemindex]);}var E=nexacro.Event;var is_accessibility=nexacro._enableaccessibility;var previouse_item_index;switch(keycode){case E.KEY_UP:if(is_accessibility){break;}if(!popupvisible){if(menuexpand){item=this._items[this._menuitemindex];if(item){this._showPopup(item);}}}else{this._fire_on_Popupmenu(keycode,alt_key,ctrl_key,shift_key,fire_comp,refer_comp);}break;case E.KEY_DOWN:if(is_accessibility){break;}if(!popupvisible&&this._menuitemindex> -1){if(menuexpand){item=this._items[this._menuitemindex];if(item){this._showPopup(item);this._fire_on_Popupmenu(keycode,alt_key,ctrl_key,shift_key,fire_comp,refer_comp);}}}else{this._fire_on_Popupmenu(keycode,alt_key,ctrl_key,shift_key,fire_comp,refer_comp);}break;case E.KEY_LEFT:if(!popupvisible&&this._menuitemindex<= -1){if(this._isNavigationVisible()){previouse_item_index=this._menuitemindex;if(previouse_item_index==0||previouse_item_index<=this._start_navigation_index){this._navigationprev(true);}}previouse_item_index=this._menuitemindex;this._select_menuitem(this._getItemIndex( -1),previouse_item_index,popupvisible);}else if(!is_accessibility){if(this._menuitemindex> -1&&nexacro._isNull(this._popupmenu)){previouse_item_index=this._menuitemindex;this._select_menuitem(this._getItemIndex( -1),previouse_item_index,true);}else{this._fire_on_Popupmenu(keycode,alt_key,ctrl_key,shift_key,fire_comp,refer_comp);}}break;case E.KEY_RIGHT:if(!popupvisible&&this._menuitemindex<= -1){if(this._isNavigationVisible()){previouse_item_index=this._menuitemindex;if(previouse_item_index+1>=this._end_navigation_index){this._navigationnext(true);}}previouse_item_index=this._menuitemindex;this._select_menuitem(this._getItemIndex(1),previouse_item_index,popupvisible);}else if(!is_accessibility){if(this._menuitemindex> -1&&nexacro._isNull(this._popupmenu)){previouse_item_index=this._menuitemindex;this._select_menuitem(this._getItemIndex(1),previouse_item_index,true);}else{this._fire_on_Popupmenu(keycode,alt_key,ctrl_key,shift_key,fire_comp,refer_comp);}}break;case E.KEY_ENTER:if(!popupvisible){item=this._items[this._menuitemindex];if(menuexpand){if(item&&item._isEnable()){this._showPopup(item);}this._fire_on_Popupmenu(keycode,alt_key,ctrl_key,shift_key,fire_comp,refer_comp);}else{if(item){var bselected=item._userstatus=="selected"?true:false;this.on_notify_menuitem_onclick(item);if(bselected){item._changeUserStatus("selected",false);}else{item._changeUserStatus("selected",true);}}}}else if(!is_accessibility){this._fire_on_Popupmenu(keycode,alt_key,ctrl_key,shift_key,fire_comp,refer_comp);}break;case E.KEY_ESC:if(popupvisible){this._fire_on_Popupmenu(keycode,alt_key,ctrl_key,shift_key,fire_comp,refer_comp);}else{item=this._items[this._menuitemindex];if(refer_comp.parent==pThis){this._item_killfocus(item);item._on_apply_selected(false);this._menuitemindex= -1;}else{item._on_focus(false);}}break;default:break;}return nexacro.Component.prototype.on_fire_sys_onkeydown.call(this,keycode,alt_key,ctrl_key,shift_key,fire_comp,refer_comp);};_pMenu.on_fire_oninnerdatachanged=function(obj,oldvalue,newvalue,columnid,col,row){if(this.oninnerdatachanged&&this.oninnerdatachanged._has_handlers){var evt=new nexacro.InnerdataChangedEventInfo(obj,"oninnerdatachanged",oldvalue,newvalue,columnid,col,row);return this.oninnerdatachanged._fireEvent(this,evt);}return true;};_pMenu.on_notify_menuitem_onmouseleave=function(obj){this._last_mouseleave_iteminfo={index:obj.index,bindindex:obj._bindindex,level:obj.parent.level};};_pMenu._select_menuitem=function(nextitemindex,previtemindex,popupvisible){var next_item=this._items[nextitemindex> -1?nextitemindex:this._menuitemindex];var prev_item=this._items[previtemindex];this._closePopup();if(prev_item&&nextitemindex!=previtemindex){prev_item._on_apply_selected(false);this._do_defocus(prev_item,false);}this._previtemindex=this._menuitemindex=nextitemindex;if(popupvisible){this._showPopup(next_item);next_item._on_focus(false);var popupmenu=this._popupmenu;if(popupmenu){popupmenu._select_menuitem(popupmenu._getItemIndex(0));}}this._item_focus(next_item,true);next_item._on_apply_selected(true);};_pMenu._fire_on_Popupmenu=function(keycode,alt_key,ctrl_key,shift_key,fire_comp,refer_comp){var popupmenu=this._popupmenu;if(popupmenu){popupmenu.on_fire_sys_onkeydown(keycode,alt_key,ctrl_key,shift_key,fire_comp,refer_comp);}};_pMenu.on_notify_menuitem_onmouseenter=function(obj){var popupmenu=this._popupmenu;this._menuitemonmouseenter=obj;if(popupmenu){if(popupmenu._is_popup()||this._menuitemindex> -1){if(this._previtemindex!=obj.index){popupmenu.cancelPopup();this._showPopup(obj);obj._on_apply_selected(true);this._item_focus(obj,true);var item=this._items[this._previtemindex];if(item){item._on_apply_selected(false);item._changeStatus("focused",false);}this._previtemindex=this._menuitemindex=obj.index;}}}else{if(this._menuitemindex> -1&&obj.enable){if(this._previtemindex!=obj.index){var item=this._items[this._previtemindex];if(item){item._on_apply_selected(false);item._changeStatus("focused",false);}this._showPopup(obj);this._item_focus(obj,true);obj._on_apply_selected(true);this._previtemindex=this._menuitemindex=obj.index;}}}return true;};_pMenu.on_notify_menuitem_onclick=function(obj){if(!obj){return;}var popuptype=this.popuptype;if(obj.enable==false||popuptype=="none"){return;}if(nexacro._enableaccessibility){this._want_tab=true;}if(!this._is_alive){return;}if(this._previtemindex!=obj.index){var item=this._items[this._previtemindex];if(item){item._on_apply_selected(false);}this._previtemindex=obj.index;}if(this.visible&&this._isEnable()&&this.enableevent&&obj._isEnable()){var rootComp=this._getRootComponent(obj);if(!obj._canExpand){this.on_fire_onitemclick(rootComp,obj._id,obj.userdata);}this._item_focus(obj,false);}};_pMenu.on_notify_menuitem_onlbuttondown=function(obj){if(this._previtemindex!=obj.index){var item=this._items[this._previtemindex];if(item){item._on_apply_selected(false);}}var popupmenu=this._popupmenu;if(popupmenu){if(popupmenu._is_popup()){popupmenu.cancelPopup();this._popupitemindex= -1;this._item_focus(obj,false);return;}}else{this._menuitemonmouseenter=obj;}if(obj._canExpand&&obj._isEnable()){this._showPopup(obj);this._menuitemindex=obj.index;}else if(this._menuitemindex> -1){this._item_focus(obj,false);obj._on_apply_selected(false);this._previtemindex=0;this._menuitemindex= -1;return;}this._item_focus(obj,true);obj._on_apply_selected(true);this._previtemindex=this._menuitemindex=obj.index;};_pMenu.on_fire_onitemclick=function(obj,itemid,itemuserdata){if(this.onmenuclick&&this.onmenuclick._has_handlers){var evt=new nexacro.MenuClickEventInfo(obj,"onmenuclick",itemid,itemuserdata);this.onmenuclick._fireEvent(this,evt);}};_pMenu.on_notify_navigationnext_onclick=function(){this._closePopup();this._navigationnext();};_pMenu.on_notify_navigationprev_onclick=function(){this._closePopup();this._navigationprev();};_pMenu._on_getFitSize=function(){var elem=this.getElement();if(elem){var total_w=0;var total_h=0;var border=this._getCurrentStyleBorder();var padding=this._getCurrentStylePadding();if(border){total_w+=border._getBorderWidth();total_h+=border._getBorderHeight();}if(padding){total_w+=padding.left+padding.right;total_h+=padding.top+padding.bottom;}var items=this._items;var item_len=items.length;if(item_len){var item=items[0];var itemborder=item._getCurrentStyleBorder();var itempadding=item._getCurrentStylePadding();var itemwidth=0;var itemheight=0;var items_width=this._items_width=[];var itemsize=null;for(var i=0,n=this._items.length;i<n;i++ ){item=items[i];itemsize=item._on_getFitSize();itemwidth=Math.ceil(itemsize[0]);items_width.push(itemwidth);total_w+=itemwidth;itemheight=Math.max(itemheight,itemsize[1]);}if(itemborder){total_h+=itemborder._getBorderHeight();}if(itempadding){total_h+=itempadding.top+itempadding.bottom;}total_h+=itemheight;}return [total_w,total_h];}return [this._adjust_width,this._adjust_height];};_pMenu._createMenu=function(){var control=this.getElement();if(control){this._deleteMenu();var ds=this._innerdataset;if(ds&&this.captioncolumn&&this.captioncolumn&&this.idcolumn){var left=0;var index=0;var len=ds.getRowCount();var text,enable,hotkey,id,level,userdata;var item;var is_expanditem=true;for(var i=0;i<len;i++ ){hotkey=ds.getColumn(i,this.hotkeycolumn);id=ds.getColumn(i,this.idcolumn);level=ds.getColumn(i,this.levelcolumn);if(i==(len-1)||level>=ds.getColumn(i+1,this.levelcolumn)){is_expanditem=false;}if(this.autohotkey&&hotkey&&!is_expanditem){this._set_hotkey(id,hotkey);}if(level==0){text=ds.getColumn(i,this.captioncolumn);enable=ds.getColumn(i,this.enablecolumn);userdata=ds.getColumn(i,this.userdatacolumn);item=new nexacro._MenuItemControl("item"+i,0,0,0,0,null,null,null,null,null,null,this);this._items.push(item);item.userdata=userdata;item._bindindex=i;item.index=index++ ;item.datarow=i;item._id=id?id:"";item.level=level;if(text){item.set_text(text);}item._setEventHandler("onlbuttondown",this.on_notify_menuitem_onlbuttondown,this);item._setEventHandler("onclick",this.on_notify_menuitem_onclick,this);if(!(nexacro._isTouchInteraction&&nexacro._SupportTouch)){item._setEventHandler("onmouseenter",this.on_notify_menuitem_onmouseenter,this);item._setEventHandler("onmouseleave",this.on_notify_menuitem_onmouseleave,this);}if(i==ds.getRowCount()-1){item._canExpand=false;}else{level=ds.getColumn(i+1,this.levelcolumn);if(level<=this.level){item._canExpand=false;}}item.set_enable(enable==false||enable=="false"?false:true);item.createComponent();}}if(this.fittocontents!=="none"){this._update_position();}var items_width=this._items_width=[];var items_total_width=this._items_total_width;var size,width,height;var itemborder,itempadding,itemfont,itemwordwrap,itemwordspace,itemletterspace;for(i=0;i<this._items.length;i++ ){item=this._items[i];itemfont=item._getCurrentStyleInheritValue("font");itemwordwrap=item.wordWrap||item._getCSSStyleValue("wordWrap");itemborder=item._border||item._getCSSStyleValue("border");itempadding=item._padding||item._getCSSStyleValue("padding");itemwordspace=this._wordspacing||item._wordspacing||item._getCSSStyleValue("wordSpacing");itemletterspace=this._letterspacing||item._letterspacing||item._getCSSStyleValue("letterSpacing");size=nexacro._getTextSize(item.text,itemfont,true,undefined,itemwordwrap,itemwordspace,itemletterspace);width=Math.ceil(size[0])+(itemborder?itemborder.left._width+itemborder.right._width:0);width+=(itempadding?itempadding.left+itempadding.right:0);height=this._adjust_height-(itemborder?itemborder.top._width+itemborder.bottom._width:0);item.move(left,0,width,height);items_width.push(width);items_total_width+=width;left+=width;}if(items_total_width){this._items_total_width=items_total_width;}}}};_pMenu._deleteMenu=function(){var list=this._hot_key_list;var len=list.length;var i,_form=this._getMainForm();for(i=0;i<len;i++ ){nexacro._unregisterHotkeyComp(_form,this,list[i].key);}this._hot_key_list=[];this._items_width=[];this._items_total_width=0;var items=this._items;if(items){len=items.length;for(i=0;i<len;i++ ){items[i].destroy();items[i]=null;}this._items=[];}};_pMenu._rearrangeMenuItems=function(need_calc,dir){var start_navigation_index=this._start_navigation_index;var items_width=this._items_width;var client_width=this._getClientWidth();var items=this._items;var left=this.navigationbuttonsize||this._prev_width||0;var navigationnext_width=this.navigationbuttonsize||this._next_width||0;var sum_itemwidth=left+navigationnext_width;var height=this.height?parseInt(this.height):this._adjust_height;var len=items_width.length;var end_navigation_index=this._end_navigation_index;var padding=this._getCSSStyleValue("padding",this._status);var border=this._getCSSStyleValue("border",this._status);if(padding){sum_itemwidth+=padding.left+padding.right;}if(border){if(border._single){sum_itemwidth+=border.top._width+border.top._width;}else{sum_itemwidth=border.left._width+border.right._width;}}var i,end;var item,item_width;if(need_calc){for(i=end_navigation_index-1;i>=0;i-- ){item_width=items_width[i];sum_itemwidth+=item_width;start_navigation_index=i;if(i==end_navigation_index-1||sum_itemwidth>client_width){break;}}for(i=0,end=start_navigation_index;i<end;i++ ){item=items[i];if(item){item.move(0,0,0,0);}}for(i=start_navigation_index;i<end_navigation_index;i++ ){item=items[i];item_width=items_width[i];if(item){item.move(left,0,item_width,height);}left+=item_width;}if(end_navigation_index>0&&end_navigation_index<len){for(i=end_navigation_index+1;i<len;i++ ){item=items[i];if(item){item.move(0,0,0,0);}}}}else{for(i=0,end=start_navigation_index;i<end;i++ ){item=items[i];if(item){item.move(0,0,0,0);}}for(i=start_navigation_index;i<len;i++ ){item=items[i];item_width=items_width[i];sum_itemwidth+=item_width;if(i==start_navigation_index||sum_itemwidth<client_width){if(item){item.move(left,0,item_width,height);}}else{if(dir<0&&i==end_navigation_index&&end_navigation_index==this._end_navigation_index){return true;}break;}end_navigation_index=i+1;left+=item_width;}if(end_navigation_index>0&&end_navigation_index<len){for(i=end_navigation_index;i<len;i++ ){items[i].move(0,0,0,0);}}}this._start_navigation_index=start_navigation_index;this._end_navigation_index=end_navigation_index;};_pMenu._getDlgCode=function(keycode){var E=nexacro.Event;var want_tab=this._want_tab;var want_arrow=!(nexacro._enableaccessibility&&(keycode==E.KEY_DOWN||keycode==E.KEY_UP));this._want_tab=want_tab;return {want_tab:want_tab,want_return:true,want_escape:false,want_chars:false,want_arrows:want_arrow};};_pMenu._showPopup=function(obj,x,y,bcapture){var popuptype=this.popuptype;if(popuptype=="none"){return;}if(this._innerdataset&&this.levelcolumn&&this.captioncolumn&&this.idcolumn&&obj._canExpand===true){var popupmenu=this._popupmenu;if(popupmenu==null){popupmenu=this._popupmenu=new nexacro.PopupMenu("menupopupmenu",0,0,0,0,null,null,null,null,null,null,this);popupmenu._setControl();this._setPopupContains(true);var color=this._color?this._color:this._getCurrentStyleInheritValue("color");if(color){popupmenu.set_color(color.value);}var font=this._font?this._font:this._getCurrentStyleInheritValue("font");if(font){popupmenu.set_font(font.value);}popupmenu.level=1;popupmenu.index=obj.index;popupmenu.datarow=obj.datarow+1;popupmenu.setInnerDataset(this._innerdataset);popupmenu.set_iconcolumn(this.iconcolumn);popupmenu.set_captioncolumn(this.captioncolumn);popupmenu.set_checkboxcolumn(this.checkboxcolumn);popupmenu.set_hotkeycolumn(this.hotkeycolumn);popupmenu.set_idcolumn(this.idcolumn);popupmenu.set_levelcolumn(this.levelcolumn);popupmenu.set_userdatacolumn(this.userdatacolumn);popupmenu.set_enablecolumn(this.enablecolumn);popupmenu.set_navigationbuttonsize(this.popupnavigationbuttonsize);popupmenu.set_cssclass(this.cssclass);popupmenu.createComponent();popupmenu._setEventHandler("oncloseup",this.on_notify_onclosepopup,this);}else{popupmenu.datarow=obj.datarow+1;popupmenu.set_cssclass(this.cssclass);}if(this._icontextpadding){popupmenu.set_icontextpadding(this._icontextpadding);}if(this.popupitemheight){popupmenu.set_itemheight(this.popupitemheight);}popupmenu.popuptype=this.popuptype;popupmenu._track_capture=bcapture;popupmenu._trackPopup(obj,"vertical",x,y);if(popupmenu._is_popup()){var _window=this._getWindow();if(_window){if(this._track_capture){_window._setCaptureLock(this,true,false);}else{_window._releaseCaptureLock();}}}}};_pMenu._showNavigationButton=function(navigation_visible){this._is_navigation_visible=navigation_visible;var prevbutton,nextbutton;if(navigation_visible){if(!this.nextbutton||!this.prevbutton){this._createNavigationButton();}nextbutton=this.nextbutton;prevbutton=this.prevbutton;var buttonsize=this.navigationbuttonsize;var prevbutton_width=0;var nextbutton_width=0;if(!buttonsize){var navigationbutton_width=this._getNavigationbuttonWidth(prevbutton,nextbutton);prevbutton_width=navigationbutton_width[0];nextbutton_width=navigationbutton_width[1];}else{prevbutton_width=buttonsize;nextbutton_width=buttonsize;}var client_width=this._getClientWidth();var client_height=this._getClientHeight();prevbutton.set_visible(true);prevbutton.move(0,0,prevbutton_width,client_height);nextbutton.set_visible(true);nextbutton.move(client_width-nextbutton_width,0,nextbutton_width,client_height);}else{nextbutton=this.nextbutton;if(nextbutton){nextbutton.set_visible(false);nextbutton.move(0,0,0,0);}prevbutton=this.prevbutton;if(prevbutton){prevbutton.set_visible(false);prevbutton.move(0,0,0,0);}}};_pMenu._getNavigationbuttonWidth=function(prevbutton,nextbutton){var next_width=0;var img_size,padding,border,prev_width=0;var previcon=prevbutton._getCSSStyleValue("icon","enabled");if(previcon){img_size=nexacro._getImageSize(previcon.url,nexacro._emptyFn,this);if(img_size){prev_width=img_size.width;padding=prevbutton._getCSSStyleValue("padding",this._status);border=prevbutton._getCSSStyleValue("border",this._status);if(padding){prev_width+=padding.left+padding.right;}if(border){if(border._single){prev_width+=border.top._width+border.top._width;}else{prev_width=border.left._width+border.right._width;}}this._prev_width=prev_width;}}var nexticon=nextbutton._getCSSStyleValue("icon","enabled");if(nexticon){img_size=nexacro._getImageSize(nexticon.url,nexacro._emptyFn,this);if(img_size){next_width=img_size.width;padding=nextbutton._getCSSStyleValue("padding",this._status);border=nextbutton._getCSSStyleValue("border",this._status);if(padding){next_width+=padding.left+padding.right;}if(border){if(border._single){next_width+=border.top._width+border.top._width;}else{next_width=border.top._width+border.bottom._width;}}this._next_width=next_width;}}return [prev_width,next_width];};_pMenu._setContents=function(str){var doc=nexacro._parseXMLDocument(str);var node=doc.getElementsByTagName("Dataset")[0];if(!node){return false;}var idstr=node.attributes[0].value;var normalDataset=new nexacro.NormalDataset(idstr,this);if(node.firstChild){var childnode=node.firstChild;var strXML="";while(childnode){if(node.nodeType==1){strXML+=nexacro._documentToXml(childnode);}childnode=childnode.nextSibling;}normalDataset._setContents(strXML);}this.set_innerdataset(normalDataset);return true;};_pMenu._getItemIndex=function(inc){if(inc===undefined){inc=0;}var menuitemindex=this._menuitemindex+inc;var menuitem_len=this._items?this._items.length-1:0;if(menuitemindex>menuitem_len){menuitemindex=0;}else if(menuitemindex<0){menuitemindex=menuitem_len;}var item=this._items[menuitemindex];if(!nexacro._enableaccessibility&&item&&item.enable==false&&inc<5&&inc> -5){return this._getItemIndex(inc+inc);}return menuitemindex;};_pMenu._do_defocus=function(target,bParent){var _window=this._getWindow();_window._removeFromCurrentFocusPath(target,true);target._changeStatus("focused",false);if(bParent){_window._removeFromCurrentFocusPath(this,false);}};_pMenu._setFocus=function(bResetScroll,dir){if(dir> -1||dir<4){this._focus_direction=dir;}else{this._focus_direction= -1;}var retn=this.setFocus(bResetScroll);var menuitem=this._items;var menuitem_len=menuitem.length-1;if(menuitem_len>0){if(dir>=2){this._focus_obj=this;this._menuitemindex= -1;}else{if(dir==0){this._menuitemindex=0;}else if(dir==1){this._menuitemindex=menuitem_len;}this._focus_obj=menuitem[this._menuitemindex];this._menuitemonmouseenter=this._focus_obj;this._item_focus(this._focus_obj,true);}}else{if(nexacro._enableaccessibility){this._focus_obj=this;}this._previtemindex=0;this._menuitemindex= -1;var last_focused=this._last_focused;if(last_focused){this._do_defocus(last_focused,true);}this._on_focus(true);}return retn;};_pMenu._loaded_expImage=function(imgurl,w,h){this._expImage_width=w;this._expImage_height=h;};_pMenu._loaded_chkImage=function(imgurl,w,h){this._chkImage_width=w;this._chkImage_height=h;};_pMenu._load_image=function(strImageUrl,flag){var control_elem=this._control_element;if(control_elem){var val=strImageUrl;if(val){val=nexacro._getURIValue(val);val=nexacro._getImageLocation(val,this._getRefFormBaseUrl());var size;if(flag){size=nexacro._getImageSize(val,this._loaded_expImage,this);if(size){this._expImage_width=size.width;this._expImage_height=size.height;}}else{size=nexacro._getImageSize(val,this._loaded_chkImage,this);if(size){this._chkImage_width=size.width;this._chkImage_height=size.height;}}}}};_pMenu._isNavigationVisible=function(){if(this._items_total_width>this._adjust_width){return true;}return false;};_pMenu._navigationnext=function(bKeyaction){var threshold=this._items.length;var end_index=this._end_navigation_index;var need_calc_start_index=false;if(end_index<threshold){if(this._start_navigation_index==0){this.prevbutton._changeStatus("disabled",false);}this._start_navigation_index++ ;}if(bKeyaction&&end_index>=threshold){this._start_navigation_index=0;this.nextbutton._changeStatus("disabled",false);this.prevbutton._changeStatus("disabled",true);}var b=this._rearrangeMenuItems(need_calc_start_index, -1);if(b){this._navigationnext();}if(this._end_navigation_index==threshold){this.nextbutton._changeStatus("disabled",true);}};_pMenu._navigationprev=function(bKeyaction){var start_index=this._start_navigation_index;var item_len=this._items.length;var need_calc_start_index=false;if(start_index>0){start_index-- ;if(start_index==0){this.prevbutton._changeStatus("disabled",true);}}else if(bKeyaction&&start_index<=0){this._end_navigation_index=item_len;this.nextbutton._changeStatus("disabled",true);this.prevbutton._changeStatus("disabled",false);need_calc_start_index=true;}this._start_navigation_index=start_index;var b=this._rearrangeMenuItems(need_calc_start_index,1);if(b){this._navigationprev(true);}if(item_len>this._end_navigation_index){this.nextbutton._changeStatus("disabled",false);}};_pMenu._createNavigationButton=function(){var navagationprevbutton=new nexacro.Button("prevbutton",0,0,0,0,null,null,null,null,null,null,this);navagationprevbutton._setControl("ButtonControl");navagationprevbutton.createComponent();navagationprevbutton.set_visible(true);navagationprevbutton._setEventHandler("onclick",this.on_notify_navigationprev_onclick,this);navagationprevbutton.on_created();navagationprevbutton._changeStatus("disabled",true);this.prevbutton=navagationprevbutton;var navagationnextbutton=new nexacro.Button("nextbutton",0,0,0,0,null,null,null,null,null,null,this);navagationnextbutton._setControl("ButtonControl");navagationnextbutton.createComponent();navagationnextbutton.set_visible(true);navagationnextbutton._setEventHandler("onclick",this.on_notify_navigationnext_onclick,this);navagationnextbutton.on_created();this.nextbutton=navagationnextbutton;};_pMenu._getPopupControl=function(){var rootcomp=this._getRootComponent(this);return rootcomp._popupmenu;};_pMenu._isPopupVisible=function(){var popupmenu=this._popupmenu;return popupmenu?popupmenu._is_popup():false;};_pMenu._callbackFromDataset=function(obj,e){var _reason=e.reason;if(_reason==91){this._deleteMenu();}else{this._createMenu();if(this._is_created){this._relayout();}}};_pMenu._callback_onvaluechanged=function(obj,e){if(this._is_created){this.on_fire_oninnerdatachanged(obj,e.oldvalue,e.newvalue,e.columnid,e.col,e.row);}};_pMenu._relayout=function(){if(this._isNavigationVisible()){this._showNavigationButton(true);this._rearrangeMenuItems();}else{this._showNavigationButton(false);}};_pMenu._closePopup=function(){var popup=this._popupmenu;if(popup){popup.cancelPopup();var _window=this._getWindow();if(_window&&this._track_capture){_window._releaseCaptureLock(this);}}var cur_index=this._menuitemindex;{var item=this._items[cur_index];if(item){item._on_apply_selected(false);}}this._popupitemindex= -1;this._menuitemindex= -1;};_pMenu.on_fire_onkillfocus=function(obj,fromObj){this._closePopup();var cur_index=this._menuitemindex;if(cur_index> -1){var item=this._items[cur_index];if(item){item._on_apply_selected(false);}}var lastfocuseditem=this._last_focused;if(lastfocuseditem&&lastfocuseditem!=obj){this._do_defocus(lastfocuseditem,true);}nexacro.Component.prototype.on_fire_onkillfocus.call(this,obj,fromObj);};_pMenu.on_notify_onclosepopup=function(obj){var _window=this._getWindow();if(_window&&this._track_capture){_window._releaseCaptureLock(this);}var items=this._items;if(items){var prev_sel_menu=this._previtemindex;var item=items[prev_sel_menu];if(item){item._on_apply_selected(false);}this._popupitemindex=this._menuitemindex= -1;}};_pMenu._set_hotkey=function(id,v){var hotkey=new nexacro._HotKey(v);if(hotkey._isEmpty()){delete hotkey;}else{if(this._is_created){this._registerItemHotkey(hotkey);}}var list={id:id,key:hotkey};this._hot_key_list.push(list);};_pMenu._item_focus=function(obj,bflag){var lastfocuedobj=this._last_focused;if(lastfocuedobj&&lastfocuedobj!=obj){this._do_defocus(lastfocuedobj,false);}var evt_name="";if(nexacro._enableaccessibility){evt_name="downkey";}if(lastfocuedobj!=obj){if(nexacro._enableaccessibility){if(obj instanceof nexacro._PopupMenuItemControl){obj._on_focus(false,evt_name);}else{obj._on_focus(true,evt_name);}}else{obj._on_focus(false,evt_name);}if(!(obj instanceof nexacro._PopupMenuItemControl)){this._last_focused=obj;}}};_pMenu._item_killfocus=function(obj){if(obj){if(nexacro._enableaccessibility){var _window=this._getWindow();if(_window){_window._removeFromCurrentFocusPath(obj,true);}}}};_pMenu._item_find=function(obj){if(obj._popupmenu==null||obj._popupmenu.visible==false){return obj._items;}return obj._popupmenu._items;};_pMenu._is_popupmenu_visible=function(obj){if(obj._popupmenu==null||obj._popupmenu.visible==false){return false;}return true;};_pMenu._popupmenu_find=function(obj){var pThis=obj;while(pThis){if(pThis._popupmenu===null||pThis._popupmenu.visible==false){break;}pThis=pThis._popupmenu;}return pThis;};_pMenu._popupmenuitem_extend=function(obj){return obj._canExpand;};delete _pMenu;}
if(!nexacro._PopupMenuItemControl){nexacro._PopupMenuItemControl=function(id,left,top,width,height,right,bottom,minwidth,maxwidth,minheight,maxheight,parent){nexacro._MenuItemControl.call(this,id,left,top,width,height,right,bottom,minwidth,maxwidth,minheight,maxheight,parent);};var _pPopupMenuItemControl=nexacro._createPrototype(nexacro._MenuItemControl,nexacro._PopupMenuItemControl);nexacro._PopupMenuItemControl.prototype=_pPopupMenuItemControl;_pPopupMenuItemControl._type_name="PopupMenuItemControl";_pPopupMenuItemControl._is_subcontrol=true;_pPopupMenuItemControl._is_focus_accept=true;_pPopupMenuItemControl.expimgelem=null;_pPopupMenuItemControl.chkwidth=0;_pPopupMenuItemControl.textwidth=0;_pPopupMenuItemControl.hotkeywidth=0;_pPopupMenuItemControl.expwidth=0;_pPopupMenuItemControl.expheight=0;_pPopupMenuItemControl.index=0;_pPopupMenuItemControl.datarow=0;_pPopupMenuItemControl.icon="";_pPopupMenuItemControl.userdata=null;_pPopupMenuItemControl.buttonalign="";_pPopupMenuItemControl.accessibilityrole="menuitem";_pPopupMenuItemControl._id="";_pPopupMenuItemControl._check=false;_pPopupMenuItemControl._icon=null;_pPopupMenuItemControl._hotkeytext="";_pPopupMenuItemControl._canExpand=true;_pPopupMenuItemControl._hotkey_string="";_pPopupMenuItemControl.on_create_contents=function(){var control_elem=this.getElement();if(control_elem){var textcontrol=new nexacro.Static("popupmenuitemtext",0,0,0,0,null,null,null,null,null,null,this);textcontrol._setControl();textcontrol._setEventInfoControl(false);textcontrol._setEventHandler("onclick",this.on_notify_itemclick,this);textcontrol.createComponent();var hotkeytextcontrol=new nexacro.Static("popupmenuitemhotkeytext",0,0,0,0,null,null,null,null,null,null,this);hotkeytextcontrol._setControl();hotkeytextcontrol._setEventInfoControl(false);hotkeytextcontrol._setEventHandler("onclick",this.on_notify_itemclick,this);hotkeytextcontrol.set_text(this._hotkeytext?this._hotkeytext:"");hotkeytextcontrol.createComponent();this._textcontrol=textcontrol;this._hotkeytextcontrol=hotkeytextcontrol;}};_pPopupMenuItemControl.on_created_contents=function(win){this.on_apply_text();this._on_apply_hotkeytext();if(this._textcontrol){this._textcontrol.on_created(win);}if(this._hotkeytextcontrol){this._hotkeytextcontrol.on_created(win);}if(this._iconcontrol){this._iconcontrol.on_created(win);}if(this._expiconcontrol){this._expiconcontrol.on_created(win);}};_pPopupMenuItemControl.on_create_contents_command=function(){var str="";if(this._textcontrol){str+=this._textcontrol.createCommand();}if(this._hotkeytextcontrol){str+=this._hotkeytextcontrol.createCommand();}if(this._iconcontrol){str+=this._iconcontrol.createCommand();}if(this._expiconcontrol){str+=this._expiconcontrol.createCommand();}return str;};_pPopupMenuItemControl.on_attach_contents_handle=function(win){if(this._textcontrol){this._textcontrol.attachHandle(win);}if(this._hotkeytextcontrol){this._hotkeytextcontrol.attachHandle(win);}if(this._iconcontrol){this._iconcontrol.attachHandle(win);}if(this._expiconcontrol){this._expiconcontrol.attachHandle(win);}};_pPopupMenuItemControl.on_destroy_contents=function(){if(this._textcontrol){this._textcontrol.destroy();this._textcontrol=null;}if(this._hotkeytextcontrol){this._hotkeytextcontrol.destroy();this._hotkeytextcontrol=null;}if(this._iconcontrol){this._iconcontrol.destroy();this._iconcontrol=null;}if(this._expiconcontrol){this._expiconcontrol.destroy();this._expiconcontrol=null;}};_pPopupMenuItemControl.on_change_containerRect=function(){this._updateControlPosition();};_pPopupMenuItemControl.on_get_accessibility_label=function(){var text=this.text;var hotkey_text=this._hotkeytext;return text+" "+hotkey_text;};_pPopupMenuItemControl.on_getIDCSSSelector=function(){return "popupmenuitem";};_pPopupMenuItemControl.on_apply_prop_enable=function(enable){nexacro.Component.prototype.on_apply_prop_enable.call(this,enable);if(this._textcontrol){this._textcontrol._setEnable(enable);}if(this._hotkeytextcontrol){this._hotkeytextcontrol._setEnable(enable);}if(this._iconcontrol){this._iconcontrol._setEnable(enable);}if(this._expiconcontrol){this._expiconcontrol._setEnable(enable);}};_pPopupMenuItemControl.on_apply_text=function(text){if(this._textcontrol){this._textcontrol.set_text(text);}};_pPopupMenuItemControl.on_apply_accessibility=function(){nexacro.Component.prototype.on_apply_accessibility.call(this);this._updateAccessibilityLabel(this);};_pPopupMenuItemControl._on_apply_hotkeytext=function(){if(this._hotkeytextcontrol){this._hotkeytextcontrol.set_text(this._hotkeytext);}};_pPopupMenuItemControl.on_notify_itemclick=function(obj,e){var popupmenu=this.parent;if(popupmenu){popupmenu.on_notify_menuitem_onclick(this,e);}};_pPopupMenuItemControl._on_apply_mouseover=function(isovered){if(this.selected){return;}if(isovered){this._changeStatus("mouseover",true);}else{this._changeStatus("mouseover",false);}};_pPopupMenuItemControl._load_image=function(val){var control_elem=this._control_element;if(control_elem){if(val){var expiconcontrol=this._expiconcontrol;if(!expiconcontrol){expiconcontrol=new nexacro._IconText("popupmenuitemexpandimage",0,0,0,0,null,null,null,null,null,null,this);expiconcontrol._setEventHandler("onclick",this.on_notify_itemclick,this);expiconcontrol._setControl();expiconcontrol.createComponent();this._expiconcontrol=expiconcontrol;}else{expiconcontrol.set_text("");}expiconcontrol.set_icon(val);}}};_pPopupMenuItemControl._updateControlPosition=function(){if(!this._is_created_contents){return;}var positionobj=this._getItemControlPosition();if(!positionobj){return;}var client_height=this._getClientHeight();var icon_x=positionobj.icon_x;var icon_width=positionobj.iconimgwidth;var icon_height=positionobj.iconheight;var text_x=positionobj.text_x;var textwidth=positionobj.textwidth;var textheight=positionobj.textheight;var hotkey_x=positionobj.hotkey_x;var hotkeywidth=positionobj.hotkeywidth;var hotkeyheight=positionobj.hotkeyheight;var gap=positionobj.gap;var expimg_x=hotkeywidth?hotkey_x+hotkeywidth+gap:hotkey_x;var expwidth=positionobj.expimgwidth?positionobj.expimgwidth:10;var expheight=positionobj.expimgheight?positionobj.expimgheight:this.height;var exptop=expheight?((client_height-expheight)/2):0;var iconcontrol=this._iconcontrol;if(iconcontrol){iconcontrol.move(icon_x,0,icon_width,icon_height);}var expiconcontrol=this._expiconcontrol;var hotkeytextcontrol=this._hotkeytextcontrol;if(this._canExpand&&expiconcontrol){expiconcontrol.move(expimg_x,exptop,expwidth,expheight);if(hotkeytextcontrol){hotkeytextcontrol.set_visible(false);}}else if(hotkeytextcontrol){if(hotkeytextcontrol.text==""){hotkeytextcontrol.set_visible(false);}else{hotkeytextcontrol.set_visible(true);hotkeytextcontrol.move(hotkey_x,0,hotkeywidth,hotkeyheight);}}var textcontrol=this._textcontrol;if(textcontrol){textcontrol.move(text_x,0,textwidth,textheight);}};_pPopupMenuItemControl._updateAccessibilityLabel=function(item){var rootComp=this._getRootComponent(this);var dataLen=rootComp._innerdataset.getRowCount();if(item){item._setAccessibilityInfoIndex(item.datarow+1);item._setAccessibilityInfoCount(dataLen);item._setAccessibilityFlagHasPopup(item._canExpand?true:false);}};_pPopupMenuItemControl._getWindowPosition=function(){return nexacro.Component.prototype._getWindowPosition.call(this);};_pPopupMenuItemControl._isChecked=function(){var v=this._check;if(!!v||v.toString().toLowerCase()=="true"){return true;}return false;};_pPopupMenuItemControl._getItemControlPosition=function(){return this.parent._itempos;};_pPopupMenuItemControl._getWidth=function(){var chkwidth=this.chkwidth;var textwidth=this.textwidth;var hotkeywidth=this.hotkeywidth;var expwidth=this.expwidth;var gap=this.gap;if(textwidth>0){chkwidth+=(textwidth+gap);}if(hotkeywidth>0&&expwidth>0){chkwidth+=Math.max(hotkeywidth,expwidth)+gap;}else{if(hotkeywidth>0){chkwidth+=(hotkeywidth+gap);}chkwidth+=expwidth;}return chkwidth;};_pPopupMenuItemControl._setId=function(v){this._id=v;};_pPopupMenuItemControl._setCheck=function(v){this._check=v;if(this._check){var iconcontrol=this._iconcontrol;if(!iconcontrol){iconcontrol=new nexacro._Icon("popupmenuitemcheckbox",0,0,0,0,null,null,null,null,null,null,this);iconcontrol._setEventHandler("onclick",this.on_notify_itemclick,this);iconcontrol._setControl();iconcontrol.createComponent();this._iconcontrol=iconcontrol;if(this._is_created_contents){iconcontrol.on_created();}}}};_pPopupMenuItemControl._setIcon=function(v){this._icon=v;var iconcontrol=this._iconcontrol;if(!iconcontrol){iconcontrol=new nexacro._Icon("popupmenuitemicon",0,0,0,0,null,null,null,null,null,null,this);iconcontrol._setEventHandler("onclick",this.on_notify_itemclick,this);iconcontrol._setControl();iconcontrol.createComponent();this._iconcontrol=iconcontrol;}var icon=this._icon;if(icon){iconcontrol.set_icon(icon);}};_pPopupMenuItemControl._setHotkeyText=function(v){if(this._hotkeytext!=v){this._hotkeytext=v;this._on_apply_hotkeytext();}};_pPopupMenuItemControl._setExpandimage=function(){if(this._canExpand){var expiconcontrol=this._expiconcontrol;if(!expiconcontrol){expiconcontrol=new nexacro._IconText("popupmenuitemexpandimage",0,0,0,0,null,null,null,null,null,null,this);expiconcontrol._setEventHandler("onclick",this.on_notify_itemclick,this);expiconcontrol._setControl();expiconcontrol.createComponent();this._expiconcontrol=expiconcontrol;}var icon=expiconcontrol._getCSSStyleValue("icon");if(!icon){expiconcontrol.set_text(">");}}};_pPopupMenuItemControl._setUserdata=function(v){if(this.userdata!=v){this.userdata=v;}};delete _pPopupMenuItemControl;}if(!nexacro.PopupMenu){nexacro.MenuCloseUpEventInfo=function(obj,id,isselect){this.id=this.eventid=id||"oncloseup";this.fromobject=obj;this.fromreferenceobject=obj;this.isselect=isselect;};var _pMenuCloseUpEventInfo=nexacro._createPrototype(nexacro.Event,nexacro.MenuCloseUpEventInfo);nexacro.MenuCloseUpEventInfo.prototype=_pMenuCloseUpEventInfo;_pMenuCloseUpEventInfo._type_name="MenuCloseUpEventInfo";delete _pMenuCloseUpEventInfo;nexacro.MenuClickEventInfo=function(obj,id,itemid,itemuserdata,index,level){this.eventid=id||"onmenuclick";this.id=itemid;this.fromobject=this.fromreferenceobject=obj;this.index=index;this.level=level;this.userdata=itemuserdata;};var _pMenuClickEventInfo=nexacro._createPrototype(nexacro.Event,nexacro.MenuClickEventInfo);nexacro.MenuClickEventInfo.prototype=_pMenuClickEventInfo;_pMenuClickEventInfo._type_name="MenuClickEventInfo";delete _pMenuClickEventInfo;nexacro.PopupMenu=function(id,left,top,width,height,right,bottom,minwidth,maxwidth,minheight,maxheight,parent){nexacro.PopupControl.call(this,id,left,top,width,height,right,bottom,minwidth,maxwidth,minheight,maxheight,parent);this._attached_comp=this;this._items=[];this._lineItems=[];this._hot_key_list=[];this._itempos={};this._last_mouseleave_iteminfo={bindindex: -1,index: -1,level: -1};};var _pPopupMenu=nexacro._createPrototype(nexacro.PopupControl,nexacro.PopupMenu);nexacro.PopupMenu.prototype=_pPopupMenu;_pPopupMenu._type_name="PopupMenu";_pPopupMenu._popupmenu=null;_pPopupMenu._innerdataset="";_pPopupMenu.autohotkey=false;_pPopupMenu.innerdataset="";_pPopupMenu.captioncolumn="";_pPopupMenu.checkboxcolumn="";_pPopupMenu.enablecolumn="";_pPopupMenu.hotkeycolumn="";_pPopupMenu.iconcolumn="";_pPopupMenu.idcolumn="";_pPopupMenu.levelcolumn="";_pPopupMenu.userdatacolumn="";_pPopupMenu.itemheight=undefined;_pPopupMenu.navigationbuttonsize=undefined;_pPopupMenu.accessibilityrole="menu";_pPopupMenu._closeflag=true;_pPopupMenu._is_updatedimages=false;_pPopupMenu._is_navigation_visible=false;_pPopupMenu.level=0;_pPopupMenu.datarow=0;_pPopupMenu.beforeindex= -1;_pPopupMenu._start_navigation_index=0;_pPopupMenu._end_navigation_index=0;_pPopupMenu._previtemindex=0;_pPopupMenu._popupitemindex= -1;_pPopupMenu._popupitempreviousindex= -1;_pPopupMenu._selected_itemindex= -1;_pPopupMenu._itemheight=0;_pPopupMenu._items_total_height=0;_pPopupMenu._iconImage_width=0;_pPopupMenu._iconImage_height=0;_pPopupMenu._icontextpadding=5;_pPopupMenu._want_arrow=true;_pPopupMenu._want_tab=true;_pPopupMenu._is_subcontrol=false;_pPopupMenu._is_trackpopup=false;_pPopupMenu._event_list={"onclick":1,"ondblclick":1,"onkeypress":1,"onkeydown":1,"onkeyup":1,"onkillfocus":1,"onsetfocus":1,"ondrag":1,"ondragenter":1,"ondragleave":1,"ondragmove":1,"ondrop":1,"onlbuttondown":1,"onlbuttonup":1,"onmouseenter":1,"onmouseleave":1,"onmousemove":1,"onmove":1,"onsize":1,"onrbuttondown":1,"onrbuttonup":1,"onmenuclick":1,"onpopup":1,"onmousedown":1,"onmouseup":1,"ontouchstart":1,"ontouchmove":1,"ontouchend":1,"oncontextmenu":1,"oncloseup":1,"oninnerdatachanged":1};_pPopupMenu.on_create_contents=function(){return;};_pPopupMenu.on_created_contents=function(win){nexacro.PopupControl.prototype.on_created_contents.call(this,win);var control_elem=this.getElement();if(control_elem){if(!this._innerdataset&&this.innerdataset){this._innerdataset=this._findDataset(this.innerdataset);this.on_apply_innerdataset();}this._createPopupMenu();var items=this._lineItems;if(items){var len=items.length;for(var i=0;i<len;i++ ){items[i].on_created();}}if(nexacro._enableaccessibility){this._setAccessibilityInfoLevel(this.level);}}};_pPopupMenu.on_create_contents_command=function(){return "";};_pPopupMenu.on_attach_contents_handle=function(win){nexacro.PopupControl.prototype.on_created.call(this,win);};_pPopupMenu.on_destroy_contents=function(){this._deletePopupMenu();if(this._popupmenu){this._popupmenu.destroyComponent();this._popupmenu=null;}this._removeEventHandlerToInnerDataset();};_pPopupMenu.on_change_containerRect=function(){this._reCalcSize();};_pPopupMenu.on_apply_prop_enable=function(enable){nexacro.Component.prototype.on_apply_prop_enable.call(this,enable);if(!enable){enable=this.enable;}var items=this._items;for(var i=0,len=items.lengh;i<len;i++ ){items[i]._setEnable(enable);}};_pPopupMenu.on_apply_prop_cssclass=function(){var popupemenu=this._popupmenu;if(popupemenu){popupemenu.on_apply_cssclass(this.cssclass);}};_pPopupMenu._getCSSMapParent=function(){var pThis=this.parent;while(pThis._is_subcontrol){pThis=pThis.parent;}return pThis;};_pPopupMenu._getDlgCode=function(){var want_arrow=this._want_arrow;var want_tab=this._want_tab;this._want_tab=true;return {want_tab:want_tab,want_return:true,want_escape:false,want_chars:false,want_arrows:want_arrow};};_pPopupMenu.on_get_accessibility_label=function(){return this.id;};_pPopupMenu._isPopupContains=function(){var rootcomp=this._getRootComponent(this);return rootcomp._is_popupcontains?true:false;};_pPopupMenu.set_autohotkey=function(v){var val=nexacro._toBoolean(v);if(val!=this.autohotkey){this.autohotkey=val;this.on_apply_autohotkey(val);}};_pPopupMenu.on_apply_autohotkey=function(autohotkey){if(autohotkey){}else{var hotkey_list=this._hot_key_list;if(hotkey_list){for(var i=hotkey_list.length-1;i> -1;i-- ){this._unregisterItemHotkey(hotkey_list[i].key);}}}};_pPopupMenu.set_visible=function(v){if(this._is_trackpopup){nexacro.PopupControl.prototype.set_visible.apply(this,arguments);}};_pPopupMenu.set_itemheight=function(v){if(v!==undefined){if(isNaN(v= +v)||v<0){return;}}if(v!=this.itemheight){this.itemheight=v;}};_pPopupMenu.set_navigationbuttonsize=function(v){if(v!==undefined){if(isNaN(v= +v)){return;}}if(v!=this.navigationbuttonsize){this.navigationbuttonsize=v;}};_pPopupMenu.set_popuptype=function(v){var popuptype_enum=["center","none","normal","system"];if(popuptype_enum.indexOf(v)== -1){return;}var popuptype=this.popuptype;if(v!=popuptype){this.popuptype=v;}};_pPopupMenu.set_captioncolumn=function(v){if(v!=this.captioncolumn){this.captioncolumn=v;this.on_apply_captioncolumn();}};_pPopupMenu.on_apply_captioncolumn=function(){var popupmenu=this._popupmenu;if(popupmenu){popupmenu.set_captioncolumn(this.captioncolumn);}var ds=this._innerdataset;if(ds){this._createPopupMenu();var items=this._items;if(items){var len=items.length;for(var i=0;i<len;i++ ){items[i].set_text(ds.getColumn(items[i].datarow,this.captioncolumn)||"");}}}};_pPopupMenu.set_checkboxcolumn=function(v){if(v!=this.checkboxcolumn){this.checkboxcolumn=v;this.on_apply_checkboxcolumn();}};_pPopupMenu.on_apply_checkboxcolumn=function(){var popupmenu=this._popupmenu;if(popupmenu){popupmenu.set_checkboxcolumn(this.checkboxcolumn);}var ds=this._innerdataset;if(ds){this._createPopupMenu();var items=this._items;if(items){var len=items.length;for(var i=0;i<len;i++ ){items[i]._setCheck(nexacro._toBoolean(ds.getColumn(items[i].datarow,this.checkboxcolumn)));}}}};_pPopupMenu.set_enablecolumn=function(v){if(v!=this.enablecolumn){this.enablecolumn=v;this.on_apply_enablecolumn();}};_pPopupMenu.on_apply_enablecolumn=function(){var popupmenu=this._popupmenu;if(popupmenu){popupmenu.set_enablecolumn(this.enablecolumn);}var ds=this._innerdataset;if(ds){this._createPopupMenu();var items=this._items;if(items){var len=items.length;for(var i=0;i<len;i++ ){items[i].set_enable(ds.getColumn(items[i].datarow,this.enablecolumn)||true);}}}};_pPopupMenu.set_hotkeycolumn=function(v){if(v!=this.hotkeycolumn){this.hotkeycolumn=v;this.on_apply_hotkeycolumn();}};_pPopupMenu.on_apply_hotkeycolumn=function(){var popupmenu=this._popupmenu;if(popupmenu){popupmenu.set_hotkeycolumn(this.hotkeycolumn);}var ds=this._innerdataset;if(ds){this._createPopupMenu();var items=this._items;if(items){var len=items.length;for(var i=0;i<len;i++ ){items[i]._setHotkeyText(ds.getColumn(items[i].datarow,this.hotkeycolumn)||"");}}}};_pPopupMenu.set_iconcolumn=function(v){if(v!=this.iconcolumn){this.iconcolumn=v;this.on_apply_iconcolumn();}};_pPopupMenu.on_apply_iconcolumn=function(){var popupmenu=this._popupmenu;if(popupmenu){popupmenu.set_iconcolumn(this.iconcolumn);}var ds=this._innerdataset;if(ds){this._createPopupMenu();var items=this._items;if(items){var len=items.length;for(var i=0;i<len;i++ ){items[i]._setIcon(ds.getColumn(items[i].datarow,this.iconcolumn)||"");}}}};_pPopupMenu.set_idcolumn=function(v){if(v!=this.idcolumn){this.idcolumn=v;this.on_apply_idcolumn();}};_pPopupMenu.on_apply_idcolumn=function(){var popupmenu=this._popupmenu;if(popupmenu){popupmenu.set_idcolumn(this.idcolumn);}var ds=this._innerdataset;if(ds){this._createPopupMenu();var items=this._items;if(items){var len=items.length;for(var i=0;i<len;i++ ){items[i]._setId(ds.getColumn(items[i].datarow,this.idcolumn)||"");}}}};_pPopupMenu.set_levelcolumn=function(v){if(v!=this.levelcolumn){this.levelcolumn=v;this.on_apply_levelcolumn();}};_pPopupMenu.on_apply_levelcolumn=function(){var popupmenu=this._popupmenu;if(popupmenu){popupmenu.set_levelcolumn(this.levelcolumn);}var ds=this._innerdataset;if(ds){this._createPopupMenu();var items=this._items;if(items){var len=items.length;for(var i=0;i<len;i++ ){items[i].level=ds.getColumn(items[i].datarow,this.levelcolumn)|| -1;}}}};_pPopupMenu.set_userdatacolumn=function(v){if(v!=this.userdatacolumn){this.userdatacolumn=v;this.on_apply_userdatacolumn();}};_pPopupMenu.on_apply_userdatacolumn=function(){var popupmenu=this._popupmenu;if(popupmenu){popupmenu.set_userdatacolumn(this.userdatacolumn);}var ds=this._innerdataset;if(ds){this._createPopupMenu();var items=this._items;if(items){var len=items.length;for(var i=0;i<len;i++ ){items[i]._setUserdata(ds.getColumn(items[i].datarow,this.userdatacolumn)||null);}}}};_pPopupMenu.set_innerdataset=function(str){if(typeof str!="string"){this.setInnerDataset(str);return;}if(str!=this.innerdataset){this._removeEventHandlerToInnerDataset();if(!str){this._innerdataset=null;this.innerdataset="";}else{str=str.replace("@","");this._innerdataset=this._findDataset(str);this.innerdataset=str;}this.on_apply_innerdataset();}else if(this.innerdataset&&!this._innerdataset){this._setInnerDatasetStr(this.innerdataset);this.on_apply_innerdataset();}};_pPopupMenu.on_apply_innerdataset=function(){var ds=this._innerdataset;if(ds){ds._setEventHandler("onrowposchanged",this._callbackFromDataset,this);ds._setEventHandler("oncolumnchanged",this._callbackFromDataset,this);ds._setEventHandler("onrowsetchanged",this._callbackFromDataset,this);ds._setEventHandler("onvaluechanged",this._callback_onvaluechanged,this);}if(this._popupmenu){this._popupmenu.set_innerdataset(this.innerdataset);}this._createPopupMenu();this.beforeindex= -1;};_pPopupMenu.set_icontextpadding=function(v){this._icontextpadding= +v;};_pPopupMenu._on_hotkey=function(keycode,altKey,ctrlKey,shiftKey){var list=this._hot_key_list;var len=list.length;for(var i=0,key,modifykey;i<len;i++ ){key=list[i].key;if(key._keycode==keycode){modifykey=key._modifierkey;if(altKey==((modifykey&0x02)==0x02)&&ctrlKey==((modifykey&0x01)==0x01)&&shiftKey==((modifykey&0x04)==0x04)){this.on_fire_onitemclick(this,list[i].id,"");break;}}}};_pPopupMenu._on_focus=function(self_flag,evt_name,lose_focus,refer_lose_focus,new_focus,refer_new_focus){var retn=nexacro.Component.prototype._on_focus.call(this,self_flag,evt_name,lose_focus,refer_lose_focus,new_focus,refer_new_focus);if(self_flag==false){if(nexacro._enableaccessibility){if(!this._isAccessibilityEnable()){this._select_menuitem(0, -1);}}}return retn;};_pPopupMenu._do_defocus=function(target,bParent){var _window=this._getWindow();_window._removeFromCurrentFocusPath(target,true);if(bParent){_window._removeFromCurrentFocusPath(this,false);}};_pPopupMenu._item_focus=function(obj,bflag,evt_name){if(nexacro._enableaccessibility){evt_name=evt_name?evt_name:"downkey";}if(obj){if(nexacro._enableaccessibility){if(obj instanceof nexacro._PopupMenuItemControl){obj._on_focus(false,evt_name);}else{obj._on_focus(true,evt_name);}}}};_pPopupMenu._item_killfocus=function(obj){if(obj){if(nexacro._enableaccessibility){var _window=this._getWindow();if(_window){_window._removeFromCurrentFocusPath(obj,true);}}if(obj._on_apply_mouseover){obj._on_apply_mouseover(false);}}};_pPopupMenu._fire_on_Popupmenu=function(keycode,alt_key,ctrl_key,shift_key,fire_comp,refer_comp){var popupmenu=this._popupmenu;if(popupmenu){popupmenu.on_fire_sys_onkeydown(keycode,alt_key,ctrl_key,shift_key,fire_comp,refer_comp);}};_pPopupMenu._callbackFromDataset=function(){this._createPopupMenu();this._closeAllPopup();};_pPopupMenu._callback_onvaluechanged=function(obj,e){if(this._is_created){this.on_fire_oninnerdatachanged(obj,e.oldvalue,e.newvalue,e.columnid,e.col,e.row);}};_pPopupMenu.on_notify_menuitem_onclick=function(obj,e){var popuptype=this._getPopupType();var previtemindex=this._previtemindex;this._previtemindex=obj.index;if(obj.enable==false||!popuptype||popuptype=="none"){return;}var rootComp=this._getRootComponent(obj);if(previtemindex> -1){var previtem=this._items[previtemindex];if(previtem){previtem._changeUserStatus("selected",false);}}if(obj._canExpand){this._showPopup(obj);obj._changeUserStatus("selected",true);if(rootComp instanceof nexacro.Menu){rootComp._popupitemindex=obj.index;}}else if(obj._canExpand===false){if(this.parent&&this.parent.enable==true){if(this.parent instanceof nexacro.Menu){if(this.parent.onmenuclick&&this.parent.onmenuclick._has_handlers){this.parent.on_notify_menuitem_onclick(obj,e);}this._closeAllPopup();}else if(!(this.parent instanceof nexacro.PopupMenu)){this._closeAllPopup();if(this.onmenuclick&&this.onmenuclick._has_handlers){this.on_fire_onitemclick(rootComp,obj._id,obj.userdata);}}else{this.parent.on_notify_menuitem_onclick(obj,e);this._closeAllPopup();}}}};_pPopupMenu.on_notify_onmouseenter=function(obj){var rootComp=this._getRootComponent(obj);var previousitem=rootComp._menuitemonmouseenter;if(previousitem){var previousparent=previousitem.parent;if(previousparent&&previousparent.level<this.level){previousitem._changeUserStatus("selected",true);}}};_pPopupMenu.on_notify_menuitem_onmouseenter=function(obj){var rootComp=this._getRootComponent(obj);rootComp._popupitemindex=obj.index;rootComp._menuitemonmouseenter=obj;var popupmenu=this._popupmenu;if(popupmenu&&popupmenu._is_popup()){if(this.beforeindex!=obj.index){popupmenu.cancelPopup();this._showPopup(obj);}}else{var popuptype=this._getPopupType();if(popuptype&&popuptype!="none"){this._showPopup(obj);}}var previousitem=rootComp._menuitemonmouseenter;if(previousitem){previousitem._changeUserStatus("selected",false);var curparent=obj.parent;var preparent=previousitem.parent;if(this.beforeindex> -1){var before_item=this._items[this.beforeindex];if(before_item){before_item._changeUserStatus("selected",false);}}if(curparent&&curparent!=preparent){if(preparent&&curparent.level>preparent.level){previousitem._changeUserStatus("selected",true);}}}this.beforeindex=this._popupitemindex=obj.index;if(!nexacro._enableaccessibility){var item=this._items;item[obj.index]._on_apply_mouseover(true);if(this._popupitempreviousindex== -1||this._popupitemindex== -1){this._popupitempreviousindex=0;this._popupitemindex=0;}if(item.length<=this._popupitemindex){this._popupitemindex=item.length-1;this._popupitempreviousindex=this._popupitemindex;}if(item[this._previtemindex]){item[this._previtemindex]._on_apply_mouseover(false);}if(popupmenu&&popupmenu._is_popup()==true){this._popupitemindex= -1;}else{this._popupitemindex=obj.index;}this._previtemindex=obj.index;}};_pPopupMenu.on_notify_menuitem_onmouseleave=function(obj){var rootComp=this._getRootComponent(this);rootComp._last_mouseleave_iteminfo={index:obj.index,bindindex:obj._bindindex,level:obj.parent.level};};_pPopupMenu.on_notify_menuitem_onlbuttondown=function(obj){this._menuitemonmouseenter=obj;var popupmenu=this._popupmenu;if(popupmenu){if(popupmenu._is_popup()){if(this.beforeindex!=obj.index){this.beforeindex=obj.index;}popupmenu.cancelPopup();}}if(obj._canExpand){this._showPopup(obj);var rootComp=this._getRootComponent(obj);if(rootComp instanceof nexacro.Menu){rootComp._popupitemindex=obj.index;}}};_pPopupMenu.on_notify_navigationprev_onclick=function(){var popupmenu=this._popupmenu;if(popupmenu){popupmenu._closePopup();}this._navigationPrev();};_pPopupMenu.on_notify_navigationnext_onclick=function(){var popupmenu=this._popupmenu;if(popupmenu){popupmenu._closePopup();}this._navigationNext();};_pPopupMenu.on_fire_user_onlbuttondown=function(button,alt_key,ctrl_key,shift_key,screenX,screenY,canvasX,canvasY,clientX,clientY,from_comp,from_refer_comp){if(this.onlbuttondown&&this.onlbuttondown._has_handlers){var evtinfo_control=this._getEventInfoComponent(from_refer_comp);var evt=new nexacro.MenuMouseEventInfo(this,"onlbuttondown",evtinfo_control.id,button,alt_key,ctrl_key,shift_key,screenX,screenY,canvasX,canvasY,clientX,clientY,from_comp,evtinfo_control,evtinfo_control.parent.level,evtinfo_control.index,evtinfo_control._bindindex);return this.onlbuttondown._fireUserEvent(this,evt);}return false;};_pPopupMenu.on_fire_user_onlbuttonup=function(button,alt_key,ctrl_key,shift_key,screenX,screenY,canvasX,canvasY,clientX,clientY,from_comp,from_refer_comp){if(this.onlbuttonup&&this.onlbuttonup._has_handlers){var evtinfo_control=this._getEventInfoComponent(from_refer_comp);var evt=new nexacro.MenuMouseEventInfo(button,"onlbuttonup",evtinfo_control.id,button,alt_key,ctrl_key,shift_key,screenX,screenY,canvasX,canvasY,clientX,clientY,from_comp,evtinfo_control,evtinfo_control.parent.level,evtinfo_control.index,evtinfo_control._bindindex);return this.onlbuttonup._fireUserEvent(this,evt);}return false;};_pPopupMenu.on_fire_user_onmousedown=function(button,alt_key,ctrl_key,shift_key,screenX,screenY,canvasX,canvasY,clientX,clientY,from_comp,from_refer_comp){if(this.onmousedown&&this.onmousedown._has_handlers){var evtinfo_control=this._getEventInfoComponent(from_refer_comp);var evt=new nexacro.MenuMouseEventInfo(this,"onmousedown",evtinfo_control.id,button,alt_key,ctrl_key,shift_key,screenX,screenY,canvasX,canvasY,clientX,clientY,from_comp,evtinfo_control,evtinfo_control.parent.level,evtinfo_control.index,evtinfo_control._bindindex);return this.onmousedown._fireUserEvent(this,evt);}return false;};_pPopupMenu.on_fire_user_onmouseup=function(button,alt_key,ctrl_key,shift_key,screenX,screenY,canvasX,canvasY,clientX,clientY,from_comp,from_refer_comp){if(this.onmouseup&&this.onmouseup._has_handlers){var evtinfo_control=this._getEventInfoComponent(from_refer_comp);var evt=new nexacro.MenuMouseEventInfo(this,"onmouseup",from_refer_comp.id,button,alt_key,ctrl_key,shift_key,screenX,screenY,canvasX,canvasY,clientX,clientY,from_comp,evtinfo_control,evtinfo_control.parent.level,evtinfo_control.index,evtinfo_control._bindindex);return this.onmouseup._fireUserEvent(this,evt);}return false;};_pPopupMenu.on_fire_user_onmouseenter=function(button,alt_key,ctrl_key,shift_key,screenX,screenY,canvasX,canvasY,clientX,clientY,from_comp,from_refer_comp){if(this.onmouseenter&&this.onmouseenter._has_handlers){var evtinfo_control=this._getEventInfoComponent(from_refer_comp);var evt=new nexacro.MenuMouseEventInfo(this,"onmouseenter",evtinfo_control.id,button,alt_key,ctrl_key,shift_key,screenX,screenY,canvasX,canvasY,clientX,clientY,from_comp,evtinfo_control,evtinfo_control.parent.level,evtinfo_control.index,evtinfo_control._bindindex);return this.onmouseenter._fireUserEvent(this,evt);}};_pPopupMenu.on_fire_user_onmouseleave=function(button,alt_key,ctrl_key,shift_key,screenX,screenY,canvasX,canvasY,clientX,clientY,from_comp,from_refer_comp){if(this.onmouseleave&&this.onmouseleave._has_handlers){var evtinfo_control=this._getEventInfoComponent(from_refer_comp);var iteminfo=this._last_mouseleave_iteminfo;var evt=new nexacro.MenuMouseEventInfo(this,"onmouseleave",evtinfo_control.id,button,alt_key,ctrl_key,shift_key,screenX,screenY,canvasX,canvasY,clientX,clientY,from_comp,evtinfo_control,iteminfo.level,iteminfo.index,iteminfo.bindindex);return this.onmouseleave._fireUserEvent(this,evt);}return false;};_pPopupMenu.on_fire_user_onmousemove=function(button,alt_key,ctrl_key,shift_key,screenX,screenY,canvasX,canvasY,clientX,clientY,from_comp,from_refer_comp){if(this.onmousemove&&this.onmousemove._has_handlers){var evtinfo_control=this._getEventInfoComponent(from_refer_comp);var evt=new nexacro.MenuMouseEventInfo(this,"onmousemove",evtinfo_control.id,button,alt_key,ctrl_key,shift_key,screenX,screenY,canvasX,canvasY,clientX,clientY,from_comp,evtinfo_control,evtinfo_control.parent.level,evtinfo_control.index,evtinfo_control._bindindex);return this.onmousemove._fireUserEvent(this,evt);}return false;};_pPopupMenu.on_fire_user_ondrag=function(button,alt_key,ctrl_key,shift_key,screenX,screenY,canvasX,canvasY,clientX,clientY,from_comp,refer_comp,self_refer_comp){if(this.ondrag&&this.ondrag._has_handlers){var dragData=this._getDragData();var evtinfo_control=this._getEventInfoComponent(self_refer_comp);var evt=new nexacro.MenuDragEventInfo(this,"ondrag",refer_comp.id,dragData,null,"text",null,this,self_refer_comp,from_comp,refer_comp,button,alt_key,ctrl_key,shift_key,screenX,screenY,canvasX,canvasY,clientX,clientY,evtinfo_control.parent.level,evtinfo_control.index,evtinfo_control._bindindex);return [this.ondrag._fireUserEvent(this,evt),this,self_refer_comp,dragData,evt.userdata];}return [false];};_pPopupMenu.on_fire_user_ondrop=function(src_comp,src_refer_comp,dragdata,userdata,datatype,filelist,button,alt_key,ctrl_key,shift_key,screenX,screenY,canvasX,canvasY,clientX,clientY,from_comp,from_refer_comp){if(this.ondrop&&this.ondrop._has_handlers){var evtinfo_control=this._getEventInfoComponent(from_refer_comp);var evt=new nexacro.MenuDragEventInfo(this,"ondrop",evtinfo_control.id,dragdata,userdata,datatype,filelist,src_comp,src_refer_comp,from_comp,evtinfo_control,button,alt_key,ctrl_key,shift_key,screenX,screenY,canvasX,canvasY,clientX,clientY,evtinfo_control.parent.level,evtinfo_control.index,evtinfo_control._bindindex);return this.ondrop._fireUserEvent(this,evt);}return false;};_pPopupMenu.on_fire_user_ondragenter=function(src_comp,src_refer_comp,dragdata,userdata,datatype,filelist,button,alt_key,ctrl_key,shift_key,screenX,screenY,canvasX,canvasY,clientX,clientY,from_comp,from_refer_comp){if(this.ondragenter&&this.ondragenter._has_handlers){var evtinfo_control=this._getEventInfoComponent(from_refer_comp);var evt=new nexacro.MenuDragEventInfo(this,"ondragenter",evtinfo_control.id,dragdata,userdata,datatype,filelist,src_comp,src_refer_comp,from_comp,evtinfo_control,button,alt_key,ctrl_key,shift_key,screenX,screenY,canvasX,canvasY,clientX,clientY,evtinfo_control.parent.level,evtinfo_control.index,evtinfo_control._bindindex);return this.ondragenter._fireUserEvent(this,evt);}return false;};_pPopupMenu.on_fire_user_ondragleave=function(src_comp,src_refer_comp,dragdata,userdata,datatype,filelist,button,alt_key,ctrl_key,shift_key,screenX,screenY,canvasX,canvasY,clientX,clientY,from_comp,from_refer_comp){if(this.ondragleave&&this.ondragleave._has_handlers){var iteminfo=this._last_mouseleave_iteminfo;var evtinfo_control=this._getEventInfoComponent(from_refer_comp);var evt=new nexacro.MenuDragEventInfo(this,"ondragleave",evtinfo_control.id,dragdata,userdata,datatype,filelist,src_comp,src_refer_comp,from_comp,evtinfo_control,button,alt_key,ctrl_key,shift_key,screenX,screenY,canvasX,canvasY,clientX,clientY,iteminfo.level,iteminfo.index,iteminfo.bindindex);return this.ondragleave._fireUserEvent(this,evt);}return false;};_pPopupMenu.on_fire_user_ondragmove=function(src_comp,src_refer_comp,dragdata,userdata,datatype,filelist,button,alt_key,ctrl_key,shift_key,screenX,screenY,canvasX,canvasY,clientX,clientY,from_comp,from_refer_comp){if(this.ondragmove&&this.ondragmove._has_handlers){var evtinfo_control=this._getEventInfoComponent(from_refer_comp);var evt=new nexacro.MenuDragEventInfo(this,"ondragmove",evtinfo_control.id,dragdata,userdata,datatype,filelist,src_comp,src_refer_comp,from_comp,evtinfo_control,button,alt_key,ctrl_key,shift_key,screenX,screenY,canvasX,canvasY,clientX,clientY,evtinfo_control.parent.level,evtinfo_control.index,evtinfo_control._bindindex);return this.ondragmove._fireUserEvent(this,evt);}return false;};_pPopupMenu.on_fire_user_onkeydown=function(keycode,alt_key,ctrl_key,shift_key,fire_comp,refer_comp){var rootComp=this._getRootComponent(this);var pThis=this._popupmenu_find(this);var popupvisible=this._is_popupmenu_visible(this);var item=this._item_find(pThis);var item_len=item.length-1;if(keycode==nexacro.Event.KEY_TAB){if(!popupvisible){if(!shift_key&&this._popupitemindex==item_len||shift_key&&this._popupitemindex<0){this._want_tab=false;this._closePopup();}else{pThis._item_killfocus(item[pThis._popupitemindex]);if(shift_key==false){this._popupitemindex++ ;}else{this._popupitemindex-- ;}if(item[this._popupitemindex]){rootComp._menuitemonmouseenter=item[this._popupitemindex];this._item_focus(item[this._popupitemindex],true,"tabkey");}else{this._do_defocus(this._last_focused,true);this._on_focus(true);}}this.parent._getWindow()._keydown_element._event_stop=true;}else{if(!shift_key&&pThis._popupitemindex==item_len||shift_key&&pThis._popupitemindex==0){pThis._item_killfocus(item[pThis._popupitemindex]);pThis._closePopup();pThis=this._popupmenu_find(this);item=this._item_find(pThis);pThis._item_focus(item[pThis._previtemindex],true,"tabkey");pThis._popupitemindex=pThis._previtemindex;}else{pThis._item_killfocus(item[pThis._popupitemindex]);if(shift_key){pThis._popupitemindex-- ;}else{pThis._popupitemindex++ ;}rootComp._menuitemonmouseenter=item[pThis._popupitemindex];pThis._item_focus(item[pThis._popupitemindex],true,"tabkey");}this.parent._getWindow()._keydown_element._event_stop=true;}}return nexacro.Component.prototype.on_fire_user_onkeydown.call(this,keycode,alt_key,ctrl_key,shift_key,fire_comp,refer_comp);};_pPopupMenu.on_fire_sys_onkeydown=function(keycode,alt_key,ctrl_key,shift_key,fire_comp,refer_comp){var pThis=this._popupmenu_find(this);var item=this._item_find(pThis);var popupvisible=this._is_popupmenu_visible(this);var popuptype=this._getPopupType();var rootComp=this._getRootComponent(this);var E=nexacro.Event;var is_accessibility=nexacro._enableaccessibility;var popupmenu,popupexpand;var prev_popupitemindex,popupitemindex;switch(keycode){case E.KEY_UP:if(is_accessibility){break;}if(pThis._popupitemindex> -1){if(!popupvisible){prev_popupitemindex=this._popupitemindex;popupitemindex=this._getItemIndex( -1);this._select_menuitem(popupitemindex,prev_popupitemindex);}else{this._fire_on_Popupmenu(keycode,alt_key,ctrl_key,shift_key,fire_comp,refer_comp);}}else{this._select_menuitem(this._getItemIndex(0));}break;case E.KEY_DOWN:if(is_accessibility){break;}if(!popupvisible){prev_popupitemindex=this._popupitemindex;popupitemindex=this._getItemIndex(1);this._select_menuitem(popupitemindex,prev_popupitemindex);}else{this._fire_on_Popupmenu(keycode,alt_key,ctrl_key,shift_key,fire_comp,refer_comp);}break;case E.KEY_LEFT:if(popuptype=="none"){break;}if(is_accessibility){if(!popupvisible){prev_popupitemindex=this._popupitemindex;popupitemindex=this._getItemIndex( -1);this._select_menuitem(popupitemindex,prev_popupitemindex);}else{}}else{if(pThis._popupitemindex> -1){if(!popupvisible){var parent=this.parent;if(parent instanceof nexacro.PopupMenu){parent._select_menuitem(parent._popupitemindex);this._closePopup();}else{rootComp._select_menuitem(rootComp._getItemIndex( -1),rootComp._popupitemindex,true);}}else{this._fire_on_Popupmenu(keycode,alt_key,ctrl_key,shift_key,fire_comp,refer_comp);}}else{rootComp._select_menuitem(rootComp._getItemIndex( -1),rootComp._popupitemindex,true);}}break;case E.KEY_RIGHT:if(popuptype=="none"){break;}if(is_accessibility){if(!popupvisible){prev_popupitemindex=this._popupitemindex;popupitemindex=this._getItemIndex(1);this._select_menuitem(popupitemindex,prev_popupitemindex);}else{}}else{var cur_idx=pThis._popupitemindex;if(cur_idx> -1){item=item[cur_idx];if(!item){return;}popupexpand=pThis._popupmenuitem_extend(item);if(popupexpand){pThis._showPopup(item);popupmenu=this._popupmenu;if(popupmenu){pThis.on_fire_sys_onkeydown(keycode,alt_key,ctrl_key,shift_key,fire_comp,refer_comp);}else{rootComp._select_menuitem(rootComp._getItemIndex(1),0,true);}}else{if(popupvisible){popupmenu=this._popupmenu;if(popupmenu){popupmenu.on_fire_sys_onkeydown(keycode,alt_key,ctrl_key,shift_key,fire_comp,refer_comp);}}else if(rootComp instanceof nexacro.PopupMenu&&!rootComp._is_subcontrol){popupmenu=rootComp._popupmenu;if(popupmenu){popupmenu._closeAllPopup();var rootitems=rootComp._items;var next_index=rootComp._getItemIndex(1);rootComp._select_menuitem(next_index,rootComp._popupitemindex,true);rootComp._showPopup(rootitems[next_index]);popupmenu._select_menuitem(this._getItemIndex(0));}}else{rootComp._select_menuitem(rootComp._getItemIndex(1),rootComp._popupitemindex,true);}}}else{item=this._items[this._popupitemindex];if(item){popupexpand=pThis._popupmenuitem_extend(item);}if(popupexpand){pThis._select_menuitem(this._getItemIndex(0));}else{rootComp._select_menuitem(rootComp._getItemIndex(1),rootComp._popupitemindex,true);}}}break;case E.KEY_ENTER:if(popuptype=="none"){break;}if(!popupvisible){if(pThis._popupitemindex> -1){popupexpand=pThis._popupmenuitem_extend(item[pThis._popupitemindex]);if(popupexpand){pThis._showPopup(item[pThis._popupitemindex]);popupmenu=this._popupmenu;if(popupmenu){popupmenu.on_fire_sys_onkeydown(keycode,alt_key,ctrl_key,shift_key,fire_comp,refer_comp);}}else{item=pThis._items[pThis._popupitemindex];if(item){pThis.on_notify_menuitem_onlbuttondown(item);}rootComp._closePopup();}}else{pThis._select_menuitem(this._getItemIndex(0));}}else if(!nexacro._enableaccessibility){this._fire_on_Popupmenu(keycode,alt_key,ctrl_key,shift_key,fire_comp,refer_comp);}break;case E.KEY_ESC:if(popuptype=="none"){break;}popupmenu=this._popupmenu;if(popupmenu&&this._is_popupmenu_visible(this)){popupmenu.on_fire_sys_onkeydown(keycode,alt_key,ctrl_key,shift_key,fire_comp,refer_comp);}else{if(refer_comp==fire_comp||refer_comp.parent==fire_comp){this._closePopup();}else{item=this._items[this._popupitemindex];if(item){item._on_focus(false);}}}break;default:break;}return nexacro.Component.prototype.on_fire_sys_onkeydown.call(this,keycode,alt_key,ctrl_key,shift_key,fire_comp,refer_comp);};_pPopupMenu.on_fire_onitemclick=function(obj,itemid,itemuserdata){var rootComp=this._getRootComponent(obj);if(rootComp.onmenuclick&&rootComp.onmenuclick._has_handlers){var evt=new nexacro.MenuClickEventInfo(obj,"onmenuclick",itemid,itemuserdata);rootComp.onmenuclick._fireEvent(rootComp,evt);}};_pPopupMenu.on_fire_oninnerdatachanged=function(obj,oldvalue,newvalue,columnid,col,row){if(this.oninnerdatachanged&&this.oninnerdatachanged._has_handlers){var evt=new nexacro.InnerdataChangedEventInfo(obj,"oninnerdatachanged",oldvalue,newvalue,columnid,col,row);return this.oninnerdatachanged._fireEvent(this,evt);}return true;};_pPopupMenu.on_fire_onpopup=function(obj){if(this.onpopup&&this.onpopup._has_handlers){var evt=new nexacro.EventInfo(obj,"onpopup");return this.onpopup._fireEvent(this,evt);}return false;};_pPopupMenu.on_fire_oncloseup=function(obj){if(this.oncloseup&&this.oncloseup._has_handlers){var isselect=(this._selected_itemindex>=0);var evt=new nexacro.MenuCloseUpEventInfo(obj,"oncloseup",isselect);return this.oncloseup._fireEvent(this,evt);}return false;};_pPopupMenu.cancelPopup=function(){this._closePopup();};_pPopupMenu.closePopup=function(){this._closePopup();};_pPopupMenu.isPopup=function(){return this._is_popup();};_pPopupMenu.trackPopup=function(x,y,align,bcapture){this._selected_itemindex= -1;this._track_capture=bcapture==undefined?true:nexacro._toBoolean(bcapture);if(!this._is_updatedimages){var ds=this._innerdataset;if(ds){var items=this._items;var level= +ds.getColumn(this.datarow+1,this.levelcolumn);for(var i=0,len=items.length;i<len;i++ ){if(level>this.level){items[i]._setExpandimage();}}}this._is_updatedimages=true;}if(!this._is_subcontrol&&this.autohotkey){var hotkey_list=this._hot_key_list;for(var i=0;i<hotkey_list.length;i++ ){this._registerItemHotkey(hotkey_list[i].key);}}this._calcNavigationbutton(this);this._reCalcSize();this._setInheritStyleValues(this);this.on_created();this._adjustPopupPosition( +x, +y,align);this.setFocus();this.on_fire_onpopup(this);};_pPopupMenu.trackPopupByComponent=function(obj,x,y,align,bcapture){this._selected_itemindex= -1;this._track_capture=bcapture==undefined?true:nexacro._toBoolean(bcapture);if(!this._is_subcontrol&&this.autohotkey){var hotkey_list=this._hot_key_list;for(var i=0;i<hotkey_list.length;i++ ){this._registerItemHotkey(hotkey_list[i].key);}}this._calcNavigationbutton(this);this._reCalcSize();this.on_created();var p=nexacro._getElementPositionInFrame(obj.getElement());var win_left=p.x;var win_top=p.y;var _window=this._getWindow();var m_c_width=_window.clientWidth;var m_c_height=_window.clientHeight;var width=this._adjust_width;var height=this._adjust_height;if(!align){if(win_left+x+width>m_c_width){var l_temp=m_c_width-width;if(l_temp<0){x= -win_left;}else{x=l_temp-win_left;}}if(win_top+y+height>m_c_height){var t_temp=m_c_height-height;if(t_temp<0){y= -win_top;}else{y=t_temp-win_top;}}}var form=this._getForm();x= +x+win_left;y= +y+win_top;this._adjustPopupPosition(x,y,align,form._getWindowPosition());this.setFocus();this.on_fire_onpopup(this);};_pPopupMenu.setInnerDataset=function(obj){this._removeEventHandlerToInnerDataset();if(!obj){this._innerdataset=null;this.innerdataset="";this.on_apply_innerdataset();}else if(obj instanceof nexacro.Dataset){this._innerdataset=obj;this.innerdataset=obj.id;this.on_apply_innerdataset();}};_pPopupMenu.getInnerDataset=function(){return this._innerdataset;};_pPopupMenu._createPopupMenu=function(){var control_elem=this.getElement();if(control_elem){this._deletePopupMenu();var ds=this._innerdataset;if(ds&&this.levelcolumn&&this.captioncolumn&&this.idcolumn){var item_index=0;var row_index=this.datarow;var ds_len=ds.getRowCount();var top=0;var height=this.itemheight?this.itemheight:0;for(;row_index<ds_len;row_index++ ){var rootComp=this._getRootComponent(this);var id=ds.getColumn(row_index,this.idcolumn);var level=ds.getColumn(row_index,this.levelcolumn);var caption=ds.getColumn(row_index,this.captioncolumn);var enable=ds.getColumn(row_index,this.enablecolumn);var hotkey=ds.getColumn(row_index,this.hotkeycolumn);var userdata=ds.getColumn(row_index,this.userdatacolumn);var icon=ds.getColumn(row_index,this.iconcolumn);var check=ds.getColumn(row_index,this.checkboxcolumn);if(level==this.level){if(caption=="-"){var lineItem=new nexacro.Static("separator",0,top,0,1,null,null,null,null,null,null,this);lineItem._setControl();lineItem.set_background("black");lineItem.createComponent();lineItem._bLine=true;top+=1;this._lineItems.push(lineItem);continue;}var popupmenuitem=new nexacro._PopupMenuItemControl("popupmenuitem"+row_index,0,top,0,height,null,null,null,null,null,null,this);popupmenuitem.createComponent();top+=height;popupmenuitem._bindindex=row_index;popupmenuitem.index=item_index++ ;popupmenuitem.datarow=row_index;popupmenuitem.level=level;popupmenuitem.set_text(caption||"");popupmenuitem._setEnable((enable===false||enable==="false")?false:true);popupmenuitem._setId(id||"");popupmenuitem._setHotkeyText(hotkey||"");popupmenuitem._setUserdata(userdata||null);check=nexacro._toBoolean(check);if(check){popupmenuitem._setCheck(check);}else if(icon){popupmenuitem._setIcon(icon);}if(row_index==ds.getRowCount()-1){popupmenuitem._canExpand=false;}else{var next_itemlevel= +ds.getColumn(row_index+1,this.levelcolumn);if(next_itemlevel<=this.level){popupmenuitem._canExpand=false;}else{popupmenuitem._setExpandimage();}}popupmenuitem._setEventHandler("onclick",this.on_notify_menuitem_onclick,this);popupmenuitem._setEventHandler("onlbuttondown",this.on_notify_menuitem_onlbuttondown,this);if(!(nexacro._isTouchInteraction&&nexacro._SupportTouch)){popupmenuitem._setEventHandler("onmouseenter",this.on_notify_menuitem_onmouseenter,this);this._setEventHandler("onmouseenter",this.on_notify_onmouseenter,this);if(rootComp.onmouseleave){popupmenuitem._setEventHandler("onmouseleave",this.on_notify_menuitem_onmouseleave,this);}}if(nexacro._enableaccessibility){popupmenuitem.on_apply_accessibility();}this._items.push(popupmenuitem);this._lineItems.push(popupmenuitem);popupmenuitem._real_visible=false;}else if(level<this.level){break;}if(!this._is_subcontrol){if(this.autohotkey&&hotkey){this._set_hotkey(id,hotkey);}}}this._is_updatedimages=true;}}};_pPopupMenu._deletePopupMenu=function(){var i;if(!this._is_subcontrol){for(i=0;i<this._hot_key_list.length;i++ ){this._unregisterItemHotkey(this._hot_key_list[i].key);}}for(i=0;i<this._items.length;i++ ){this._items[i].destroyComponent();this._items[i]=null;}for(i=0;i<this._lineItems.length;i++ ){this._lineItems[i].destroyComponent();this._lineItems[i]=null;}if(this.nextbutton){this.nextbutton.destroyComponent();this.nextbutton=null;}if(this.prevbutton){this.prevbutton.destroyComponent();this.prevbutton=null;}this._items=[];this._lineItems=[];this._hot_key_list=[];this._start_navigation_index=0;this._end_navigation_index=0;this._is_navigation_visible=false;};_pPopupMenu._showPopup=function(obj){var popuptype=this._getPopupType();if(popuptype=="none"){return;}if(this._innerdataset&&this.levelcolumn&&this.captioncolumn&&this.idcolumn&&obj._canExpand===true&&this.visible){var popupmenu=this._popupmenu;if(!popupmenu){popupmenu=this._popupmenu=new nexacro.PopupMenu("menupopupmenu",0,0,0,0,null,null,null,null,null,null,this);popupmenu._setControl();var color=this._color?this._color:this._getCurrentStyleInheritValue("color");if(color){popupmenu.set_color(color.value);}var font=this._font?this._font:this._getCurrentStyleInheritValue("font");if(font){popupmenu.set_font(font.value);}popupmenu.level=this.level+1;popupmenu.datarow=obj.datarow+1;this._setPopupContains(true);popupmenu._track_capture=false;popupmenu._is_loading=true;popupmenu.setInnerDataset(this._innerdataset);popupmenu.set_captioncolumn(this.captioncolumn);popupmenu.set_checkboxcolumn(this.checkboxcolumn);popupmenu.set_hotkeycolumn(this.hotkeycolumn);popupmenu.set_idcolumn(this.idcolumn);popupmenu.set_levelcolumn(this.levelcolumn);popupmenu.set_userdatacolumn(this.userdatacolumn);popupmenu.set_enablecolumn(this.enablecolumn);popupmenu.set_iconcolumn(this.iconcolumn);popupmenu.set_popuptype(this._getPopupType());popupmenu.set_cssclass(this.cssclass);popupmenu.createComponent();}else{popupmenu.datarow=obj.datarow+1;}var itemheight=this.itemheight;if(itemheight){popupmenu.set_itemheight(itemheight);}popupmenu._trackPopup(obj,"horizontal");}};_pPopupMenu._trackPopup=function(obj,direction,x,y){this._createPopupMenu();if(!this._is_subcontrol&&this.autohotkey){var hotkey_list=this._hot_key_list;for(var i=0;i<hotkey_list.length;i++ ){this._registerItemHotkey(hotkey_list[i].key);}}this._reCalcSize();this.on_created();var _left,_top,_width,_height;var parent=this.parent;var rootframe=this._getRootFrame();var s=nexacro._getElementPositionInFrame(rootframe.getElement());var padding=this._getCSSStyleValue("padding",this._status);var padding_l=0,padding_r=0,padding_b=0,padding_t=0;if(padding){padding_l=padding.left;padding_r=padding.right;padding_b=padding.bottom;padding_t=padding.top;}var p_width,p_height,p;var popup_width=this._width;var popup_height=this._height;var bodyWidth=s.x+rootframe._adjust_width;var bodyHeight=s.y+rootframe._adjust_height;var tmp;var px;_width=popup_width+padding_l+padding_r;_height=popup_height+padding_b+padding_t;if(direction=="horizontal"){p=nexacro._getElementPositionInFrame(parent.getElement());p_width=parent._getClientWidth();_left=p_width;_top=0;if(!y){tmp=p.y+obj._adjust_top+popup_height;if(tmp>bodyHeight){_height=parent._adjust_height-obj._adjust_top;this._showNavigationButton(true);}else if(this._is_navigation_visible){this._showNavigationButton(false);}}else{_top=y;}if(!x){px=p.x;var px_width=px+p_width;if(px_width+popup_width>bodyWidth){if(px-popup_width>0){_left= -popup_width;}}}else{_left=x;}}else{p=nexacro._getElementPositionInFrame(obj.getElement());p_height=obj._adjust_height;_left=0;_top=p_height;if(!y){tmp=p.y+p_height+popup_height;if(tmp>bodyHeight){if(s.y<(p.y-popup_height)){_top= -popup_height;}else{_height=bodyHeight-p.y-parent._adjust_height;this._showNavigationButton(true);}}else if(this._is_navigation_visible){this._showNavigationButton(false);}}else{_top=y;}if(!x){px=p.x;if(px+popup_width>bodyWidth){_left=bodyWidth-px-popup_width;}}else{_left=x;}}var popuptype=this._getPopupType();if(popuptype=="center"){var left=(rootframe._adjust_width/2)-(_width/2);var top=(rootframe._adjust_height/2)-(_height/2);this._adjustPopupPosition(left,top);}else{this._is_trackpopup=true;var _window=this._getWindow();if(_window&&(_window._wheelZoom!=undefined)){_left=_left*_window._wheelZoom/100;_top=_top*_window._wheelZoom/100;}this._popupBy(obj,_left,_top-1,_width,_height);}};_pPopupMenu._adjustPopupPosition=function(x,y,align,win_position){var alignPosition=this._getAlignPosition(x,y,align);var popup_left=alignPosition[0]<0?0:alignPosition[0];var popup_top=alignPosition[1]<0?0:alignPosition[1];var popup_width=this._width;var popup_height=this._height;var popup_winpos_right=popup_left+popup_width;var popup_winpos_bottom=popup_top+popup_height;var _window=this._getWindow();var win_width=_window.clientWidth;var win_height=_window.clientHeight;var width_gap=popup_winpos_right-win_width;if(popup_winpos_right>win_width&&popup_left>width_gap){popup_left=popup_left-width_gap;}if(popup_winpos_bottom>win_height){popup_top=win_height-popup_height;}this._is_trackpopup=true;this._popup(popup_left,popup_top,popup_width,popup_height);};_pPopupMenu._closePopup=function(){var popupmenu=this._popupmenu;if(popupmenu){popupmenu._closePopup();}var _window=this._getWindow();if(_window&&this._track_capture){_window._releaseCaptureLock(this);}var hotkey_list=this._hot_key_list;for(var i=0;i<hotkey_list.length;i++ ){this._unregisterItemHotkey(hotkey_list[i].key);}var items=this._item_find(this);if(nexacro._enableaccessibility){this._item_killfocus(items[this._popupitemindex]);}for(i=0;i<items.length;i++ ){items[i]._on_apply_mouseover(false);}if(items[this._popupitemindex]){items[this._popupitemindex]._changeUserStatus("selected",false);}if(items[this.beforeindex]){items[this.beforeindex]._changeUserStatus("selected",false);}if(items[this._previtemindex]){items[this._previtemindex]._changeUserStatus("selected",false);}this._popupitemindex= -1;this.set_visible(false);this._is_trackpopup=false;};_pPopupMenu._closeAllPopup=function(){this._closePopup();};_pPopupMenu._reCalcSize=function(){var ds=this._innerdataset;if(ds&&this.captioncolumn){var items=this._items;if(!items||items.length==0){return;}var len=items.length;var currentstatus=this._status;var expandtext_width=parseInt(nexacro._getTextSize(">",items[0]._getCurrentStyleInheritValue("font",this._status))[0]);var controls_info=this._getControlInfo();var textcontrol_width=controls_info[0];var hotkeycontrol_width=controls_info[1];var maxtextheight=controls_info[2];var maxhotkeyheight=controls_info[3];var has_expand=controls_info[4];var itemborder=controls_info[5];var itemborder_t=0,itemborder_b=0;var itempadding=controls_info[6];var itempadding_l=0,itempadding_r=0,itempadding_t=0,itempadding_b=0;var iconimgwidth=controls_info[7];var itemheight=controls_info[8];var expimgwidth=controls_info[9];var expimgheight=controls_info[10];var bchkimg=controls_info[11];var chkimgwidth=0;var border=this._getCSSStyleValue("border",currentstatus);var padding=this._getCSSStyleValue("padding",currentstatus);if(itempadding){itempadding_l=itempadding.left;itempadding_r=itempadding.right;itempadding_t=itempadding.top;itempadding_b=itempadding.bottom;}if(itemborder){if(itemborder.top){itemborder_t=itemborder.top._width;}if(itemborder.bottom){itemborder_b=itemborder.bottom._width;}}var border_left=0,border_top=0,border_right=0,border_bottom=0;if(border){border_left=border.left._width;border_top=border.top._width;border_right=border.right._width;border_bottom=border.bottom._width;}var padding_left=0,padding_top=0,padding_right=0,padding_bottom=0;if(padding){padding_left=padding.left;padding_right=padding.right;padding_top=padding.top;padding_bottom=padding.bottom;}var item_h=this.itemheight;var item_contents_height=0;if(item_h==undefined){item_h=itemheight+itemborder_t+itemborder_b+itempadding_t+itempadding_b;item_contents_height=itemheight;}else{item_contents_height=item_h-itemborder_t-itemborder_b-itempadding_t-itempadding_b;}this._itemheight=item_h;if(bchkimg){chkimgwidth=item_h;}var gap=0,icontextpadding=0;if(!this._is_subcontrol||(!this.checkboxcolumn&&!this.iconcolumn)){iconimgwidth=0;chkimgwidth=0;icontextpadding=0;}var iconwidth=(iconimgwidth?iconimgwidth:chkimgwidth);var item_width=itempadding_l+itempadding_r+icontextpadding+(iconwidth?iconwidth:0)+(textcontrol_width?textcontrol_width+gap:0)+(hotkeycontrol_width?hotkeycontrol_width+gap:0)+(has_expand?expimgwidth?expimgwidth+gap:gap+expandtext_width:0);var popupmenu_width=item_width+padding_left+padding_right+border_left+border_right;var items_total_height=this._items_total_height=item_h*len;var popupmenu_height=items_total_height+border_top+border_bottom+padding_top+padding_bottom;var buttonsize=this.buttonsize|0;var navigation_visible=this._isNavigationbuttonVisible();if(navigation_visible){this._rearrangePopupMenuItems();}else{this._showNavigationButton(navigation_visible);this.resize(popupmenu_width,popupmenu_height);}var _item_top=buttonsize;var icon_x=0;var icon_end_x;icon_end_x=chkimgwidth==0?iconimgwidth+icon_x:chkimgwidth+icon_x;var text_x=icon_x>itempadding_l?icon_end_x+icontextpadding:icon_end_x;var hotkey_x=text_x+textcontrol_width+gap;this._setItemControlPosition(icon_x,iconwidth,itemheight,text_x,textcontrol_width,maxtextheight,hotkey_x,hotkeycontrol_width,maxhotkeyheight,gap,chkimgwidth,expimgwidth?expimgwidth:expandtext_width,expimgheight?expimgheight:0,item_contents_height);for(var i=0;i<this._lineItems.length;i++ ){var item=this._lineItems[i];if(item._bLine){item.move(0,_item_top,popupmenu_width,1);_item_top+=1;}else{if(navigation_visible==false){item.move(0,_item_top,popupmenu_width,item_h);}if(nexacro._enableaccessibility){item._updateAccessibilityLabel(item);}_item_top+=item_h;}}}};_pPopupMenu._rearrangePopupMenuItems=function(){var start_navigation_index=this._start_navigation_index;var itemheight=this._itemheight;var client_width=this._getClientWidth();var client_height=this._getClientHeight();var items=this._items;var navigation_height=this.navigationbuttonsize||this._navigationbuttonsize||0;var top=navigation_height;var len=items.length;var end_navigation_index=this._end_navigation_index;var sum_itemheight=top+navigation_height;this._showNavigationButton(this._isNavigationbuttonVisible());var i,end;for(i=0,end=start_navigation_index;i<end;i++ ){items[i].move(0,0,0,0);}for(i=start_navigation_index;i<=len;i++ ){var item=items[i];end_navigation_index=i;sum_itemheight+=itemheight;if(i==start_navigation_index||sum_itemheight<client_height){if(item){item.move(0,top,client_width,itemheight);}}else{break;}top+=itemheight;}if(end_navigation_index>0&&end_navigation_index<len){for(i=end_navigation_index;i<len;i++ ){items[i].move(0,0,0,0);}}this._end_navigation_index=end_navigation_index;};_pPopupMenu._select_menuitem=function(nextitemindex,previtemindex){var items=this._items;var prev_item=items[previtemindex];this._popupitemindex=nextitemindex;var next_item=items[nextitemindex];if(prev_item&&nextitemindex!=previtemindex){this._do_defocus(prev_item);prev_item._changeUserStatus("selected",false);}if(next_item){this._item_focus(next_item,true);next_item._changeUserStatus("selected",true);this._menuitemonmouseenter=next_item;}};_pPopupMenu._createNavigationButton=function(){var nextbutton=new nexacro.Button("nextbutton",0,0,0,0,null,null,null,null,null,null,this);nextbutton._setControl("ButtonControl");nextbutton._is_focus_accept=false;nextbutton.createComponent();nextbutton.set_visible(true);nextbutton._setEventHandler("onclick",this.on_notify_navigationnext_onclick,this);nextbutton.on_created();this.nextbutton=nextbutton;var prevbutton=new nexacro.Button("prevbutton",0,0,0,0,null,null,null,null,null,null,this);prevbutton._setControl("ButtonControl");prevbutton._is_focus_accept=false;prevbutton.createComponent();prevbutton.set_visible(true);prevbutton._setEventHandler("onclick",this.on_notify_navigationprev_onclick,this);prevbutton.on_created();prevbutton._changeStatus("disabled",true);this.prevbutton=prevbutton;var previcon=prevbutton._getCSSStyleValue("icon","enabled");var img_size;if(previcon){img_size=nexacro._getImageSize(previcon.url,this._rearrangePopupMenuItems,this);if(img_size){this._navigationbuttonsize=img_size.height;this._rearrangePopupMenuItems();}}var nexticon=nextbutton._getCSSStyleValue("icon","enabled");if(nexticon){img_size=nexacro._getImageSize(nexticon.url,this._rearrangePopupMenuItems,this);if(img_size){this._navigationbuttonsize=img_size.height;this._rearrangePopupMenuItems();}}};_pPopupMenu._showNavigationButton=function(navigation_visible){this._is_navigation_visible=navigation_visible;var prevbutton,nextbutton;if(navigation_visible){if(!this.prevbutton||!this.nextbutton){this._createNavigationButton();}prevbutton=this.prevbutton;nextbutton=this.nextbutton;var navigationbuttonsize=this.navigationbuttonsize;var navigationprevbutton_height=0;var navigationnextbutton_height=0;if(!navigationbuttonsize){var navigationbutton_height=this._getNavigationbuttonHeight(nextbutton,prevbutton);navigationnextbutton_height=navigationbutton_height[0];navigationprevbutton_height=navigationbutton_height[1];}else{navigationnextbutton_height=navigationbuttonsize;navigationprevbutton_height=navigationbuttonsize;}this._navigationbuttonsize=navigationprevbutton_height;var client_width=this._getClientWidth();var client_height=this._getClientHeight();prevbutton.set_visible(true);prevbutton.move(0,0,client_width,navigationprevbutton_height);nextbutton.set_visible(true);nextbutton.move(0,client_height-navigationnextbutton_height,client_width,navigationnextbutton_height);}else{prevbutton=this.prevbutton;if(prevbutton){prevbutton.set_visible(false);prevbutton.move(0,0,0,0);}nextbutton=this.nextbutton;if(nextbutton){nextbutton.set_visible(false);nextbutton.move(0,0,0,0);}}};_pPopupMenu._calcNavigationbutton=function(){var rootframe=this._getRootFrame();var s=nexacro._getElementPositionInFrame(rootframe.getElement());var bodyHeight=s.y+rootframe._adjust_height;if(this._items_total_height>bodyHeight){this._is_navigation_visible=true;this.resize(this._width,bodyHeight);}else if(this._is_navigation_visible){this._is_navigation_visible=false;}};_pPopupMenu._navigationPrev=function(){var start_index=this._start_navigation_index;if(start_index>0){if(this._items.length==this._end_navigation_index){this.nextbutton._changeStatus("disabled",false);}start_index-- ;if(start_index==0){this.prevbutton._changeStatus("disabled",true);}}this._start_navigation_index=start_index;this._rearrangePopupMenuItems();};_pPopupMenu._navigationNext=function(){var threshold=this._items.length;if(this._end_navigation_index<threshold){if(this._start_navigation_index==0){this.prevbutton._changeStatus("disabled",false);}this._start_navigation_index++ ;}this._rearrangePopupMenuItems();if(this._end_navigation_index==threshold){this.nextbutton._changeStatus("disabled",true);}};_pPopupMenu._set_hotkey=function(id,v){var hotkey=new nexacro._HotKey(v);if(hotkey._isEmpty()){delete hotkey;}var list={id:id,key:hotkey};this._hot_key_list.push(list);};_pPopupMenu._registerItemHotkey=function(hotkey){if(!hotkey||hotkey._is_registered){return;}var _form=this._getMainForm();if(_form){nexacro._registerHotkeyComp(_form,this,hotkey);}this._setAccessibilityHotKey(hotkey);};_pPopupMenu._unregisterItemHotkey=function(hotkey){if(!hotkey||!hotkey._is_registered){return;}var _form=this._getMainForm();if(_form){nexacro._unregisterHotkeyComp(_form,this,hotkey);}};_pPopupMenu._loaded_expImage=function(imgurl,w,h){if(this._expImage_width!=w||this._expImage_height!=h){this._expImage_width=w;this._expImage_height=h;if(this.visible){this._reCalcSize();}}};_pPopupMenu._loaded_chkImage=function(imgurl,w,h){if(this._chkImage_width!=w||this._chkImage_height!=h){this._chkImage_width=w;this._chkImage_height=h;if(this.visible){this._reCalcSize();}}};_pPopupMenu._loaded_iconImage=function(imgurl,w,h){if(this._iconImage_width!=w||this._iconImage_height!=h){this._iconImage_width=w;this._iconImage_height=h;if(this.visible){this._reCalcSize();}}};_pPopupMenu._load_image=function(strImageUrl,strflag){var control_elem=this._control_element;if(control_elem){var val=strImageUrl;if(val){val=nexacro._getURIValue(val);val=nexacro._getImageLocation(val,this._getRefFormBaseUrl());var size;if(strflag=="exp"){size=nexacro._getImageSize(val,this._loaded_expImage,this);if(size){this._expImage_width=size.width;this._expImage_height=size.height;}}else if(strflag=="chk"){size=nexacro._getImageSize(val,this._loaded_chkImage,this);if(size){this._chkImage_width=size.width;this._chkImage_height=size.height;}}else if(strflag=="icon"){size=nexacro._getImageSize(val,this._loaded_iconImage,this);if(size){this._iconImage_width=size.width;this._iconImage_height=size.height;}}return val;}}};_pPopupMenu._getPopupControl=function(){var rootcomp=this._getRootComponent(this);return rootcomp._popupmenu;};_pPopupMenu._getPopupType=function(){var rootComp=this._getRootComponent(this);var popuptype=rootComp.popuptype;return popuptype?popuptype:"normal";};_pPopupMenu._is_popupmenu_visible=function(obj){if(!obj||obj._popupmenu==null||obj._popupmenu.visible==false){return false;}return true;};_pPopupMenu._isNavigationbuttonVisible=function(){return this._is_navigation_visible;};_pPopupMenu._getNavigationbuttonHeight=function(nextbutton,prevbutton){var prev_height=0;var img_size,padding,border,next_height=0;var nexticon=nextbutton._getCSSStyleValue("icon","enabled");if(nexticon){img_size=nexacro._getImageSize(nexticon.url,nexacro._emptyFn,this);if(img_size){next_height=img_size.height;padding=nextbutton._getCSSStyleValue("padding",this._status);if(padding){next_height+=padding.top+padding.bottom;}border=nextbutton._getCSSStyleValue("border",this._status);if(border){if(border._single){next_height+=border.top._width+border.top._width;}else{next_height+=border.top._width+border.bottom._width;}}}}var previcon=prevbutton._getCSSStyleValue("icon","enabled");if(previcon){img_size=nexacro._getImageSize(previcon.url,nexacro._emptyFn,this);if(img_size){prev_height=img_size.height;padding=prevbutton._getCSSStyleValue("padding",this._status);if(padding){prev_height+=padding.top+padding.bottom;}border=prevbutton._getCSSStyleValue("border",this._status);if(border){if(border._single){prev_height+=border.top._width+border.top._width;}else{prev_height+=border.top._width+border.bottom._width;}}}}return [next_height,prev_height];};_pPopupMenu._getMaxTextSize=function(column){var ds=this._innerdataset;var text_maxsize=[0,0];if(ds){var text_size;var items=this._items;if(items){var len=items.length;if(len){var font=items[0]._getCurrentStyleInheritValue("font",this._status);for(var i=0;i<len;i++ ){var text=ds.getColumn(items[i].datarow,column);if(text===undefined){break;}text_size=nexacro._getTextSize(text,font);if(text_size[0]>text_maxsize[0]){text_maxsize[0]=text_size[0];}if(text_size[1]>text_maxsize[1]){text_maxsize[1]=text_size[1];}}}}}return text_maxsize;};_pPopupMenu._getRootFrame=function(){var root_frame;var owner_frame=this._getOwnerFrame();if(owner_frame){var win=owner_frame._getWindow();if(win){root_frame=win.frame;}}return root_frame;};_pPopupMenu._getMenuObj=function(){var p=this.parent;while(!(p instanceof nexacro.Menu)){p=p.parent;}return p;};_pPopupMenu._getControlInfo=function(){var items=this._items;var text_control_size={};var hotkey_control_size={};var max_text_width=0;var max_hotkey_width=0;var max_icon_width=0;var text_height=0;var hotkey_height=0;var text_font,hotkey_font;var max_item_height=0;var item_border;var item_padding;var has_expand=false;var icon_border;var icon_padding;var text_border;var hotkey_border;var text_padding;var hotkey_padding;var icon_width=0;var expandimg_width=0;var expandimg_height=0;var bchkimg=false;for(var i=0,len=items.length;i<len;i++ ){var item=items[i];var text_control=item._textcontrol;var hotkey_control=item._hotkeytextcontrol;var expiconcontrol=item._expiconcontrol;var currentstatus=item._status;if(item._check){bchkimg=true;}var icon_control=item._iconcontrol;if(icon_control){var icon=icon_control._icon||icon_control._getCSSStyleValue("icon",currentstatus);if(icon){var iconsize=nexacro._getImageSize(icon.value,this._loaded_iconImage,this);if(iconsize){icon_width=iconsize.width;}}icon_border=icon_control._getCSSStyleValue("border",currentstatus);if(icon_border){if(icon_border._single){icon_width=icon_width+icon_border.top._width+icon_border.top._width;}else{icon_width=icon_width+icon_border.top._width+icon_border.bottom._width;}}icon_padding=icon_control._getCSSStyleValue("padding",currentstatus);if(icon_padding){icon_width=icon_width+icon_padding.left+icon_padding.right;}if(icon_width>max_icon_width){max_icon_width=icon_width;}}if(text_control){var text=text_control.text;if(text){if(!text_font){text_font=text_control._getCurrentStyleInheritValue("font",currentstatus);}text_control_size=nexacro._getTextSize(text,text_font);if(text_control_size[0]>max_text_width){max_text_width=text_control_size[0];}}if(!text_border){text_border=text_control._getCSSStyleValue("border",currentstatus);}if(!text_padding){text_padding=text_control._getCSSStyleValue("padding",currentstatus);}}if(hotkey_control){var hotkey=hotkey_control.text;if(hotkey){if(!hotkey_font){hotkey_font=hotkey_control._getCurrentStyleInheritValue("font",this._status);}hotkey_control_size=nexacro._getTextSize(hotkey,hotkey_font);if(hotkey_control_size[0]>max_hotkey_width){max_hotkey_width=hotkey_control_size[0];}}if(!hotkey_border){hotkey_border=hotkey_control._getCSSStyleValue("border",currentstatus);}if(!hotkey_padding){hotkey_padding=hotkey_control._getCSSStyleValue("padding",currentstatus);}}if(!has_expand&&item._canExpand){has_expand=true;}if(expiconcontrol){var expicon=expiconcontrol._getCSSStyleValue("icon",currentstatus);if(expicon){var expsize=nexacro._getImageSize(expicon.value,this._loaded_expImage,this);if(expsize){expandimg_width=expsize.width;expandimg_height=expsize.height;}}}if(!item_padding){item_padding=item._getCSSStyleValue("padding");}if(!item_border){item_border=item._getCSSStyleValue("border");}}if(!max_item_height){text_height=text_control_size[1];if(text_border){if(text_border._single){text_height=text_height+text_border.top._width+text_border.top._width;max_text_width=max_text_width+text_border.top._width+text_border.top._width;}else{text_height=text_height+text_border.top._width+text_border.bottom._width;max_text_width=max_text_width+text_border.top._width+text_border.bottom._width;}}if(text_padding){text_height=text_height+text_padding.top+text_padding.bottom;}if(text_control_size&&hotkey_control_size.length>1){hotkey_height=hotkey_control_size[1];if(hotkey_border){if(hotkey_border._single){hotkey_height=hotkey_height+hotkey_border.top._width+hotkey_border.top._width;max_hotkey_width=max_hotkey_width+hotkey_border.top._width+hotkey_border.top._width;}else{hotkey_height=hotkey_height+hotkey_border.top._width+hotkey_border.bottom._width;max_hotkey_width=max_hotkey_width+hotkey_border.top._width+hotkey_border.bottom._width;}}if(hotkey_padding){hotkey_height=hotkey_height+hotkey_padding.top+hotkey_padding.bottom;}max_item_height=text_height>hotkey_height?text_height:hotkey_height;}else{max_item_height=text_height;}}if(text_padding){max_text_width=max_text_width+text_padding.left+text_padding.right;}if(hotkey_padding){max_hotkey_width=max_hotkey_width+hotkey_padding.left+hotkey_padding.right;}return [Math.ceil(max_text_width),Math.ceil(max_hotkey_width),text_height,hotkey_height,has_expand,item_border,item_padding,max_icon_width?max_icon_width:0,max_item_height,expandimg_width,expandimg_height,bchkimg];};_pPopupMenu._getAlignPosition=function(x,y,align){if(align){var width=this._width;var height=this._height;var popup_align=align.split(/\s+/);var align_len=popup_align.length;var horizon=parseInt(x,10)|0;var vertical=parseInt(y,10)|0;switch(align_len){case 0:break;case 1:if(popup_align[0]=="left"){x=horizon-width;}else if(popup_align[0]=="center"){x=horizon-(width/2);}else if(popup_align[0]=="top"){y=vertical-height;}else if(popup_align[0]=="middle"){y=vertical-(height/2);}break;case 2:if(popup_align[0]=="left"||popup_align[0]=="center"||popup_align[0]=="right"){if(popup_align[0]=="left"){x=horizon-width;}else if(popup_align[0]=="center"){x=horizon-(width/2);}}else if(popup_align[0]=="top"||popup_align[0]=="middle"||popup_align[0]=="bottom"){if(popup_align[0]=="top"){y=vertical-height;}else if(popup_align[0]=="middle"){y=vertical-(height/2);}}if(popup_align[1]=="left"||popup_align[1]=="center"||popup_align[1]=="right"){if(popup_align[1]=="left"){x=horizon-width;}else if(popup_align[1]=="center"){x=horizon-(width/2);}}else if(popup_align[1]=="top"||popup_align[1]=="middle"||popup_align[1]=="bottom"){if(popup_align[1]=="top"){y=vertical-height;}else if(popup_align[1]=="middle"){y=vertical-(height/2);}}break;default:break;}}return [x,y];};_pPopupMenu._getItemIndex=function(dir){if(dir===undefined){dir=0;}var inc=dir<0?dir:1;var popupitemindex=dir===0?0:this._popupitemindex+inc;var items=this._items;var popupitem_len=items?items.length:0;for(var i=0;i<popupitem_len;i++ ){var item=items[popupitemindex];if(nexacro._enableaccessibility){if(item){return popupitemindex;}}else{if(item&&item._real_enable){return popupitemindex;}}popupitemindex+=inc;if(popupitemindex>popupitem_len){popupitemindex=0;}else if(popupitemindex<0){popupitemindex=popupitem_len-1;}}return this._popupitemindex;};_pPopupMenu._getEventInfoComponent=function(refer_comp){while(!refer_comp._is_eventinfo_control){refer_comp=refer_comp.parent;}return refer_comp;};_pPopupMenu._setContents=function(str){var doc=nexacro._parseXMLDocument(str);var node=doc.getElementsByTagName("Dataset")[0];if(!node){return false;}var idstr=node.attributes[0].value;var normalDataset=new nexacro.NormalDataset(idstr,this);if(node.firstChild){var childnode=node.firstChild;var strXML="";while(childnode){if(node.nodeType==1){strXML+=nexacro._documentToXml(childnode);}childnode=childnode.nextSibling;}normalDataset._setContents(strXML);}this.set_innerdataset(normalDataset);return true;};_pPopupMenu._setItemControlPosition=function(icon_x,iconimgwidth,iconheight,text_x,textwidth,textheight,hotkey_x,hotkeywidth,hotkeyheight,gap,chkimgwidth,expimgwidth,expimgheight,itemheight){var height=itemheight?itemheight:iconheight;this._itempos={icon_x:icon_x,iconimgwidth:iconimgwidth,iconheight:height,text_x:text_x,textheight:height,textwidth:textwidth,hotkey_x:hotkey_x,hotkeywidth:hotkeywidth,hotkeyheight:height,expimgwidth:expimgwidth,expimgheight:expimgheight,chkimgwidth:chkimgwidth,gap:gap};};_pPopupMenu._setInnerDatasetStr=function(str){this._removeEventHandlerToInnerDataset();if(!str){this._innerdataset=null;this.innerdataset="";}else{str=str.replace("@","");this._innerdataset=this._findDataset(str);this.innerdataset=str;}};_pPopupMenu._removeEventHandlerToInnerDataset=function(){if(this._innerdataset){this._innerdataset._removeEventHandler("onrowposchanged",this._callbackFromDataset,this);this._innerdataset._removeEventHandler("oncolumnchanged",this._callbackFromDataset,this);this._innerdataset._removeEventHandler("onrowsetchanged",this._callbackFromDataset,this);this._innerdataset._removeEventHandler("onvaluechanged",this._callback_onvaluechanged,this);this._innerdataset=null;}};_pPopupMenu._item_find=function(obj){if(obj._popupmenu==null||obj._popupmenu.visible==false){return obj._items;}return obj._popupmenu._items;};_pPopupMenu._popupmenu_find=function(obj){var pThis=obj;while(pThis){if(pThis._popupmenu===null||pThis._popupmenu.visible==false){break;}pThis=pThis._popupmenu;}return pThis;};_pPopupMenu._popupmenuitem_extend=function(obj){return obj._canExpand;};delete _pPopupMenu;}
if(!nexacro.Spin){nexacro.SpinEventInfo=function(obj,id,beforeText,beforeValue,afterText,afterValue,isUp){this.id=this.eventid=id||"onspin";this.fromobject=this.fromreferenceobject=obj;this.pretext=beforeText;this.prevalue=beforeValue;this.posttext=afterText;this.postvalue=afterValue;this.up=isUp;};var _pSpinEventInfo=nexacro._createPrototype(nexacro.Event,nexacro.SpinEventInfo);nexacro.SpinEventInfo.prototype=_pSpinEventInfo;_pSpinEventInfo._type_name="SpinEventInfo";delete _pSpinEventInfo;_pSpinEventInfo=null;nexacro.Spin=function(id,left,top,width,height,right,bottom,minwidth,maxwidth,minheight,maxheight,parent){nexacro.Component.call(this,id,left,top,width,height,right,bottom,minwidth,maxwidth,minheight,maxheight,parent);};var _pSpin=nexacro._createPrototype(nexacro.Component,nexacro.Spin);nexacro.Spin.prototype=_pSpin;_pSpin._type_name="Spin";_pSpin.spinedit=null;_pSpin.spinupbutton=null;_pSpin.spindownbutton=null;_pSpin.buttonposition="right";_pSpin.buttonsize=undefined;_pSpin.circulation=false;_pSpin.displaycomma=false;_pSpin.displaynulltext="";_pSpin.displayinvalidtext="invalid value";_pSpin.increment=1;_pSpin.locale="";_pSpin.max=10000;_pSpin.min=0;_pSpin.readonly=false;_pSpin.text="";_pSpin.type="normal";_pSpin.usecontextmenu=true;_pSpin.value=undefined;_pSpin.usesoftkeyboard=true;_pSpin._default_value=undefined;_pSpin._default_text="";_pSpin._default_mask="9.9";_pSpin._default_commamask="9,999.9";_pSpin._want_arrow=true;_pSpin._has_inputElement=true;_pSpin._use_readonly_status=true;_pSpin._is_locale_control=true;_pSpin._is_editable_control=true;_pSpin._event_list={"oneditclick":1,"onkeydown":1,"onkeyup":1,"onkillfocus":1,"onsetfocus":1,"ondrag":1,"ondragenter":1,"ondragleave":1,"ondragmove":1,"ondrop":1,"onlbuttondown":1,"onlbuttonup":1,"onrbuttondown":1,"onrbuttonup":1,"onmousedown":1,"onmouseup":1,"onmouseenter":1,"onmouseleave":1,"onmousemove":1,"onmove":1,"onsize":1,"canchange":1,"onchanged":1,"oninput":1,"onspin":1,"oncontextmenu":1,"ontouchstart":1,"ontouchmove":1,"ontouchend":1};_pSpin.accessibilityrole="spin";_pSpin._is_compound=true;_pSpin.on_create_contents=function(){var control=this.getElement();if(control){var spinedit=this.spinedit=new nexacro._SpinEditControl("spinedit",0,0,0,0,null,null,null,null,null,null,this);var spinupbutton=this.spinupbutton=new nexacro._SpinButtonControl("spinupbutton",0,0,0,0,null,null,null,null,null,null,this);var spindownbutton=this.spindownbutton=new nexacro._SpinButtonControl("spindownbutton",0,0,0,0,null,null,null,null,null,null,this);spinedit.set_limitbymask("none");spinedit.createComponent(true);spinupbutton.createComponent(true);spindownbutton.createComponent(true);}};_pSpin.on_created_contents=function(){this._setEventHandlerToCalendarEdit();this._setEventHandlerToSpinButtons();this.on_apply_displaycomma(this.displaycomma);this.on_apply_type(this.type);this.on_apply_readonly(this.readonly);this.on_apply_value(this.value);this.on_apply_usecontextmenu(this.usecontextmenu);this.spinupbutton.on_created();this.spindownbutton.on_created();this.spinedit.on_created();this.on_apply_displaynulltext(this.displaynulltext);this.on_apply_displayinvalidtext(this.displayinvalidtext);this._recalcLayout();this._updateButton();this._setDefaultProp();if(nexacro._enableaccessibility){this._setAccessibilityInfoValueMax(this.max);this._setAccessibilityInfoValueMin(this.min);this._setAccessibilityInfoValueCur(this.value);if(this.accessibilitydesclevel!="none"&&this.accessibilitydesclevel!="child"){this._setAccessibilityActiveDescendant(this.spinedit._input_element);}if(nexacro._accessibilitytype==5){this.spinedit._setAccessibilityStatHidden(true);}this.spinupbutton._setAccessibilityStatHidden(true);this.spindownbutton._setAccessibilityStatHidden(true);this._want_arrow=false;}if(this.spinedit){this.spinedit.set_usesoftkeyboard(this.usesoftkeyboard,true);}};_pSpin.on_destroy_contents=function(){if(this.spinedit){this.spinedit.destroy();this.spinedit=null;}if(this.spinupbutton){this.spinupbutton.destroy();this.spinupbutton=null;}if(this.spindownbutton){this.spindownbutton.destroy();this.spindownbutton=null;}};_pSpin.on_create_contents_command=function(){this._setEventHandlerToCalendarEdit();this._setEventHandlerToSpinButtons();this.on_apply_displaycomma(this.displaycomma);this.on_apply_type(this.type);this.on_apply_readonly(this.readonly);this.on_apply_value(this.value);this.on_apply_usecontextmenu(this.usecontextmenu);var str="";if(this.spinedit){str+=this.spinedit.createCommand();}if(this.spinupbutton){str+=this.spinupbutton.createCommand();}if(this.spindownbutton){str+=this.spindownbutton.createCommand();}return str;};_pSpin.on_attach_contents_handle=function(win){if(this.spinedit){this.spinedit.attachHandle(win);}if(this.spinupbutton){this.spinupbutton.attachHandle(win);}if(this.spindownbutton){this.spindownbutton.attachHandle(win);}this.on_apply_displaynulltext(this.displaynulltext);this.on_apply_displayinvalidtext(this.displayinvalidtext);this._setEventHandlerToCalendarEdit();this._setEventHandlerToSpinButtons();this._recalcLayout();this._updateButton();this._setDefaultProp();};_pSpin.on_change_containerRect=function(width,height){this._recalcLayout();};_pSpin.on_change_containerPos=function(left,top){};_pSpin.on_apply_prop_cssclass=function(){var spinedit=this.spinedit;if(spinedit){spinedit.on_apply_cssclass();}var spinupbutton=this.spinupbutton;if(spinupbutton){spinupbutton.on_apply_cssclass();}var spindownbutton=this.spindownbutton;if(spindownbutton){spindownbutton.on_apply_cssclass();}};_pSpin._apply_setfocus=function(evt_name){var spinedit=this.spinedit;if(spinedit){spinedit._on_focus(true,evt_name);}};_pSpin.on_getBindableProperties=function(){return "value";};_pSpin.on_apply_prop_enable=function(v){if(this.spinedit){this.spinedit._setEnable(v);}if(this.spinupbutton&&!this.readonly){this.spinupbutton._setEnable(v);}if(this.spindownbutton&&!this.readonly){this.spindownbutton._setEnable(v);}};_pSpin.on_init_bindSource=function(columnid,propid,ds){if(propid=="value"){this._setValue(undefined);}};_pSpin.on_change_bindSource=function(propid,ds,row,col,index){if(propid=="value"){var ds_val=ds.getColumn(row,col);var v=this._convertValueType(ds_val,true);if(isNaN(v)){v=ds_val;}this._setValue(v);}};_pSpin.on_apply_accessibility=function(){nexacro.Component.prototype.on_apply_accessibility.call(this);if(this.spinedit){this.spinedit.on_apply_accessibility();}};_pSpin.on_get_accessibility_label=function(){var label="";return label;};_pSpin._on_getAccessibilityAdditionalLabel=function(){var label="";if(this.spinedit){if(this.spinedit.text){label=this.spinedit.text;}else if(this._default_value!=null){label=this._default_value;}else if(this.displaynulltext){label=this.displaynulltext;}}return label;};_pSpin._getAccessibilityReadLabel=function(bwholeread){var _readlabel=nexacro.Component.prototype._getAccessibilityReadLabel.call(this);if(bwholeread&&this.spinedit._input_element&&this._status!="focus"){if(!this.spinedit._input_element._wantAccessibilityAdditionalLabel||!this.spinedit._input_element._wantAccessibilityAdditionalLabel()){_readlabel=this.text+" "+_readlabel;}}return _readlabel;};_pSpin._getDlgCode=function(keycode,altKey,ctrlKey,shiftKey){var want_arrow=this._want_arrow;if((keycode==nexacro.Event.KEY_UP||keycode==nexacro.Event.KEY_DOWN)&&(ctrlKey||altKey)){want_arrow=true;}this._want_arrow=false;return {want_tab:false,want_return:false,want_escape:false,want_chars:false,want_arrows:want_arrow};};_pSpin.set_text=nexacro._emptyFn;_pSpin.set_value=function(v){v=this._convertValueType(v);if(this.value!==v){if(!this.applyto_bindSource("value",v)){return;}this._setValue(v);}};_pSpin.on_apply_value=function(value){if(nexacro._isNull(value)||(value.date||value.time||value.blob||value.datetime)){value=undefined;}var spinedit=this.spinedit;if(spinedit){spinedit.set_value(value);if(nexacro._isNull(value)){this.text="";}else{this.text=spinedit.text;}this._setAccessibilityInfoValueCur(spinedit.text);this._updateAccessibilityLabel();spinedit._updateAccessibilityLabel();this._notifyAccessibility(spinedit.text);}};_pSpin.set_usesoftkeyboard=function(v,bforce){v=nexacro._toBoolean(v);if(v!=this.usesoftkeyboard||bforce){this.usesoftkeyboard=v;this.on_apply_usesoftkeyboard(bforce);}};_pSpin.on_apply_usesoftkeyboard=function(bforce){if(this.spinedit){this.spinedit.set_usesoftkeyboard(this.usesoftkeyboard,bforce);}};_pSpin.set_displaynulltext=function(v){var isNull=nexacro._isNull(v);if(isNull){v="";}else{v=nexacro._toString(v);v=v.replace(/&quot;/g,"\"");}if(this.displaynulltext!=v){this.displaynulltext=v;this.on_apply_displaynulltext(v);}};_pSpin.on_apply_displaynulltext=function(displaynulltext){var spinedit=this.spinedit;if(spinedit){spinedit.set_displaynulltext(displaynulltext);}};_pSpin.set_displayinvalidtext=function(v){v=nexacro._toString(v).replace(/&quot;/g,"\"");if(this.displayinvalidtext!=v){this.displayinvalidtext=v;this.on_apply_displayinvalidtext(v);}};_pSpin.on_apply_displayinvalidtext=function(v){v=nexacro._toString(v).replace(/&quot;/g,"\"");var spinedit=this.spinedit;if(spinedit){spinedit.set_displayinvalidtext(v);}};_pSpin.set_readonly=function(v){v=nexacro._toBoolean(v);if(this.readonly!=v){this.readonly=v;this.on_apply_readonly(v);}};_pSpin.on_apply_readonly=function(readonly){this._changeStatus("readonly",readonly);var spinedit=this.spinedit;if(spinedit){if(this.type=="noneditable"){spinedit.set_readonly(true);}else{spinedit.set_readonly(readonly);}}var spinupbutton=this.spinupbutton;if(spinupbutton){spinupbutton._setEnable(this.enable&&!readonly);}var spindownbutton=this.spindownbutton;if(spindownbutton){spindownbutton._setEnable(this.enable&&!readonly);}};_pSpin.set_type=function(v){var type_enum=["noneditable","normal","spinonly"];if(type_enum.indexOf(v)== -1){return;}if(this.type!=v){this.type=v;this.on_apply_type(v);this.on_apply_readonly(this.readonly);this._recalcLayout();}};_pSpin.on_apply_type=function(type){var spinedit=this.spinedit;if(spinedit){switch(type){case "spinonly":spinedit.set_visible(false);break;case "noneditable":spinedit.set_visible(true);break;case "normal":default:spinedit.set_visible(true);break;}}};_pSpin.set_locale=function(v){if(this.locale!=v){this.locale=v;this._locale=v;this.on_apply_locale(v);}};_pSpin.on_apply_locale=function(locale){var spinedit=this.spinedit;if(spinedit){spinedit._setLocale(locale);}};_pSpin.set_usecontextmenu=function(v){v=nexacro._toBoolean(v);if(this.usecontextmenu!=v){this.usecontextmenu=v;this.on_apply_usecontextmenu(v);}};_pSpin.on_apply_usecontextmenu=function(usecontextmenu){var spinedit=this.spinedit;if(spinedit){spinedit.set_usecontextmenu(usecontextmenu);}};_pSpin.set_buttonposition=function(v){var buttonposition_enum=["left","right"];if(buttonposition_enum.indexOf(v)== -1){return;}if(this.buttonposition!=v){this.buttonposition=v;this.on_apply_buttonposition(v);}};_pSpin.on_apply_buttonposition=function(buttonposition){this._recalcLayout();};_pSpin.set_buttonsize=function(v){if(v!==undefined){if(isNaN(v= +v)){return;}}if(this.buttonsize!=v){this.buttonsize=v;this.on_apply_buttonsize(v);}};_pSpin.on_apply_buttonsize=function(buttonsize){this._recalcLayout();};_pSpin.set_circulation=function(v){v=nexacro._toBoolean(v);if(this.circulation!=v){this.circulation=v;this.on_apply_circulation(v);this._updateButton();}};_pSpin.on_apply_circulation=function(circulation){this._updateButton();};_pSpin.set_displaycomma=function(v){v=nexacro._toBoolean(v);if(this.displaycomma!=v){this.displaycomma=v;this.on_apply_displaycomma(v);this.on_apply_value(this.value);this._setDefaultText();}};_pSpin.on_apply_displaycomma=function(displaycomma){var spinedit=this.spinedit;if(spinedit){if(!displaycomma){spinedit.set_format(this._default_mask);}else{spinedit.set_format(this._default_commamask);}}};_pSpin.set_increment=function(v){if(isNaN(v= +v)){return;}if(this.increment!=v){this.increment=v;}};_pSpin.set_max=function(v){if(isNaN(v= +v)){return;}if(this.max!=v){this.max=v;this._setAccessibilityInfoValueMax(v);this.on_apply_max(v);this.on_apply_value(this.value);this._updateButton();this._setDefaultProp();}};_pSpin.on_apply_max=function(max){if(this.value>max){this.value=max;}if(max<this.min){this.min=max;}};_pSpin.set_min=function(v){if(isNaN(v= +v)){return;}if(this.min!=v){this.min=v;this._setAccessibilityInfoValueMin(v);this.on_apply_min(v);this.on_apply_value(this.value);this._updateButton();this._setDefaultProp();}};_pSpin.on_apply_min=function(min){if(this.value<min){this.value=min;}if(this.max<min){this.max=min;}};_pSpin.setRange=function(min,max){this.set_min(min);this.set_max(max);if(this.min>this.max){var swap=this.min;this.min=this.max;this.max=swap;}};_pSpin.getCaretPos=function(){if(this.readonly){return  -1;}var spinedit=this.spinedit;if(spinedit){return spinedit.getCaretPos();}return  -1;};_pSpin.setCaretPos=function(v){var spinedit=this.spinedit;if(spinedit){return spinedit.setCaretPos(v);}return false;};_pSpin.getSelect=function(){var spinedit=this.spinedit;if(spinedit){return spinedit.getSelect();}return [0,0];};_pSpin.setSelect=function(start,end){var spinedit=this.spinedit;if(spinedit){return spinedit.setSelect(start,end);}return false;};_pSpin.getSelectedText=function(){var spinedit=this.spinedit;if(spinedit){return spinedit.getSelectedText();}return "";};_pSpin.updateToDataset=function(){return this.applyto_bindSource("value",this.value);};_pSpin._on_value_change=function(){var ret=true;var spinedit=this.spinedit;var max=this.max;var min=this.min;var pre_value=this._default_value;var pre_text=this._default_text;var cur_value=spinedit.value;var cur_text=spinedit.text;if(spinedit&&spinedit.text){cur_value=parseFloat(spinedit.text.replace(/\,/g,''),10)|0;}if(cur_value>max){cur_value=max;}else if(cur_value<min){cur_value=min;}if(!this.on_fire_canchange(this,pre_text,pre_value,cur_text,cur_value)||!this.applyto_bindSource("value",cur_value)){ret=false;}if(!ret){this._setValue(pre_value);return false;}this._setValue(cur_value);this.on_fire_onchanged(this,pre_text,pre_value,cur_text,cur_value);return true;};_pSpin._on_spin_up=function(){if(this.readonly){return false;}var maskobj=this._getMaskObj();var increment=this.increment;var max=this.max;var min=this.min;var pre_value=parseFloat(this.spinedit.value,10);var pre_text=this.text;if(nexacro._isNull(pre_value)||isNaN(pre_value)){pre_value=0;}var cur_value=this._calcValue(pre_value,increment,true);if(this.circulation){if(increment>=0){cur_value=(cur_value>max)?min:cur_value;}else{cur_value=(cur_value<min)?max:cur_value;}}else{cur_value=(cur_value>max)?max:(cur_value<min)?min:cur_value;}var cur_text=maskobj.applyMask(cur_value);if(!this.on_fire_onspin(this,pre_text,pre_value,cur_text,cur_value,true)){cur_value=pre_value;}this.value=cur_value;this.on_apply_value(cur_value);this._updateButton();};_pSpin._on_spin_down=function(){if(this.readonly){return false;}var maskobj=this._getMaskObj();var increment=this.increment;var max=this.max;var min=this.min;var pre_value=parseFloat(this.spinedit.value,10);var pre_text=this.text;if(nexacro._isNull(pre_value)||isNaN(pre_value)){pre_value=0;}var cur_value=this._calcValue(pre_value,increment,false);if(this.circulation){if(increment>=0){cur_value=(cur_value<min)?max:cur_value;}else{cur_value=(cur_value>max)?min:cur_value;}}else{cur_value=(cur_value<min)?min:(cur_value>max)?max:cur_value;}var cur_text=maskobj.applyMask(cur_value);if(!this.on_fire_onspin(this,pre_text,pre_value,cur_text,cur_value,false)){cur_value=pre_value;}this.value=cur_value;this.on_apply_value(cur_value);this._updateButton();};_pSpin._on_edit_oneditclick=function(obj,e){this.on_fire_oneditclick(obj,e.caretpos,e.button,e.altkey,e.ctrlkey,e.shiftkey,e.screenx,e.screeny,e.canvasx,e.canvasy,e.clientx,e.clienty,e.fromobject,e.fromreferenceobject);};_pSpin._on_edit_onkeydown=function(obj,e){switch(e.keycode){case nexacro.Event.KEY_UP:if(!nexacro._enableaccessibility||e.ctrlkey){this._on_spin_up();}break;case nexacro.Event.KEY_DOWN:if(!nexacro._enableaccessibility||e.ctrlkey){this._on_spin_down();}break;case nexacro.Event.KEY_ENTER:if(this._default_value!=this.spinedit.value){this._on_value_change();}break;}};_pSpin._on_edit_oninput=function(obj,e){if(this.readonly||!this._isEnable()){return false;}this.on_fire_oninput();var val=this.spinedit.value;val=parseFloat(val,10);if(isNaN(val)){this.value=this.min;}};_pSpin._on_upbutton_onclick=function(obj,e){this._on_spin_up();};_pSpin._on_downbutton_onclick=function(obj,e){this._on_spin_down();};_pSpin.on_focus_basic_action=function(self_flag,evt_name,lose_focus,refer_lose_focus,new_focus,refer_new_focus){this._changeStatus("focused",true);if(!(refer_new_focus instanceof nexacro.MaskEdit)){var spinedit=this.spinedit;if(spinedit){spinedit._on_focus(true,evt_name);}}};_pSpin.on_killfocus_basic_action=function(new_focus,new_refer_focus){if(this._default_value!=this.spinedit.value){this._on_value_change();}};_pSpin.on_fire_oneditclick=function(obj,caretpos,button,alt_key,ctrl_key,shift_key,screenX,screenY,canvasX,canvasY,clientX,clientY,from_comp,from_refer_comp){if(this.oneditclick&&this.oneditclick._has_handlers){var evt=new nexacro.EditClickEventInfo(this,"oneditclick",caretpos,button,alt_key,ctrl_key,shift_key,screenX,screenY,canvasX,canvasY,clientX,clientY,this,from_refer_comp);return this.oneditclick._fireEvent(this,evt);}return false;};_pSpin.on_fire_canchange=function(obj,pretext,prevalue,posttext,postvalue){if(this.canchange&&this.canchange._has_handlers){var evt=new nexacro.ChangeEventInfo(this,"canchange",pretext,prevalue,posttext,postvalue);return this.canchange._fireCheckEvent(this,evt);}return true;};_pSpin.on_fire_onchanged=function(obj,pretext,prevalue,posttext,postvalue){if(this.onchanged&&this.onchanged._has_handlers){var evt=new nexacro.ChangeEventInfo(obj,"onchanged",pretext,prevalue,posttext,postvalue);return this.onchanged._fireEvent(this,evt);}return true;};_pSpin.on_fire_oninput=function(){if(this.oninput&&this.oninput._has_handlers){var evt=new nexacro.InputEventInfo(this,"oninput");return this.oninput._fireEvent(this,evt);}return true;};_pSpin.on_fire_onspin=function(obj,pretext,prevalue,posttext,postvalue,isUp){if(this.onspin&&this.onspin._has_handlers){var evt=new nexacro.SpinEventInfo(obj,"onspin",pretext,prevalue,posttext,postvalue,isUp);return this.onspin._fireCheckEvent(this,evt);}return true;};_pSpin._recalcLayout=function(){if(this._is_created_contents){var spinedit=this.spinedit;var spinupbutton=this.spinupbutton;var spindownbutton=this.spindownbutton;var client_width=this._getClientWidth();var client_height=this._getClientHeight();var buttonsize_w=this.buttonsize;if(buttonsize_w==null){buttonsize_w=client_height;}else if(buttonsize_w>client_width){buttonsize_w=client_width;}var buttonsize_h=Math.floor(client_height/2);switch(this.type){case "spinonly":buttonsize_w=client_width;spinupbutton.move(0,0,buttonsize_w,buttonsize_h,null,null);spindownbutton.move(0,client_height-buttonsize_h,buttonsize_w,buttonsize_h,null,null);break;case "normal":case "noneditable":default:switch(this.buttonposition){case "left":spinedit.move(buttonsize_w,0,client_width-buttonsize_w,client_height,null,null);spinupbutton.move(0,0,buttonsize_w,buttonsize_h,null,null);spindownbutton.move(0,client_height-buttonsize_h,buttonsize_w,buttonsize_h,null,null);break;case "right":default:var w=client_width-buttonsize_w;spinedit.move(0,0,w,client_height,null,null);spinupbutton.move(w,0,buttonsize_w,buttonsize_h,null,null);spindownbutton.move(w,client_height-buttonsize_h,buttonsize_w,buttonsize_h,null,null);break;}break;}}};_pSpin._updateButton=function(){var control_elem=this.getElement();if(control_elem){var spinedit=this.spinedit;var spinupbutton=this.spinupbutton;var spindownbutton=this.spindownbutton;var v=spinedit.value;var max=this.max;var min=this.min;if(!this._isEnable()){spinedit._setEnable(false);spinupbutton._setEnable(false);spindownbutton._setEnable(false);}else{spinedit._setEnable(true);if(!this.circulation){if(nexacro._isNull(v)||this._isInvalidValue(v)){spindownbutton._setEnable(false);spinupbutton._setEnable(!this.readonly);}else{if(this.increment>=0){if(max>v){spinupbutton._setEnable(!this.readonly);}else{spinupbutton._setEnable(false);spinupbutton._changeStatus("mouseover",false);}if(min<v){spindownbutton._setEnable(!this.readonly);}else{spindownbutton._setEnable(false);spindownbutton._changeStatus("mouseover",false);}}else{if(max>v){spindownbutton._setEnable(!this.readonly);}else{spindownbutton._setEnable(false);spindownbutton._changeStatus("mouseover",false);}if(min<v){spinupbutton._setEnable(!this.readonly);}else{spinupbutton._setEnable(false);spinupbutton._changeStatus("mouseover",false);}}}}else{spinupbutton._setEnable(!this.readonly);spindownbutton._setEnable(!this.readonly);}}}};_pSpin._convertValueType=function(v,bapplyrule){var ret;if(v===""){ret=v;}else{if(bapplyrule){ret=nexacro.Component.prototype._convertValueType.call(this,v,2);}else{ret=nexacro._isNull(v)?v:parseFloat(v);}}return ret;};_pSpin._setValue=function(v){this.value=v;this.on_apply_value(v);this._updateButton();this._setDefaultProp();};_pSpin._setDefaultProp=function(){this._setDefaultValue();this._setDefaultText();};_pSpin._setDefaultValue=function(){this._default_value=this.value;};_pSpin._setDefaultText=function(){this._default_text=this.text;};_pSpin._setLocale=function(v){if(!this.locale&&v!=this._locale){this._locale=v;this.on_apply_locale(v);this.on_apply_value(this.value);this._setDefaultText();}};_pSpin._setEnableView=function(v){var spinedit=this.spinedit;if(spinedit){spinedit._setEnableView(v);}};_pSpin._setEventHandlerToCalendarEdit=function(){var spinedit=this.spinedit;if(spinedit){spinedit._setEventHandler("oneditclick",this._on_edit_oneditclick,this);spinedit._setEventHandler("onkeydown",this._on_edit_onkeydown,this);spinedit._setEventHandler("oninput",this._on_edit_oninput,this);}};_pSpin._setEventHandlerToSpinButtons=function(){var spinupbutton=this.spinupbutton;if(spinupbutton){spinupbutton._setEventHandler("onclick",this._on_upbutton_onclick,this);}var spindownbutton=this.spindownbutton;if(spindownbutton){spindownbutton._setEventHandler("onclick",this._on_downbutton_onclick,this);}};_pSpin._getMaskObj=function(){var spinedit=this.spinedit;if(spinedit){return spinedit._getMaskObj();}return null;};_pSpin._calcValue=function(val,inc,bAdd){var addConst=1;var strVal=val.toString();var strInc=inc.toString();var bPointVal=strVal.indexOf(".");var bPointInc=strInc.indexOf(".");if(bPointVal> -1||bPointInc> -1){var decVal=bPointVal> -1?strVal.substring(bPointVal+1,strVal.length):"";var decInc=bPointInc> -1?strInc.substring(bPointInc+1,strInc.length):"";var maxLength=decVal.length>=decInc.length?decVal.length:decInc.length;addConst=Math.pow(10,maxLength);val=Math.round(val*addConst);inc=Math.round(inc*addConst);}if(bAdd){return (val+inc)/addConst;}else{return (val-inc)/addConst;}};_pSpin._isInvalidValue=function(v){if(nexacro._isNull(v)||v===""){return false;}v=nexacro._toString(v);v=parseFloat(v.replace(/\,/g,''),10);if(!isFinite( +v)||isNaN( +v)){return true;}return false;};_pSpin._on_getDisplayText=function(){var spinedit=this.spinedit;if(spinedit){return spinedit._on_getDisplayText();}};delete _pSpin;nexacro._SpinEditControl=function(id,left,top,width,height,right,bottom,minwidth,maxwidth,minheight,maxheight,parent,onlydisplay){nexacro.MaskEdit.call(this,id,left,top,width,height,right,bottom,minwidth,maxwidth,minheight,maxheight,parent,onlydisplay);this._setControl();};var _pSpinEditControl=nexacro._createPrototype(nexacro.MaskEdit,nexacro._SpinEditControl);nexacro._SpinEditControl.prototype=_pSpinEditControl;_pSpinEditControl._is_subcontrol=true;_pSpinEditControl._getFromComponent=function(comp){var parent=comp.parent;if(parent&&parent._isPopupVisible()){return parent;}else{return nexacro.Component.prototype._getFromComponent.call(this,comp);}};_pSpinEditControl._isInvalidValue=function(v){return this.parent._isInvalidValue(v);};delete _pSpinEditControl;nexacro._SpinButtonControl=function(id,left,top,width,height,right,bottom,minwidth,maxwidth,minheight,maxheight,parent){nexacro.Button.call(this,id,left,top,width,height,right,bottom,minwidth,maxwidth,minheight,maxheight,parent);};var _pSpinButtonControl=nexacro._createPrototype(nexacro.Button,nexacro._SpinButtonControl);nexacro._SpinButtonControl.prototype=_pSpinButtonControl;_pSpinButtonControl._type_name="ButtonControl";_pSpinButtonControl._is_subcontrol=true;_pSpinButtonControl.on_focus_basic_action=function(self_flag,evt_name,lose_focus,refer_lose_focus,new_focus,refer_new_focus){var spin=this.parent;if(spin){{spin._apply_setfocus(evt_name);}}};delete _pSpinButtonControl;}
if(!nexacro.DatePickerControl){nexacro.DatePickerControl=function(id,left,top,width,height,right,bottom,minwidth,maxwidth,minheight,maxheight,parent){nexacro.Component.call(this,id,left,top,width,height,right,bottom,minwidth,maxwidth,minheight,maxheight,parent);};var _pDatePickerControl=nexacro._createPrototype(nexacro.Component,nexacro.DatePickerControl);nexacro.DatePickerControl.prototype=_pDatePickerControl;_pDatePickerControl._type_name="DatePickerControl";_pDatePickerControl.accessibilityrole="datepicker";_pDatePickerControl._is_subcontrol=true;_pDatePickerControl.head=null;_pDatePickerControl.body=null;_pDatePickerControl._selected_year="";_pDatePickerControl._selected_month="";_pDatePickerControl._selected_day="";_pDatePickerControl._use_readonly_status=true;_pDatePickerControl._is_locale_control=true;_pDatePickerControl._event_list={"onclick":1,"ondayclick":1,"onspin":1,"oncloseup":1};_pDatePickerControl.accessibilityrole="datepicker";_pDatePickerControl._has_accessibility_value=false;_pDatePickerControl.on_create_contents=function(){var control_elem=this.getElement();if(control_elem){var head=this.head=new nexacro._DatePickerHeadControl("head",0,0,0,0,null,null,null,null,null,null,this);var body=this.body=new nexacro._DatePickerBodyControl("body",0,0,0,0,null,null,null,null,null,null,this);head.createComponent(true);body.createComponent(true);}};_pDatePickerControl.on_created_contents=function(win){var control_elem=this.getElement();if(control_elem){var head=this.head;var body=this.body;head._setEventHandler("onclick",this._on_head_onheadclick,this);head._setEventHandler("onspin",this._on_head_onheadspin,this);head._setEventHandler("onkeydown",this._on_head_onkeydown,this);body._setEventHandler("ondayclick",this._on_body_ondayclick,this);body._setEventHandler("onkeydown",this._on_body_onkeydown,this);head.on_created(win);body.on_created(win);this._recalcLayout();}};_pDatePickerControl.on_create_contents_command=function(){var head=this.head;var body=this.body;var str="";if(head){str+=head.createCommand();}if(body){str+=body.createCommand();}return str;};_pDatePickerControl.on_attach_contents_handle=function(win){var head=this.head;var body=this.body;head._setEventHandler("onclick",this._on_head_onheadclick,this);head._setEventHandler("onspin",this._on_head_onheadspin,this);head._setEventHandler("onkeydown",this._on_head_onkeydown,this);body._setEventHandler("ondayclick",this._on_body_ondayclick,this);body._setEventHandler("onkeydown",this._on_body_onkeydown,this);body.attachHandle(win);head.attachHandle(win);this._recalcLayout();};_pDatePickerControl.on_destroy_contents=function(){if(this.head){this.head.destroy();this.head=null;}if(this.body){this.body.destroy();this.body=null;}};_pDatePickerControl.on_change_containerRect=function(width,height){this._recalcLayout();};_pDatePickerControl.on_apply_prop_enable=function(v){var head=this.head;var body=this.body;if(head){head._setEnable(v);}if(body){body._setEnable(v);}};_pDatePickerControl.set_readonly=function(v){v=nexacro._toBoolean(v);if(this.readonly!=v){this.readonly=v;this.on_apply_readonly(v);}};_pDatePickerControl.on_apply_readonly=function(readonly){this._changeStatus("readonly",readonly);var head=this.head;if(head){head.set_readonly(readonly);}var body=this.body;if(body){body.set_readonly(readonly);}};_pDatePickerControl._on_head_onkeydown=function(obj,e){var keycode=e.keycode;var enableaccessibility=nexacro._enableaccessibility;if((e.fromreferenceobject.id=="spinedit")&&keycode!=13){return;}this._changeDate(obj,e);if(!enableaccessibility){if(!(obj instanceof nexacro._CalendarEditControl)&&(keycode==13||keycode==37||keycode==38||keycode==39||keycode==40)){this.on_fire_ondayclick(obj);}}};_pDatePickerControl._on_head_onheadclick=function(obj,e){if(!this.enable||this.readonly){return false;}var head=this.head;var body=this.body;body._setDate(head._date.str_year,head._date.str_month,body._date.str_day);};_pDatePickerControl._on_head_onheadspin=function(obj,e){if(!this.enable||this.readonly==true){return false;}var head=this.head;var body=this.body;body._setDate(head._date.str_year,head._date.str_month,body._date.str_day);};_pDatePickerControl._on_body_ondayclick=function(obj,e){this.on_fire_ondayclick(obj,e);};_pDatePickerControl._on_body_onkeydown=function(obj,e){var keycode=e.keycode;var enableaccessibility=nexacro._enableaccessibility;this._changeDate(obj,e);if(!enableaccessibility){if(!(obj instanceof nexacro._CalendarEditControl)&&(keycode==37||keycode==38||keycode==39||keycode==40)){this.on_fire_ondayclick(obj);}}};_pDatePickerControl.on_lbuttondown_basic_action=function(elem,button,alt_key,ctrl_key,shift_key,canvasX,canvasY,screenX,screenY,refer_comp){var control_name=refer_comp.name;if(control_name=="head"||control_name=="prevbutton"||control_name=="nextbutton"||control_name=="body"||control_name=="weekband"||control_name.indexOf("weekitem")> -1||control_name.indexOf("dayitem")> -1){this._refreshSpindate();}};_pDatePickerControl.on_touchend_basic_action=function(touch_manager,touchinfos,changedtouchinfos,refer_comp){var control_name=refer_comp.name;if(control_name=="head"||control_name=="prevbutton"||control_name=="nextbutton"||control_name=="body"||control_name=="weekband"||control_name.indexOf("weekitem")> -1||control_name.indexOf("dayitem")> -1){this._refreshSpindate();}};_pDatePickerControl.on_fire_oncloseup=function(obj){if(this.oncloseup&&this.oncloseup._has_handlers){return this.oncloseup._fireEvent(this);}return false;};_pDatePickerControl.on_fire_ondayclick=function(obj,e){if(this.ondayclick&&this.ondayclick._has_handlers){if(!e){var item=this.body._getDayItem(this._selected_day);e=new nexacro.CalendarDayClickEventInfo(item,"ondayclick",this._value);}return this.ondayclick._fireEvent(this,e);}return false;};_pDatePickerControl._on_button_onnextlbuttondown=function(){var head=this.head;if(!head.enable||head.readonly){return false;}var year=head._date.int_year;var month=head._date.int_month;if((month+=1)>12){month=1;if((year+=1)>9999){year=0;}}head._setDate(year,month);head._refreshSpindate();this._on_head_onheadclick();};_pDatePickerControl._on_button_onprevlbuttondown=function(){var head=this.head;if(!head.enable||head.readonly){return false;}var year=head._date.int_year;var month=head._date.int_month;if((month-=1)<=0){month=12;if((year-=1)<0){year=9999;}}head._setDate(year,month);head._refreshSpindate();this._on_head_onheadclick();};_pDatePickerControl._setValue=function(v){this._value=v;this.on_apply_value(v);};_pDatePickerControl.on_apply_value=function(value){var year=value.substr(0,4);var month=value.substr(4,2);var day=value.substr(6,2);this._selected_year=year;this._selected_month=month;this._selected_day=day;var head=this.head;if(head){head._setDate(year,month);head._recalcLayout();}var body=this.body;if(body){body._setDate(year,month,day);}};_pDatePickerControl._setHeadformatText=function(){var head=this.head;if(head){head._setDate(head._date.str_year,head._date.str_month);head._recalcLayout();}};_pDatePickerControl._setWeekformatText=function(){var body=this.body;if(body){body._setWeekformatText();}};_pDatePickerControl._getInnerDataset=function(){var calendar=this.parent;if(calendar){return calendar.getInnerDataset();}return null;};_pDatePickerControl._getBackgroundcolumn=function(){var calendar=this.parent;if(calendar){return calendar.backgroundcolumn;}return null;};_pDatePickerControl._getBordercolumn=function(){var calendar=this.parent;if(calendar){return calendar.bordercolumn;}return null;};_pDatePickerControl._getDatecolumn=function(){var calendar=this.parent;if(calendar){return calendar.datecolumn;}return null;};_pDatePickerControl._getTextcolorcolumn=function(){var calendar=this.parent;if(calendar){return calendar.textcolorcolumn;}return null;};_pDatePickerControl._getHeadheight=function(){var calendar=this.parent;if(calendar){return calendar.headheight;}return null;};_pDatePickerControl._getDaysize=function(){var calendar=this.parent;if(calendar){return calendar.daysize;}return "";};_pDatePickerControl._getHeadformat=function(){var calendar=this.parent;if(calendar){return calendar.headformat;}return null;};_pDatePickerControl._getWeekformat=function(){var calendar=this.parent;if(calendar){return calendar.weekformat;}return null;};_pDatePickerControl._getUsetrailingday=function(){var calendar=this.parent;if(calendar){return calendar.usetrailingday;}return false;};_pDatePickerControl._getShowmonthspin=function(){var calendar=this.parent;if(calendar){return calendar.showmonthspin;}return false;};_pDatePickerControl._getShowyearspin=function(){var calendar=this.parent;if(calendar){return calendar.showyearspin;}return false;};_pDatePickerControl._getCurrentDate=function(){var calendar=this.parent;if(calendar){return calendar._getCurrentDate();}return "";};_pDatePickerControl._getEndDay=function(year,month){var calendar=this.parent;if(calendar){return calendar._getEndDay(year,month);}return "";};_pDatePickerControl._changeDate=function(obj,e){var body=this.body;var body_date=body._date;var year=body_date.int_year;var month=body_date.int_month;var day=body_date.int_day;var endday=this._getEndDay(year,month);var is_full_changed=false;var inc_month=false;var inc_day=false;var dec_month=false;var dec_day=false;var enableaccessibility=nexacro._enableaccessibility;var keycode=e.keycode;if(keycode==37||keycode==38||keycode==39||keycode==40||keycode==13){switch(keycode){case 13:var date=new nexacro.Date(year,month-1,day);year=date.getFullYear();month=date.getMonth()+1;day=date.getDate();break;case 37:if(e.ctrlkey){dec_month=true;}else{dec_day=true;}if(dec_day){day-=1;if(day<=0){dec_month=true;}}if(dec_month){month-=1;if(month<=0){if(year<=0){year=9999;}else{year-=1;}month=12;}if(!e.ctrlkey){day+=this._getEndDay(year,month);}is_full_changed=true;}break;case 38:if(e.ctrlkey){year-=1;is_full_changed=true;}else if(!enableaccessibility){day-=7;if(day<=0){if(month<=1){month=12;if(year<=0){year=9999;}else{year-=1;}}else{month-=1;}day+=this._getEndDay(year,month);}}break;case 39:if(e.ctrlkey){inc_month=true;}else{inc_day=true;}if(inc_day){day+=1;if(day>endday){inc_month=true;}}if(inc_month){month+=1;if(month>12){if(year>=9999){year=0;}else{year+=1;}month=1;}if(inc_day){day-=endday;}is_full_changed=true;}break;case 40:if(e.ctrlkey){year+=1;is_full_changed=true;}else if(!enableaccessibility){day+=7;if(day>endday){if(month>=12){month=1;if(year>=9999){year=0;}else{year+=1;}}else{month+=1;}day-=endday;}}break;}year=nexacro._toString(year).padLeft(4,"0");month=nexacro._toString(month).padLeft(2,"0");day=nexacro._toString(day).padLeft(2,"0");this._setValue(year+month+day);if(nexacro._enableaccessibility){if(is_full_changed){var item=this.body._getDayItem(this._selected_day);item._setAccessibilityLabel(year+" "+month+" "+day);}var calendar=this.parent;if(calendar){var calendaredit=calendar.calendaredit;calendaredit._setAccessibilityLabel(is_full_changed?year+" "+month+" "+day:day);}}}if(enableaccessibility){if(keycode==13){this.on_fire_ondayclick(obj);}else if(keycode==27){this.parent._closePopup();}}};_pDatePickerControl._recalcLayout=function(){if(this._is_created_contents){var headheight=this._getHeadheight();var client_width=this._getClientWidth();var client_height=this._getClientHeight();if(!headheight){headheight=client_height/8;}var body_l=0;var body_t=0+headheight;var body_w=client_width;var body_h=client_height-headheight;var head_l=0;var head_t=0;var head_w=client_width;var head_h=headheight;this.body.move(body_l,body_t,body_w,body_h,null,null);this.head.move(head_l,head_t,head_w,head_h,null,null);}};_pDatePickerControl._refreshSpindate=function(){var head=this.head;if(this._is_created){if(head){head._refreshSpindate();}}};_pDatePickerControl._refreshDay=function(){var body=this.body;if(this._is_created){if(body){body._refreshDay();}}};_pDatePickerControl._on_beforerepeat=function(refer_comp){var head=this.head;if(head){return head._on_beforerepeat(refer_comp);}};delete _pDatePickerControl;nexacro._DatePickerHeadControl=function(id,left,top,width,height,right,bottom,minwidth,maxwidth,minheight,maxheight,parent){nexacro.Component.call(this,id,left,top,width,height,right,bottom,minwidth,maxwidth,minheight,maxheight,parent);this._date={str_year:"",str_month:"",int_year:0,int_month:0};};var _pDatePickerHeadControl=nexacro._createPrototype(nexacro.Component,nexacro._DatePickerHeadControl);nexacro._DatePickerHeadControl.prototype=_pDatePickerHeadControl;_pDatePickerHeadControl._type_name="DatePickerHeadControl";_pDatePickerHeadControl._is_subcontrol=true;_pDatePickerHeadControl.prevbutton=null;_pDatePickerHeadControl.nextbutton=null;_pDatePickerHeadControl.yearstatic=null;_pDatePickerHeadControl.monthstatic=null;_pDatePickerHeadControl.yearspin=null;_pDatePickerHeadControl.monthspin=null;_pDatePickerHeadControl._use_readonly_status=true;_pDatePickerHeadControl._event_list={"onclick":1,"onspin":1,"onkeydown":1};_pDatePickerHeadControl.on_create_contents=function(){var prevbutton=this.prevbutton=new nexacro.Button("prevbutton",0,0,0,0,null,null,null,null,null,null,this);var nextbutton=this.nextbutton=new nexacro.Button("nextbutton",0,0,0,0,null,null,null,null,null,null,this);var yearstatic=this.yearstatic=new nexacro.Static("yearstatic",0,0,0,0,null,null,null,null,null,null,this);var monthstatic=this.monthstatic=new nexacro.Static("monthstatic",0,0,0,0,null,null,null,null,null,null,this);var yearspin=this.yearspin=new nexacro._YearSpinControl("yearspin",0,0,0,0,null,null,null,null,null,null,this);var monthspin=this.monthspin=new nexacro._MonthSpinControl("monthspin",0,0,0,0,null,null,null,null,null,null,this);prevbutton._setControl();nextbutton._setControl();yearstatic._setControl();monthstatic._setControl();yearspin._setControl();monthspin._setControl();prevbutton.createComponent(true);nextbutton.createComponent(true);yearstatic.createComponent(true);monthstatic.createComponent(true);yearspin.createComponent(true);monthspin.createComponent(true);yearspin.set_visible(false);yearspin.set_min("0");yearspin.set_max("9999");yearspin.set_circulation(true);yearspin.set_displaycomma(false);monthspin.set_visible(false);monthspin.set_min("1");monthspin.set_max("12");monthspin.set_circulation(true);monthspin.set_displaycomma(false);};_pDatePickerHeadControl.on_created_contents=function(win){this.on_apply_prop_enable(this.enable);var prevbutton=this.prevbutton;var nextbutton=this.nextbutton;var yearstatic=this.yearstatic;var monthstatic=this.monthstatic;var yearspin=this.yearspin;var monthspin=this.monthspin;if(nexacro._isTouchInteraction&&nexacro._SupportTouch){yearstatic._setEventHandler("onclick",this._on_static_mobile_onclick,this);monthstatic._setEventHandler("onclick",this._on_static_mobile_onclick,this);}yearstatic._setEventHandler("onlbuttondown",this._on_static_onlbuttondown,this);monthstatic._setEventHandler("onlbuttondown",this._on_static_onlbuttondown,this);prevbutton._setEventHandler("onclick",this._on_button_onprevclick,this);nextbutton._setEventHandler("onclick",this._on_button_onnextclick,this);yearspin._setEventHandler("onspin",this._on_spin_onspin,this);monthspin._setEventHandler("onspin",this._on_spin_onspin,this);yearspin._setEventHandler("onkeydown",this._on_spin_onkeydown,this);monthspin._setEventHandler("onkeydown",this._on_spin_onkeydown,this);prevbutton.on_created(win);nextbutton.on_created(win);yearstatic.on_created(win);monthstatic.on_created(win);yearspin.on_created(win);monthspin.on_created(win);yearspin.set_value(this._date.str_year);monthspin.set_value(this._date.str_month);if(this.parent._is_popupcontains){yearspin._setEnableView(false);monthspin._setEnableView(false);}this._refreshSpindate();};_pDatePickerHeadControl.on_create_contents_command=function(){this._refreshSpindate();var str="";if(this.prevbutton){str+=this.prevbutton.createCommand();}if(this.nextbutton){str+=this.nextbutton.createCommand();}if(this.yearstatic){str+=this.yearstatic.createCommand();}if(this.monthstatic){str+=this.monthstatic.createCommand();}if(this.yearspin){str+=this.yearspin.createCommand();}if(this.monthspin){str+=this.monthspin.createCommand();}return str;};_pDatePickerHeadControl.on_attach_contents_handle=function(win){var prevbutton=this.prevbutton;var nextbutton=this.nextbutton;var yearstatic=this.yearstatic;var monthstatic=this.monthstatic;var yearspin=this.yearspin;var monthspin=this.monthspin;if(nexacro._isTouchInteraction&&nexacro._SupportTouch){yearstatic._setEventHandler("onclick",this._on_static_mobile_onclick,this);monthstatic._setEventHandler("onclick",this._on_static_mobile_onclick,this);}yearstatic._setEventHandler("onlbuttondown",this._on_static_onlbuttondown,this);monthstatic._setEventHandler("onlbuttondown",this._on_static_onlbuttondown,this);prevbutton._setEventHandler("onclick",this._on_button_onprevclick,this);nextbutton._setEventHandler("onclick",this._on_button_onnextclick,this);yearspin._setEventHandler("onspin",this._on_spin_onspin,this);monthspin._setEventHandler("onspin",this._on_spin_onspin,this);yearspin._setEventHandler("onkeydown",this._on_spin_onkeydown,this);monthspin._setEventHandler("onkeydown",this._on_spin_onkeydown,this);prevbutton.attachHandle(win);nextbutton.attachHandle(win);yearstatic.attachHandle(win);monthstatic.attachHandle(win);yearspin.attachHandle(win);monthspin.attachHandle(win);yearspin.set_value(this._date.str_year);monthspin.set_value(this._date.str_month);if(this.parent._is_popupcontains){yearspin._setEnableView(false);monthspin._setEnableView(false);}};_pDatePickerHeadControl.on_destroy_contents=function(){this._date=null;if(this.prevbutton){this.prevbutton.destroy();this.prevbutton=null;}if(this.nextbutton){this.nextbutton.destroy();this.nextbutton=null;}if(this.yearstatic){this.yearstatic.destroy();this.yearstatic=null;}if(this.monthstatic){this.monthstatic.destroy();this.monthstatic=null;}if(this.yearspin){this.yearspin.destroy();this.yearspin=null;}if(this.monthspin){this.monthspin.destroy();this.monthspin=null;}};_pDatePickerHeadControl.on_change_containerRect=function(widht,height){this._recalcLayout();};_pDatePickerHeadControl.on_apply_prop_enable=function(v){if(this.prevbutton){this.prevbutton._setEnable(v);}if(this.nextbutton){this.nextbutton._setEnable(v);}if(this.yearstatic){this.yearstatic._setEnable(v);}if(this.monthstatic){this.monthstatic._setEnable(v);}if(this.yearspin){this.yearspin._setEnable(v);}if(this.monthspin){this.monthspin._setEnable(v);}};_pDatePickerHeadControl.set_readonly=function(v){v=nexacro._toBoolean(v);if(this.readonly!=v){this.readonly=v;this.on_apply_readonly(v);}};_pDatePickerHeadControl.on_apply_readonly=function(readonly){this._changeStatus("readonly",readonly);var control_elem=this.getElement();if(control_elem){var yearspin=this.yearspin;if(yearspin){yearspin.set_readonly(readonly);}var monthspin=this.monthspin;if(monthspin){monthspin.set_readonly(readonly);}}};_pDatePickerHeadControl._on_static_mobile_onclick=function(obj,e){var yearstatic=this.yearstatic;var monthstatic=this.monthstatic;var yearspin=this.yearspin;var monthspin=this.monthspin;var control_name=obj.name;if(control_name=="yearstatic"){yearstatic.set_visible(false);yearspin.set_visible(true);}else if(control_name=="monthstatic"){monthstatic.set_visible(false);monthspin.set_visible(true);}};_pDatePickerHeadControl._on_static_onlbuttondown=function(obj,e){var yearstatic=this.yearstatic;var monthstatic=this.monthstatic;var yearspin=this.yearspin;var monthspin=this.monthspin;var comp_name=obj.name;if(comp_name=="yearstatic"){yearstatic.set_visible(false);yearspin.set_visible(true);}else if(comp_name=="monthstatic"){monthstatic.set_visible(false);monthspin.set_visible(true);}};_pDatePickerHeadControl._on_button_onprevclick=function(obj,e){if(!this.enable||this.readonly){return false;}var year=this._date.int_year;var month=this._date.int_month;if((month-=1)<=0){month=12;if((year-=1)<0){year=9999;}}this._setDate(year,month);this._refreshSpindate();this.on_fire_onclick(e.button,e.alt_key,e.ctrl_key,e.shift_key,e.screenX,e.screenY,e.canvasX,e.canvasY,e.clientX,e.clientY,this,obj);};_pDatePickerHeadControl._on_button_onnextclick=function(obj,e){if(!this.enable||this.readonly){return false;}var year=this._date.int_year;var month=this._date.int_month;if((month+=1)>12){month=1;if((year+=1)>9999){year=0;}}this._setDate(year,month);this._refreshSpindate();this.on_fire_onclick(e.button,e.alt_key,e.ctrl_key,e.shift_key,e.screenX,e.screenY,e.canvasX,e.canvasY,e.clientX,e.clientY,this,obj);};_pDatePickerHeadControl._on_spin_onspin=function(obj,e){var v=nexacro._toString(e.postvalue);var year=this._date.str_year;var month=this._date.str_month;var control_name=obj.name;if(control_name=="yearspin"){year=v;}else if(control_name=="monthspin"){month=v;}this._setDate(year,month);this.on_fire_onspin(obj,e);};_pDatePickerHeadControl._on_spin_onkeydown=function(obj,e){if(e.keycode==nexacro.Event.KEY_ENTER){var year=this._date.str_year;var month=this._date.str_month;var control_name=obj.name;if(control_name=="yearspin"){year=obj.text;}else if(control_name=="monthspin"){month=obj.text;}this._setDate(year,month);this.on_fire_onspin(obj,e);}};_pDatePickerHeadControl.on_fire_onspin=function(obj,preText,preValue,postText,postValue,isUp){if(this.onspin&&this.onspin._has_handlers){var evt=new nexacro.SpinEventInfo(obj,"onspin",preText,preValue,postText,postValue,isUp);return this.onspin._fireEvent(this,evt);}return true;};_pDatePickerHeadControl._refreshSpindate=function(){var yearstatic=this.yearstatic;var monthstatic=this.monthstatic;var yearspin=this.yearspin;var monthspin=this.monthspin;if(yearstatic||monthstatic){var bShowyear=this._getShowyearspin();var bShowmonth=this._getShowmonthspin();if(bShowyear){if(bShowmonth){yearstatic.set_visible(false);monthstatic.set_visible(false);yearspin.set_visible(true);monthspin.set_visible(true);}else{yearstatic.set_visible(false);monthstatic.set_visible(true);yearspin.set_visible(true);monthspin.set_visible(false);}}else{if(bShowmonth){yearstatic.set_visible(true);monthstatic.set_visible(false);yearspin.set_visible(false);monthspin.set_visible(true);}else{yearstatic.set_visible(true);monthstatic.set_visible(true);yearspin.set_visible(false);monthspin.set_visible(false);}}}};_pDatePickerHeadControl._recalcLayout=function(){if(this._is_created_contents){var headformat=this._getHeadformat();var client_w=this._getClientWidth();var client_h=this._getClientHeight();var year_size=0,year_l=0,year_w=0;var month_size=0,month_l=0,month_w=0;var prevbutton=this.prevbutton;if(prevbutton){prevbutton.move(0,0,client_h,client_h,null,null);}var nextbutton=this.nextbutton;if(nextbutton){nextbutton.move(client_w-client_h,0,client_h,client_h,null,null);}var yearstatic=this.yearstatic;if(yearstatic){year_size=yearstatic._on_getFitSize();year_w=year_size[0];}var monthstatic=this.monthstatic;if(monthstatic){month_size=monthstatic._on_getFitSize();month_w=month_size[0];}var offset_x=((client_w/2)-((year_w+month_w)/2));if(headformat=="MM.yyyy"){month_l=offset_x;year_l=offset_x+month_w;}else{year_l=offset_x;month_l=offset_x+year_w;}if(yearstatic){yearstatic.move(year_l,0,year_w,client_h,null,null);}if(monthstatic){monthstatic.move(month_l,0,month_w,client_h,null,null);}var yearspin=this.yearspin;if(yearspin){year_size=this._getSpinControlSize("year");year_w=year_size+client_h;}var monthspin=this.monthspin;if(monthspin){month_size=this._getSpinControlSize("month");month_w=month_size+client_h;}offset_x=((client_w/2)-((year_w+month_w)/2));if(headformat=="MM.yyyy"){month_l=offset_x;year_l=offset_x+month_w;}else{year_l=offset_x;month_l=offset_x+year_w;}if(yearspin){yearspin.move(year_l,0,year_w,client_h,null,null);}if(monthspin){monthspin.move(month_l,0,month_w,client_h,null,null);}}};_pDatePickerHeadControl._on_beforerepeat=function(refer_comp){if(refer_comp==this.prevbutton||refer_comp==this.nextbutton||refer_comp instanceof nexacro._SpinButtonControl){return [true,true];}return [false,true];};_pDatePickerHeadControl._setDate=function(year,month){var date=this._date;if(date){date.str_year=nexacro._toString(year).padLeft(4,"0");date.str_month=nexacro._toString(month).padLeft(2,"0");date.int_year= +year;date.int_month= +month;}var yearstatic=this.yearstatic;var yearspin=this.yearspin;var monthstatic=this.monthstatic;var monthspin=this.monthspin;if(this._getHeadformat()=="MM.yyyy"){yearstatic.set_text(date.str_year);monthstatic.set_text(date.str_month+".");}else{yearstatic.set_text(date.str_year+".");monthstatic.set_text(date.str_month);}yearspin.set_value(date.str_year);monthspin.set_value(date.str_month);};_pDatePickerHeadControl._getHeadheight=function(){var datepicker=this.parent;if(datepicker){return datepicker._getHeadheight();}return null;};_pDatePickerHeadControl._getHeadformat=function(){var datepicker=this.parent;if(datepicker){return datepicker._getHeadformat();}return null;};_pDatePickerHeadControl._getShowyearspin=function(){var calendar=this.parent;if(calendar){return calendar._getShowyearspin();}return null;};_pDatePickerHeadControl._getShowmonthspin=function(){var datepicker=this.parent;if(datepicker){return datepicker._getShowmonthspin();}return null;};_pDatePickerHeadControl._getSpinControlSize=function(type){var control;switch(type){case "year":control=this.yearspin;break;case "month":control=this.monthspin;break;}var total_w=0;if(control){var border=control._getCurrentStyleBorder();if(border){total_w+=border._getBorderWidth();}var padding=control._getCurrentStylePadding();if(padding){total_w+=padding.left+padding.right;}var spinedit=control.spinedit;if(spinedit){var tmp=spinedit.text;if(tmp.length==1){spinedit.text+=".0";}else{spinedit.text+=".";}total_w+=spinedit._on_getFitSize()[0];spinedit.text=tmp;}}return total_w;};nexacro._DatePickerBodyControl=function(id,left,top,width,height,right,bottom,minwidth,maxwidth,minheight,maxheight,parent){nexacro.Component.call(this,id,left,top,width,height,right,bottom,minwidth,maxwidth,minheight,maxheight,parent);this._weekitems=[];this._dayitems=[];this._changedDays=[];this._date={str_year:"",str_month:"",str_day:"",int_year:0,int_month:0,int_day:0};};var _pDatePickerBodyControl=nexacro._createPrototype(nexacro.Component,nexacro._DatePickerBodyControl);nexacro._DatePickerBodyControl.prototype=_pDatePickerBodyControl;_pDatePickerBodyControl._type_name="DatePickerBodyControl";_pDatePickerBodyControl.weekband=null;_pDatePickerBodyControl._preday="";_pDatePickerBodyControl._maxWeek=7;_pDatePickerBodyControl._maxDay=42;_pDatePickerBodyControl._is_subcontrol=true;_pDatePickerBodyControl._use_readonly_status=true;_pDatePickerBodyControl._is_locale_control=true;_pDatePickerBodyControl._event_list={"onclick":1,"ondayclick":1,"onkeydown":1};_pDatePickerBodyControl.on_create_contents=function(){var control_elem=this.getElement();if(control_elem){var weekband=this.weekband=new nexacro.Static("weekband",0,0,0,0,null,null,null,null,null,null,this);weekband._setControl();weekband.createComponent(true);var weekformat=this._getWeekformat();var weeks=this._weekitems;var days=this._dayitems;var maxWeek=this._maxWeek;var maxDay=this._maxDay;var weekstatic,daystatic;for(var i=0;i<maxWeek;i++ ){weekstatic=weeks[i]=new nexacro._DatePickerWeekItemControl("weekitem"+i,0,0,0,0,null,null,null,null,null,null,this);weekstatic.set_text(weekformat[i]);weekstatic._setDaysOfWeek(i%7);weekstatic.createComponent(true);}for(i=0;i<maxDay;i++ ){daystatic=days[i]=new nexacro._DatePickerDayItemControl("dayitem"+i,0,0,0,0,null,null,null,null,null,null,this);daystatic._setDaysOfWeek(i%7);daystatic.createComponent(true);}}};_pDatePickerBodyControl.on_created_contents=function(win){var control_elem=this.getElement();if(control_elem){var weeks=this._weekitems;var days=this._dayitems;var maxWeek=this._maxWeek;var maxDay=this._maxDay;this.weekband.on_created(win);for(var i=0;i<maxWeek;i++ ){weeks[i].on_created(win);}for(i=0;i<maxDay;i++ ){days[i]._setEventHandler("onclick",this._on_dayitem_ondayclick,this);days[i].on_created(win);}}};_pDatePickerBodyControl.on_create_contents_command=function(){var weekband=this.weekband;var weeks=this._weekitems;var days=this._dayitems;var maxWeek=this._maxWeek;var maxDay=this._maxDay;var str="";str+=weekband.createCommand();for(var i=0;i<maxWeek;i++ ){str+=weeks[i].createCommand();}for(i=0;i<maxDay;i++ ){str+=days[i].createCommand();}return str;};_pDatePickerBodyControl.on_attach_contents_handle=function(win){var weekband=this.weekband;var weeks=this._weekitems;var days=this._dayitems;var maxWeek=this._maxWeek;var maxDay=this._maxDay;weekband.attachHandle(win);for(var i=0;i<maxWeek;i++ ){weeks[i].attachHandle(win);}for(i=0;i<maxDay;i++ ){days[i]._setEventHandler("onclick",this._on_dayitem_ondayclick,this);days[i].attachHandle(win);}};_pDatePickerBodyControl.on_destroy_contents=function(){if(this.weekband){this.weekband.destroy();this.weekband=null;}var weeks=this._weekitems;var days=this._dayitems;var maxWeek=this._maxWeek;var maxDay=this._maxDay;for(var i=0;i<maxWeek;i++ ){weeks[i].destroy();}for(i=0;i<maxDay;i++ ){days[i].destroy();}this._weekitems=null;this._dayitems=null;this._changedDays=null;this._date=null;};_pDatePickerBodyControl.on_change_containerRect=function(width,height){this._recalcLayout();};_pDatePickerBodyControl.on_apply_prop_enable=function(enable){var i;var weeks=this._weekitems;var days=this._dayitems;var maxWeek=this._maxWeek;var maxDay=this._maxDay;if(this.weekband){this.weekband._setEnable(enable);}for(i=0;i<maxWeek;i++ ){weeks[i]._setEnable(enable);}for(i=0;i<maxDay;i++ ){days[i]._setEnable(enable);}};_pDatePickerBodyControl.set_readonly=function(v){v=nexacro._toBoolean(v);if(this.readonly!=v){this.readonly=v;this.on_apply_readonly(v);}};_pDatePickerBodyControl.on_apply_readonly=function(readonly){this._changeStatus("readonly",readonly);var weeks=this._weekitems;var days=this._dayitems;var maxWeek=this._maxWeek;var maxDay=this._maxDay;for(var i=0;i<maxWeek;i++ ){weeks[i].set_readonly(readonly);}for(i=0;i<maxDay;i++ ){days[i].set_readonly(readonly);}};_pDatePickerBodyControl._on_dayitem_ondayclick=function(obj,e){this.on_fire_ondayclick(obj,e);};_pDatePickerBodyControl.on_fire_ondayclick=function(obj,e){if(this.ondayclick&&this.ondayclick._has_handlers){return this.ondayclick._fireEvent(this,e);}return false;};_pDatePickerBodyControl._recalcLayout=function(){if(this._is_created_contents){var weeks=this._weekitems;var days=this._dayitems;var maxWeek=this._maxWeek;var maxDay=this._maxDay;var client_w=this._getClientWidth();var client_h=this._getClientHeight();var client_l=this._getClientLeft();var client_t=this._getClientTop();var daysize=this._getDaysize();var item_w=daysize.width;var item_h=daysize.height;var drawWidth_daysize=item_w*7;var drawHeight_daysize=item_h*7;var blankWidth=0;var blankHeight=0;if(drawWidth_daysize<client_w){blankWidth=(client_w-drawWidth_daysize)/14;}if(drawHeight_daysize<client_h){blankHeight=(client_h-drawHeight_daysize)/8;}var week_l=client_l+blankWidth;var week_t=client_t+(blankHeight/2);this.weekband.move(client_l,week_t,client_w,item_h,null,null);var i;for(i=0;i<maxWeek;i++ ){weeks[i].move(week_l,week_t,item_w,item_h,null,null);week_l=week_l+item_w+(blankWidth*2);}var day_l=client_l+blankWidth;var day_t=week_t+item_h+blankHeight;for(i=0;i<maxDay;i++ ){days[i].move(day_l,day_t,item_w,item_h,null,null);day_l=day_l+item_w+(blankWidth*2);if(((i+1)%7)==0){day_l=client_l+blankWidth;day_t=day_t+item_h+blankHeight;}}}};_pDatePickerBodyControl._refreshDay=function(){var day,control_elem=this.getElement();if(control_elem){var dayInfo={};var trailingdayinfo={};var date=this._date;var year=date.int_year;var month=date.int_month;day=date.int_day;var tempDate=new Date(year,month-1,1);if(year<100){tempDate.setFullYear(year);}var N=nexacro.Calendar.EndDayNormal;var L=nexacro.Calendar.EndDayLeap;var firstDay=tempDate.getDay();var endDay=this._getLeapYear(year)?L[month-1]:N[month-1];var usetrailingday=this._getUsetrailingday();if(usetrailingday){trailingdayinfo=this._getUseTrailingDayInfo(year,month,tempDate,endDay);}var days=this._dayitems;var maxDay=this._maxDay;var dayCount=1;var daysofweek= -1;for(var i=0;i<maxDay;i++ ){if(firstDay<=i&&endDay>=dayCount){dayInfo=this._getDayInfo(dayCount,false,true,year,month);this._setDayItemInfo(days[i],dayInfo.text,dayInfo.visible,dayInfo.year,dayInfo.month,dayInfo.trailingday);daysofweek=i%7;if(daysofweek==0){days[i]._changeUserStatus("sunday",true);}else if(daysofweek==6){days[i]._changeUserStatus("saturday",true);}else{if(this._isToday(dayInfo.day)){days[i]._changeUserStatus("today",true);}else{days[i]._changeUserStatus("day",true);}}dayCount++ ;}else{if(usetrailingday){if(trailingdayinfo.idx>=0){dayInfo=this._getDayInfo(trailingdayinfo.pre_endDay-trailingdayinfo.idx,true,true,trailingdayinfo.prev_year,trailingdayinfo.prev_month);trailingdayinfo.idx-- ;}else{dayInfo=this._getDayInfo(trailingdayinfo.next_beginDay,true,true,trailingdayinfo.next_year,trailingdayinfo.next_month);trailingdayinfo.next_beginDay++ ;trailingdayinfo.endWeek++ ;}this._setDayItemInfo(days[i],dayInfo.text,dayInfo.visible,dayInfo.year,dayInfo.month,dayInfo.trailingday);days[i]._changeUserStatus("trailingday",true);}else{dayInfo=this._getDayInfo("",false,false,"","");this._setDayItemInfo(days[i],dayInfo.text,dayInfo.visible,dayInfo.year,dayInfo.month,dayInfo.trailingday);}}}}this._initChangedDays();var dataset=this._getInnerDataset();if(dataset){this._setDatasetStyle(dataset);}if(this._isSelectedDay(day)){this._on_apply_day(true);}else{this._on_apply_day(false);}this._setCalendarAccessibility();};_pDatePickerBodyControl._on_apply_day=function(flag){var preDay=this._preday;var currDay=this._date.str_day;var predayObj=this._getDayItem(preDay);var dayObj=this._getDayItem(currDay);this._preday=currDay;if(predayObj){predayObj._changeUserStatus("selected",false);if(predayObj._daysofweek==6){predayObj._changeUserStatus("saturday",true);}else if(predayObj._daysofweek==0){predayObj._changeUserStatus("sunday",true);}else{predayObj._changeUserStatus("day",true);}}if(dayObj){if(flag){dayObj._changeUserStatus("selected",true);}else{dayObj._changeUserStatus("selected",false);if(dayObj._daysofweek==6){dayObj._changeUserStatus("saturday",true);}else if(dayObj._daysofweek==0){dayObj._changeUserStatus("sunday",true);}else{dayObj._changeUserStatus("day",true);}}}var currtDate=new Date();var today=currtDate.getDate();if(this._isToday(today)){today=nexacro._toString(today).padLeft(2,"0");var todayObj=this._getDayItem(today);if(flag){if(todayObj!=dayObj){todayObj._changeUserStatus("today",true);}}else{todayObj._changeUserStatus("today",true);}}};_pDatePickerBodyControl._initChangedDays=function(){var len=this._changedDays.length;for(var i=(len-1);i>=0;i-- ){this._changedDays[i].set_background(null);this._changedDays[i].set_color(null);this._changedDays[i].set_border(null);this._changedDays.pop();}};_pDatePickerBodyControl._setDate=function(year,month,day){var date=this._date;if(date.str_year!=(year=year.padLeft(4,"0"))){date.str_year=year;date.int_year= +year;}if(date.str_month!=(month=month.padLeft(2,"0"))){date.str_month=month;date.int_month= +month;}if(date.str_day!=(day=day.padLeft(2,"0"))){this._preday=date.str_day;date.str_day=day;date.int_day= +day;}this._refreshDay();};_pDatePickerBodyControl._setDayItemInfo=function(day,text,visible,year,month,trailingday){day.set_text(text);day.set_wordWrap("none");day.set_visible(visible);day._year=year;day._month=month;day._trailingday=trailingday;};_pDatePickerBodyControl._setWeekformatText=function(){var control_elem=this.getElement();if(control_elem){var weekformat=this._getWeekformat();var weeks=this._weekitems;var weeks_len=weeks.length;for(var i=0;i<weeks_len;i++ ){weeks[i].set_text(weekformat[i]);}}};_pDatePickerBodyControl._setDatasetStyle=function(ds){var day_item,date;var day_items=this._dayitems;var maxDay=this._maxDay;var cols=this._getInnerDatasetColumns();var background,border,color;var rowCount=ds.getRowCount();for(var i=0;i<rowCount;i++ ){date=ds.getColumn(i,cols.datecolumn);for(var j=0;j<maxDay;j++ ){day_item=day_items[j];var currDate=day_item._year+day_item._month+day_item.text.padLeft(2,"0");if(currDate==date){background=ds.getColumn(i,cols.backgroundcolumn);border=ds.getColumn(i,cols.bordercolumn);color=ds.getColumn(i,cols.textcolorcolumn);if(background){day_item.set_background(background);}if(border){day_item.set_border(border);}if(color){day_item.set_color(color);}this._changedDays[this._changedDays.length]=day_item;}}}};_pDatePickerBodyControl._getLeapYear=function(year){if((year%4)==0&&(year%100)!=0||(year%400)==0){return true;}return false;};_pDatePickerBodyControl._getCurrentDate=function(){var datepicker=this.parent;if(datepicker){return datepicker._getCurrentDate();}return;};_pDatePickerBodyControl._getWeekformat=function(){var datepicker=this.parent;if(datepicker){var format=datepicker._getWeekformat();if(format){if(format===" "){return [" "," "," "," "," "," "," "];}else{return format.split(/\s+/);}}else{var locale=this._getLocale();var locale_info=nexacro.Locale.getLocaleInfo(locale);return locale_info.weekday_names_short;}}return null;};_pDatePickerBodyControl._getDaysize=function(){var width=0;var height=0;var datepicker=this.parent;if(datepicker){var size=datepicker._getDaysize();if(!size){size=(this._getClientWidth()/7)+" "+(this._getClientHeight()/7);}size=size.split(/\s+/);width= +size[0];height=size[1]? +size[1]:width;}return {width:width,height:height};};_pDatePickerBodyControl._getDayInfo=function(text,trailingday,visible,year,month){year=nexacro._toString(year);year=year?year.padLeft(4,"0"):"";month=nexacro._toString(month);month=month?month.padLeft(2,"0"):"";var day=nexacro._toString(text);day=day?day.padLeft(2,"0"):"";return {text:text,trailingday:trailingday,visible:visible,year:year,month:month,day:day};};_pDatePickerBodyControl._getDayItem=function(day){if(day== -1){return null;}var days=this._dayitems;var maxDay=this._maxDay;for(var i=0;i<maxDay;i++ ){if(!days[i]._trailingday&&day==days[i].text.padLeft(2,"0")){return days[i];}}return null;};_pDatePickerBodyControl._getUsetrailingday=function(){var datepicker=this.parent;if(datepicker){return datepicker._getUsetrailingday();}return null;};_pDatePickerBodyControl._getUseTrailingDayInfo=function(year,month,dateObj,endDay){var prev_year=year;var next_year=year;var prev_month=month;var next_month=month;if(month==1){prev_year-=1;prev_month=12;next_month+=1;}else{prev_month-=1;if(month==12){next_year+=1;next_month=1;}else{next_month+=1;}}var idx=dateObj.getDay()-1;dateObj.setDate(endDay);var endWeek=dateObj.getDay();var N=nexacro.Calendar.EndDayNormal;var L=nexacro.Calendar.EndDayLeap;var is_pre_leapyear=this._getLeapYear(prev_year);var pre_endDay=is_pre_leapyear?L[prev_month-1]:N[prev_month-1];var next_beginDay=1;return {prev_year:prev_year,next_year:next_year,prev_month:prev_month,next_month:next_month,endWeek:endWeek,idx:idx,pre_endDay:pre_endDay,next_beginDay:next_beginDay};};_pDatePickerBodyControl._getInnerDataset=function(){var datepicker=this.parent;if(datepicker){return datepicker._getInnerDataset();}return null;};_pDatePickerBodyControl._getInnerDatasetColumns=function(){var datepicker=this.parent;if(datepicker){var background=datepicker._getBackgroundcolumn();var border=datepicker._getBordercolumn();var date=datepicker._getDatecolumn();var textcolor=datepicker._getTextcolorcolumn();return {backgroundcolumn:background,bordercolumn:border,datecolumn:date,textcolorcolumn:textcolor};}return null;};_pDatePickerBodyControl._isToday=function(v){var year=this._date.int_year;var month=this._date.int_month;var day=parseInt(v,10);var currDate=this._getCurrentDate();if(year==currDate.year&&month==currDate.month&&day==currDate.day){return true;}return false;};_pDatePickerBodyControl._isSelectedDay=function(v){v=parseInt(v,10);var year=this._date.int_year;var month=this._date.int_month;if(year==this.parent._selected_year&&month==this.parent._selected_month&&v==this.parent._selected_day){return true;}return false;};_pDatePickerBodyControl._setCalendarAccessibility=function(){if(nexacro._enableaccessibility){var calendar=this.parent.parent;var date=this._date;var cal_value=date.str_year+date.str_month+date.str_day;var accessibility_value=calendar._masktypeobj.applyMask(cal_value);this.parent._setAccessibilityLabel(accessibility_value);this._setAccessibilityLabel(accessibility_value);nexacro._notifyAccessibilityValue(this._control_element,accessibility_value,"daychange");}};_pDatePickerBodyControl.on_get_accessibility_label=function(){var date=this._date;var cal_value=date.str_year+date.str_month+date.str_day;return cal_value;};delete _pDatePickerBodyControl;nexacro._DatePickerDayItemControl=function(id,left,top,width,height,right,bottom,minwidth,maxwidth,minheight,maxheight,parent){nexacro.Button.call(this,id,left,top,width,height,right,bottom,minwidth,maxwidth,minheight,maxheight,parent);this._flag_dataset= -1;this._dataset_background="";this._refObj=parent.parent;};var _pDatePickerDayItemControl=nexacro._createPrototype(nexacro.Button,nexacro._DatePickerDayItemControl);nexacro._DatePickerDayItemControl.prototype=_pDatePickerDayItemControl;_pDatePickerDayItemControl._type_name="DatePickerDayItemControl";_pDatePickerDayItemControl._is_subcontrol=true;_pDatePickerDayItemControl.accessibilityrole="gridcell";_pDatePickerDayItemControl._trailingday=false;_pDatePickerDayItemControl._year="";_pDatePickerDayItemControl._month="";_pDatePickerDayItemControl._daysofweek= -1;_pDatePickerDayItemControl._use_readonly_status=true;_pDatePickerDayItemControl.set_readonly=function(v){v=nexacro._toBoolean(v);if(v!=this.readonly){this.readonly=v;this.on_apply_readonly();}};_pDatePickerDayItemControl.on_apply_readonly=function(){var v=this.readonly;this._changeStatus("readonly",v);};_pDatePickerDayItemControl._setDaysOfWeek=function(daysofweek){if(this._daysofweek!=daysofweek){this._daysofweek=daysofweek;this._on_apply_daysofweek(daysofweek);}};_pDatePickerDayItemControl._on_apply_daysofweek=function(v){var text=v;if(text&&text.length>0){if(this.trailingday){this._changeUserStatus("trailingday",true);}else if(this.parent._isSelectedDay(text)){this._changeUserStatus("selected",true);}else if(this.parent._isToday(text)){this._changeUserStatus("today",true);}else if(this._daysofweek==6){this._changeUserStatus("saturday",true);}else if(this._daysofweek==0){this._changeUserStatus("sunday",true);}}};_pDatePickerDayItemControl.on_changeUserStatus=function(changestatus,value,applyuserstatus,currentstatus,currentuserstatus){if(value){return changestatus;}else{return applyuserstatus;}};_pDatePickerDayItemControl.on_getIDCSSSelector=function(){return "dayitem";};_pDatePickerDayItemControl.on_keydown_basic_action=function(){if(nexacro._enableaccessibility){nexacro.Button.prototype.on_apply_accessibility.call(this);}};delete _pDatePickerDayItemControl;nexacro._DatePickerWeekItemControl=function(id,left,top,width,height,right,bottom,minwidth,maxwidth,minheight,maxheight,parent){nexacro.Static.call(this,id,left,top,width,height,right,bottom,minwidth,maxwidth,minheight,maxheight,parent);this._refObj=parent.parent;};var _pDatePickerWeekItemControl=nexacro._createPrototype(nexacro.Static,nexacro._DatePickerWeekItemControl);nexacro._DatePickerWeekItemControl.prototype=_pDatePickerWeekItemControl;_pDatePickerWeekItemControl._type_name="DatePickerWeekItemControl";_pDatePickerWeekItemControl._is_subcontrol=true;_pDatePickerWeekItemControl._daysofweek= -1;_pDatePickerWeekItemControl._use_readonly_status=true;_pDatePickerWeekItemControl.set_readonly=function(v){v=nexacro._toBoolean(v);if(v!=this.readonly){this.readonly=v;this.on_apply_readonly();}};_pDatePickerWeekItemControl.on_apply_readonly=function(){var v=this.readonly;this._changeStatus("readonly",v);};_pDatePickerWeekItemControl._setDaysOfWeek=function(daysofweek){if(this._daysofweek!=daysofweek){this._daysofweek=daysofweek;this._on_apply_daysofweek(daysofweek);}};_pDatePickerWeekItemControl._on_apply_daysofweek=function(v){if(v==0){this._changeUserStatus("sunday",true);}else if(v==6){this._changeUserStatus("saturday",true);}};_pDatePickerWeekItemControl.on_changeUserStatus=function(changestatus,value,applyuserstatus,currentstatus,currentuserstatus){return changestatus;};_pDatePickerWeekItemControl.on_getIDCSSSelector=function(){return "weekitem";};delete _pDatePickerWeekItemControl;nexacro._YearSpinControl=function(id,left,top,width,height,right,bottom,minwidth,maxwidth,minheight,maxheight,parent){nexacro.Spin.call(this,id,left,top,width,height,right,bottom,minwidth,maxwidth,minheight,maxheight,parent);};var _pYearSpinControl=nexacro._createPrototype(nexacro.Spin,nexacro._YearSpinControl);nexacro._YearSpinControl.prototype=_pYearSpinControl;_pYearSpinControl._type_name="Spin";_pYearSpinControl._default_mask="9999";_pYearSpinControl._is_subcontrol=true;_pYearSpinControl.on_create_contents=function(){var control=this.getElement();if(control){var spinedit=this.spinedit=new nexacro._SpinEditControl("spinedit",0,0,0,0,null,null,null,null,null,null,this);var spinupbutton=this.spinupbutton=new nexacro._SpinButtonControl("spinupbutton",0,0,0,0,null,null,null,null,null,null,this);var spindownbutton=this.spindownbutton=new nexacro._SpinButtonControl("spindownbutton",0,0,0,0,null,null,null,null,null,null,this);spinedit.set_limitbymask("both");spinedit.createComponent(true);spinupbutton.createComponent(true);spindownbutton.createComponent(true);}};_pYearSpinControl=null;nexacro._MonthSpinControl=function(id,left,top,width,height,right,bottom,minwidth,maxwidth,minheight,maxheight,parent){nexacro.Spin.call(this,id,left,top,width,height,right,bottom,minwidth,maxwidth,minheight,maxheight,parent);};var _pMonthSpinControl=nexacro._createPrototype(nexacro.Spin,nexacro._MonthSpinControl);nexacro._MonthSpinControl.prototype=_pMonthSpinControl;_pMonthSpinControl._type_name="Spin";_pMonthSpinControl._is_subcontrol=true;_pMonthSpinControl._default_mask="99";_pMonthSpinControl.on_create_contents=function(){var control=this.getElement();if(control){var spinedit=this.spinedit=new nexacro._SpinEditControl("spinedit",0,0,0,0,null,null,null,null,null,null,this);var spinupbutton=this.spinupbutton=new nexacro._SpinButtonControl("spinupbutton",0,0,0,0,null,null,null,null,null,null,this);var spindownbutton=this.spindownbutton=new nexacro._SpinButtonControl("spindownbutton",0,0,0,0,null,null,null,null,null,null,this);spinedit.set_limitbymask("both");spinedit.createComponent(true);spinupbutton.createComponent(true);spindownbutton.createComponent(true);}};_pMonthSpinControl=null;}
if(!nexacro.Calendar){nexacro.CalendarCloseUpEventInfo=function(obj,id,pretext,posttext,prevalue,postvalue){this.id=this.eventid=id||"oncloseup";this.fromobject=this.fromreferenceobject=obj;this.pretext=pretext;this.posttext=posttext;this.prevalue=prevalue;this.postvalue=postvalue;};var _pCalendarCloseUpEventInfo=nexacro._createPrototype(nexacro.Event,nexacro.CalendarCloseUpEventInfo);nexacro.CalendarCloseUpEventInfo.prototype=_pCalendarCloseUpEventInfo;_pCalendarCloseUpEventInfo._type_name="CalendarCloseUpEventInfo";delete _pCalendarCloseUpEventInfo;_pCalendarCloseUpEventInfo=null;nexacro.CalendarDayClickEventInfo=function(obj,id,date){this.id=this.eventid=id||"ondayclick";this.fromobject=this.fromreferenceobject=obj;this.date=date;};var _pCalendarDayClickEventInfo=nexacro._createPrototype(nexacro.Event,nexacro.CalendarDayClickEventInfo);nexacro.CalendarDayClickEventInfo.prototype=_pCalendarDayClickEventInfo;_pCalendarDayClickEventInfo._type_name="CalendarDayClickEventInfo";delete _pCalendarDayClickEventInfo;_pCalendarDayClickEventInfo=null;nexacro.CalendarSpinEventInfo=function(obj,id,beforeText,afterText,beforeValue,afterValue,isUp,fromobject,fromreferenceobject){nexacro.Event.call(this,obj,id||"oncalendarspin");this.id=this.eventid=id||"oncalendarspin";this.fromobject=fromobject||obj;this.fromreferenceobject=fromreferenceobject||obj;this.pretext=beforeText;this.posttext=afterText;this.prevalue=beforeValue;this.postvalue=afterValue;this.up=isUp;};var _pCalendarSpinEventInfo=nexacro._createPrototype(nexacro.Event,nexacro.CalendarSpinEventInfo);nexacro.CalendarSpinEventInfo.prototype=_pCalendarSpinEventInfo;_pCalendarSpinEventInfo._type_name="CalendarSpinEventInfo";delete _pCalendarSpinEventInfo;_pCalendarSpinEventInfo=null;nexacro.Calendar=function(id,left,top,width,height,right,bottom,minwidth,maxwidth,minheight,maxheight,parent,onlydisplay){nexacro.Component.call(this,id,left,top,width,height,right,bottom,minwidth,maxwidth,minheight,maxheight,parent);this._masktypeobj=new nexacro._EditMaskTypeDate();this._onlydisplay=onlydisplay;};var _pCalendar=nexacro._createPrototype(nexacro.Component,nexacro.Calendar);nexacro.Calendar.prototype=_pCalendar;_pCalendar._type_name="Calendar";_pCalendar.calendaredit=null;_pCalendar.dropbutton=null;_pCalendar.datepicker=null;_pCalendar.calendarspinupbutton=null;_pCalendar.calendarspindownbutton=null;_pCalendar._popupcontrol=null;_pCalendar.value=undefined;_pCalendar.displaynulltext="";_pCalendar.displayinvalidtext="invalid value";_pCalendar.readonly=false;_pCalendar.autoselect=false;_pCalendar.autoskip=false;_pCalendar.type="normal";_pCalendar.popuptype=undefined;_pCalendar.text="";_pCalendar.usecontextmenu=true;_pCalendar.usesoftkeyboard=true;_pCalendar.locale="";_pCalendar.innerdataset=null;_pCalendar.backgroundcolumn="";_pCalendar.bordercolumn="";_pCalendar.datecolumn="";_pCalendar.textcolorcolumn="";_pCalendar.buttonsize=undefined;_pCalendar.headheight=undefined;_pCalendar.daysize=undefined;_pCalendar.popupsize=undefined;_pCalendar.dateformat="yyyy-MM-dd ddd";_pCalendar.editformat="yyyy-MM-dd";_pCalendar.headformat="yyyy.MM";_pCalendar.weekformat=undefined;_pCalendar.usetrailingday=false;_pCalendar.showmonthspin=false;_pCalendar.showyearspin=false;_pCalendar._masktypeobj=null;_pCalendar._innerdataset=null;_pCalendar._locale="";_pCalendar._type="normal";_pCalendar._systemformat="yyyy-MM-dd";_pCalendar._default_value=undefined;_pCalendar._default_text="";_pCalendar._default_type="";_pCalendar._want_arrows=false;_pCalendar._has_inputElement=true;_pCalendar._change_caret_from_method=false;_pCalendar._onlydisplay=false;_pCalendar._is_repeat=true;_pCalendar._is_locale_control=true;_pCalendar._is_editable_control=true;_pCalendar._use_readonly_status=true;_pCalendar._event_list={"oneditclick":1,"ondayclick":1,"onkeydown":1,"onkeyup":1,"onkillfocus":1,"onsetfocus":1,"ondrag":1,"ondragenter":1,"ondragleave":1,"ondragmove":1,"ondrop":1,"onlbuttondown":1,"onlbuttonup":1,"onrbuttondown":1,"onrbuttonup":1,"onmousedown":1,"onmouseup":1,"onmouseenter":1,"onmouseleave":1,"onmousemove":1,"onmove":1,"onsize":1,"canchange":1,"onchanged":1,"oninput":1,"oncontextmenu":1,"ondropdown":1,"oncloseup":1,"onspin":1,"oninnerdatachanged":1,"ontouchstart":1,"ontouchmove":1,"ontouchend":1};_pCalendar.accessibilityrole="calendar";_pCalendar._is_compound=true;nexacro.Calendar.EndDayNormal=new Array(31,28,31,30,31,30,31,31,30,31,30,31);nexacro.Calendar.EndDayLeap=new Array(31,29,31,30,31,30,31,31,30,31,30,31);_pCalendar.on_create_contents=function(){var control=this.getElement();if(control){var maskobj=this._masktypeobj;if(maskobj){var mode="number";var useeditbuffer=true;var bMobile=((nexacro._isMobile&&nexacro._isMobile())||(nexacro._isHybrid&&nexacro._isHybrid())||(!nexacro._isDesktop()&&nexacro._OS=="Android"&&nexacro._Browser=="Runtime"));if(bMobile){this._is_repeat=false;if((!this.popuptype||this.popuptype=="system")&&this._type=="normal"){mode="date";useeditbuffer=false;this._type="system";}}maskobj.setInputMode(mode);maskobj.setUseEditBuffer(useeditbuffer);}switch(this._type){case "normal":case "system":this._createCalendaredit();this._createDropbutton();break;case "spin":this._createCalendaredit();this._createSpinbutton();break;case "monthonly":this._createDatePicker();break;}}};_pCalendar.on_created_contents=function(win){this.on_apply_innerdataset(this._innerdataset);this.on_apply_locale(this._getLocale());this.on_apply_editformat(this.editformat);this.on_apply_dateformat(this.dateformat);this.on_apply_weekformat(this.weekformat);if(this.expr){this._on_apply_expr(this.expr);}else{this.on_apply_value(this.value);}this._recalcLayout();switch(this._type){case "spin":this._setEventHandlerToCalendarEdit();this._setEventHandlerToSpinButton();this.calendaredit._on_apply_inputtype();this.calendaredit.on_created(win);this.calendarspinupbutton.on_created(win);this.calendarspindownbutton.on_created(win);if(nexacro._accessibilitytype==5){this.calendaredit._setAccessibilityStatHidden(true);this.calendarspinupbutton._setAccessibilityStatHidden(true);this.calendarspindownbutton._setAccessibilityStatHidden(true);}break;case "monthonly":this._setEventHandlerToDatePicker();this.datepicker.on_created(win);break;case "system":if(nexacro._enableaccessibility&&nexacro._accessibilitytype==4){var control_elem=this.getElement();if(control_elem){control_elem.setElementAccessibilityStatHidden(false);}}this._setEventHandlerToCalendarEdit();this._setEventHandlerToDropButton();this.calendaredit._on_apply_inputtype();this.calendaredit.on_created(win);var dropbutton=this.dropbutton;if(dropbutton){dropbutton.on_created(win);}if(nexacro._accessibilitytype==5){this.calendaredit._setAccessibilityStatHidden(true);}if(this.accessibilitydesclevel!="none"&&this.accessibilitydesclevel!="child"){this._setAccessibilityActiveDescendant(this.calendaredit._input_element);}break;case "normal":default:this._setEventHandlerToCalendarEdit();this._setEventHandlerToDropButton();this.calendaredit._on_apply_inputtype();this.calendaredit.on_created(win);if(nexacro._accessibilitytype==5){this.calendaredit._setAccessibilityStatHidden(true);}this.dropbutton.on_created(win);break;}if(this.calendaredit){this.calendaredit.set_usesoftkeyboard(this.usesoftkeyboard,true);}this._default_value=this.value;this._default_text=this.text;this.on_apply_displaynulltext(this.displaynulltext);this.on_apply_displayinvalidtext(this.displayinvalidtext);this.on_apply_readonly(this.readonly);};_pCalendar.on_destroy_contents=function(){this._destroyControl();this._removeEventHandlerToInnerDataset();};_pCalendar._removeEventHandlerToInnerDataset=function(){if(this._innerdataset){this._innerdataset._removeEventHandler("onvaluechanged",this._on_dataset_onvaluechanged,this);this._innerdataset._removeEventHandler("onrowsetchanged",this._on_dataset_onrowsetchanged,this);this._innerdataset=null;}};_pCalendar.on_create_contents_command=function(){this.on_apply_innerdataset(this._innerdataset);this.on_apply_locale(this._getLocale());this.on_apply_editformat(this.editformat);this.on_apply_dateformat(this.dateformat);this.on_apply_weekformat(this.weekformat);this.on_apply_readonly(this.readonly);if(this.expr){this._on_apply_expr(this.expr);}else{this.on_apply_value(this.value);}this._recalcLayout();switch(this._type){case "system":case "normal":this._setEventHandlerToCalendarEdit();this._setEventHandlerToDropButton();break;case "spin":this._setEventHandlerToCalendarEdit();this._setEventHandlerToSpinButton();break;case "monthonly":this._setEventHandlerToDatePicker();break;}var str="";if(this.calendaredit){this.calendaredit._on_apply_inputtype();str+=this.calendaredit.createCommand();}if(this.dropbutton){str+=this.dropbutton.createCommand();}if(this.calendarspindownbutton){str+=this.calendarspindownbutton.createCommand();}if(this.calendarspinupbutton){str+=this.calendarspinupbutton.createCommand();}if(this.datepicker){str+=this.datepicker.createCommand();}return str;};_pCalendar.on_attach_contents_handle=function(win){if(this.calendaredit){this.calendaredit.attachHandle(win);}if(this.dropbutton){this.dropbutton.attachHandle(win);}if(this.calendarspindownbutton){this.calendarspindownbutton.attachHandle(win);}if(this.calendarspinupbutton){this.calendarspinupbutton.attachHandle(win);}if(this.datepicker){this.datepicker.attachHandle(win);}this._default_value=this.value;this._default_text=this.text;this.on_apply_displaynulltext(this.displaynulltext);this.on_apply_displayinvalidtext(this.displayinvalidtext);};_pCalendar.on_change_containerRect=function(){this._recalcLayout();};_pCalendar.on_change_containerPos=function(){};_pCalendar._apply_setfocus=function(evt_name){var calendaredit=this.calendaredit;if(calendaredit){calendaredit._on_focus(true,nexacro._getBrowserEventName(evt_name));}};_pCalendar.on_apply_prop_enable=function(v){if(this.calendaredit){this.calendaredit._setEnable(v);}if(this.dropbutton&&!this.readonly){this.dropbutton._setEnable(v);}if(this.calendarspinupbutton&&!this.readonly){this.calendarspinupbutton._setEnable(v);}if(this.calendarspindownbutton&&!this.readonly){this.calendarspindownbutton._setEnable(v);}if(this.datepicker){this.datepicker._setEnable(v);}};_pCalendar.on_apply_prop_cssclass=function(){if(this.calendaredit){this.calendaredit.on_apply_cssclass();}if(this.dropbutton){this.dropbutton.on_apply_cssclass();}if(this.calendarspinupbutton){this.calendarspinupbutton.on_apply_cssclass();}if(this.calendarspindownbutton){this.calendarspindownbutton.on_apply_cssclass();}if(this.datepicker){this.datepicker.on_apply_cssclass();}};_pCalendar.on_init_bindSource=function(columnid,propid){if(propid=="value"){this._setValue(undefined);}};_pCalendar.on_change_bindSource=function(propid,ds,row,col){if(propid=="value"){var v=ds.getColumn(row,col);var maskobj=this._masktypeobj;var dateobj=this._convertToDateObject(v);if(dateobj){if(!this._isInvalidValue(dateobj)){v=this._convertValueType(v,dateobj,true);if(v!=this.value){var packeddate=maskobj.changeNormalizeValue(dateobj.toString());if(maskobj){maskobj.setDate(packeddate);}this.value=v;this.on_apply_value(packeddate);}}else{this.value=v;this.on_apply_value(v);}}else{if(v!=this.value){this._setValue(v);}}}};_pCalendar.on_getBindableProperties=function(){return "value";};_pCalendar._getDragData=function(){var calendaredit=this.calendaredit;if(calendaredit){return calendaredit.getSelectedText();}};_pCalendar._getDlgCode=function(keycode,altKey,ctrlKey){var _want_arrows=this._want_arrows;this._is_first_focus=false;if(ctrlKey==true){_want_arrows=true;}return {want_tab:false,want_return:false,want_escape:false,want_chars:false,want_arrows:_want_arrows};};_pCalendar.on_get_accessibility_label=function(){{}return "";};_pCalendar._on_getAccessibilityAdditionalLabel=function(){var additionallabel="";if(this.type!="monthonly"){additionallabel=this._accessibilityvalue?this._accessibilityvalue:this.text?this.text:this._getCurrentDateStr();}else{additionallabel=this._getCurrentDateStr();}return additionallabel?additionallabel:this.displaynulltext;};_pCalendar._getAccessibilityReadLabel=function(){if(this._accessibilityvalue){return this._accessibilityvalue;}if(this.text){return this.text;}return this._getCurrentDateStr();};_pCalendar.set_text=nexacro._emptyFn;_pCalendar.on_apply_text=function(v){var expr=this.expr;if(expr){if(expr.substring(0,4)=="Date"){v=new nexacro.Date(v).toString();}if(this.value!=v){this.set_value(v);}else{this.on_apply_value(v);}}};_pCalendar.set_value=function(v){var dateobj=this._convertToDateObject(v);var binvalid=false;if(dateobj){binvalid=this._isInvalidValue(dateobj);if(!binvalid){v=this._convertValueType(v,dateobj);}}if(this.value!==v){if(this.applyto_bindSource("value",v)){this.value=v;this.on_apply_value(v,binvalid);}}};_pCalendar.on_apply_value=function(value,binvalid){value=nexacro._isNull(value)?value:nexacro._toString(value).trim();var maskobj=this._masktypeobj;if(maskobj){if(nexacro._isNull(binvalid)){binvalid=this._isInvalidValue(value);}if(binvalid){this.text=maskobj.applyMask("");}else{this.text=maskobj.applyMask(value);}this._setCalendarEditValue(value);this._setDatePickerValue(maskobj.getDatePickerValue());}};_pCalendar.set_displaynulltext=function(v){v=nexacro._toString(v).replace(/&quot;/g,"\"");if(this.displaynulltext!=v){this.displaynulltext=v;this.on_apply_displaynulltext(v);}};_pCalendar.on_apply_displaynulltext=function(displaynulltext){var calendaredit=this.calendaredit;if(calendaredit){calendaredit.set_displaynulltext(displaynulltext);}};_pCalendar.set_displayinvalidtext=function(v){v=nexacro._toString(v).replace(/&quot;/g,"\"");if(this.displayinvalidtext!=v){this.displayinvalidtext=v;this.on_apply_displayinvalidtext(v);}};_pCalendar.on_apply_displayinvalidtext=function(v){var calendaredit=this.calendaredit;if(calendaredit){calendaredit.set_displayinvalidtext(v);}};_pCalendar.set_readonly=function(v){v=nexacro._toBoolean(v);if(this.readonly!=v){this.readonly=v;this.on_apply_readonly(v);}};_pCalendar.on_apply_readonly=function(readonly){this._changeStatus("readonly",readonly);var calendaredit=this.calendaredit;if(calendaredit){if(!this._onlydisplay){calendaredit.set_readonly(readonly);}else{calendaredit._changeStatus("readonly",readonly);}}var dropbutton=this.dropbutton;if(dropbutton){dropbutton._setEnable(this.enable&&!readonly);}var spinupbutton=this.calendarspinupbutton;if(spinupbutton){spinupbutton._setEnable(this.enable&&!readonly);}var spindownbutton=this.calendarspindownbutton;if(spindownbutton){spindownbutton._setEnable(this.enable&&!readonly);}var datepicker=this.datepicker;if(datepicker){datepicker.set_readonly(readonly);}};_pCalendar.set_autoselect=function(v){v=nexacro._toBoolean(v);if(this.autoselect!=v){this.autoselect=v;this.on_apply_autoselect(v);}};_pCalendar.on_apply_autoselect=function(autoselect){var calendaredit=this.calendaredit;if(calendaredit){calendaredit.set_autoselect(autoselect);}};_pCalendar.set_autoskip=function(v){v=nexacro._toBoolean(v);if(this.autoskip!=v){this.autoskip=v;this.on_apply_autoskip(v);}};_pCalendar.on_apply_autoskip=function(autoskip){var calendaredit=this.calendaredit;if(calendaredit){calendaredit.set_autoskip(autoskip);}};_pCalendar.set_type=function(v){var type_enum=["normal","spin","monthonly"];if(type_enum.indexOf(v)== -1){return;}if(this.type!=v){this._default_type=this.type;this.type=v;this.on_apply_type(v);}};_pCalendar.on_apply_type=function(type){var is_change=true;var client_width=this._getClientWidth();var normal_height=Math.round(client_width/5);if(this._default_type!="monthonly"||type=="monthonly"){is_change=false;}if(type!="spin"&&type!="monthonly"&&this._masktypeobj.getInputMode()=="date"){type="system";}this._type=type;var control_elem=this.getElement();if(control_elem){this._destroyControl();switch(this._type){case "system":case "normal":this._createNormaltypeControl();this.calendaredit._on_apply_inputtype();if(is_change){this.resize(client_width,normal_height);}else{this._recalcLayout();}break;case "spin":this._createSpintypeControl();this.calendaredit._on_apply_inputtype();if(is_change){this.resize(client_width,normal_height);}else{this._recalcLayout();}break;case "monthonly":this._createMonthlytypeControl();var popupsize=this._getPopupSizeArr();if(this._adjust_width==popupsize.width&&this._adjust_height==popupsize.height){this._recalcLayout();}else{this.resize(popupsize.width,popupsize.height);}break;}}};_pCalendar.set_popuptype=function(v){var popuptype_enum=["center","none","normal","system"];if(v&&popuptype_enum.indexOf(v)== -1){return;}if(this.popuptype!=v){this.popuptype=v;this.on_apply_popuptype(v);}};_pCalendar.on_apply_popuptype=function(popuptype){var type=this._type;var maskobj=this._masktypeobj;if(maskobj){var mode="number";var useeditbuffer=true;if((!this.popuptype||this.popuptype=="system")&&type=="normal"){var bMobile=((nexacro._isMobile&&nexacro._isMobile())||(nexacro._isHybrid&&nexacro._isHybrid())||(!nexacro._isDesktop()&&nexacro._OS=="Android"&&nexacro._Browser=="Runtime"));if(bMobile&&this._is_created){mode="date";useeditbuffer=false;}}maskobj.setInputMode(mode);maskobj.setUseEditBuffer(useeditbuffer);this.on_apply_type(this.type);}};_pCalendar.set_locale=function(v){if(this.locale!=v){this.locale=v;this._locale=v;this.on_apply_locale(v);this.on_apply_weekformat(this.weekformat);this.on_apply_value(this.value);}};_pCalendar.on_apply_locale=function(locale){var maskobj=this._masktypeobj;if(maskobj){maskobj.setLocale(locale);if(nexacro._OS=="Android"&&nexacro._Browser=="Runtime"){this._systemformat=nexacro.Locale._makeDateMaskString(locale,"SHORTDATE");}}};_pCalendar.set_usecontextmenu=function(v){v=nexacro._toBoolean(v);if(this.usecontextmenu!=v){this.usecontextmenu=v;this.on_apply_usecontextmenu(v);}};_pCalendar.on_apply_usecontextmenu=function(usecontextmenu){var calendaredit=this.calendaredit;if(calendaredit){calendaredit.set_usecontextmenu(usecontextmenu);}};_pCalendar.set_usesoftkeyboard=function(v,bforce){v=nexacro._toBoolean(v);if(v!=this.usesoftkeyboard||bforce){this.usesoftkeyboard=v;this.on_apply_usesoftkeyboard(bforce);}};_pCalendar.on_apply_usesoftkeyboard=function(bforce){if(this.calendaredit){this.calendaredit.set_usesoftkeyboard(this.usesoftkeyboard,bforce);}};_pCalendar.set_innerdataset=function(v){if(typeof v!="string"){this.setInnerDataset(v);return;}if(this.innerdataset!=v||(this.innerdataset&&!this._innerdataset)){this._setInnerDatasetStr(v);this.on_apply_innerdataset(this._innerdataset);}};_pCalendar.on_apply_innerdataset=function(ds){if(ds){ds._setEventHandler("onvaluechanged",this._on_dataset_onvaluechanged,this);ds._setEventHandler("onrowsetchanged",this._on_dataset_onrowsetchanged,this);}var datepicker=this.datepicker;if(datepicker){datepicker._refreshDay();}};_pCalendar.set_backgroundcolumn=function(v){if(this.backgroundcolumn!=v){this.backgroundcolumn=v;this.on_apply_backgroundcolumn(v);}};_pCalendar.on_apply_backgroundcolumn=function(){var datepicker=this.datepicker;if(datepicker){datepicker._refreshDay();}};_pCalendar.set_bordercolumn=function(v){if(this.bordercolumn!=v){this.bordercolumn=v;this.on_apply_bordercolumn(v);}};_pCalendar.on_apply_bordercolumn=function(){var datepicker=this.datepicker;if(datepicker){datepicker._refreshDay();}};_pCalendar.set_datecolumn=function(v){if(this.datecolumn!=v){this.datecolumn=v;this.on_apply_datecolumn(v);}};_pCalendar.on_apply_datecolumn=function(){var datepicker=this.datepicker;if(datepicker){datepicker._refreshDay();}};_pCalendar.set_textcolorcolumn=function(v){if(this.textcolorcolumn!=v){this.textcolorcolumn=v;this.on_apply_textcolorcolumn(v);}};_pCalendar.on_apply_textcolorcolumn=function(){var datepicker=this.datepicker;if(datepicker){datepicker._refreshDay();}};_pCalendar.set_buttonsize=function(v){if(this.buttonsize!=v){this.buttonsize=v;this.on_apply_buttonsize(v);}};_pCalendar.on_apply_buttonsize=function(){this._recalcLayout();};_pCalendar.set_headheight=function(v){if(v!==undefined){if(isNaN(v= +v)){return;}}if(this.headheight!=v){this.headheight=v;this.on_apply_headheight(v);}};_pCalendar.on_apply_headheight=function(){var datepicker=this.datepicker;if(datepicker){datepicker._recalcLayout();}};_pCalendar.set_daysize=function(v){if(this.daysize!=v){this.daysize=v;this.on_apply_daysize(v);}};_pCalendar.on_apply_daysize=function(){var datepicker=this.datepicker;if(datepicker){datepicker._refreshDay();datepicker.body._recalcLayout();}};_pCalendar.set_popupsize=function(v){if(this.popupsize!=v){this.popupsize=v;}};_pCalendar.on_apply_popupsize=nexacro._emptyFn;_pCalendar.set_dateformat=function(v){if(this.dateformat!=v){this.dateformat=v;this.on_apply_dateformat(v);this.on_apply_value(this.value);}};_pCalendar.on_apply_dateformat=function(dateformat){var maskobj=this._masktypeobj;if(maskobj){if(this._type=="system"){this.dateformat=dateformat=this._systemformat;}maskobj.setDateMask(dateformat);}};_pCalendar.set_editformat=function(v){if(this.editformat!=v){this.editformat=v;this.on_apply_editformat(v);this._setValue(this.value);}};_pCalendar.on_apply_editformat=function(editformat){var maskobj=this._masktypeobj;if(maskobj){if(this._type=="system"){editformat=this._systemformat;}maskobj.setEditMask(editformat);}};_pCalendar.set_headformat=function(v){if(this.headformat!=v){this.headformat=v;this.on_apply_headformat(v);}};_pCalendar.on_apply_headformat=function(){var datepicker=this.datepicker;if(datepicker){datepicker._setHeadformatText();}};_pCalendar.set_weekformat=function(v){if(this.weekformat!=v){this.weekformat=v;this.on_apply_weekformat(v);}};_pCalendar.on_apply_weekformat=function(){var datepicker=this.datepicker;if(datepicker){datepicker._setWeekformatText();}};_pCalendar.set_usetrailingday=function(v){v=nexacro._toBoolean(v);if(this.usetrailingday!=v){this.usetrailingday=v;this.on_apply_usetrailingday(v);}};_pCalendar.on_apply_usetrailingday=function(){var datepicker=this.datepicker;if(datepicker){datepicker._refreshDay();}};_pCalendar.set_showmonthspin=function(v){v=nexacro._toBoolean(v);if(this.showmonthspin!=v){this.showmonthspin=v;this.on_apply_showmonthspin(v);}};_pCalendar.on_apply_showmonthspin=function(){var datepicker=this.datepicker;if(datepicker){datepicker._refreshSpindate();}};_pCalendar.set_showyearspin=function(v){v=nexacro._toBoolean(v);if(this.showyearspin!=v){this.showyearspin=v;this.on_apply_showyearspin(v);}};_pCalendar.on_apply_showyearspin=function(){var datepicker=this.datepicker;if(datepicker){datepicker._refreshSpindate();}};_pCalendar.on_apply_accessibility=function(){nexacro.Component.prototype.on_apply_accessibility.call(this);if(this.calendaredit){this.calendaredit.on_apply_accessibility();}};_pCalendar.set_visible=function(v){nexacro.Component.prototype.set_visible.call(this,v);if(!this.visible&&this._isPopupVisible()){this._closePopup();}};_pCalendar.on_apply_accessibility=function(accessibility){nexacro.Component.prototype.on_apply_accessibility.call(this,accessibility);if(this.calendaredit){this.calendaredit.on_apply_accessibility(accessibility);}};_pCalendar.dropdown=function(){if(!this.enable||this.readonly||!this.visible||this._type=="system"){return false;}if(this._isPopupVisible()){return false;}this._setFocus(false);this._showPopup();this._setDefaultCaret();};_pCalendar.isDropdown=function(){return this._isPopupVisible();};_pCalendar.getCaretPos=function(){if(this.readonly){return  -1;}var calendaredit=this.calendaredit;if(calendaredit){return calendaredit.getCaretPos();}return  -1;};_pCalendar.setCaretPos=function(v){var calendaredit=this.calendaredit;if(calendaredit){this._change_caret_from_method=true;return calendaredit.setCaretPos(v);}};_pCalendar.getSelect=function(){var calendaredit=this.calendaredit;if(calendaredit){return calendaredit.getSelect();}return [0,0];};_pCalendar.setSelect=function(begin,end){var calendaredit=this.calendaredit;if(calendaredit){this._change_caret_from_method=true;return calendaredit.setSelect(begin,end);}return false;};_pCalendar.getSelectedText=function(){var calendaredit=this.calendaredit;if(calendaredit){return calendaredit.getSelectedText();}return "";};_pCalendar.getInnerDataset=function(){return this._innerdataset;};_pCalendar.setInnerDataset=function(obj){this._removeEventHandlerToInnerDataset();if(!obj){this._innerdataset=null;this.innerdataset="";this.on_apply_innerdataset(this._innerdataset);}else if(obj instanceof nexacro.Dataset){this._innerdataset=obj;this.innerdataset=obj.id;this.on_apply_innerdataset(this._innerdataset);}};_pCalendar.getYear=function(){var ret=1970;if(this.value){var maskobj=this._masktypeobj;if(maskobj){return maskobj._dateObj.getFullYear();}}return ret;};_pCalendar.getMonth=function(){var ret=1;if(this.value){var maskobj=this._masktypeobj;if(maskobj){return maskobj._dateObj.getMonth()+1;}}return ret;};_pCalendar.getDay=function(){var ret=1;if(this.value){var maskobj=this._masktypeobj;if(maskobj){return maskobj._dateObj.getDate();}}return ret;};_pCalendar.getDayOfWeek=function(){var ret=4;if(this.value){var maskobj=this._masktypeobj;if(maskobj){return maskobj._dateObj.getDay();}}return ret;};_pCalendar.updateToDataset=function(){return this.applyto_bindSource("value",this.value);};_pCalendar._on_value_change=function(prevalue,postvalue){var ret=true;var pretext=this._getEventInfoText(prevalue);var posttext=this._getEventInfoText(postvalue);if(!this.on_fire_canchange(this,pretext,prevalue,posttext,postvalue)||!this.applyto_bindSource("value",postvalue)){ret=false;}if(!ret){this.value=prevalue;var maskobj=this._masktypeobj;var packeddate=maskobj.changeNormalizeValue(prevalue);this.on_apply_value(packeddate);return false;}this._setValue(postvalue);this._default_value=prevalue;this._default_text=pretext;this.on_fire_onchanged(this,pretext,prevalue,posttext,postvalue);if(this.autoskip&&this._isPopupVisible()){this._closePopup();}return true;};_pCalendar._on_dataset_onvaluechanged=function(obj,e){var datepicker=this.datepicker;if(datepicker){datepicker._refreshDay();}if(this._is_created){this.on_fire_oninnerdatachanged(obj,e.oldvalue,e.newvalue,e.columnid,e.col,e.row);}};_pCalendar._on_dataset_onrowsetchanged=function(){var datepicker=this.datepicker;if(datepicker){datepicker._refreshDay();}};_pCalendar._on_edit_oneditclick=function(obj,e){this.on_fire_oneditclick(obj,e.caretpos,e.button,e.altkey,e.ctrlkey,e.shiftkey,e.screenx,e.screeny,e.canvasx,e.canvasy,e.clientx,e.clienty,e.fromobject,e.fromreferenceobject);if(this._type=="system"&&!this.readonly){var control_elem=this.getElement();if(control_elem){this.calendaredit._prevent_clickevent=false;var ret=this.on_fire_ondropdown(this);if(ret){nexacro._openSystemCalendar(this,this.value,"_on_notify_mobile_valuechanged");}this.calendaredit._prevent_clickevent=true;}return true;}};_pCalendar._on_edit_onlbuttondown=function(){if(this.readonly){return false;}if(this._isPopupVisible()){this._closePopup();}};_pCalendar._on_edit_onlbuttonup=function(){};_pCalendar._on_edit_onkeydown=function(obj,e){var keycode=e.keycode;var calendaredit=this.calendaredit;var datepicker=this.datepicker;switch(this.type){case "normal":if(keycode==nexacro.Event.KEY_ESC){if(this._isPopupVisible()){this._closePopup();}this._setDefaultCaret();}else if(keycode==nexacro.Event.KEY_ENTER){if(this._isPopupVisible()){datepicker._changeDate(obj,e);datepicker.on_fire_ondayclick(datepicker._value);}else{if(this.value!=calendaredit.value){this._on_value_change(this.value,calendaredit.value);}else if(this.text!=calendaredit.text){this._setValue(this.value);}}this._setDefaultCaret();}else if(e.altkey&&keycode==nexacro.Event.KEY_DOWN){if(!this._isPopupVisible()){this._showPopup();this._setDefaultCaret();if(calendaredit){var value=calendaredit.value?calendaredit.value:this.datepicker._value;this._setDatePickerValue(value);}}}else{if(this._isPopupVisible()){if(keycode>=nexacro.Event.KEY_LEFT&&keycode<=nexacro.Event.KEY_DOWN){datepicker._on_body_onkeydown(obj,e);}}}break;case "spin":if(keycode==nexacro.Event.KEY_ENTER){if(this.value!=calendaredit.value){this._on_value_change(this.value,calendaredit.value);}else if(this.text!=calendaredit.text){this._setValue(this.value);}this._setDefaultCaret();}else if(keycode==nexacro.Event.KEY_UP){if(!nexacro._enableaccessibility||e.ctrlkey){this._on_spin_onspinup(obj,e);}}else if(keycode==nexacro.Event.KEY_DOWN){if(!nexacro._enableaccessibility||e.ctrlkey){this._on_spin_onspindown(obj,e);}}break;case "monthonly":if(keycode>=nexacro.Event.KEY_LEFT&&keycode<=nexacro.Event.KEY_DOWN){datepicker.on_keydown_default_action(keycode,e.altkey,e.ctrlkey,e.shiftkey,e.fromreferenceobject);datepicker._refreshSpindate();datepicker.on_fire_ondayclick(datepicker);}break;default:break;}if(keycode>=nexacro.Event.KEY_LEFT&&keycode<=nexacro.Event.KEY_DOWN){if(this._isPopupVisible()){calendaredit._input_element.stopSysEvent();}else{if(keycode==nexacro.Event.KEY_UP||keycode==nexacro.Event.KEY_DOWN){calendaredit._input_element.stopSysEvent();}}}return false;};_pCalendar._on_edit_oninput=function(){var cur_value;var maskobj=this._masktypeobj;if(maskobj._use_edit_buf){cur_value=maskobj.changeNormalizeValueFromBuffer();}else{cur_value=maskobj.changeNormalizeValue(this.calendaredit.value);}if(this._isPopupVisible()){this._setDatePickerValue(cur_value);}this.on_fire_oninput();if(this._type=="system"){if(this.value!=cur_value){this._on_value_change(this.value,cur_value);}}};_pCalendar._on_notify_mobile_valuechanged=function(v){if(this._type=="system"){this._setCalendarEditValue(v);this.on_fire_oninput();var maskobj=this._masktypeobj;if(maskobj){var cur_value=maskobj.changeNormalizeValueFromBuffer();if(this.value!=cur_value){this._on_value_change(this.value,cur_value);}}}};_pCalendar._on_drop_onlbuttondown=function(){if(this.readonly||!this.enable){return false;}if(this._isPopupVisible()){this._closePopup();if(!this.autoselect){this._setDefaultCaret();}}else{var datepicker=this.datepicker;var calendaredit=this.calendaredit;if(datepicker&&calendaredit){var value=calendaredit.value;if(value){var binvalid=calendaredit._isInvalidValue(value);if(binvalid){value=datepicker._value;}}else{value=datepicker._value;}this._setDatePickerValue(value);}this._showPopup();if(!this.autoselect){this._setDefaultCaret();}}return false;};_pCalendar._on_drop_mobile_onclick=function(){if(this.readonly||!this.enable){return false;}if(this._isPopupVisible()){this._closePopup();}else{var datepicker=this.datepicker;var calendaredit=this.calendaredit;if(datepicker&&calendaredit){var value=calendaredit.value?calendaredit.value:datepicker._value;this._setDatePickerValue(value);}this._showPopup();}return false;};_pCalendar._on_drop_onclick=function(){};_pCalendar._on_spin_onspinup=function(){if(this.readonly){return false;}var calendaredit=this.calendaredit;if(calendaredit){var cur_text="";var cur_value;var pre_text;var pre_value=this._default_value;var post_text="";var pos=this.getCaretPos();var old_pos=pos;var end_pos=this.calendaredit.text.length;if(this._rtl&&nexacro._Browser=="Chrome"){if(pos==0){pos=end_pos;}else if(pos==end_pos){pos=0;}}var maskobj=this._masktypeobj;if(maskobj){if(!maskobj.date){var currDate=this._getCurrentDate();var year=nexacro._toString(currDate.year).padLeft(4,"0");var month=nexacro._toString(currDate.month).padLeft(2,"0");var day=nexacro._toString(currDate.day).padLeft(2,"0");var type=maskobj.getEditFormatType();switch(type){case 0:cur_value=year+month+day;break;case 1:cur_value="000000000";break;case 2:cur_value=year+month+day+"000000000";}cur_text=maskobj.applyMask(cur_value);this._setSpinValue(cur_value,cur_text,old_pos);}else{cur_text=maskobj.applyMaskSpin(pos,1);cur_value=maskobj.changeNormalizeValueFromBuffer();pre_text=this._getEventInfoText(pre_value);post_text=this._getEventInfoText(cur_value);if(!this.on_fire_onspin(this,pre_text,pre_value,post_text,cur_value,true)){cur_text=pre_value?pre_text:maskobj.applyMask(this.value);cur_value=pre_value?pre_value:maskobj.removeMask(cur_text);}maskobj.applyMask(cur_value);this._setSpinValue(cur_value,cur_text,old_pos);}}}};_pCalendar._on_spin_onspindown=function(){if(this.readonly){return false;}var calendaredit=this.calendaredit;if(calendaredit){var cur_text="";var cur_value;var pre_text;var pre_value=this._default_value;var post_text="";var pos=this.getCaretPos();var old_pos=pos;var end_pos=this.calendaredit.text.length;if(this._rtl&&nexacro._Browser=="Chrome"){if(pos==0){pos=end_pos;}else if(pos==end_pos){pos=0;}}var maskobj=this._masktypeobj;if(maskobj){if(!maskobj.date){var currDate=this._getCurrentDate();var year=nexacro._toString(currDate.year).padLeft(4,"0");var month=nexacro._toString(currDate.month).padLeft(2,"0");var day=nexacro._toString(currDate.day).padLeft(2,"0");var type=maskobj.getEditFormatType();switch(type){case 0:cur_value=year+month+day;break;case 1:cur_value="000000000";break;case 2:cur_value=year+month+day+"000000000";}cur_text=maskobj.applyMask(cur_value);this._setSpinValue(cur_value,cur_text,old_pos);}else{cur_text=maskobj.applyMaskSpin(pos, -1);cur_value=maskobj.changeNormalizeValueFromBuffer();pre_text=this._getEventInfoText(pre_value);post_text=this._getEventInfoText(cur_value);if(!this.on_fire_onspin(this,pre_text,pre_value,post_text,cur_value,true)){cur_text=pre_value?pre_text:maskobj.applyMask(this.value);cur_value=pre_value?pre_value:maskobj.removeMask(cur_text);}maskobj.applyMask(cur_value);this._setSpinValue(cur_value,cur_text,old_pos);}}}};_pCalendar._on_spin_mobile_onspinup=function(){if(this.readonly){return false;}var calendaredit=this.calendaredit;if(calendaredit){var cur_text="";var cur_value;var pre_text;var pre_value=this._default_value;var post_text="";var pos=this.getCaretPos();var maskobj=this._masktypeobj;if(maskobj){if(!maskobj.date){var currDate=this._getCurrentDate();var year=nexacro._toString(currDate.year).padLeft(4,"0");var month=nexacro._toString(currDate.month).padLeft(2,"0");var day=nexacro._toString(currDate.day).padLeft(2,"0");var type=maskobj.getEditFormatType();switch(type){case 0:cur_value=year+month+day;break;case 1:cur_value="000000000";break;case 2:cur_value=year+month+day+"000000000";}cur_text=maskobj.applyMask(cur_value);this._setSpinValue(cur_value,cur_text,pos);}else{cur_text=maskobj.applyMaskSpin(pos,1);cur_value=maskobj.changeNormalizeValueFromBuffer();pre_text=this._getEventInfoText(pre_value);post_text=this._getEventInfoText(cur_value);if(!this.on_fire_onspin(this,pre_text,pre_value,post_text,cur_value,true)){cur_text=pre_value?pre_text:maskobj.applyMask(this.value);cur_value=pre_value?pre_value:maskobj.removeMask(cur_text);}maskobj.applyMask(cur_value);this._setSpinValue(cur_value,cur_text,pos);}}}};_pCalendar._on_spin_mobile_onspindown=function(){if(this.readonly){return false;}var calendaredit=this.calendaredit;if(calendaredit){var cur_text="";var cur_value;var pre_text;var pre_value=this._default_value;var post_text="";var pos=this.getCaretPos();var maskobj=this._masktypeobj;if(maskobj){if(!maskobj.date){var currDate=this._getCurrentDate();var year=nexacro._toString(currDate.year).padLeft(4,"0");var month=nexacro._toString(currDate.month).padLeft(2,"0");var day=nexacro._toString(currDate.day).padLeft(2,"0");var type=maskobj.getEditFormatType();switch(type){case 0:cur_value=year+month+day;break;case 1:cur_value="000000000";break;case 2:cur_value=year+month+day+"000000000";}cur_text=maskobj.applyMask(cur_value);this._setSpinValue(cur_value,cur_text,pos);}else{cur_text=maskobj.applyMaskSpin(pos, -1);cur_value=maskobj.changeNormalizeValueFromBuffer();pre_text=this._getEventInfoText(pre_value);post_text=this._getEventInfoText(cur_value);if(!this.on_fire_onspin(this,pre_text,pre_value,post_text,cur_value,true)){cur_text=pre_value?pre_text:maskobj.applyMask(this.value);cur_value=pre_value?pre_value:maskobj.removeMask(cur_text);}maskobj.applyMask(cur_value);this._setSpinValue(cur_value,cur_text,pos);}}}};_pCalendar._on_datepicker_ondayclick=function(obj,e){if(this.readonly){return;}var ret=true;var maskobj=this._masktypeobj;var from_comp=e.fromobject;var cur_date=from_comp._year+from_comp._month+from_comp.text.padLeft(2,"0");var h=maskobj._date[3]?maskobj._date[3]:"";var m=maskobj._date[4]?maskobj._date[4]:"";var s=maskobj._date[5]?maskobj._date[5]:"";var ss=maskobj._date[6]?maskobj._date[6]:"";var editmast_type=maskobj.getEditFormatType();var pre_value=this.value;var cur_value;if(editmast_type==1){if(!nexacro._isNull(h)){h=h.padLeft(2,"0");}if(!nexacro._isNull(m)){m=m.padLeft(2,"0");}if(!nexacro._isNull(s)){s=s.padLeft(2,"0");}if(!nexacro._isNull(ss)){ss=ss.padLeft(3,"0");}cur_value=maskobj.changeNormalizeValue(h+m+s+ss);}else{cur_value=maskobj.changeNormalizeValue(cur_date+h+m+s+ss);}this.on_fire_ondayclick(cur_date);if(pre_value!=cur_value){ret=this._on_value_change(pre_value,cur_value);}else{this._setCalendarEditValue(this.value);}if(ret){if(this._isPopupVisible()){this._closePopup();}}else{if(this.type=="monthonly"&&from_comp){from_comp._changeStatus("focused",false);}}if(this.autoskip){this._setFocusToNextComponent();}else{this._setDefaultCaret();}};_pCalendar._on_datepicker_oncloseup=function(){var _window=this._getWindow();if(_window&&this._track_capture){_window._releaseCaptureLock(this);}this._changeStatus("mouseover",false);this.calendaredit._changeStatus("mouseover",false);this.dropbutton._changeStatus("mouseover",false);this.on_fire_oncloseup(this,this._default_text,this._default_value,this.text,this.value);};_pCalendar.on_focus_basic_action=function(self_flag,evt_name,lose_focus,refer_lose_focus,new_focus,refer_new_focus){this._changeStatus("focused",true);if(nexacro._enableaccessibility&&this.type=="monthonly"){this.datepicker.body._on_focus(false);}var bMobile=(nexacro._isTouchInteraction&&nexacro._SupportTouch&&(this._type=="system"));if(!bMobile&&!(refer_new_focus instanceof nexacro._CalendarEditControl)){var calendaredit=this.calendaredit;if(calendaredit){calendaredit._on_focus(true,nexacro._getBrowserEventName(evt_name));if(!this.autoselect&&!this._change_caret_from_method){this._setDefaultCaret();}}}this._change_caret_from_method=false;};_pCalendar.on_killfocus_basic_action=function(){var calendaredit=this.calendaredit;var datepicker=this.datepicker;if(this.type!="monthonly"){if(this.value!=calendaredit.value){this._on_value_change(this.value,calendaredit.value);}else if(this.text!=calendaredit.text){this._setValue(this.value);}}else{if(datepicker){datepicker._refreshSpindate();}this.on_apply_value(this.value);}if(this._isPopupVisible()){this._closePopup();}};_pCalendar.on_fire_sys_onmousewheel=function(wheelDeltaX,wheelDeltaY,button,alt_key,ctrl_key,shift_key,screenX,screenY,canvasX,canvasY,clientX,clientY,from_comp,from_refer_comp){nexacro.Component.prototype.on_fire_user_onmousewheel.call(this,wheelDeltaX,wheelDeltaY,button,alt_key,ctrl_key,shift_key,screenX,screenY,canvasX,canvasY,clientX,clientY,from_comp,from_refer_comp);return (this._popupcontrol&&this._popupcontrol._is_popup())?true:false;};_pCalendar.on_fire_sys_onslide=function(elem,touch_manager,touchinfos,xaccvalue,yaccvalue,xdeltavalue,ydeltavalue,from_comp,from_refer_comp){var ret=nexacro.Component.prototype.on_fire_sys_onslide.call(this,elem,touch_manager,touchinfos,xaccvalue,yaccvalue,xdeltavalue,ydeltavalue,from_comp,from_refer_comp);this._updatePopupControlPosition();return ret;};_pCalendar.on_fire_sys_onfling=function(elem,fling_handler,xstartvalue,ystartvalue,xdeltavalue,ydeltavalue,touchlen,from_comp,from_refer_comp){var ret=nexacro.Component.prototype.on_fire_sys_onfling.call(this,elem,fling_handler,xstartvalue,ystartvalue,xdeltavalue,ydeltavalue,touchlen,from_comp,from_refer_comp);this._updatePopupControlPosition();return ret;};_pCalendar.on_fire_oneditclick=function(obj,caretpos,button,alt_key,ctrl_key,shift_key,screenX,screenY,canvasX,canvasY,clientX,clientY,from_comp,from_refer_comp){if(this.visible&&this._isEnable()&&this.enableevent){if(this.oneditclick&&this.oneditclick._has_handlers){var evt=new nexacro.EditClickEventInfo(this,"oneditclick",caretpos,button,alt_key,ctrl_key,shift_key,screenX,screenY,canvasX,canvasY,clientX,clientY,this,from_refer_comp);return this.oneditclick._fireEvent(this,evt);}}return true;};_pCalendar.on_fire_ondayclick=function(postdate){if(this.ondayclick&&this.ondayclick._has_handlers){var evt=new nexacro.CalendarDayClickEventInfo(this,"ondayclick",postdate);return this.ondayclick._fireEvent(this,evt);}return true;};_pCalendar.on_fire_canchange=function(obj,pretext,prevalue,posttext,postvalue){if(this.canchange&&this.canchange._has_handlers){var evt=new nexacro.ChangeEventInfo(this,"canchange",pretext,prevalue,posttext,postvalue);return this.canchange._fireCheckEvent(this,evt);}return true;};_pCalendar.on_fire_onchanged=function(obj,pretext,prevalue,posttext,postvalue){if(this.onchanged&&this.onchanged._has_handlers){var evt=new nexacro.ChangedEventInfo(this,"onchanged",pretext,prevalue,posttext,postvalue);return this.onchanged._fireEvent(this,evt);}};_pCalendar.on_fire_oncloseup=function(obj,pretext,prevalue,posttext,postvalue){if(this.oncloseup&&this.oncloseup._has_handlers){var evt=new nexacro.CalendarCloseUpEventInfo(this,"oncloseup",pretext,posttext,prevalue,postvalue);return this.oncloseup._fireEvent(this,evt);}return false;};_pCalendar.on_fire_ondropdown=function(obj){if(this.ondropdown&&this.ondropdown._has_handlers){var evt=new nexacro.Event(this,"ondropdown");evt.fromreferenceobject=this.dropbutton;return this.ondropdown._fireCheckEvent(this,evt);}return true;};_pCalendar.on_fire_oninput=function(){if(this.oninput&&this.oninput._has_handlers){var evt=new nexacro.InputEventInfo(this,"oninput");return this.oninput._fireEvent(this,evt);}return true;};_pCalendar.on_fire_onspin=function(obj,pretext,prevalue,posttext,postvalue,isUp){if(this.onspin&&this.onspin._has_handlers){var evt=new nexacro.CalendarSpinEventInfo(this,"onspin",pretext,posttext,prevalue,postvalue,isUp);return this.onspin._fireCheckEvent(this,evt);}return true;};_pCalendar.on_fire_oninnerdatachanged=function(obj,oldvalue,newvalue,columnid,col,row){if(this.oninnerdatachanged&&this.oninnerdatachanged._has_handlers){var evt=new nexacro.InnerdataChangedEventInfo(obj,"oninnerdatachanged",oldvalue,newvalue,columnid,col,row);return this.oninnerdatachanged._fireEvent(this,evt);}return true;};_pCalendar._createCalendaredit=function(){var calendaredit=this.calendaredit;if(!calendaredit){calendaredit=this.calendaredit=new nexacro._CalendarEditControl("calendaredit",0,0,0,0,null,null,null,null,null,null,this,this._onlydisplay);calendaredit.set_displaynulltext(this.displaynulltext);calendaredit.set_readonly(this.readonly);calendaredit.set_autoselect(this.autoselect);calendaredit.set_autoskip(this.autoskip);calendaredit.set_usecontextmenu(this.usecontextmenu);calendaredit.createComponent(true);}};_pCalendar._createDropbutton=function(){var dropbutton=this.dropbutton;if(!dropbutton){dropbutton=this.dropbutton=new nexacro._CalendarDropButtonControl("dropbutton",0,0,0,0,null,null,null,null,null,null,this);dropbutton.createComponent(true);}};_pCalendar._createSpinbutton=function(){var spinupbutton=this.calendarspinupbutton;if(!spinupbutton){spinupbutton=this.calendarspinupbutton=new nexacro._CalendarSpinButtonControl("calendarspinupbutton",0,0,0,0,null,null,null,null,null,null,this);spinupbutton.createComponent(true);}var spindownbutton=this.calendarspindownbutton;if(!spindownbutton){spindownbutton=this.calendarspindownbutton=new nexacro._CalendarSpinButtonControl("calendarspindownbutton",0,0,0,0,null,null,null,null,null,null,this);spindownbutton.createComponent(true);}};_pCalendar._createDatePicker=function(){var datepicker=this.datepicker;if(!datepicker){datepicker=this.datepicker=new nexacro.DatePickerControl("datepicker",0,0,0,0,null,null,null,null,null,null,this);if(this.type=="monthonly"){datepicker._is_focus_accept=true;}else{datepicker._setPopupContains(true);datepicker._is_focus_accept=false;}datepicker.createComponent(true);}};_pCalendar._createPopupControl=function(){var popupcontrol=this._popupcontrol;if(!popupcontrol){popupcontrol=this._popupcontrol=new nexacro._CalendarPopupControl("calendarpopup",0,0,0,0,null,null,null,null,null,null,this);popupcontrol.createComponent(true);}};_pCalendar._createNormaltypeControl=function(){var control_elem=this.getElement();if(control_elem){this._createCalendaredit();this._createDropbutton();this._createPopupControl();this._createDatePicker();this._setEventHandlerToCalendarEdit();this._setEventHandlerToDropButton();this._setEventHandlerToDatePicker();this._applyAllProps();if(this._is_created){var calendaredit=this.calendaredit;var dropbutton=this.dropbutton;if(calendaredit){calendaredit._on_apply_inputtype();calendaredit.on_created();}if(dropbutton){dropbutton.on_created();}}}};_pCalendar._createSpintypeControl=function(){var control_elem=this.getElement();if(control_elem){this._createCalendaredit();this._createSpinbutton();this._setEventHandlerToCalendarEdit();this._setEventHandlerToSpinButton();this._applyAllProps();if(this._is_created){var calendaredit=this.calendaredit;var spinupbutton=this.calendarspinupbutton;var spindownbutton=this.calendarspindownbutton;if(calendaredit){calendaredit.on_created();}if(spinupbutton){spinupbutton.on_created();}if(spindownbutton){spindownbutton.on_created();}}}};_pCalendar._createMonthlytypeControl=function(){var control_elem=this.getElement();if(control_elem){this._createDatePicker();this._setEventHandlerToDatePicker();this._applyDatePickerProps();if(this._is_created){var datepicker=this.datepicker;if(datepicker){datepicker.on_created();}}}};_pCalendar._createSystemtypeControl=function(){var control_elem=this.getElement();if(control_elem){this._createCalendaredit();this._setEventHandlerToCalendarEdit();this._applyAllProps();if(this._is_created){var calendaredit=this.calendaredit;if(calendaredit){calendaredit._on_apply_inputtype();calendaredit.on_created();}}}};_pCalendar._createPopupDatePickerControl=function(){this._createPopupControl();this._createDatePicker();var datepicker=this.datepicker;var popupcontrol=this._popupcontrol;if(!popupcontrol._is_created){popupcontrol._attach(datepicker);popupcontrol.on_created();}if(!datepicker._is_created){this._setEventHandlerToDatePicker();this._applyDatePickerProps();datepicker.on_created();}};_pCalendar._destroyControl=function(){if(this.calendaredit){this.calendaredit.destroy();this.calendaredit=null;}if(this.dropbutton){this.dropbutton.destroy();this.dropbutton=null;}if(this.calendarspinupbutton){this.calendarspinupbutton.destroy();this.calendarspinupbutton=null;}if(this.calendarspindownbutton){this.calendarspindownbutton.destroy();this.calendarspindownbutton=null;}if(this.datepicker){this.datepicker.destroy();this.datepicker=null;}if(this._popupcontrol){this._popupcontrol.destroy();this._popupcontrol=null;}};_pCalendar._recalcLayout=function(){if(this._is_created_contents){var calendaredit=this.calendaredit;var dropbutton=this.dropbutton;var spinupbutton=this.calendarspinupbutton;var spindownbutton=this.calendarspindownbutton;var datepicker=this.datepicker;var client_width=this._getClientWidth();var client_height=this._getClientHeight();var buttonsize=this.buttonsize;var buttonsize_w,buttonsize_h;if(buttonsize==undefined){buttonsize_w=client_height;buttonsize_h=client_height;}else{buttonsize=buttonsize.split(" ");buttonsize_w= +buttonsize[0];buttonsize_h=(buttonsize[1])? +buttonsize[1]:client_height;}if(buttonsize_w>client_width){buttonsize_w=client_width;}if(buttonsize_h>client_height){buttonsize_h=client_height;}switch(this._type){case "system":case "normal":var button_l=client_width-buttonsize_w;var button_t=0;if(buttonsize_h<client_height){button_t=(client_height-buttonsize_h)/2;}dropbutton.move(button_l,button_t,buttonsize_w,buttonsize_h,null,null);calendaredit.move(0,0,button_l,client_height,null,null);calendaredit.set_visible(true);dropbutton.set_visible(true);break;case "spin":var upbutton_l=client_width-buttonsize_w;var upbutton_t=0;var upbutton_h=Math.floor(buttonsize_h/2);if(buttonsize_h<client_height){upbutton_t=(client_height-buttonsize_h)/2;}var downbutton_l=upbutton_l;var downbutton_t=buttonsize_h-upbutton_h+upbutton_t;var downbutton_h=Math.floor(buttonsize_h/2);spinupbutton.move(upbutton_l,upbutton_t,buttonsize_w,upbutton_h,null,null);spindownbutton.move(downbutton_l,downbutton_t,buttonsize_w,downbutton_h,null,null);calendaredit.move(0,0,upbutton_l,client_height,null,null);calendaredit.set_visible(true);spinupbutton.set_visible(true);spindownbutton.set_visible(true);break;case "monthonly":this._applyDatePickerProps();datepicker.move(0,0,client_width,client_height,null,null);datepicker.set_visible(true);break;}}};_pCalendar._updatePopupControlPosition=function(){var popupcontrol=this._popupcontrol;if(popupcontrol){var control_elem=this.getElement();var popup_control_elem=popupcontrol.getElement();var pos=this._getElementPosition(control_elem);var left=pos.x;var top=pos.y+(this._adjust_height);popup_control_elem.setElementPosition(left,top);}};_pCalendar._showPopup=function(){if(this.type!="normal"){return;}if(nexacro._enableaccessibility){this._want_arrows=true;}var _window=this._getWindow();var control_elem=this.getElement();if(control_elem){var ret=this.on_fire_ondropdown(this);if(this.popuptype=="none"||this._type=="system"){return;}if(ret){this._createPopupDatePickerControl();var popupcontrol=this._popupcontrol;var popupsize=this._getPopupSizeArr();var pos=this._getElementPosition();var cal_winpos_left=pos.x;var cal_winpos_top=pos.y;var parentpos=popupcontrol._getPopupParentPos();var cal_height=parentpos.height;var popup_left=0;var popup_top=cal_height;var popup_width=popupsize.width;var popup_height=popupsize.height;var popup_winpos_right=cal_winpos_left+popup_width;var popup_winpos_bottom=cal_winpos_top+cal_height+popup_height;var win_width=_window.clientWidth;var win_height=_window.clientHeight;var width_gap=popup_winpos_right-win_width;if(popup_winpos_right>win_width&&cal_winpos_left>width_gap){popup_left=popup_left-width_gap;}if(cal_winpos_left<0){popup_left= -cal_winpos_left;}if(cal_winpos_top>popup_height&&popup_winpos_bottom>win_height){popup_top= -popup_height;}if(popup_winpos_bottom>win_height){var t_temp=win_height-popup_height;if(t_temp<0){popup_top= -cal_winpos_top;}else{popup_top=t_temp-cal_winpos_top;}}if(this.popuptype=="center"){var frame=_window.frame;var frame_pos=nexacro._getElementPositionInFrame(frame.getElement());var l=((frame.width/2)-(popup_width/2));var t=((frame.height/2)-(popup_height/2));t=t<0?0:t;popupcontrol._popup((l+frame_pos.x),(t+frame_pos.y),popup_width,popup_height);}else{popupcontrol._popupBy(this,popup_left+parentpos.xgap,popup_top+parentpos.ygap,popup_width,popup_height);}if(_window&&this._track_capture){_window._setCaptureLock(this,true,false);}}}};_pCalendar._applyZoomPopup=function(){if(this._isPopupVisible()){this._showPopup();}};_pCalendar._closePopup=function(){if(this._type=="system"){nexacro._closeSystemCalendar();return;}else{var popupcontrol=this._popupcontrol;if(popupcontrol){popupcontrol._closePopup();}}if(nexacro._enableaccessibility){var type=this.type;this._want_arrows=false;if(type=="normal"){var _window=this._getWindow();_window._removeFromCurrentFocusPath(this.calendaredit,true);this.calendaredit._on_focus(true);}}};_pCalendar._setContents=function(str){var doc=nexacro._parseXMLDocument(str);var node=doc.getElementsByTagName("Dataset")[0];if(!node){return false;}var idstr=node.attributes[0].value;var normalDataset=new nexacro.NormalDataset(idstr,this);if(node.firstChild){var childnode=node.firstChild;var strXML="";while(childnode){if(node.nodeType==1){strXML+=nexacro._documentToXml(childnode);}childnode=childnode.nextSibling;}normalDataset._setContents(strXML);}this.set_innerdataset(normalDataset);return true;};_pCalendar._on_repeat=function(fromComp){var type=this._type;var fromObject=fromComp;if(type=="spin"){var bMobile=(nexacro._isTouchInteraction&&nexacro._SupportTouch);if(bMobile){if(fromObject.id=="calendarspinupbutton"){this._on_spin_mobile_onspinup();}else if(fromObject.id=="calendarspindownbutton"){this._on_spin_mobile_onspindown();}}else{if(fromObject.id=="calendarspinupbutton"){this._on_spin_onspinup();}else if(fromObject.id=="calendarspindownbutton"){this._on_spin_onspindown();}}}else{var parentObject=fromComp.parent;if(fromObject.id=="spinupbutton"){parentObject._on_spin_up();}else if(fromObject.id=="spindownbutton"){parentObject._on_spin_down();}else if(fromObject.id=="nextbutton"){this.datepicker._on_button_onnextlbuttondown();}else if(fromObject.id=="prevbutton"){this.datepicker._on_button_onprevlbuttondown();}}};_pCalendar._on_beforerepeat=function(refer_comp){if(this._type=="spin"){if(refer_comp==this.calendarspindownbutton||refer_comp==this.calendarspinupbutton){return [true,true];}}else{var datepicker=this.datepicker;if(datepicker){return datepicker._on_beforerepeat(refer_comp);}}return [false,true];};_pCalendar._convertValueType=function(v,dateobj,bapplyrule){var ret,datatyperule;if(bapplyrule){datatyperule=nexacro._getDatatypeRule();if(datatyperule=="1.0"){return v;}}ret=(dateobj===undefined||dateobj===null)?dateobj:nexacro._toString(dateobj);return ret;};_pCalendar._setValue=function(v){var maskobj=this._masktypeobj;if(maskobj){v=maskobj.changeNormalizeValue(v);this.value=v;this.on_apply_value(v);}};_pCalendar._setSpinValue=function(value,text,pos){this._default_value=value;this.text=this._default_text=text;var calendaredit=this.calendaredit;if(calendaredit){calendaredit._setSpinValue(text,pos);}};_pCalendar._setCalendarEditValue=function(value){var calendaredit=this.calendaredit;if(calendaredit){calendaredit._setValue(value);if(nexacro._enableaccessibility){this._accessibilityvalue=calendaredit.text;this._updateAccessibilityLabel();calendaredit._updateAccessibilityLabel();}}};_pCalendar._setDatePickerValue=function(value){var datepicker=this.datepicker;if(datepicker){datepicker._setValue(value);}};_pCalendar._setLocale=function(v){if(!this.locale&&v!=this._locale){this._locale=v;this.on_apply_locale(v);this.on_apply_weekformat(this.weekformat);this.on_apply_value(this.value);}};_pCalendar._setInnerDatasetStr=function(str){this._removeEventHandlerToInnerDataset();if(!str){this._innerdataset=null;this.innerdataset="";}else{str=str.replace("@","");this._innerdataset=this._findDataset(str);this.innerdataset=str;}};_pCalendar._setDefaultCaret=function(){var edit=this.calendaredit;if(edit&&this._type!="system"&&nexacro._checkActiveElement(edit._input_element)){edit.setCaretPos(0);}};_pCalendar._setFocusToNextComponent=function(){var root_comp=this._getRootComponent(this);var next_comp=this._getForm().getNextComponent(root_comp,true);if(next_comp){next_comp.setFocus();if(!next_comp.autoselect&&next_comp._is_editable_control){next_comp._setDefaultCaret();}}};_pCalendar._setEventHandlerToCalendarEdit=function(){var calendaredit=this.calendaredit;if(calendaredit){calendaredit._setEventHandler("onkeydown",this._on_edit_onkeydown,this);calendaredit._setEventHandler("onlbuttondown",this._on_edit_onlbuttondown,this);calendaredit._setEventHandler("onlbuttonup",this._on_edit_onlbuttonup,this);calendaredit._setEventHandler("oneditclick",this._on_edit_oneditclick,this);calendaredit._setEventHandler("oninput",this._on_edit_oninput,this);}};_pCalendar._setEventHandlerToDropButton=function(){var dropbutton=this.dropbutton;if(dropbutton){var bMobile=(nexacro._isTouchInteraction&&nexacro._SupportTouch);if(bMobile){if(this._type=="system"){dropbutton._setEventHandler("onclick",this._on_edit_oneditclick,this);}else{dropbutton._setEventHandler("onclick",this._on_drop_mobile_onclick,this);}}else{dropbutton._setEventHandler("onclick",this._on_drop_onclick,this);dropbutton._setEventHandler("onlbuttondown",this._on_drop_onlbuttondown,this);}}};_pCalendar._setEventHandlerToSpinButton=function(){var bMobile=(nexacro._isTouchInteraction&&nexacro._SupportTouch);var spinupbutton=this.calendarspinupbutton;if(spinupbutton){if(bMobile){spinupbutton._setEventHandler("onclick",this._on_spin_mobile_onspinup,this);}else{spinupbutton._setEventHandler("onclick",this._on_spin_onspinup,this);}}var spindownbutton=this.calendarspindownbutton;if(spindownbutton){if(bMobile){spindownbutton._setEventHandler("onclick",this._on_spin_mobile_onspindown,this);}else{spindownbutton._setEventHandler("onclick",this._on_spin_onspindown,this);}}};_pCalendar._setEventHandlerToDatePicker=function(){var datepicker=this.datepicker;if(datepicker){datepicker._setEventHandler("ondayclick",this._on_datepicker_ondayclick,this);datepicker._setEventHandler("oncloseup",this._on_datepicker_oncloseup,this);}};_pCalendar._getDateMaskObj=function(){return this._masktypeobj;};_pCalendar._getFormatType=function(){var maskobj=this._masktypeobj;if(maskobj){return maskobj.getEditFormatType();}return;};_pCalendar._getCurrentDate=function(){var maskobj=this._masktypeobj;if(maskobj){return maskobj.getCurrentDate();}return;};_pCalendar._getCurrentDateStr=function(){var maskobj=this._masktypeobj;if(maskobj){var currDate=maskobj.getCurrentDate();if(currDate){var year=nexacro._toString(currDate.year).padLeft(4,"0");var month=nexacro._toString(currDate.month).padLeft(2,"0");var day=nexacro._toString(currDate.day).padLeft(2,"0");var type=maskobj.getEditFormatType();var val="";switch(type){case 0:val=year+month+day;break;case 1:val="000000000";break;case 2:val=year+month+day+"000000000";}return maskobj.applyMask(val);}}return "";};_pCalendar._getEndDay=function(y,m){var maskobj=this._masktypeobj;if(maskobj){return maskobj.getEndDay(y,m);}return;};_pCalendar._getPopupSizeArr=function(){var size=this.popupsize;if(!size){size="200 220";}size=size.split(/\s+/);var width= +size[0];var height=size[1]? +size[1]:width;return {width:width,height:height};};_pCalendar._getElementPosition=function(){return nexacro._getElementPositionInFrame(this.getElement());};_pCalendar._getEventInfoText=function(v){var ret="";var maskobj=this._masktypeobj;if(maskobj){var cur_status=maskobj.getEditStatus();maskobj.setEditStatus(false);var binvalid=this._isInvalidValue(v);if(binvalid){ret=maskobj.applyMask("");}else{ret=maskobj.applyMask(v);}maskobj.setEditStatus(cur_status);}return ret;};_pCalendar._isPopupVisible=function(){var ret=false;if(this.type!="monthonly"){if(this._popupcontrol){ret=this._popupcontrol.visible;}}return ret;};_pCalendar._applyAllProps=function(){this.on_apply_innerdataset(this._innerdataset);this.on_apply_locale(this._getLocale());this.on_apply_weekformat(this.weekformat);this.on_apply_readonly(this.readonly);this.on_apply_editformat(this.editformat);this.on_apply_dateformat(this.dateformat);this.on_apply_value(this.value);};_pCalendar._applyDatePickerProps=function(){var maskobj=this._masktypeobj;var datepicker=this.datepicker;if(datepicker){datepicker._setEnable(this.enable);datepicker.set_readonly(this.readonly);datepicker._setValue(maskobj.getDatePickerValue());}};_pCalendar._makeCalendarText=function(value){if(!value){return "";}var val_str=value.toString();var oldformat=this._currentformat;this._currentformat="dateformat";var date=this._makeMaskValue(val_str);var mask=this._makeMask("dateformat",this._makeDateObj(value));var txt_idx=0;var return_txt="";var matchStr="yMdHhmsl";this._currentformat=oldformat;for(var i=0,n=mask.length;i<n;i++ ){var mask_ch=mask.charAt(i);if(matchStr.indexOf(mask_ch)>=0){return_txt+=date.charAt(txt_idx);txt_idx++ ;}else{if(mask_ch==="~"||mask_ch==="^"){return_txt+=date.charAt(txt_idx);txt_idx++ ;}else{return_txt+=mask_ch;}}}return return_txt;};_pCalendar._isValidDate=function(val,editmask_type){var y,M,d;var h,m,s,ss;switch(editmask_type){case 0:y=val.substr(0,4);M=val.substr(4,2);d=val.substr(6,2);break;case 1:h=val.substr(0,2);m=val.substr(2,2);s=val.substr(4,2);ss=val.substr(6,3);break;case 2:y=val.substr(0,4);M=val.substr(4,2);d=val.substr(6,2);h=val.substr(8,2);m=val.substr(10,2);s=val.substr(12,2);ss=val.substr(14,3);break;}if((y&&isNaN(y= +y))||(M&&isNaN(M= +M))||(d&&isNaN(d= +d))||(h&&isNaN(h= +h))||(m&&isNaN(m= +m))||(s&&isNaN(s= +s))||(ss&&isNaN(ss= +ss))){return false;}var maskobj=this._masktypeobj;var maxDay=maskobj.getEndDay(y,M);if((editmask_type!=1&&!maxDay)||(M&&( +M>12))||(d&&( +d>maxDay))||(h&&( +h>=24))||(m&&( +m>=60))||(s&&( +s>=60))||(ss&&( +ss>=1000))){return false;}return true;};_pCalendar._isInvalidValue=function(v){if(nexacro._isNull(v)||v===""){return false;}var dateobj;if(v instanceof Date||v instanceof nexacro.Date){dateobj=v;}else{dateobj=this._convertToDateObject(v);}if(dateobj){if(dateobj._isInvalidDate?dateobj._isInvalidDate():isNaN(dateobj.valueOf())){return true;}var year=dateobj.getFullYear();if(year<0||year>9999){return true;}}return false;};_pCalendar._convertToDateObject=function(v){if(nexacro._isNull(v)||v===""){return null;}var dateobj;var maskobj=this._masktypeobj;var editformattype=maskobj.getEditFormatType();if(editformattype<0){if(this.editformat){this.on_apply_editformat(this.editformat);}editformattype=maskobj.getEditFormatType();}if(v instanceof Date||v instanceof nexacro.Date){dateobj=v;}else{v=nexacro._toString(v);if(/[^0-9]/.test(v)){dateobj=new Date(v);}else{dateobj=maskobj.convertToDateObject(v,editformattype);}}if(dateobj){if(isNaN(dateobj.valueOf())){return dateobj;}switch(editformattype){case 0:dateobj=new nexacro.Date(dateobj.getFullYear(),dateobj.getMonth(),dateobj.getDate());break;case 1:dateobj=new nexacro.Date(dateobj.getFullYear(),dateobj.getMonth(),dateobj.getDate(),dateobj.getHours(),dateobj.getMinutes(),dateobj.getSeconds(),dateobj.getMilliseconds());dateobj._timeonly=true;break;case 2:dateobj=new nexacro.Date(dateobj.getFullYear(),dateobj.getMonth(),dateobj.getDate(),dateobj.getHours(),dateobj.getMinutes(),dateobj.getSeconds(),dateobj.getMilliseconds());break;default:break;}}return dateobj;};_pCalendar._on_getDisplayText=function(){var calendaredit=this.calendaredit;if(calendaredit){return calendaredit._on_getDisplayText();}};delete _pCalendar;nexacro._CalendarDropButtonControl=function(id,left,top,width,height,right,bottom,minwidth,maxwidth,minheight,maxheight,parent){nexacro.Button.call(this,id,left,top,width,height,right,bottom,minwidth,maxwidth,minheight,maxheight,parent);};var _pCalendarDropButtonControl=nexacro._createPrototype(nexacro.Button,nexacro._CalendarDropButtonControl);nexacro._CalendarDropButtonControl.prototype=_pCalendarDropButtonControl;_pCalendarDropButtonControl._type_name="ButtonControl";_pCalendarDropButtonControl._is_subcontrol=true;_pCalendarDropButtonControl.on_focus_basic_action=function(self_flag,evt_name,lose_focus,refer_lose_focus,new_focus,refer_new_focus){var calendar=this.parent;if(calendar){var bMobile=(nexacro._isTouchInteraction&&nexacro._SupportTouch);if(bMobile){nexacro.Component.prototype.on_focus_basic_action.call(this,self_flag,evt_name,lose_focus,refer_lose_focus,new_focus,refer_new_focus);}else{calendar._apply_setfocus(evt_name);}}};_pCalendarDropButtonControl._on_click=function(elem,button,alt_key,ctrl_key,shift_key,canvasX,canvasY,screenX,screenY){if(!this._is_alive){return;}if(this.visible&&this.parent._isEnable()&&this.enableevent){var clientXY=this._getClientXY(canvasX,canvasY);this.on_fire_onclick(button,alt_key,ctrl_key,shift_key,screenX,screenY,canvasX,canvasY,clientXY[0],clientXY[1],this,this);this.on_click_basic_action(elem,button,alt_key,ctrl_key,shift_key,canvasX,canvasY,screenX,screenY);}};delete _pCalendarDropButtonControl;nexacro._CalendarSpinButtonControl=function(id,left,top,width,height,right,bottom,minwidth,maxwidth,minheight,maxheight,parent){nexacro.Button.call(this,id,left,top,width,height,right,bottom,minwidth,maxwidth,minheight,maxheight,parent);};var _pCalendarSpinButtonControl=nexacro._createPrototype(nexacro.Button,nexacro._CalendarSpinButtonControl);nexacro._CalendarSpinButtonControl.prototype=_pCalendarSpinButtonControl;_pCalendarSpinButtonControl._type_name="ButtonControl";_pCalendarSpinButtonControl._is_subcontrol=true;_pCalendarSpinButtonControl.on_focus_basic_action=function(self_flag,evt_name,lose_focus,refer_lose_focus,new_focus,refer_new_focus){var calendar=this.parent;if(calendar){calendar._apply_setfocus(evt_name);}};delete _pCalendarSpinButtonControl;nexacro._CalendarEditControl=function(id,left,top,width,height,right,bottom,minwidth,maxwidth,minheight,maxheight,parent,onlydisplay){nexacro.MaskEdit.call(this,id,left,top,width,height,right,bottom,minwidth,maxwidth,minheight,maxheight,parent,onlydisplay);};var _pCalendarEditControl=nexacro._createPrototype(nexacro.MaskEdit,nexacro._CalendarEditControl);nexacro._CalendarEditControl.prototype=_pCalendarEditControl;_pCalendarEditControl._type_name="MaskEditControl";_pCalendarEditControl._is_subcontrol=true;_pCalendarEditControl._prevent_clickevent=true;_pCalendarEditControl.on_created_contents=function(win){var input_elem=this._input_element;if(input_elem){this.on_apply_value(this.value);input_elem.create(win);if(nexacro._isNull(this.value)){this._changeUserStatus("nulltext",true);}else{this._changeUserStatus("nulltext",false);if(this._isInvalidValue(this.value)){this._changeUserStatus("invalidtext",true);}else{this._changeUserStatus("invalidtext",false);}}}this.on_apply_displaynulltext(this.displaynulltext);this.on_apply_displayinvalidtext(this.displayinvalidtext);};_pCalendarEditControl.on_create_contents_command=function(){var input_elem=this._input_element;if(input_elem){this.on_apply_value(this.value);return input_elem.createCommand();}return "";};_pCalendarEditControl.on_keydown_default_action=function(keycode,alt_key,ctrl_key,shift_key,refer_comp){if(this.readonly||!this._isEnable()){return;}var input_elem=this._input_element;if(input_elem){var maskobj=this._getMaskObj();var input_value=input_elem.value;var pos=input_elem.getElementCaretPos();var idx,ch;if(keycode==nexacro.KeyCode_ImeInput){input_elem.stopSysEvent();}else if(keycode==nexacro.Event.KEY_BACKSPACE){if(maskobj&&input_value){if(pos.end>0&&pos.begin==pos.end){idx=pos.end-1;while((ch=input_value.charAt(idx))){if(maskobj.isDeletableChar(ch,idx)||idx==0){break;}idx-- ;}maskobj._is_filled=false;if(idx!=(pos.end-1)){input_elem.setElementSetSelect(idx+1,idx+1);}}}}else if(keycode==nexacro.Event.KEY_DEL){if(maskobj&&input_value){var len=input_value.length;if(pos.end<len&&pos.begin==pos.end){idx=pos.end;while((ch=input_value.charAt(idx))){if(maskobj.isDeletableChar(ch,idx)||idx==len){break;}idx++ ;}maskobj._is_filled=false;if(idx!=pos.end){input_elem.setElementSetSelect(idx,idx);}}}}}};_pCalendarEditControl.on_keyinput_basic_action=function(){if(this.readonly||!this._isEnable()){return false;}var input_elem=this._input_element;if(input_elem){var input_value=input_elem.value;var input_text=input_value?input_value:"";var maskobj=this._getMaskObj();if(maskobj){if(maskobj._editmasked_empty_text==input_text){input_value="";}else{if(maskobj._use_edit_buf){input_value=maskobj.changeNormalizeValueFromBuffer();}else{input_value=maskobj.removeMask(input_text.split(''));input_value=maskobj.changeNormalizeValue(input_value);}}}if(!input_value&&!this._default_value){this.value=this._default_value;}else{this.value=input_value;}this.text=input_text;if(this._undostack){var pos=input_elem.getElementCaretPos();if(pos&&pos!= -1){this._undostack.push(input_text,pos.begin,pos.end);}else{this._undostack.push(input_text,0,0);}}}};_pCalendarEditControl._beforeinput_process_with_HTMLEvent=function(value,status,begin,end,inputType){var input_elem=this._input_element;var maskobj=this._getMaskObj();var ret=[];if(maskobj){var input_value=input_elem._getInputValue();var front_text,rear_text,update_value,result,input_pos;switch(inputType){case "deleteContentBackward":if(begin==end){front_text=input_value.substring(0,begin-1);rear_text=input_value.substring(end);update_value=front_text+rear_text;result=maskobj.arrangeMask(update_value,begin-1,begin-1);input_elem._beforeinput_result_data=result.text;input_elem._beforeinput_result_pos={begin:result.pos,end:result.pos};}else{front_text=input_value.substring(0,begin);rear_text=input_value.substring(end);update_value=front_text+rear_text;if((end-begin==input_value.length)){input_elem._beforeinput_result_data=maskobj.applyMask(update_value);input_elem._beforeinput_result_pos={begin:begin,end:begin};}else{result=maskobj.arrangeMask(update_value,begin,begin);input_elem._beforeinput_result_data=result.text;input_elem._beforeinput_result_pos={begin:result.pos,end:result.pos};}}ret.push(input_elem._BeforeinputState.REPLACE);break;case "deleteContentForward":if(begin==end){front_text=input_value.substring(0,begin);rear_text=input_value.substring(end+1);update_value=front_text+rear_text;result=maskobj.arrangeMask(update_value,begin,begin);input_elem._beforeinput_result_data=result.text;input_elem._beforeinput_result_pos={begin:result.pos,end:result.pos};}else{front_text=input_value.substring(0,begin);rear_text=input_value.substring(end);update_value=front_text+rear_text;if((end-begin==input_value.length)){input_elem._beforeinput_result_data=maskobj.applyMask(update_value);input_elem._beforeinput_result_pos={begin:begin,end:begin};}else{result=maskobj.arrangeMask(update_value,begin,begin);input_elem._beforeinput_result_data=result.text;input_elem._beforeinput_result_pos={begin:result.pos,end:result.pos};}}ret.push(input_elem._BeforeinputState.REPLACE);break;case "deleteByCut":if(begin==end){}else{front_text=input_value.substring(0,begin);rear_text=input_value.substring(end);update_value=front_text+rear_text;if((end-begin==input_value.length)){input_elem._beforeinput_result_data=maskobj.applyMask(update_value);input_elem._beforeinput_result_pos={begin:begin,end:begin};}else{result=maskobj.arrangeMask(update_value,begin,begin);input_elem._beforeinput_result_data=result.text;input_elem._beforeinput_result_pos={begin:result.pos,end:result.pos};}}ret.push(input_elem._BeforeinputState.REPLACE);break;case "insertText":case "insertCompositionText":value=value?value:"";input_pos=maskobj.findNearEditablePos(begin,1);if(input_pos<0||maskobj.isFilterChar(value,input_pos,end)){ret.push(input_elem._BeforeinputState.CANCEL);}else{if(begin==end){update_value=input_value.substring(0,begin)+value+input_value.substring(end);end=end+value.length;}else{var append_value=value+"".padLeft(end-value.length," ");update_value=input_value.substring(0,begin)+append_value+input_value.substring(begin);end=append_value.length;}result=maskobj.arrangeMask(update_value,begin,end);if(result==null){ret.push(input_elem._BeforeinputState.CANCEL);}else{input_pos=maskobj.findNearEditablePos(begin+value.length,1);input_elem._beforeinput_result_data=result.text;input_elem._beforeinput_result_pos={begin:input_pos,end:input_pos};ret.push(input_elem._BeforeinputState.REPLACE);}}break;case "insertFromPaste":input_pos=maskobj.findNearEditablePos(begin,1);if(input_pos<0||maskobj.isFilterChar(value,input_pos)){ret.push(input_elem._BeforeinputState.CANCEL);}else{if(begin==end){update_value=input_value.substring(0,begin)+value+input_value.substring(end);end=end+value.length;}else{update_value=input_value.substring(0,begin)+(value+"".padLeft(" ",end-value.length))+input_value.substring(begin);end=begin+value.length;}result=maskobj.arrangeMask(update_value,begin,end);if(result==null){ret.push(input_elem._BeforeinputState.CANCEL);}else{input_pos=maskobj.findNearEditablePos(result.pos,1);input_elem._beforeinput_result_data=result.text;input_elem._beforeinput_result_pos={begin:input_pos,end:input_pos};ret.push(input_elem._BeforeinputState.REPLACE);}}break;default:ret.push(input_elem._BeforeinputState.PASS);break;}}return ret;};_pCalendarEditControl._beforeinput_process_with_NexacroInputEvent=function(value,status,begin,end){var input_elem=this._input_element;if(input_elem){var input_pos=0;var input_text=value?value:"";var inputtype=input_elem.inputtype;var maskobj=this._getMaskObj();if(maskobj){if(inputtype=="date"){if(maskobj.getCurrentText()!=input_text){value=maskobj.removeMask(input_text.split(''));maskobj.applyMask(value);}}else{var result=maskobj.arrangeMask(input_text,begin,end);if(result==null){input_elem.replaceElementText("",begin,end);input_elem.stopSysEvent();}else{if(begin<end){var insert_text=input_text.substring(begin,end);var new_text=maskobj.removeMask(result.text.split(''));var calendar=this.parent;if(calendar){if(!calendar._isValidDate(new_text,maskobj.getEditFormatType())){input_elem.replaceElementText("",begin,begin+insert_text.length);input_elem.stopSysEvent();return;}}}input_pos=maskobj.findNearEditablePos(result.pos,1);if(result.text!=input_text||result.pos!=input_pos){input_elem.updateElementText(result.text,input_pos);}}}}}};_pCalendarEditControl._isInvalidValue=function(v){return this.parent._isInvalidValue(v);};_pCalendarEditControl._setSpinValue=function(v,pos){var input_elem=this._input_element;if(input_elem){input_elem.setCompositionComplete();if(!this._onlydisplay){input_elem.updateElementText(v,pos);}if(nexacro._enableaccessibility){this._setAccessibilityLabel(v);}}};_pCalendarEditControl._getMaskObj=function(){var calendar=this.parent;if(calendar){return calendar._masktypeobj;}return null;};_pCalendarEditControl._getEmptyText=function(){var maskobj=this._getMaskObj();if(maskobj){return maskobj.getEmptyText();}return "";};nexacro._CalendarPopupControl=function(id,left,top,width,height,right,bottom,minwidth,maxwidth,minheight,maxheight,parent){nexacro.PopupControl.call(this,id,left,top,width,height,right,bottom,minwidth,maxwidth,minheight,maxheight,parent);};var _pCalendarPopupControl=nexacro._createPrototype(nexacro.PopupControl,nexacro._CalendarPopupControl);nexacro._CalendarPopupControl.prototype=_pCalendarPopupControl;_pCalendarPopupControl._type_name="popupCalendar";_pCalendarPopupControl._is_subcontrol=true;_pCalendarPopupControl._getPopupParentPos=function(){var calendar=this.parent;var calendar_size=[calendar._adjust_width,calendar._adjust_height];var calendar_elem_pos=nexacro._getElementPositionInFrame(calendar.getElement());return {"x":calendar_elem_pos.x,"y":calendar_elem_pos.y,"width":calendar_size[0],"height":calendar_size[1],"xgap":0,"ygap":0};};delete _pCalendarPopupControl;}
if(!nexacro.GroupBox){nexacro.GroupBox=function(id,left,top,width,height,right,bottom,minwidth,maxwidth,minheight,maxheight,parent){nexacro.Component.call(this,id,left,top,width,height,right,bottom,minwidth,maxwidth,minheight,maxheight,parent);};var _pGroupBox=nexacro._createPrototype(nexacro.Component,nexacro.GroupBox);nexacro.GroupBox.prototype=_pGroupBox;_pGroupBox._type_name="GroupBox";_pGroupBox._titlecontrol=null;_pGroupBox._boxcontrol=null;_pGroupBox.titlealign="topleft";_pGroupBox.titlegap=undefined;_pGroupBox.tabstop=false;_pGroupBox._title_adjust_width=8;_pGroupBox._is_focus_accept=false;_pGroupBox.accessibilityrole="groupbox";_pGroupBox._event_list={"onlbuttondown":1,"onlbuttonup":1,"onmouseenter":1,"onmouseleave":1,"onmousemove":1,"onmove":1,"onsize":1,"onmousedown":1,"onmouseup":1,"oncontextmenu":1,"ontouchstart":1,"ontouchmove":1,"ontouchend":1};_pGroupBox._accessibility_role="groupbox";_pGroupBox.on_create_contents=function(){var control_elem=this.getElement();if(control_elem){var boxcontrol=this._boxcontrol=new nexacro.Static("groupboxcontents",0,0,0,0,null,null,null,null,null,null,this);boxcontrol._setControl();boxcontrol.createComponent(true);var titlecontrol=this._titlecontrol=new nexacro._IconText("groupboxtitle",0,0,0,0,null,null,null,null,null,null,this);titlecontrol._setControl();titlecontrol.set_text(this._displaytext);titlecontrol.createComponent(true);}};_pGroupBox.on_created_contents=function(win){this._recalcLayout();var boxcontrol=this._boxcontrol;if(boxcontrol){boxcontrol.on_created(win);}var titlecontrol=this._titlecontrol;if(titlecontrol){titlecontrol.on_created(win);}};_pGroupBox.on_destroy_contents=function(){if(this._boxcontrol){this._boxcontrol.destroy();this._boxcontrol=null;}if(this._titlecontrol){this._titlecontrol.destroy();this._titlecontrol=null;}};_pGroupBox.on_create_contents_command=function(){this._recalcLayout();var boxcontrol=this._boxcontrol;var titlecontrol=this._titlecontrol;var str="";if(boxcontrol){str+=boxcontrol.createCommand();}if(titlecontrol){str+=titlecontrol.createCommand();}return str;};_pGroupBox.on_attach_contents_handle=function(win){var boxcontrol=this._boxcontrol;var titlecontrol=this._titlecontrol;if(boxcontrol){boxcontrol.attachHandle(win);}if(titlecontrol){titlecontrol.attachHandle(win);}};_pGroupBox.on_change_containerRect=function(){if(this._is_created_contents){this._recalcLayout();}};_pGroupBox.on_change_containerPos=function(){};_pGroupBox.on_get_prop_tabstop=function(){if(nexacro._enableaccessibility){var accessibility=this.accessibility;if(accessibility&&accessibility.enable&&accessibility.role=="link"){return true;}}return false;};_pGroupBox._isFocusAcceptable=function(){return nexacro._enableaccessibility;};_pGroupBox.on_apply_prop_enable=function(v){var boxcontrol=this._boxcontrol;if(boxcontrol){boxcontrol.set_enable(v);}var titlecontrol=this._titlecontrol;if(titlecontrol){titlecontrol.set_enable(v);}};_pGroupBox.set_titlealign=function(v){var titlealign_enum=["topleft","topcenter","topright","lefttop","leftcenter","leftbottom","righttop","rightcenter","rightbottom","bottomleft","bottomcenter","bottomright"];if(titlealign_enum.indexOf(v)== -1){return;}if(this.titlealign!=v){this.titlealign=v;this.on_apply_titlealign(v);}};_pGroupBox.on_apply_titlealign=function(){this._recalcLayout();};_pGroupBox.set_titlegap=function(v){if(v!==undefined){if(isNaN(v= +v)||v<0){return;}}if(this.titlegap!=v){this.titlegap=v;this.on_apply_titlegap(v);}};_pGroupBox.on_apply_titlegap=function(){this._recalcLayout();};_pGroupBox.on_apply_text=function(text){var titlecontrol=this._titlecontrol;if(titlecontrol){titlecontrol.set_text(text);this._recalcLayout();}};_pGroupBox.on_apply_font=function(font){nexacro.Component.prototype.on_apply_font.call(this,font);this._recalcLayout();};_pGroupBox.on_apply_prop_cssclass=function(){var titlecontrol=this._titlecontrol;if(titlecontrol){titlecontrol.on_apply_cssclass();}var boxcontrol=this._boxcontrol;if(boxcontrol){boxcontrol.on_apply_cssclass();}this._recalcLayout();};_pGroupBox._recalcLayout=function(){var control_elem=this.getElement();if(control_elem&&this._is_created_contents){var titlecontrol=this._titlecontrol;var boxcontrol=this._boxcontrol;var client_w=this._getClientWidth();var client_h=this._getClientHeight();var titlealign=this.titlealign;var titlegap=this.titlegap;if(!titlegap){titlegap=10;}var title_size=titlecontrol._on_getFitSize();var title_w=title_size[0]+this._title_adjust_width;var title_h=title_size[1];var title_l,title_t;var box_l,box_t,box_w,box_h;if(titlealign.indexOf("top")==0){box_l=0;box_t=title_h/2;box_w=client_w;box_h=client_h-(title_h/2);title_t=0;if(titlealign=="topleft"){title_l=titlegap;}else if(titlealign=="topcenter"){title_l=(client_w/2)-(title_w/2);}else if(titlealign=="topright"){title_l=client_w-title_w-titlegap;}}else if(titlealign.indexOf("left")==0){box_l=title_w/2;box_t=0;box_w=client_w-(title_w/2);box_h=client_h;title_l=0;if(titlealign=="lefttop"){title_t=titlegap;}else if(titlealign=="leftcenter"){title_t=(client_h/2)-(title_h/2);}else if(titlealign=="leftbottom"){title_t=client_h-title_h-titlegap;}}else if(titlealign.indexOf("right")==0){box_l=0;box_t=0;box_w=client_w-(title_w/2);box_h=client_h;title_l=client_w-title_w;if(titlealign=="righttop"){title_t=titlegap;}else if(titlealign=="rightcenter"){title_t=(client_h/2)-(title_h/2);}else if(titlealign=="rightbottom"){title_t=client_h-title_h-titlegap;}}else if(titlealign.indexOf("bottom")==0){box_l=0;box_t=0;box_w=client_w;box_h=client_h-(title_h/2);title_t=client_h-title_h;if(titlealign=="bottomleft"){title_l=titlegap;}else if(titlealign=="bottomcenter"){title_l=(client_w/2)-(title_w/2);}else if(titlealign=="bottomright"){title_l=client_w-title_w-titlegap;}}titlecontrol.move(title_l,title_t,title_w,title_h);boxcontrol.move(box_l,box_t,box_w,box_h);}};delete _pGroupBox;}
nexacro.TabIndexChangeEventInfo=function(obj,id,postindex,preindex){this.id=this.eventid=id||"ontabindexchange";this.fromobject=this.fromreferenceobject=obj;this.postindex=postindex;this.preindex=preindex;};var _pTabIndexChangeEventInfo=nexacro._createPrototype(nexacro.Event,nexacro.ChangeEventInfo);nexacro.TabIndexChangeEventInfo.prototype=_pTabIndexChangeEventInfo;_pTabIndexChangeEventInfo._type_name="TabIndexChangeEventInfo";delete _pTabIndexChangeEventInfo;nexacro.TabMouseEventInfo=function(obj,id,index,button,alt_key,ctrl_key,shift_key,screenX,screenY,canvasX,canvasY,clientX,clientY,from_comp,from_refer_comp){nexacro.MouseEventInfo.call(this,obj,id||"onextrabuttonclick",button,alt_key,ctrl_key,shift_key,screenX,screenY,canvasX,canvasY,clientX,clientY,from_comp,from_refer_comp);this.index=index;};var _pTabMouseEventInfo=nexacro._createPrototype(nexacro.Event,nexacro.MouseEventInfo);nexacro.TabMouseEventInfo.prototype=_pTabMouseEventInfo;_pTabMouseEventInfo._type_name="TabMouseEventInfo";delete _pTabMouseEventInfo;if(!nexacro.Tab){nexacro.Tab=function(id,left,top,width,height,right,bottom,minwidth,maxwidth,minheight,maxheight,parent){nexacro.Component.call(this,id,left,top,width,height,right,bottom,minwidth,maxwidth,minheight,maxheight,parent);this._tabbuttonitems=[];this.tabpages=new nexacro.Collection();};var _pTab=nexacro._createPrototype(nexacro.Component,nexacro.Tab);nexacro.Tab.prototype=_pTab;_pTab._type_name="Tab";_pTab.prevbutton=null;_pTab.nextbutton=null;_pTab.multiline=false;_pTab.tabindex= -1;_pTab.focusacceptable=false;_pTab.usecontrolkey=true;_pTab.rotatetext=false;_pTab.tabjustify=false;_pTab.selectchangetype="down";_pTab.tabposition="top";_pTab.extrabutton=null;_pTab.preload=false;_pTab.accessibilityrole="tab";_pTab._default_spinbutton_size={width:14,height:14};_pTab._extrabutton_size=null;_pTab._prevbutton_size=null;_pTab._nextbutton_size=null;_pTab._is_containerset=true;_pTab._init_tabindex=0;_pTab._next_button_idx=0;_pTab._event_list={"onclick":1,"ondblclick":1,"onkeypress":1,"onkeydown":1,"onkeyup":1,"onkillfocus":1,"onsetfocus":1,"ondrag":1,"ondragenter":1,"ondragleave":1,"ondragmove":1,"ondrop":1,"onlbuttondown":1,"onlbuttonup":1,"onmouseenter":1,"onmouseleave":1,"onmousemove":1,"onmove":1,"onsize":1,"onrbuttondown":1,"onrbuttonup":1,"oncontextmenu":1,"onchanged":1,"onspin":1,"canchange":1,"oneditclick":1,"onextrabuttonclick":1,"onmouseup":1,"onmousedown":1,"ontouchstart":1,"ontouchmove":1,"ontouchend":1};_pTab.on_create_contents=function(){var control_elem=this.getElement();if(control_elem){control_elem.setElementSize(this._getClientWidth(),this._getClientHeight());this._createSpinButton(true);this._createTabpages(true);this._createTabButtons(true);}};_pTab.on_created_contents=function(_window){var tabpages=this.tabpages;var tabpages_length=tabpages.length;var tabbuttonitems=this._tabbuttonitems;var tabbuttonitems_length=tabbuttonitems.length;for(var i=0;i<tabpages_length;i++ ){tabpages[i].on_created(_window);if(this.preload){tabpages[i]._on_apply_url();}}for(i=0;i<tabbuttonitems_length;i++ ){tabbuttonitems[i].on_created(_window);}if(this.nextbutton){this.nextbutton.on_created(_window);}if(this.prevbutton){this.prevbutton.on_created(_window);}this._is_created=true;this.on_apply_tabindex(this._init_tabindex);this._rearrangeContents();};_pTab.on_destroy_contents=function(){var tabpages=this.tabpages;var tabpages_length=tabpages.length;var tabbuttonitems=this._tabbuttonitems;var tabbuttonitems_length=tabbuttonitems.length;if(this.nextbutton){this.nextbutton.destroy();this.nextbutton=null;}if(this.prevbutton){this.prevbutton.destroy();this.prevbutton=null;}for(var i=tabbuttonitems_length-1;i>=0;i-- ){tabbuttonitems[i].destroy();tabbuttonitems.splice(i,1);}for(i=tabpages_length-1;i>=0;i-- ){tabpages[i].destroy();}this.tabpages.clear();this.tabpages=null;this._tabbuttonitems=null;this._prevbutton_size=null;this._nextbutton_size=null;};_pTab.on_create_contents_command=function(){var str="";var tabpages=this.tabpages;var tabpages_length=tabpages.length;var tabbuttonitems=this._tabbuttonitems;var tabbuttonitems_length=tabbuttonitems.length;for(var i=0;i<tabpages_length;i++ ){str+=tabpages[i].createCommand();}for(i=0;i<tabbuttonitems_length;i++ ){str+=tabbuttonitems[i].createCommand();}if(this.nextbutton){str+=this.nextbutton.createCommand();}if(this.prevbutton){str+=this.prevbutton.createCommand();}return str;};_pTab.on_attach_contents_handle=function(win){var tabpages=this.tabpages;var tabpages_length=tabpages.length;var tabbuttonitems=this._tabbuttonitems;var tabbuttonitems_length=tabbuttonitems.length;if(this.nextbutton){this.nextbutton.attachHandle(win);}if(this.prevbutton){this.prevbutton.attachHandle(win);}for(var i=0;i<tabpages_length;i++ ){tabpages[i].attachHandle(win);if(this.preload){tabpages[i]._on_apply_url();}}for(i=0;i<tabbuttonitems_length;i++ ){tabbuttonitems[i].attachHandle(win);}this._is_created=true;this.on_apply_tabindex(this._init_tabindex);this._rearrangeContents();this._init_tabindex= -1;};_pTab.on_change_containerRect=function(width,height){this._rearrangeContents();};_pTab._on_bubble_beforeclose=function(root_closing_comp,event_bubbles,fire_comp,refer_comp){return this.parent._on_bubble_beforeclose(root_closing_comp,event_bubbles,fire_comp,refer_comp);};_pTab._on_bubble_close=function(event_bubbles,fire_comp,refer_comp){return this.parent._on_bubble_close(event_bubbles,fire_comp,refer_comp);};_pTab._on_activate=function(){nexacro.Component.prototype._on_activate.call(this);var tabpage=this.tabpages[this.tabindex];if(tabpage&&tabpage.form){tabpage.form._on_activate();}return true;};_pTab._on_deactivate=function(){nexacro.Component.prototype._on_deactivate.call(this);var tabpage=this.tabpages[this.tabindex];if(tabpage&&tabpage.form){tabpage.form._on_deactivate();}return true;};_pTab.getOwnerFrame=function(){return this._getOwnerFrame();};_pTab.on_apply_prop_enable=function(v){var tabpages=this.tabpages;var tabpages_length=tabpages.length;var tabpage;var prevbutton=this.prevbutton;var nextbutton=this.nextbutton;for(var i=0;i<tabpages_length;i++ ){tabpage=tabpages[i];tabpage._setEnable(v);}if(prevbutton){prevbutton._setEnable(v);}if(nextbutton){nextbutton._setEnable(v);}};_pTab.on_fire_sys_onaccessibilitygesture=function(direction,fire_comp,refer_comp){var next_obj=null;var tabindex=this._getTabIndex();if(direction){if(this._accessibility_tabindex==tabindex){next_obj=this._child_list[tabindex];}else{this._accessibility_tabindex++ ;if(this._accessibility_tabindex<this.tabpages.length){next_obj=this._tabButtons[this._accessibility_tabindex];}else{this._accessibility_tabindex= -1;this._accessibility_is_next=true;next_obj=this.parent._searchNextTabFocus(this,undefined,undefined,3)[0];}}}else{if(this._accessibility_tabindex==tabindex){this._accessibility_tabindex-- ;next_obj=this._tabButtons[this._accessibility_tabindex];}else{this._accessibility_tabindex-- ;if(this._accessibility_tabindex>=0){if(this._accessibility_tabindex==tabindex){next_obj=this._child_list[tabindex];}else{next_obj=this._tabButtons[this._accessibility_tabindex];}}}}if(next_obj){next_obj._setAccessibilityNotifyEvent(direction);return true;}return false;};_pTab._resetScrollPos=function(target_comp,left,top,right,bottom,focus_direction){if(!this._is_popup_control&&this.parent&&this.parent!=this){var form_top=this._adjust_top;var form_left=this._adjust_left;top+=form_top;left+=form_left;bottom+=form_top;right+=form_left;this.parent._resetScrollPos(this,left,top,right,bottom,focus_direction);}};_pTab.set_multiline=function(v){v=nexacro._toBoolean(v);if(this.multiline!=v){this.multiline=v;this.on_apply_multiline(v);}};_pTab.on_apply_multiline=function(v){this._rearrangeContents();};_pTab.set_tabindex=function(v){if(isNaN(v= +v)||v< -1){return;}var post_idx=parseInt(v,10)|0;var pre_idx=this.tabindex;if(post_idx!=pre_idx){this._oldtabindex=pre_idx;if(!this._is_created){this._init_tabindex=post_idx;}else{this.on_apply_tabindex(post_idx);this._rearrangeContents();}}};_pTab.on_apply_tabindex=function(v){var is_apply_focus=false;var form=this._getForm();if(form._getTabOrderFirst() instanceof nexacro.Tab&&this.parent._last_focused&&this.parent._last_focused.name==this.name){is_apply_focus=true;}var bcanchange=this._changeTabIndex(v,is_apply_focus);if(bcanchange){this._last_focused=null;this._tabbutton_obj=this._tabbuttonitems[v];if(this.enableevent&&this._is_created&&this._oldtabindex> -1){this.on_fire_onchanged(this,v,this._oldtabindex);}this._rearrangeContents( -1);}};_pTab.set_focusacceptable=function(v){var _v=nexacro._toBoolean(v);if(this.focusacceptable!=_v){this.focusacceptable=_v;}};_pTab.set_usecontrolkey=function(v){this.usecontrolkey=nexacro._toBoolean(v);};_pTab.set_rotatetext=function(v){this.rotatetext=v;};_pTab.on_apply_rotatetext=function(v){};_pTab.set_tabjustify=function(v){v=nexacro._toBoolean(v);if(this.tabjustify!=v){this.tabjustify=v;this.on_apply_tabjustify(v);}};_pTab.on_apply_tabjustify=function(v){this._rearrangeContents();};_pTab.set_selectchangetype=function(v){switch(v){case "down":case "up":this.selectchangetype=v;break;default:break;}};_pTab.set_tabposition=function(v){var pre_value=nexacro._toString(this.tabposition);var post_value=nexacro._toString(v);switch(post_value){case "left":case "top":case "right":case "bottom":if(pre_value!=post_value){this.tabposition=post_value;this.on_apply_tabposition(post_value);}break;default:return;}};_pTab.on_apply_tabposition=function(v){this._rearrangeContents();};_pTab.set_showextrabutton=function(v){v=nexacro._toBoolean(v);if(this.showextrabutton!=v){this.showextrabutton=v;this.on_apply_showextrabutton(v);}};_pTab.on_apply_showextrabutton=function(v){this._rearrangeContents();};_pTab.set_preload=function(v){v=nexacro._toBoolean(v);if(this.preload!=v){this.preload=v;this.on_apply_preload(v);}};_pTab.on_apply_preload=function(v){};_pTab.set_tabbuttonwidth=function(v){if(this.tabbuttonwidth!=v){this.tabbuttonwidth=(v===undefined)?v:(parseInt(v)|0);this._rearrangeContents();}};_pTab.set_tabbuttonheight=function(v){if(this.tabbuttonheight!=v){this.tabbuttonheight=(v===undefined)?v:(parseInt(v)|0);this._rearrangeContents();}};_pTab.set_selectedtabbuttonwidth=function(v){if(this.selectedtabbuttonwidth!=v){this.selectedtabbuttonwidth=(v===undefined)?v:(parseInt(v)|0);this._rearrangeContents();}};_pTab.set_selectedtabbuttonheight=function(v){if(this.selectedtabbuttonheight!=v){this.selectedtabbuttonheight=(v===undefined)?v:(parseInt(v)|0);this._rearrangeContents();}};_pTab.set_extrabuttonsize=function(v){v=nexacro._toString(v).replace(/\s+/," ").trim();if(this.extrabuttonsize==v){return;}this.extrabuttonsize=v;this._extrabutton_size=null;this._rearrangeContents();};_pTab.getParentContext=function(){return this.parent;};_pTab.addChild=function(id,obj){this._addChild(id,obj,false);};_pTab.insertTabpage=function(strId,nIndex,strUrl,strText,tabbuttonwidth,tabbuttonheight){var idx=parseInt(nIndex)|0;var tabpages=this.tabpages;var tabpages_len=tabpages.length;var tabbuttonitems=this._tabbuttonitems;var tabpage;var oldtabindex;for(var i=0;i<tabpages_len;i++ ){tabpage=this.tabpages[i];if(strId==tabpage.text){return  -1;}}tabpage=new nexacro.Tabpage(strId,this);tabpage._refobj=this;if(strText){tabpage.set_text(strText);}else{tabpage.set_text(strId);}if(tabbuttonwidth){tabpage.set_tabbuttonwidth(tabbuttonwidth);}if(tabbuttonheight){tabpage.set_tabbuttonheight(tabbuttonheight);}tabpage._preload=this.preload;tabpage.createComponent(false);if(idx>tabpages_len){idx= -1;}this.on_fire_canchange(this,this.tabindex,this.tabpages.length);if(this._is_canchange){oldtabindex=this.tabindex;if(this[strId]){if(this[strId].name==tabpage.name){tabpage.destroy();return  -1;}}var oldtabpage=oldtabindex> -1?tabpages[oldtabindex]:undefined;var oldtabtn=oldtabindex> -1?this._tabbuttonitems[oldtabindex]:undefined;if(oldtabpage&&oldtabtn){if(oldtabpage.enable){oldtabtn._changeStatus("enabled",true);}else{oldtabtn._changeStatus("disabled",true);}oldtabtn._changeUserStatus("selected",false);oldtabpage.set_visible(false);oldtabtn._setAccessibilityStatSelected(false);}}if(idx== -1){this.tabindex=idx=this.tabpages.length;this._addChild(strId,tabpage);}else{for(i=tabpages_len;i>idx;i-- ){tabbuttonitems[i]=tabbuttonitems[i-1];tabbuttonitems[i]._tabindex+=1;}this._addChild(strId,tabpage,true,idx);}var newtabbtn;if(this._is_canchange){this.tabindex=idx;newtabbtn=this._tabbutton_obj=tabbuttonitems[idx]=this._createTabbutton(idx,tabpage,false);if(strUrl&&!this.preload){tabpage.set_url(strUrl);}tabpage.set_visible(true);newtabbtn._changeUserStatus("selected",true);newtabbtn._setAccessibilityStatSelected(true);this._last_focused=null;}else{if(this.tabindex>=idx){this.tabindex=this.tabindex+1;}newtabbtn=tabbuttonitems[idx]=this._createTabbutton(idx,tabpage,false);newtabbtn._changeUserStatus("selected",false);newtabbtn._setAccessibilityStatSelected(false);}this._rearrangeContents();if(this.enableevent&&this._is_canchange){this.on_fire_onchanged(this,this.tabindex,this._oldtabindex);}return idx;};_pTab.removeTabpage=function(nIndex){var idx=parseInt(nIndex)|0;var tabpages=this.tabpages;var tabpages_len=tabpages.length;if(tabpages_len==0){return  -1;}var tabbuttonitems,tabbuttonitems_len=0;if(tabpages_len>0){var tabpage=tabpages[idx];if(!tabpage){return  -1;}var confirm_message=tabpage.form._on_beforeclose();if(tabpage.form._checkAndConfirmClose(confirm_message)==false){return  -1;}if(tabpage==this._last_focused){this._last_focused=null;}tabpage.form._on_close();this[tabpage.id]=null;delete this[tabpage.id];tabpages.delete_item(tabpage.id);tabpage.destroy();tabbuttonitems=this._tabbuttonitems;var tabbuttonitem=tabbuttonitems[idx];if(tabbuttonitem!=undefined){if(tabbuttonitem==this._tabbutton_obj){this._tabbutton_obj=null;}if(tabbuttonitem==this._last_focused){this._last_focused=null;}tabbuttonitem.destroy();}tabbuttonitems.splice(idx,1);tabbuttonitems_len=tabbuttonitems.length;for(var i=0;i<tabbuttonitems_len;i++ ){tabbuttonitems[i]._tabindex=i;}}var is_changed_tabpage=false;if(this.tabindex==idx){is_changed_tabpage=true;}if(idx!=0&&this.tabindex==idx&&this.tabindex==tabbuttonitems_len){this.tabindex=idx-1;}else if(this.tabindex>idx||tabbuttonitems_len==0){this.tabindex-=1;}var newtabpage=tabpages[this.tabindex];if(newtabpage){newtabpage.set_visible(true);if(!this.preload){newtabpage._on_apply_url();}if(tabbuttonitems){tabbuttonitems[this.tabindex]._changeUserStatus("selected",true);}if(this.enableevent&&is_changed_tabpage){this.on_fire_onchanged(this,this.tabindex,this._oldtabindex);}}if(tabbuttonitems_len>0){this._rearrangeContents();}return 0;};_pTab.moveTabpage=function(nFromIndex,nToIndex){var tabpages=this.tabpages;var tabpages_len=tabpages.length;if(nToIndex<0||tabpages_len<=nToIndex||tabpages_len<=nFromIndex||nFromIndex<0){return  -1;}if(nFromIndex==nToIndex){return  -1;}var tabindex=this.tabindex;var tabpage=tabpages[tabindex];var cur_tabpage_id=tabpage.id;var fromtabpage=tabpages[nFromIndex];var tabbuttonitems=this._tabbuttonitems;var frombutton=tabbuttonitems[nFromIndex];tabpages.delete_item(nFromIndex);tabpages.insert_item(nToIndex,fromtabpage.id,fromtabpage);var i;if(nFromIndex<nToIndex){for(i=nFromIndex+1;i<tabpages_len;i++ ){tabbuttonitems[i-1]=tabbuttonitems[i];tabbuttonitems[i-1]._tabindex=i-1;if(i==nToIndex){tabbuttonitems[i]=frombutton;tabbuttonitems[i]._tabindex=i;break;}}}else{for(i=nFromIndex;i>nToIndex;i-- ){tabbuttonitems[i]=tabbuttonitems[i-1];tabbuttonitems[i]._tabindex=i;}tabbuttonitems[nToIndex]=frombutton;tabbuttonitems[nToIndex]._tabindex=nToIndex;}for(i=0;i<tabpages_len;i++ ){if(cur_tabpage_id==tabpages[i].id){this.tabindex=i;}}this._rearrangeContents();return 0;};_pTab.getTabpageCount=function(){return this.tabpages.length;};_pTab.getIndex=function(nXPos,nYPos){var tabindex=this._getTabIndex(parseInt(nXPos,10),parseInt(nYPos,10));return tabindex;};_pTab.setContents=function(str){var ret=this._setContents(str);return ret;};_pTab.on_fire_user_onmousedown=function(button,altKey,ctrlKey,shiftKey,screenX,screenY,canvasX,canvasY,clientX,clientY,from_comp,from_refer_comp){if(this.onmousedown&&this.onmousedown._has_handlers){var rootComp=this._getRootComponent(from_comp);if(from_comp instanceof nexacro.Tabpage){rootComp=from_comp;}var evt=new nexacro.MouseEventInfo(rootComp,"onmousedown",button,altKey,ctrlKey,shiftKey,screenX,screenY,canvasX,canvasY,clientX,clientY,from_comp,from_refer_comp);return this.onmousedown._fireUserEvent(this,evt);}return false;};_pTab.on_fire_sys_onmousedown=function(button,altKey,ctrlKey,shiftKey,screenX,screenY,canvasX,canvasY,clientX,clientY,from_comp,from_refer_comp){if(this.onmousedown&&this.onmousedown._has_handlers){var rootComp=this._getRootComponent(from_comp);if(from_comp instanceof nexacro.Tabpage){rootComp=from_comp;}var evt=new nexacro.MouseEventInfo(rootComp,"onmousedown",button,altKey,ctrlKey,shiftKey,screenX,screenY,canvasX,canvasY,clientX,clientY,from_comp,from_refer_comp);return this.onmousedown._fireSysEvent(this,evt);}return false;};_pTab.on_fire_user_onmouseup=function(button,alt_key,ctrl_key,shift_key,screenX,screenY,canvasX,canvasY,clientX,clientY,from_comp,from_refer_comp){if(this.onmouseup&&this.onmouseup._has_handlers){var rootComp=this._getRootComponent(from_comp);if(from_comp instanceof nexacro.Tabpage){rootComp=from_comp;}var evt=new nexacro.MouseEventInfo(rootComp,"onmouseup",button,alt_key,ctrl_key,shift_key,screenX,screenY,canvasX,canvasY,clientX,clientY,from_comp,from_refer_comp);return this.onmouseup._fireUserEvent(this,evt);}return false;};_pTab.on_fire_sys_onmouseup=function(button,alt_key,ctrl_key,shift_key,screenX,screenY,canvasX,canvasY,clientX,clientY,from_comp,from_refer_comp){if(this.onmouseup&&this.onmouseup._has_handlers){var rootComp=this._getRootComponent(from_comp);if(from_comp instanceof nexacro.Tabpage){rootComp=from_comp;}var evt=new nexacro.MouseEventInfo(rootComp,"onmouseup",button,alt_key,ctrl_key,shift_key,screenX,screenY,canvasX,canvasY,clientX,clientY,from_comp,from_refer_comp);return this.onmouseup._fireSysEvent(this,evt);}return false;};_pTab._on_focus=function(self_flag,evt_name,lose_focus,refer_lose_focus,new_focus,refer_new_focus){nexacro.Component.prototype._on_focus.call(this,self_flag,evt_name,lose_focus,refer_lose_focus,new_focus,refer_new_focus);if(!this._focusobj){this._setTabFocusObj(this);}};_pTab.on_killfocus_basic_action=function(new_focus,new_ref_focus){if(new_focus===this){return;}if(new_focus==null&&new_ref_focus==null){return;}this._focusobj=null;};_pTab.on_fire_user_onkeydown=function(key_code,alt_key,ctrl_key,shift_key,from_comp,from_refer_comp){var ret=false;if(!this.onkeydown||(this.onkeydown&&!this.onkeydown.defaultprevented)){if(key_code==nexacro.Event.KEY_TAB||key_code==nexacro.Event.KEY_RIGHT||key_code==nexacro.Event.KEY_LEFT||key_code==nexacro.Event.KEY_BACKSPACE){if(this._keydown_filter(null,key_code,alt_key,ctrl_key,shift_key,undefined,from_comp,from_refer_comp)){this._getWindow()._keydown_element._event_stop=true;return true;}}else if(nexacro._enableaccessibility){if(key_code==nexacro.Event.KEY_DOWN||key_code==nexacro.Event.KEY_UP){if(this._keydown_filter(null,key_code,alt_key,ctrl_key,shift_key,undefined,from_comp,from_refer_comp)){return true;}}}}ret=nexacro.Component.prototype.on_fire_user_onkeydown.call(this,key_code,alt_key,ctrl_key,shift_key,from_comp,from_refer_comp);return ret;};_pTab.on_fire_sys_onkeydown=function(key_code,alt_key,ctrl_key,shift_key,from_comp,from_refer_comp){if(this.onkeydown&&this.onkeydown._has_handlers){var evt=new nexacro.KeyEventInfo(this,"onkeydown",alt_key,ctrl_key,shift_key,key_code,from_comp,from_refer_comp);return this.onkeydown._fireSysEvent(this,evt);}return false;};_pTab.on_fire_user_onkeyup=function(key_code,alt_key,ctrl_key,shift_key,from_comp,from_refer_comp){if(this.onkeyup&&this.onkeyup._has_handlers){var evt=new nexacro.KeyEventInfo(this,"onkeyup",alt_key,ctrl_key,shift_key,key_code,from_comp,from_refer_comp);return this.onkeyup._fireUserEvent(this,evt);}return false;};_pTab.on_fire_sys_onkeyup=function(key_code,alt_key,ctrl_key,shift_key,from_comp,from_refer_comp){if(this.onkeyup&&this.onkeyup._has_handlers){var evt=new nexacro.KeyEventInfo(this,"onkeyup",alt_key,ctrl_key,shift_key,key_code,from_comp,from_refer_comp);return this.onkeyup._fireSysEvent(this,evt);}return false;};_pTab.on_lbuttondown_basic_action=function(elem,button,alt_key,ctrl_key,shift_key,canvasX,canvasY,screenX,screenY,refer_comp){var ret=nexacro.Component.prototype.on_lbuttondown_basic_action.call(this,elem,button,alt_key,ctrl_key,shift_key,canvasX,canvasY,screenX,screenY,refer_comp);if(!this.visible||this._isEnable()==false){return ret;}var tabbutton_obj=this._tabbutton_obj;if(tabbutton_obj&&tabbutton_obj.name=="extrabutton"){if(this._tabbuttonitems[tabbutton_obj._tabindex]){this._tabbuttonitems[tabbutton_obj._tabindex]._setFocus();}}if(tabbutton_obj&&this.selectchangetype=="down"){var idx=tabbutton_obj._tabindex;var oldindex=this.tabindex;var bcanchange=this._changeTabIndex(idx,true);if(bcanchange){if(this.enableevent&&oldindex!=this.tabindex){this.on_fire_onchanged(tabbutton_obj,idx,oldindex);}}this._rearrangeContents( -1);}return ret;};_pTab.on_fire_user_onlbuttondown=function(button,alt_key,ctrl_key,shift_key,screenX,screenY,canvasX,canvasY,clientX,clientY,from_comp,from_refer_comp){if(from_refer_comp.name=="extrabutton"){var tabbutton=from_refer_comp.parent;var idx=tabbutton._tabindex;if(idx>=0){this.on_fire_onextrabuttonclick(tabbutton,idx,button,alt_key,ctrl_key,shift_key,screenX,screenY,canvasX,canvasY,clientX,clientY,from_comp,from_refer_comp);}}if(this.onlbuttondown&&this.onlbuttondown._has_handlers){var evt=new nexacro.TabMouseEventInfo(this,"onlbuttondown",this.tabindex,button,alt_key,ctrl_key,shift_key,screenX,screenY,canvasX,canvasY,clientX,clientY,from_comp,from_refer_comp);return this.onlbuttondown._fireUserEvent(this,evt);}return false;};_pTab.on_lbuttonup_basic_action=function(elem,button,alt_key,ctrl_key,shift_key,canvasX,canvasY,screenX,screenY,refer_comp){var ret=nexacro.Component.prototype.on_lbuttonup_basic_action.call(this,elem,button,alt_key,ctrl_key,shift_key,canvasX,canvasY,screenX,screenY,refer_comp);if(!this.visible||this._isEnable()==false){return ret;}if(this._tabbutton_obj&&this.selectchangetype=="up"){var tabbutton_obj=this._tabbutton_obj;var idx=tabbutton_obj._tabindex;var oldindex=this.tabindex;var bcanchange=this._changeTabIndex(idx,true);if(bcanchange){if(this.enableevent&&oldindex!=this.tabindex){this.on_fire_onchanged(tabbutton_obj,idx,oldindex);}}this._rearrangeContents( -1);}};_pTab.on_touchend_basic_action=function(touch_manager,touchinfos,changedtouchinfos){var ret=nexacro.Component.prototype.on_touchend_basic_action.call(this,touch_manager,touchinfos,changedtouchinfos);var control=this._getControlFromElement(touch_manager._start_elem);if(control){var idx;if(control instanceof nexacro._TabExtraButtonControl){var tabbuttonitem=control.parent;idx=tabbuttonitem._tabindex;var curindex=this.tabindex;if(curindex==idx){if(idx>=0){var screenX,screenY,canvasX,canvasY,clientX,clientY;if(touchinfos&&touchinfos.length>0){screenX=touchinfos[0].screenx;screenY=touchinfos[0].screeny;canvasX=touchinfos[0].canvasx;canvasY=touchinfos[0].canvasy;clientX=touchinfos[0].clientx;clientY=touchinfos[0].clienty;}this.on_fire_onextrabuttonclick(tabbuttonitem,idx,"touch",null,null,null,screenX,screenY,canvasX,canvasY,clientX,clientY,this,control);}return ret;}else{control=control.parent;}}if(control instanceof nexacro._TabButtonItemControl){this._tabbutton_obj=control;var tabbutton_obj=this._tabbutton_obj;idx=tabbutton_obj._tabindex;var oldindex=this.tabindex;var bcanchange=this._changeTabIndex(idx,true);if(bcanchange){if(this.enableevent&&oldindex!=this.tabindex){this.on_fire_onchanged(tabbutton_obj,idx,oldindex);}}this._rearrangeContents( -1);}}return ret;};_pTab.on_fire_user_onlbuttonup=function(button,alt_key,ctrl_key,shift_key,screenX,screenY,canvasX,canvasY,clientX,clientY,from_comp,from_refer_comp,from_elem){if(this.onlbuttonup&&this.onlbuttonup._has_handlers){var evt=new nexacro.TabMouseEventInfo(this,"onlbuttonup",this.tabindex,button,alt_key,ctrl_key,shift_key,screenX,screenY,canvasX,canvasY,clientX,clientY,from_comp,from_refer_comp);return this.onlbuttonup._fireUserEvent(this,evt);}return false;};_pTab.on_fire_user_onrbuttonup=function(button,alt_key,ctrl_key,shift_key,screenX,screenY,canvasX,canvasY,clientX,clientY,from_comp,from_refer_comp,from_elem){if(this.onrbuttonup&&this.onrbuttonup._has_handlers){var evt=new nexacro.TabMouseEventInfo(this,"onrbuttonup",this.tabindex,button,alt_key,ctrl_key,shift_key,screenX,screenY,canvasX,canvasY,clientX,clientY,from_comp,from_refer_comp);return this.onrbuttonup._fireUserEvent(this,evt);}return false;};_pTab.on_fire_user_onrbuttondown=function(button,alt_key,ctrl_key,shift_key,screenX,screenY,canvasX,canvasY,clientX,clientY,from_comp,from_refer_comp){if(this.onrbuttondown&&this.onrbuttondown._has_handlers){var evt=new nexacro.TabMouseEventInfo(this,"onrbuttondown",this.tabindex,button,alt_key,ctrl_key,shift_key,screenX,screenY,canvasX,canvasY,clientX,clientY,from_comp,from_refer_comp);return this.onrbuttondown._fireUserEvent(this,evt);}return false;};_pTab.on_fire_onextrabuttonclick=function(obj,index,button,alt_key,ctrl_key,shift_key,screenX,screenY,canvasX,canvasY,clientX,clientY,from_comp,from_refer_comp){if(this.onextrabuttonclick&&this.onextrabuttonclick._has_handlers){var evt=new nexacro.TabMouseEventInfo(this,"onextrabuttonclick",index,button,alt_key,ctrl_key,shift_key,screenX,screenY,canvasX,canvasY,clientX,clientY,this,this);return this.onextrabuttonclick._fireEvent(this,evt);}return true;};_pTab.on_notify_prevbutton_onclick=function(obj,e){this._adjustSpinPosition( -1);};_pTab.on_notify_nextbutton_onclick=function(obj,e){this._adjustSpinPosition(1);};_pTab.on_fire_canchange=function(obj,postindex,preindex){this._is_canchange=true;if(this.canchange&&this.canchange._has_handlers){var evt=new nexacro.TabIndexChangeEventInfo(obj,"canchange",postindex,preindex);this._is_canchange=this.canchange._fireCheckEvent(this,evt);return this._is_canchange;}return true;};_pTab.on_fire_onchanged=function(obj,postindex,preindex){if(this.onchanged&&this.onchanged._has_handlers){var evt=new nexacro.TabIndexChangeEventInfo(this,"onchanged",postindex,preindex);return this.onchanged._fireEvent(this,evt);}return true;};_pTab.on_apply_prop_cssclass=function(){var nextbutton=this.nextbutton;if(nextbutton){nextbutton.on_apply_cssclass();}var prevbutton=this.prevbutton;if(prevbutton){prevbutton.on_apply_cssclass();}var tabbuttonitems=this._tabbuttonitems;var tabpages_len=tabbuttonitems.length;var i;for(i=0;i<tabpages_len;i++ ){var tabbuttonitem=tabbuttonitems[i];if(tabbuttonitem){tabbuttonitem.on_apply_cssclass();}}var tabpages=this.tabpages;var tabpages_length=tabpages.length;var tabpage;for(i=0;i<tabpages_length;i++ ){tabpage=tabpages[i];if(tabpage){tabpage.on_apply_cssclass();}}};_pTab._createSpinButton=function(bCreateOnly){if(!this.nextbutton){this.nextbutton=new nexacro.Button("nextbutton",0,0,0,0,null,null,null,null,null,null,this);this.nextbutton._setControl();this.nextbutton.createComponent(bCreateOnly);this.nextbutton.set_visible(false);this.nextbutton._setEventHandler("onclick",this.on_notify_nextbutton_onclick,this);}if(!this.prevbutton){this.prevbutton=new nexacro.Button("prevbutton",0,0,0,0,null,null,null,null,null,null,this);this.prevbutton._setControl();this.prevbutton.createComponent(bCreateOnly);this.prevbutton.set_visible(false);this.prevbutton._setEventHandler("onclick",this.on_notify_prevbutton_onclick,this);}};_pTab._createTabpages=function(bCreateOnly){var tabpages=this.tabpages;var tabpages_length=tabpages.length;var tabpage;var tabindex=this.tabindex;for(var i=0;i<tabpages_length;i++ ){tabpage=tabpages[i];tabpage._refobj=this;tabpage._preload=this.preload;if(tabindex!=i){tabpage.set_visible(false);}if(!tabpage._is_created){tabpage.createComponent(bCreateOnly);}}};_pTab._createTabButtons=function(bCreateOnly){var tabpages=this.tabpages;var tabpages_length=tabpages.length;if(tabpages_length<=0){return;}for(var i=0;i<tabpages_length;i++ ){var tabbutton=this._createTabbutton(i,tabpages[i],bCreateOnly);this._tabbuttonitems.push(tabbutton);}};_pTab._createTabbutton=function(idx,tabpage,bCreateOnly){if(!tabpage){return null;}var button_idx=this._next_button_idx++ ;var tabpage_text=tabpage.text;var tabindex=idx;var btn=new nexacro._TabButtonItemControl("tabbutton_"+button_idx,0,0,1,1,null,null,null,null,null,null,this);btn.createComponent(bCreateOnly);btn.set_text(tabpage_text);btn._tabindex=tabindex;btn._tabpage=tabpage;tabpage._tabbuttonitem=btn;return btn;};_pTab._getTabIndex=function(nX,nY){var tabindex= -1;var tabpages_len=this.tabpages.length;if(tabpages_len<=0){return tabindex;}if(nX<0||nY<0){return tabindex;}var l=0,t=0,r=0,b=0;var tabbuttonitems,tabbuttonitem;tabbuttonitems=this._tabbuttonitems;for(var i=0;i<tabpages_len;i++ ){tabbuttonitem=tabbuttonitems[i];if(tabbuttonitem.visible){l=tabbuttonitem._position.left;t=tabbuttonitem._position.top;b=t+tabbuttonitem._position.height;r=l+tabbuttonitem._position.width;if(nX>=l&&nX<=r&&nY>=t&&nY<=b){tabindex=i;break;}}}return tabindex;};_pTab._isSpinButtonVisible=function(){return this.nextbutton.visible||this.prevbutton.visible;};_pTab._getPrevButtonSize=function(){if(!this._prevbutton_size){var width=0;var height=0;var border=this.prevbutton._getCSSStyleValue("border");var padding=this.prevbutton._getCSSStyleValue("padding");if(border){width=border.left._width+border.right._width;height=border.top._width+border.bottom._width;}if(padding){width+=padding.left+padding.right;height+=padding.top+padding.bottom;}var icon=this.prevbutton._getCSSStyleValue("icon");if(icon instanceof Object){icon=icon.value;}this._prevbutton_size={width:width,height:height};if(!icon){var size=this._default_spinbutton_size;this._prevbutton_size.width+=size.width;this._prevbutton_size.height+=size.height;}else{var iconsize=nexacro._getImageSize(icon,this._onload_prevbutton_iconimage,this);if(iconsize){this._prevbutton_size.width+=iconsize.width;this._prevbutton_size.height+=iconsize.height;}else{return null;}}}return this._prevbutton_size;};_pTab._getNextButtonSize=function(){if(!this._nextbutton_size){var width=0;var height=0;var border=this.nextbutton._getCSSStyleValue("border");var padding=this.nextbutton._getCSSStyleValue("padding");if(border){width=border.left._width+border.right._width;height=border.top._width+border.bottom._width;}if(padding){width+=padding.left+padding.right;height+=padding.top+padding.bottom;}var icon=this.nextbutton._getCSSStyleValue("icon");if(icon instanceof Object){icon=icon.value;}this._nextbutton_size={width:width,height:height};if(!icon){var size=this._default_spinbutton_size;this._nextbutton_size.width+=size.width;this._nextbutton_size.height+=size.height;}else{var iconsize=nexacro._getImageSize(icon,this._onload_nextbutton_iconimage,this);if(iconsize){this._nextbutton_size.width+=iconsize.width;this._nextbutton_size.height+=iconsize.height;}else{return null;}}}return this._nextbutton_size;};_pTab._getTabpageBorder=function(){var border;var len=this.tabpages.length;var tabpage;if(len>0){tabpage=this.tabpages[0];border=tabpage._getCSSStyleValue("border");}return border;};_pTab._addChild=function(id,obj,bInsert,nIndex){if(id&&id.length<=0){return  -1;}if(!obj){return  -1;}if(this[id]){return  -1;}if(!(obj instanceof nexacro.Tabpage)){return  -1;}obj._refform=this;if(!obj.id){obj.id=obj.name=id;}else{obj.id=id;}this[id]=obj;if(bInsert&&nIndex>=0){this.tabpages.insert_item(nIndex,id,obj);}else{this.tabpages.add_item(id,obj);}if(this.preload||(this._init_tabindex>=0&&this.tabpages[this._init_tabindex]==obj)){obj._on_apply_url();}if(!obj._url){var _form=obj.form;if(_form){_form._is_loaded=true;}}};_pTab._getFirstTabbuttonIndex=function(){var tabbuttonitems=this._tabbuttonitems;var tabbuttonitems_len=tabbuttonitems.length;var tabbuttonitem;var v= -1;for(var i=0;i<tabbuttonitems_len;i++ ){tabbuttonitem=tabbuttonitems[i];if(tabbuttonitem.visible){v=i;break;}}return v;};_pTab._adjustSpinPosition=function(v){var tabbuttonitems_len=this._tabbuttonitems.length;var begin_idx=parseInt(v);var first_indext=this._getFirstTabbuttonIndex();if(first_indext>=0){begin_idx+=first_indext;}if(begin_idx<0){begin_idx=0;}if(begin_idx>=tabbuttonitems_len){begin_idx=tabbuttonitems_len-1;}this._rearrangeContents(begin_idx);};_pTab._changeTabIndex=function(index,is_apply_focus){var nindex= +index;if(!this._is_created||this.tabindex==index||(nindex!=nindex)||index<0||(this.tabpages&&index>=this.tabpages.length)){return;}var oldindex=this.tabindex;if(oldindex> -1&&this.enableevent){var ret=this.on_fire_canchange(this,index,oldindex);if(ret==false){this._tabbuttonitems[index]._changeUserStatus("selected",false);return false;}}var oldtabpage=oldindex> -1?this.tabpages[oldindex]:undefined;var newtabpage=this.tabpages[index];var oldtabtn=oldindex> -1?this._tabbuttonitems[oldindex]:undefined;var newtabbtn=this._tabbuttonitems[index];if(oldtabpage&&oldtabtn){if(oldtabpage.enable){oldtabtn._changeStatus("enabled",true);}else{oldtabtn._changeStatus("disabled",true);}if(oldtabtn.visible){oldtabtn._changeUserStatus("selected",false);}oldtabpage.set_visible(false);oldtabtn._setAccessibilityStatSelected(false);}this._oldtabindex=oldindex;this.tabindex=index;if(newtabpage){if(!newtabpage.visible){newtabpage.set_visible(true);}if(!this.preload){newtabpage._on_apply_url(false);}if(!newtabbtn.visible){newtabbtn.set_visible(true);}newtabbtn._changeUserStatus("selected",true);newtabbtn._setAccessibilityStatSelected(true);if(is_apply_focus){newtabbtn._on_focus(true);}if(newtabpage.enable){newtabpage._changeStatus("enabled",true);}else{newtabpage._changeStatus("disabled",true);}}else{if(oldtabpage&&oldtabtn){if(oldtabtn.enable){oldtabtn._changeStatus("focused",true);}else{oldtabtn._changeStatus("disabled",true);}oldtabtn._changeUserStatus("selected",true);oldtabpage.set_visible(true);}}return true;};_pTab._rearrangeContents=function(beginTabindex){if(!this._is_created){return;}var tabposition=this.tabposition;var bmultiline=this.multiline;var btabjustify=this.tabjustify;var bshowextrabutton=this.showextrabutton;var extrabutton_size;var extrabutton_width=0;var extrabutton_height=0;if(bshowextrabutton){if(!this._extrabutton_size){extrabutton_size=this._getExtraButtonSize();if(extrabutton_size){if(extrabutton_size.width!=0||extrabutton_size.height!=0){this._extrabutton_size=extrabutton_size;}extrabutton_width=extrabutton_size.width;extrabutton_height=extrabutton_size.height;}}else{extrabutton_width=this._extrabutton_size.width;extrabutton_height=this._extrabutton_size.height;}}var tabindex=this.tabindex;var bshowspin=false;var prevbutton;var nextbutton;var prevbutton_size;var nextbutton_size;var nextbutton_enable=false;var prevbutton_enable=false;var tabpage_position={left:0,top:0,width:0,height:0};var cur_line_width=0;var cur_line_height=0;var cur_line_index=0;var line_count=0;var tabbuttonitems=this._tabbuttonitems;var tabbuttonitems_len=tabbuttonitems.length;var tabbuttonitem;var tabbuttonitem_sizeinfo,tabbuttonitem_pos;var tab_width=this._getClientWidth();var tab_height=this._getClientHeight();var tabpages=this.tabpages;var tabpages_len=tabpages.length;var tabpage;var tabpage_border=this._getTabpageBorder();var tabpage_border_l=0,tabpage_border_t=0,tabpage_border_r=0,tabpage_border_b=0;if(tabpage_border){if(tabpage_border.left){tabpage_border_l=tabpage_border.left._width;}if(tabpage_border.top){tabpage_border_t=tabpage_border.top._width;}if(tabpage_border.right){tabpage_border_r=tabpage_border.right._width;}if(tabpage_border.bottom){tabpage_border_b=tabpage_border.bottom._width;}}var tab_max_width=tab_width;var tab_max_height=tab_height;if(tab_max_width<=0||tab_max_height<=0){return;}tabpage_position.width=tab_width;tabpage_position.height=tab_height;var tab_buttonwidth=this.tabbuttonwidth;var tab_buttonheight=this.tabbuttonheight;var tab_selectedbuttonwidth=this.selectedtabbuttonwidth;var tab_selectedbuttonheight=this.selectedtabbuttonheight;this._setTabButtonItemsSizeInfo();var tabbuttonitem_max_size=this._getTabbuttonItemsMaxSize();var tabbuttonitem_max_width=tabbuttonitem_max_size[0];var tabbuttonitem_max_height=tabbuttonitem_max_size[1];var begin_index=0;var end_index=0;var bovered=false;var blastitem=false;var bovered_cur_line=false;var i;for(i=0;i<tabbuttonitems_len;i++ ){tabbuttonitem=tabbuttonitems[i];tabpage=tabbuttonitem._tabpage;tabbuttonitem_sizeinfo=tabbuttonitem._sizeinfo;tabbuttonitem_pos=tabbuttonitem._position;var tabbuttonitem_width=tabbuttonitem_sizeinfo.width;var tabbuttonitem_height=tabbuttonitem_sizeinfo.height;var prop_tabbuttonitemwidth=tabpage.tabbuttonwidth;var prop_tabbuttonitemheight=tabpage.tabbuttonheight;var each_tabbuttonitemwidth=undefined;var each_tabbuttonitemheight=undefined;if(!bmultiline){if(btabjustify){if(tabposition=="top"||tabposition=="bottom"){if(tab_buttonheight!==undefined){each_tabbuttonitemheight=tab_buttonheight;}if(prop_tabbuttonitemheight!==undefined){each_tabbuttonitemheight=prop_tabbuttonitemheight;}if(tabbuttonitem._tabindex==tabindex){if(tab_selectedbuttonheight!==undefined){each_tabbuttonitemheight=tab_selectedbuttonheight;}}}else{if(tab_buttonwidth!==undefined){each_tabbuttonitemwidth=tab_buttonwidth;}if(prop_tabbuttonitemwidth!==undefined){each_tabbuttonitemwidth=prop_tabbuttonitemwidth;}if(tabbuttonitem._tabindex==tabindex){if(tab_selectedbuttonwidth!==undefined){each_tabbuttonitemwidth=tab_selectedbuttonwidth;}}}}else{if(tab_buttonwidth!==undefined){each_tabbuttonitemwidth=tab_buttonwidth;}if(tab_buttonheight!==undefined){each_tabbuttonitemheight=tab_buttonheight;}if(prop_tabbuttonitemwidth!==undefined){each_tabbuttonitemwidth=prop_tabbuttonitemwidth;}if(prop_tabbuttonitemheight!==undefined){each_tabbuttonitemheight=prop_tabbuttonitemheight;}if(tabbuttonitem._tabindex==tabindex){if(tab_selectedbuttonwidth!==undefined){each_tabbuttonitemwidth=tab_selectedbuttonwidth;}if(tab_selectedbuttonheight!==undefined){each_tabbuttonitemheight=tab_selectedbuttonheight;}}}}if(bshowextrabutton){if(!each_tabbuttonitemwidth){if(extrabutton_width){tabbuttonitem_width+=extrabutton_width;}else{tabbuttonitem_width+=tabbuttonitem_max_height;}}}if(each_tabbuttonitemwidth!==undefined){if(each_tabbuttonitemwidth<0){tabbuttonitem_width=0;}else{tabbuttonitem_width=each_tabbuttonitemwidth;}}if(each_tabbuttonitemheight!==undefined){if(each_tabbuttonitemheight<0){tabbuttonitem_height=0;}else{tabbuttonitem_height=each_tabbuttonitemheight;}}if(tabposition=="top"||tabposition=="bottom"){tabbuttonitem_pos.width=tabbuttonitem_width;if(each_tabbuttonitemheight===undefined){tabbuttonitem_pos.height=tabbuttonitem_max_height;}else{tabbuttonitem_pos.height=each_tabbuttonitemheight;}}else{if(each_tabbuttonitemwidth===undefined){tabbuttonitem_pos.width=tabbuttonitem_max_width;}else{tabbuttonitem_pos.width=each_tabbuttonitemwidth;}tabbuttonitem_pos.height=tabbuttonitem_height;}tabbuttonitem._line_index=0;cur_line_width+=tabbuttonitem_width;cur_line_height+=tabbuttonitem_height;blastitem=((i+1)==tabbuttonitems_len);if(tabposition=="top"||tabposition=="bottom"){bovered_cur_line=cur_line_width>tab_max_width;}else{bovered_cur_line=cur_line_height>tab_max_height;}if(bovered_cur_line||blastitem){if(!bmultiline&&bovered_cur_line&&!bshowspin){bshowspin=true;prevbutton_size=this._getPrevButtonSize();nextbutton_size=this._getNextButtonSize();if(!prevbutton_size||!nextbutton_size){return;}if(tabposition=="top"||tabposition=="bottom"){tab_max_width-=(prevbutton_size.width+nextbutton_size.width);if(prevbutton_size.height>tabbuttonitem_max_height||nextbutton_size.height>tabbuttonitem_max_height){tabbuttonitem_max_height=(prevbutton_size.height>nextbutton_size.height)?prevbutton_size.height:nextbutton_size.height;}}else{tab_max_height-=(prevbutton_size.height+nextbutton_size.height);if(prevbutton_size.width>tabbuttonitem_max_width||nextbutton_size.height>tabbuttonitem_max_width){tabbuttonitem_max_width=(prevbutton_size.width>nextbutton_size.width)?prevbutton_size.width:nextbutton_size.width;}}i= -1;cur_line_index=0;cur_line_width=0;cur_line_height=0;continue;}if(bovered_cur_line){end_index=i;cur_line_width-=tabbuttonitem_width;cur_line_height-=tabbuttonitem_height;bovered=true;}else{end_index=i+1;}if(bshowspin&&btabjustify){btabjustify=false;i= -1;cur_line_index=0;cur_line_width=0;cur_line_height=0;continue;}if(btabjustify||(bmultiline&&bovered)){var extra_width=tab_max_width-cur_line_width;var extra_height=tab_max_height-cur_line_height;var remainning=0;if(tabposition=="top"||tabposition=="bottom"){remainning=extra_width;}else{remainning=extra_height;}var ratio=1;for(var j=begin_index;j<end_index;j++ ){tabbuttonitem=tabbuttonitems[j];if(bmultiline){tabbuttonitem._line_index=cur_line_index;}else{tabbuttonitem._line_index=0;}tabbuttonitem_pos=tabbuttonitem._position;if(tabposition=="top"||tabposition=="bottom"){ratio=tabbuttonitem_pos.width/cur_line_width;if((j+1)==end_index){tabbuttonitem_pos.width+=remainning;}else{tabbuttonitem_pos.width+=Math.ceil(extra_width*ratio);}remainning-=Math.ceil(extra_width*ratio);}else{ratio=tabbuttonitem_pos.height/cur_line_height;if((j+1)==end_index){tabbuttonitem_pos.height+=remainning;}else{tabbuttonitem_pos.height+=Math.ceil(extra_height*ratio);}remainning-=Math.ceil(extra_height*ratio);}}}if(end_index==tabbuttonitems_len||begin_index==end_index){break;}cur_line_width=0;cur_line_height=0;begin_index=i;cur_line_index++ ;i-- ;continue;}}line_count=cur_line_index+1;if(beginTabindex<0){beginTabindex=this._getFirstTabbuttonIndex();}if(beginTabindex==undefined||beginTabindex==null){var temp_width=0;var temp_height=0;for(i=tabindex;i>=0;i-- ){tabbuttonitem=tabbuttonitems[i];tabbuttonitem_pos=tabbuttonitem._position;temp_width+=tabbuttonitem_pos.width;temp_height+=tabbuttonitem_pos.height;if(tabposition=="top"||tabposition=="bottom"){if(temp_width<=tab_max_width){beginTabindex=i;}else{break;}}else{if(temp_height<=tab_max_height){beginTabindex=i;}else{break;}}}}var left=0;var top=0;var pre_tabbuttonitem;var pre_line_index=0;var start_line_index=0;if(tabindex>0){tabbuttonitem=tabbuttonitems[tabindex];start_line_index=tabbuttonitem._line_index;}for(i=0;i<tabbuttonitems_len;i++ ){tabbuttonitem=tabbuttonitems[i];tabbuttonitem_pos=tabbuttonitem._position;cur_line_index=tabbuttonitem._line_index;if(bmultiline){cur_line_index=(cur_line_index-start_line_index);if(cur_line_index<0){cur_line_index+=line_count;}}else{cur_line_index=0;}if(tabposition=="top"||tabposition=="bottom"){if(pre_line_index!=cur_line_index){left=0;}if(tabposition=="top"){if(bmultiline){top=tabbuttonitem_max_height*(line_count-cur_line_index-1);}else{top=tabbuttonitem_max_height-tabbuttonitem_pos.height;}tabbuttonitem_pos.height+=tabpage_border_t;}else{if(bmultiline){top=tab_max_height-tabbuttonitem_max_height*(line_count-cur_line_index);}else{top=tab_max_height-tabbuttonitem_max_height;}top-=tabpage_border_b;}tabbuttonitem_pos.left=left;tabbuttonitem_pos.top=top;if(nextbutton_enable||(!bmultiline&&(tabbuttonitem_pos.left+tabbuttonitem_pos.width)>tab_max_width)){tabbuttonitem.set_visible(false);nextbutton_enable=true;}else{tabbuttonitem.set_visible(true);if(tabindex!=tabbuttonitem._tabindex){tabbuttonitem._changeUserStatus("selected",false);}}if(tabbuttonitem.visible){pre_tabbuttonitem=tabbuttonitems[i-1];if(pre_tabbuttonitem&&!pre_tabbuttonitem.visible){prevbutton_enable=true;}if(!bmultiline&&tabbuttonitem._tabindex<beginTabindex){tabbuttonitem.set_visible(false);}else{left=tabbuttonitem_pos.left+tabbuttonitem_pos.width;}}}else{if(pre_line_index!=cur_line_index){top=0;}if(tabposition=="left"){if(bmultiline){left=tabbuttonitem_max_width*(line_count-(cur_line_index+1));}else{left=tabbuttonitem_max_width-tabbuttonitem_pos.width;}tabbuttonitem_pos.width+=tabpage_border_l;}else{if(bmultiline){left=tab_max_width-tabbuttonitem_max_width*(line_count-cur_line_index);}else{left=tab_max_width-tabbuttonitem_max_width;}left-=tabpage_border_r;}tabbuttonitem_pos.left=left;tabbuttonitem_pos.top=top;if(nextbutton_enable||(!bmultiline&&(tabbuttonitem_pos.top+tabbuttonitem_pos.height)>tab_max_height)){tabbuttonitem.set_visible(false);nextbutton_enable=true;}else{tabbuttonitem.set_visible(true);if(tabindex!=tabbuttonitem._tabindex){tabbuttonitem._changeUserStatus("selected",false);}}if(tabbuttonitem.visible){pre_tabbuttonitem=tabbuttonitems[i-1];if(pre_tabbuttonitem&&!pre_tabbuttonitem.visible){prevbutton_enable=true;}if(!bmultiline&&tabbuttonitem._tabindex<beginTabindex){tabbuttonitem.set_visible(false);}else{top=tabbuttonitem_pos.top+tabbuttonitem_pos.height;}}}pre_line_index=cur_line_index;if(bmultiline){tabbuttonitem.set_visible(true);if(tabindex!=tabbuttonitem._tabindex){tabbuttonitem._changeUserStatus("selected",false);}}if(tabbuttonitem.visible){tabbuttonitem.move(tabbuttonitem_pos.left,tabbuttonitem_pos.top,tabbuttonitem_pos.width,tabbuttonitem_pos.height);tabbuttonitem._showExtraButton(bshowextrabutton,extrabutton_width,(extrabutton_height>tabbuttonitem_pos.height?tabbuttonitem_pos.height:extrabutton_height));tabbuttonitem.set_cssclass(tabbuttonitem._tabpage.tabbuttoncssclass);}}var adjust_count=line_count;if(!bmultiline||line_count<=1){adjust_count=1;}if(tabposition=="top"||tabposition=="bottom"){tabpage_position.height-=tabbuttonitem_max_height*adjust_count;if(tabposition=="top"){tabpage_position.top+=tabbuttonitem_max_height*adjust_count;}}else{tabpage_position.width-=tabbuttonitem_max_width*adjust_count;if(tabposition=="left"){tabpage_position.left+=tabbuttonitem_max_width*adjust_count;}}for(i=0;i<tabpages_len;i++ ){tabpage=tabpages[i];tabpage.move(tabpage_position.left,tabpage_position.top,tabpage_position.width,tabpage_position.height);}prevbutton=this.prevbutton;nextbutton=this.nextbutton;if(!bshowspin){prevbutton.set_visible(false);nextbutton.set_visible(false);}else{var nextbutton_pos={left:0,top:0,width:0,height:0};var prevbutton_pos={left:0,top:0,width:0,height:0};nextbutton_pos.width=nextbutton_size.width;nextbutton_pos.height=nextbutton_size.height;prevbutton_pos.width=prevbutton_size.width;prevbutton_pos.height=prevbutton_size.height;if(tabposition=="top"||tabposition=="bottom"){prevbutton_pos.left=tab_max_width;nextbutton_pos.left=prevbutton_pos.left+prevbutton_pos.width;if(tabposition=="top"){prevbutton_pos.top=tabpage_position.top-prevbutton_size.height;nextbutton_pos.top=tabpage_position.top-nextbutton_size.height;}else{prevbutton_pos.top=tabpage_position.height;nextbutton_pos.top=tabpage_position.height;}}else{prevbutton_pos.top=tab_max_height;nextbutton_pos.top=prevbutton_pos.top+prevbutton_pos.height;if(tabposition=="left"){prevbutton_pos.left=tabpage_position.left-prevbutton_size.width;nextbutton_pos.left=tabpage_position.left-nextbutton_size.width;}else{prevbutton_pos.left=tabpage_position.width;nextbutton_pos.left=tabpage_position.width;}}prevbutton.move(prevbutton_pos.left,prevbutton_pos.top,prevbutton_pos.width,prevbutton_pos.height);nextbutton.move(nextbutton_pos.left,nextbutton_pos.top,nextbutton_pos.width,nextbutton_pos.height);if(!prevbutton.visible){prevbutton.set_visible(true);}if(!nextbutton.visible){nextbutton.set_visible(true);}prevbutton._setEnable(prevbutton_enable);nextbutton._setEnable(nextbutton_enable);if(!prevbutton_enable){prevbutton._changeStatus("mouseover",false);}if(!nextbutton_enable){nextbutton._changeStatus("mouseover",false);}}};_pTab._getExtraButtonSize=function(){var extrabuttonsize,extrabuttonsize_w,extrabuttonsize_h;if(this.extrabuttonsize){extrabuttonsize=this.extrabuttonsize.split(" ");extrabuttonsize_w= +extrabuttonsize[0];if(!isNaN(extrabuttonsize_w)){extrabuttonsize_h= +extrabuttonsize[1];if(isNaN(extrabuttonsize_h)){extrabuttonsize_h=extrabuttonsize_w;}return {width:extrabuttonsize_w,height:extrabuttonsize_h};}}var tabbuttonitem=this._tabbuttonitems?this._tabbuttonitems[0]:null;if(!tabbuttonitem){return null;}return tabbuttonitem._getExtraButtonSize(this.showextrabutton);};_pTab._getTabbuttonItemsMaxSize=function(){var tabbuttonitems=this._tabbuttonitems;var tabbuttonitems_length=tabbuttonitems.length;var tabbuttonitem,size;var max_width=0;var max_height=0;var bshowextrabutton=this.showextrabutton;var width=0,height=0;var tabindex=this.tabindex;var bmultiline=this.multiline;var btabjustify=this.tabjustify;var tabposition=this.tabposition;var tab_buttonwidth=this.tabbuttonwidth;var tab_buttonheight=this.tabbuttonheight;var tab_selectedbuttonwidth=this.selectedtabbuttonwidth;var tab_selectedbuttonheight=this.selectedtabbuttonheight;var prop_tabbuttonitemwidth,prop_tabbuttonitemheight;var each_tabbuttonitemwidth,each_tabbuttonitemheight;var each_tabbuttonitem_maxwidth=0;var each_tabbuttonitem_maxheight=0;var tabpage;for(var i=0;i<tabbuttonitems_length;i++ ){tabbuttonitem=tabbuttonitems[i];tabpage=tabbuttonitem._tabpage;size=tabbuttonitem._sizeinfo;if(size){width=size.width;height=size.height;}prop_tabbuttonitemwidth=tabpage.tabbuttonwidth;prop_tabbuttonitemheight=tabpage.tabbuttonheight;each_tabbuttonitemwidth=0;each_tabbuttonitemheight=0;if(!bmultiline){if(btabjustify){if(tabposition=="top"||tabposition=="bottom"){if(tab_buttonheight){each_tabbuttonitemheight=tab_buttonheight;}if(prop_tabbuttonitemheight){each_tabbuttonitemheight=prop_tabbuttonitemheight;}if(tabbuttonitem._tabindex==tabindex){if(tab_selectedbuttonheight){each_tabbuttonitemheight=tab_selectedbuttonheight;}}}else{if(tab_buttonwidth){each_tabbuttonitemwidth=tab_buttonwidth;}if(prop_tabbuttonitemwidth){each_tabbuttonitemwidth=prop_tabbuttonitemwidth;}if(tabbuttonitem._tabindex==tabindex){if(tab_selectedbuttonwidth){each_tabbuttonitemwidth=tab_selectedbuttonwidth;}}}}else{if(tab_buttonwidth){each_tabbuttonitemwidth=tab_buttonwidth;}if(tab_buttonheight){each_tabbuttonitemheight=tab_buttonheight;}if(prop_tabbuttonitemwidth){each_tabbuttonitemwidth=prop_tabbuttonitemwidth;}if(prop_tabbuttonitemheight){each_tabbuttonitemheight=prop_tabbuttonitemheight;}if(tabbuttonitem._tabindex==tabindex){if(tab_selectedbuttonwidth){each_tabbuttonitemwidth=tab_selectedbuttonwidth;}if(tab_selectedbuttonheight){each_tabbuttonitemheight=tab_selectedbuttonheight;}}}}if(each_tabbuttonitemheight>each_tabbuttonitem_maxheight){each_tabbuttonitem_maxheight=each_tabbuttonitemheight;}if(each_tabbuttonitemwidth>each_tabbuttonitem_maxwidth){each_tabbuttonitem_maxwidth=each_tabbuttonitemwidth;}if(tab_buttonwidth){width=tab_buttonwidth;}if(tab_buttonheight){height=tab_buttonheight;}if(height>max_height){max_height=height;}if(width>max_width){max_width=width;}}if(bshowextrabutton){var extrabutton_size=this._extrabutton_size;if(extrabutton_size){if(!each_tabbuttonitem_maxheight&&extrabutton_size.height>max_height){max_height=extrabutton_size.height;}if(!tab_buttonwidth){max_width+=extrabutton_size.width;}}else{if(!tab_buttonwidth){max_width+=max_height;}}}if(each_tabbuttonitem_maxwidth>max_width){max_width=each_tabbuttonitem_maxwidth;}if(each_tabbuttonitem_maxheight>max_height){max_height=each_tabbuttonitem_maxheight;}return [max_width,max_height];};_pTab._setTabButtonItemsSizeInfo=function(){var tabbuttonitems=this._tabbuttonitems;var tabbuttonitems_length=tabbuttonitems.length;var tabbuttonitem;var item_size;for(var i=0;i<tabbuttonitems_length;i++ ){tabbuttonitem=tabbuttonitems[i];item_size=tabbuttonitem._getItemSize();if(item_size){tabbuttonitem._sizeinfo.width=item_size[0];tabbuttonitem._sizeinfo.height=item_size[1];}}};_pTab._on_get_extrabutton_iconsize=function(width,height){this._extrabutton_size=null;this._rearrangeContents();};_pTab._onload_prevbutton_iconimage=function(url,width,height){if(this._prevbutton_size){if(width==0||height==0){var size=this._default_spinbutton_size;width=size.width;height=size.height;}this._prevbutton_size.width+=width;this._prevbutton_size.height+=width;}this._rearrangeContents();};_pTab._onload_nextbutton_iconimage=function(url,width,height){if(this._nextbutton_size){if(width==0||height==0){var size=this._default_spinbutton_size;width=size.width;height=size.height;}this._nextbutton_size.width+=width;this._nextbutton_size.height+=width;}this._rearrangeContents();};_pTab._keydown_filter=function(elem,keycode,alt_key,ctrl_key,shift_key,event_bubbles,fire_comp,refer_comp){var tabpagecnt=this.tabpages.length;if(tabpagecnt<=0){return false;}var tabindex=this.tabindex;var oldtabindex=this.tabindex;var resettabindex= -1;var comp,newcomp=[],newcompobj;var tabpage,tabpage_form;var page_first_comp,page_last_comp;var focusobj;switch(keycode){case 9:if(ctrl_key==true&&this.usecontrolkey){if(shift_key!=true){if(tabindex<tabpagecnt-1){resettabindex=tabindex+1;}else{resettabindex=0;}}else{if(tabindex>0){resettabindex=tabindex-1;}else{resettabindex=tabpagecnt-1;}}if(this._focusobj instanceof nexacro._TabButtonItemControl){this._setTabFocusObj(this._tabbuttonitems[resettabindex]);}else if(this._focusobj instanceof nexacro.Tabpage){this._setTabFocusObj(this.tabpages[resettabindex]);}break;}else{var newfocus_comp;if(this._focusobj instanceof nexacro.Tab){var env;var text;var control_elem;var win;if(shift_key==false){if(this.focusacceptable){this._setTabFocusObj(this._tabbuttonitems[tabindex]);this._tabbuttonitems[tabindex]._setFocus(false,0);}else{tabpage=this.tabpages[tabindex];page_first_comp=tabpage.form._getTabOrderFirst();if(page_first_comp){if(tabpage.form._last_focused){win=this._getWindow();win._removeFromCurrentFocusPath(tabpage.form._last_focused);}page_first_comp._setFocus(false,0);this._setTabFocusObj(tabpage);}else{newfocus_comp=this.parent._searchNextTabFocus(this,null,null,0);if(newfocus_comp){if(newfocus_comp[0]==null){if(newfocus_comp[2]==1){env=nexacro.getEnvironment();if(env){text=env.accessibilitylastovertext;control_elem=this._control_element;control_elem.notifyAccessibility(text,"notify",true);}}else if(newfocus_comp[2]== -1){env=nexacro.getEnvironment();if(env){text=env.accessibilityfirstovertext;control_elem=this._control_element;control_elem.notifyAccessibility(text,"notify",true);}}}else{if(newfocus_comp[0] instanceof nexacro.Form&&newfocus_comp[0]._last_focused){win=this._getWindow();win._removeFromCurrentFocusPath(newfocus_comp[0]._last_focused);}newfocus_comp[0]._setFocus(true,1,true);}}}}}else{newfocus_comp=this.parent._searchPrevTabFocus(this);if(newfocus_comp){if(newfocus_comp[0]==null){if(newfocus_comp[2]==1){env=nexacro.getEnvironment();if(env){text=env.accessibilitylastovertext;control_elem=this._control_element;control_elem.notifyAccessibility(text,"notify",true);}}else if(newfocus_comp[2]== -1){env=nexacro.getEnvironment();if(env){text=env.accessibilityfirstovertext;control_elem=this._control_element;control_elem.notifyAccessibility(text,"notify",true);}}}else{if(newfocus_comp[0] instanceof nexacro.Form&&newfocus_comp[0]._last_focused){win=this._getWindow();win._removeFromCurrentFocusPath(newfocus_comp[0]._last_focused);}newfocus_comp[0]._setFocus(true,1,true);}}}}else if(this._focusobj instanceof nexacro._TabButtonItemControl){if(shift_key==false){newfocus_comp=this._searchNextTabFocus(this._focusobj,false,false,0);if(newfocus_comp&&newfocus_comp[0]){newfocus_comp[0]._setFocus(true,0,true);}this._setTabFocusObj(newfocus_comp[0]);}else{newfocus_comp=this._searchPrevTabFocus(this._focusobj,false,false,0);if(newfocus_comp&&newfocus_comp[0]){newfocus_comp[0]._setFocus(true,0,true);}}}else if(this._focusobj instanceof nexacro.Tabpage){tabpage=this._focusobj;page_last_comp=tabpage.form._getLastFocused();page_first_comp=tabpage.form._getTabOrderFirst(0);if(shift_key==false){if(page_last_comp){comp=this._focusobj.form._searchNextTabFocus(page_last_comp,undefined,undefined,0);if(comp&&comp[0]){comp[0]._setFocus(true,0,true);}}else if(page_first_comp){page_first_comp._setFocus(true,0,true);}}else{if(!page_last_comp||page_last_comp==page_first_comp){if(this.focusacceptable){newcomp.push(this._tabbuttonitems[tabindex]);}else{newcomp=this.parent._searchPrevTabFocus(this,undefined,undefined,0);}if(newcomp[0]){newcomp[0]._setFocus(true,1,true);}}else{comp=this._focusobj.form._searchPrevTabFocus(page_last_comp,undefined,undefined,0);if(comp&&comp[0]){comp[0]._setFocus(true,0,true);}}}}return true;}break;case 8:if(ctrl_key==true&&this.usecontrolkey){this.on_fire_onextrabuttonclick(this,tabindex,"",false,false,false, -1, -1, -1, -1, -1, -1,this,this);return true;}break;case 38:{if(nexacro._enableaccessibility){focusobj=this._focusobj;newcompobj=null;if(focusobj instanceof nexacro.Tab){newcompobj=this.parent._searchPrevTabFocus(focusobj,undefined,undefined,7+8);}else if(focusobj instanceof nexacro._TabButtonItemControl){if(this._isAccessibilityEnable()){newcomp=this;}else{newcompobj=this.parent._searchPrevTabFocus(this,undefined,undefined,7+8);}}else if(focusobj instanceof nexacro.Tabpage){tabpage_form=focusobj.form;page_last_comp=tabpage_form._getLastFocused();if(!ctrl_key){if(page_last_comp){comp=tabpage_form._searchPrevTabFocus(page_last_comp,undefined,undefined,7+8);if(comp&&comp[0]){newcomp=comp[0];}}else{if(this.focusacceptable){newcomp=this._tabbuttonitems[focusobj.parent.tabindex];}else{if(!this._isAccessibilityEnable()){newcompobj=this.parent._searchPrevTabFocus(this,undefined,undefined,7+8);if(newcompobj&&newcompobj[0]){newcomp=newcompobj[0];}}else{newcomp=this;}}}}}if(newcompobj&&newcompobj[0]){newcomp=newcompobj[0];newcomp._setFocus(true,3,true);}else{if(newcomp&&!(newcomp instanceof Array)){newcomp._setFocus(true,3,true);this._setTabFocusObj(newcomp);}}return true;}}break;case 40:{if(nexacro._enableaccessibility){focusobj=this._focusobj;newcompobj=null;if(focusobj instanceof nexacro.Tab){if(this.focusacceptable){newcomp=this._tabbuttonitems[this.tabindex];}else{newcomp=this.tabpages[this.tabindex];if(newcomp._last_focused){newcomp._last_focused=null;}if(!newcomp._isAccessibilityEnable()){newcompobj=newcomp.form._searchNextTabFocus(focusobj._last_focused,false,false,7+8);}}}else if(focusobj instanceof nexacro._TabButtonItemControl){tabpage=this.tabpages[this.tabindex];if(tabpage._last_focused){tabpage._last_focused=null;}if(!tabpage._isAccessibilityEnable()){newcompobj=tabpage._searchNextTabFocus(null,true,false,7+8);if(!newcompobj){comp=this.parent._searchNextTabFocus(this,undefined,undefined,7+8);if(comp&&comp[0]){comp[0]._setFocus(true,2,true);}}}else{newcomp=tabpage;}}else if(focusobj instanceof nexacro.Tabpage){tabpage=focusobj;tabpage_form=tabpage.form;page_first_comp=tabpage_form._getTabOrderFirst(7+8);page_last_comp=tabpage_form._getLastFocused();if(!ctrl_key&&!alt_key&&!shift_key){if(page_last_comp){comp=tabpage_form._searchNextTabFocus(page_last_comp,undefined,undefined,7+8);if(comp&&comp[0]){comp[0]._setFocus(true,2,true);}}else if(page_first_comp){newcomp=page_first_comp;}else{newcompobj=this.parent._searchNextTabFocus(this,undefined,undefined,7+8);}}}if(newcompobj&&newcompobj[0]){newcomp=newcompobj[0];newcomp._setFocus(true,2,true);}else{if(newcomp&&!(newcomp instanceof Array)){newcomp._setFocus(true,2,true);this._setTabFocusObj(newcomp);}}return true;}}break;case 39:if(this.focusacceptable&&ctrl_key==false){focusobj=this._focusobj;if(focusobj instanceof nexacro._TabButtonItemControl){if(tabindex<tabpagecnt-1){resettabindex=tabindex+1;}else{resettabindex=0;}this._setTabFocusObj(this._tabbuttonitems[resettabindex]);}}break;case 37:if(this.focusacceptable&&ctrl_key==false){focusobj=this._focusobj;if(focusobj instanceof nexacro._TabButtonItemControl){if(tabindex>0){resettabindex=tabindex-1;}else{resettabindex=tabpagecnt-1;}this._setTabFocusObj(this._tabbuttonitems[resettabindex]);}}break;default:break;}if(resettabindex> -1){if(this._changeTabIndex(resettabindex,true)==true){if(this.enableevent){this.on_fire_onchanged(this,resettabindex,oldtabindex);}this._rearrangeContents();}}};_pTab._getDlgCode=function(keycode,altKey,ctrlKey,shiftKey){var focusobj=this._focusobj;if(focusobj&&!(focusobj instanceof nexacro.Tab||focusobj instanceof nexacro._TabButtonItemControl||focusobj instanceof nexacro.Tabpage)){return focusobj._getDlgCode(keycode,altKey,ctrlKey,shiftKey);}else{return {want_tab:true,want_return:false,want_escape:false,want_chars:false,want_arrows:this._isEnable()};}};_pTab._setTabFocusObj=function(focusobj){this._focusobj=focusobj;};_pTab._getTabFocusObj=function(){return this._focusobj;};_pTab._getComponentsByTaborder=function(p,filter_type){if(filter_type===undefined){filter_type=4;}if(p&&p!==this){return nexacro.FormBase._getComponentsByTaborder.call(this,p,filter_type);}var comps=[];var tabpage=this.tabpages[this.tabindex];var tabbuttonitem=this._tabbuttonitems[this.tabindex];if(this.focusacceptable&&tabbuttonitem){comps=[tabbuttonitem];}if((filter_type&4)||(tabpage&&tabpage.form._child_list&&tabpage.form._child_list.length>0)){comps.push(tabpage);}if(!this._isEnable()){return null;}var ar=[];{var comp_len=comps.length;for(var i=0;i<comp_len;i++ ){var comp=comps[i];if(!comp||!comp._is_created||!comp.visible||((comp._isEnable&&!comp._isEnable()||!comp.enable)&&!(filter_type&2))||comp._popup){continue;}if(!(filter_type&1)&&!comp.on_get_prop_tabstop()){continue;}ar[ar.length]=comp;}}return ar;};_pTab._searchNextTabFocus=function(current,bSearchFromFirst,opt_force_cycle,filter_type){var ret=nexacro.FormBase.prototype._searchNextTabFocus.call(this,current,bSearchFromFirst,opt_force_cycle,filter_type);if(ret&&bSearchFromFirst&&ret[0] instanceof nexacro.Tabpage){if(ret[0].form._child_list==0&&!(filter_type&4)){return [this];}}return ret;};_pTab._searchPrevTabFocus=function(current,bSearchFromLast,opt_force_cycle,filter_type){var ret=nexacro.FormBase.prototype._searchPrevTabFocus.call(this,current,bSearchFromLast,opt_force_cycle,filter_type);if(ret&&bSearchFromLast){var next=ret[0];if(next instanceof nexacro.Tabpage){if(next.form._child_list==0&&!(filter_type&4)){return [this];}}}return ret;};_pTab._getTabOrderNext=function(current,direction,filter_type){var tabbuttonitem=this._tabbuttonitems[this.tabindex];var tabpage=this.tabpages[this.tabindex];if(nexacro._isNull(filter_type)){filter_type=4;}if(direction>0){if(current===tabpage){return null;}else if(current===tabbuttonitem){if(filter_type&4){return tabpage;}else{return tabpage.form._getTabOrderFirst(filter_type);}}}else{if(current===tabpage&&this.focusacceptable){return tabbuttonitem;}else if(current===tabbuttonitem){if(filter_type&4){return this;}}}return null;};_pTab._getTabOrderFirst=function(filter_type){return nexacro.FormBase.prototype._getTabOrderFirst.call(this,filter_type);};_pTab._getTabOrderLast=function(filter_type){return nexacro.FormBase.prototype._getTabOrderLast.call(this,filter_type);};_pTab._getControlFromElement=function(elem){var ret=null;var p=elem;while(p&&p!==this){if(p instanceof nexacro._TabButtonItemControl||p instanceof nexacro._TabExtraButtonControl){return p;}p=p.parent;}return ret;};_pTab._on_orientationchange=function(orientation){var tabpage=this.tabpages[this.tabindex];if(tabpage){tabpage._on_orientationchange(orientation);}};_pTab._setContents=function(str){var doc=nexacro._parseXMLDocument(str);var tabpages=doc.getElementsByTagName("Tabpages")[0];if(!tabpages){return false;}var ret=true;var cur_tabindex=this.tabindex;var i;var len=this.tabpages.length;for(i=0;i<len;i++ ){this.removeTabpage(0);}var node=tabpages.firstChild;while(node){var className=nexacro._getRegisterClass(node.tagName);if(!className){return false;}var fnConstructor=nexacro._executeGlobalEvalStr(className);if(!fnConstructor){return false;}if(fnConstructor.prototype&&fnConstructor.prototype._is_component){var attr={};var attr_props={};for(i=0;i<node.attributes.length;i++ ){var name=node.attributes[i].name;if(/^(id|left|top|width|height|right|bottom|minwidth|maxwidth|minheight|maxheight|)$/.test(name)){attr[name]=node.attributes[i].value;}else{attr_props[name]=node.attributes[i].value;}}var obj=new fnConstructor(attr["id"],this);for(var v in attr_props){if(obj["set_"+v]){obj["set_"+v](attr_props[v]);}else{obj[v]=attr_props[v];}}if(node.firstChild){var childnode=node.firstChild;var strXML="";while(childnode){if(node.nodeType==1){strXML+=nexacro._documentToXml(childnode);}childnode=childnode.nextSibling;}ret=obj._setContents(strXML);}if(!ret){return ret;}this.addChild(obj.id,obj);obj.set_visible(false);obj.show();}node=node.nextSibling;}if(this._is_created){this._createSpinButton(false);this._createTabButtons(false);this.on_apply_tabindex(cur_tabindex);this._rearrangeContents();}return ret;};delete _pTab;}if(!nexacro.Tabpage){nexacro.Tabpage=function(id,parent){nexacro.Div.call(this,id,0,0,0,0,null,null,null,null,null,null,parent);};var _pTabpage=nexacro._createPrototype(nexacro.Div,nexacro.Tabpage);nexacro.Tabpage.prototype=_pTabpage;_pTabpage._type_name="TabpageControl";_pTabpage._is_subcontrol=true;_pTabpage.accessibilityrole="tabpage";_pTabpage.tabbuttonwidth=undefined;_pTabpage.tabbuttonheight=undefined;_pTabpage.tabbuttoncssclass="";_pTabpage._preload=false;_pTabpage._tabbuttonitem=null;_pTabpage.bringToFront=nexacro._emptyFn;_pTabpage.bringToPrev=nexacro._emptyFn;_pTabpage.moveToNext=nexacro._emptyFn;_pTabpage.moveToPrev=nexacro._emptyFn;_pTabpage.sendToBack=nexacro._emptyFn;_pTabpage.sendToNext=nexacro._emptyFn;_pTabpage.on_apply_text=function(text){var tab=this.parent;if(tab){var btn;if(tab._tabbuttonitems){var btn_len=tab._tabbuttonitems.length;for(var i=0;i<btn_len;i++ ){btn=tab._tabbuttonitems[i];if(btn._tabpage===this){btn.set_text(this.text);}}}tab._rearrangeContents();}};_pTabpage.on_apply_prop_tooltip=function(){var control_elem=this.getElement();if(control_elem){control_elem.setElementToolTip(this.tooltiptext);}this.on_apply_prop_accessibilitydescription();this._updateAccessibilityLabel();};_pTabpage.set_tabbuttonwidth=function(v){this.tabbuttonwidth=parseInt(v)|0;var tab=this.parent;if(tab){tab._rearrangeContents();}};_pTabpage.set_tabbuttonheight=function(v){this.tabbuttonheight=parseInt(v)|0;var tab=this.parent;if(tab){tab._rearrangeContents();}};_pTabpage.set_tabbuttoncssclass=function(v){v=nexacro._toString(v);if(this.tabbuttoncssclass!=v){this.tabbuttoncssclass=v;}var tabbuttonitem=this._tabbuttonitem;if(tabbuttonitem){tabbuttonitem.set_cssclass(v);}};_pTabpage.set_url=function(v){if(v&&v.substring(0,4).toLowerCase()=="url("){v=v.substring(4,v.length-1);}if(v!=this.url){this.url=v;if(this.parent._is_created==true){this.url=v;this.on_apply_url();}}};_pTabpage._on_apply_url=function(){if(!this._is_loadedform&&!this.form._is_loading&&this.url&&this.url.length>0){this.on_apply_url(false);}};_pTabpage._setTabFocusObj=function(focusobj){this.parent._focusobj=focusobj;};_pTabpage._getTabFocusObj=function(){return this.parent._getTabFocusObj();};_pTabpage.getParentContext=function(){return this.parent.getParentContext();};_pTabpage.on_getIDCSSSelector=function(){return "tabpage";};_pTabpage.on_apply_prop_enable=function(v){if(this.form){this.form._setEnable(v);}var tabbuttonitem=this._tabbuttonitem;if(tabbuttonitem){tabbuttonitem._setEnable(v);}};_pTabpage._on_focus=function(self_flag,evt_name,lose_focus,refer_lose_focus,new_focus,refer_new_focus){nexacro.Component.prototype._on_focus.call(this,self_flag,evt_name,lose_focus,refer_lose_focus,new_focus,refer_new_focus);if(new_focus){this._setTabFocusObj(new_focus);}else{this._setTabFocusObj(this);}};_pTabpage.on_killfocus_basic_action=function(new_focus,new_ref_focus){if(new_focus===this){return;}if(new_focus==null&&new_ref_focus==null){return;}this.form._last_focused=null;};_pTabpage.on_fire_user_onkeydown=function(key_code,alt_key,ctrl_key,shift_key,from_comp,from_refer_comp){if(!this.enable||key_code==nexacro.Event.KEY_TAB){return;}return nexacro.Div.prototype.on_fire_user_onkeydown.call(this,key_code,alt_key,ctrl_key,shift_key,from_comp,from_refer_comp);};_pTabpage.on_destroy_contents=function(){nexacro.Div.prototype.on_destroy_contents.call(this);this._tabbuttonitem=null;};_pTabpage.on_fire_sys_onaccessibilitygesture=function(direction,fire_comp,refer_comp){var next_obj=null;var tab_comp=this.parent;var index=tab_comp._getTabIndex();var button_len=tab_comp._tabButtons.length;var _window=this._getWindow();var last_notify=_window._accessibility_last_focused_comp;if(direction){next_obj=this._searchNextTabFocus(last_notify,undefined,undefined,3)[0];if(next_obj.parent!=fire_comp){index++ ;tab_comp._accessibility_tabindex=index;next_obj=(button_len>index)?tab_comp._tabButtons[index]:next_obj;}}else{next_obj=this._searchPrevTabFocus(last_notify,undefined,undefined,true)[0];if(next_obj==fire_comp){next_obj=tab_comp._tabButtons[index];}}if(next_obj){next_obj._setAccessibilityNotifyEvent(direction);return true;}return false;};_pTabpage._setAccessibilityNotifyEvent=function(direction){var next_obj=null;var index=this._index;var tab_comp=this.parent;var tabindex=tab_comp._getTabIndex();if(direction){if(index!=tabindex){next_obj=tab_comp._tabButtons[index];}else{next_obj=this._getTabOrderFirst(true,false);}}else{if(index!=tabindex){next_obj=tab_comp._tabButtons[index];}else{next_obj=this._getTabOrderLast(true,false);}}if(next_obj){next_obj._setAccessibilityNotifyEvent(direction);}};delete _pTabpage;}if(!nexacro._TabButtonItemControl){nexacro._TabButtonItemControl=function(id,left,top,width,height,right,bottom,minwidth,maxwidth,minheight,maxheight,parent){nexacro.Component.call(this,id,left,top,width,height,right,bottom,minwidth,maxwidth,minheight,maxheight,parent);this._sizeinfo={width:0,height:0};this._position={left:0,top:0,width:0,height:0};};var _pTabButtonItemControl=nexacro._createPrototype(nexacro.Component,nexacro._TabButtonItemControl);nexacro._TabButtonItemControl.prototype=_pTabButtonItemControl;_pTabButtonItemControl._type_name="TabButtonItemControl";_pTabButtonItemControl._is_subcontrol=true;_pTabButtonItemControl._use_selected_status=true;_pTabButtonItemControl._extrabutton=null;_pTabButtonItemControl._tabindex= -1;_pTabButtonItemControl._tabpage=null;_pTabButtonItemControl._extrabutton_iconsize=null;_pTabButtonItemControl._line_index=0;_pTabButtonItemControl.accessibilityrole="tabitem";_pTabButtonItemControl.on_created_contents=function(win){if(this._tabbuttonitemtext){this._tabbuttonitemtext.on_created(win);}if(this._extrabutton){this._extrabutton.on_created(win);}};_pTabButtonItemControl.on_create_contents_command=function(win){var str="";if(this._tabbuttonitemtext){str+=this._tabbuttonitemtext.createCommand();}if(this._extrabutton){str+=this._extrabutton.createCommand();}return str;};_pTabButtonItemControl.on_attach_contents_handle=function(win){if(this._tabbuttonitemtext){this._tabbuttonitemtext.attachHandle(win);}if(this._extrabutton){this._extrabutton.attachHandle(win);}};_pTabButtonItemControl.on_destroy_contents=function(){if(this._tabbuttonitemtext){this._tabbuttonitemtext.destroy();this._tabbuttonitemtext=null;}if(this._extrabutton){this._extrabutton.destroy();this._extrabutton=null;}this._tabpage=null;this._extrabutton_iconsize=null;};_pTabButtonItemControl.on_apply_text=function(v){var control_elem=this.getElement();if(control_elem){var tabbuttonitemtext=this._tabbuttonitemtext;var extrabutton_width=0;if(this._extrabutton){extrabutton_width=this._extrabutton._adjust_width;}var client_width=this._getClientWidth()-extrabutton_width;var client_height=this._getClientHeight();if(!v){v=this._displaytext;}if(!tabbuttonitemtext){tabbuttonitemtext=this._tabbuttonitemtext=new nexacro.Static("tabbuttonitemtext",0,0,client_width,client_height,null,null,null,null,null,null,this);tabbuttonitemtext._setControl();tabbuttonitemtext.set_text(v);tabbuttonitemtext.createComponent();}else{tabbuttonitemtext.set_text(v);tabbuttonitemtext.move(0,0,client_width,client_height,null,null);if(!tabbuttonitemtext._is_created){tabbuttonitemtext.on_created();}}}};_pTabButtonItemControl.on_changeStatus=function(changestatus,value,applystatus,currentstatus,currentuserstatus){return applystatus;};_pTabButtonItemControl.on_changeUserStatus=function(changestatus,value,applystatus,currentstatus,currentuserstatus){return applystatus;};_pTabButtonItemControl.on_apply_status=function(status,userstatus){};_pTabButtonItemControl.on_change_containerRect=function(width,height){var tabbuttonitemtext=this._tabbuttonitemtext;if(tabbuttonitemtext){var extrabutton_width=0;if(this._extrabutton){extrabutton_width=this._extrabutton._getClientWidth();}var client_width=this._getClientWidth()-extrabutton_width;var client_height=this._getClientHeight();tabbuttonitemtext.move(0,0,client_width,client_height,null,null);}};_pTabButtonItemControl.on_apply_prop_enable=function(v){var extrabutton=this._extrabutton;if(extrabutton){extrabutton._setEnable(v);}var tabbuttonitemtext=this._tabbuttonitemtext;if(tabbuttonitemtext){tabbuttonitemtext._setEnable(v);}};_pTabButtonItemControl.on_lbuttondown_basic_action=function(elem,button,alt_key,ctrl_key,shift_key,canvasX,canvasY,screenX,screenY,refer_comp){this.parent._tabbutton_obj=this;var ret=nexacro.Component.prototype.on_lbuttondown_basic_action.call(this,elem,button,alt_key,ctrl_key,shift_key,canvasX,canvasY,screenX,screenY,refer_comp);return ret;};_pTabButtonItemControl._on_focus=function(self_flag,evt_name,lose_focus,refer_lose_focus,new_focus,refer_new_focus){if(this.parent.tabindex!=this._tabindex){return;}var win=this._getWindow();var last_modalframe=win._getLastModalFrame();if(last_modalframe&&!last_modalframe._contains(this)){var form=this._getParentForm();if(form){form._setLastFocus(this);}}else{nexacro.Component.prototype._on_focus.call(this,self_flag,evt_name,lose_focus,refer_lose_focus,new_focus,refer_new_focus);this._setTabFocusObj(this);}};_pTabButtonItemControl._setTabFocusObj=function(focusobj){if(!this._is_alive){return;}this.parent._setTabFocusObj(focusobj);};_pTabButtonItemControl._getTabFocusObj=function(){if(!this._is_alive){return;}return this.parent._getTabFocusObj();};_pTabButtonItemControl.on_getIDCSSSelector=function(){return "tabbuttonitem";};_pTabButtonItemControl._onload_extra_iconimage=function(imgurl,width,height){if(!this._extrabutton_iconsize){this._extrabutton_iconsize={imageurl:imgurl,width:width,height:height};}else{var extrabutton_iconsize=this._extrabutton_iconsize;if(extrabutton_iconsize.imageurl!=imgurl||extrabutton_iconsize.width!=width||extrabutton_iconsize.height!=height){this._extrabutton_iconsize={imageurl:imgurl,width:width,height:height};}else{return;}}this.parent._on_get_extrabutton_iconsize(width,height);};_pTabButtonItemControl._showExtraButton=function(v,button_width,button_height){v=nexacro._toBoolean(v);if(v){var client_width=this._getClientWidth();var client_height=this._getClientHeight();var width=button_width||client_height;var height=button_height||client_height;var extrabutton_l=client_width-width;var extrabutton_t=(client_height-height)/2;var extrabutton_w=width;var extrabutton_h=height;if(!this._extrabutton){this._extrabutton=new nexacro._TabExtraButtonControl("extrabutton",0,0,0,0,null,null,null,null,null,null,this);this._extrabutton.createComponent();}else{if(!this._extrabutton.is_created){this._extrabutton.on_created(this._getWindow());}}this._extrabutton.move(extrabutton_l,extrabutton_t,extrabutton_w,extrabutton_h);}else{if(this._extrabutton){this._extrabutton.destroy();this._extrabutton=null;}}this.on_apply_text();};_pTabButtonItemControl._getItemSize=function(){var width=0;var height=0;var padding=this._getCSSStyleValue("padding");var border=this._getCSSStyleValue("border");var padding_l=0,padding_r=0,padding_t=0,padding_b=0;if(padding){padding_l=padding.left||0;padding_r=padding.right||0;padding_t=padding.top||0;padding_b=padding.bottom||0;}var border_w=0;var border_h=0;if(border){border_w=border._getBorderWidth()||0;border_h=border._getBorderHeight()||0;}width=padding_l+padding_r+border_w;height=padding_t+padding_b+border_h;var textsize=this._getItemTextSize();if(textsize){width+=textsize[0];height+=textsize[1];}return [width,height];};_pTabButtonItemControl._getItemTextSize=function(){var ret=[0,0];if(!this._tabbuttonitemtext){return ret;}var tabbuttonitemtext=this._tabbuttonitemtext;var padding=tabbuttonitemtext._getCSSStyleValue("padding");var border=tabbuttonitemtext._getCSSStyleValue("border");var padding_l=0,padding_r=0,padding_t=0,padding_b=0;if(padding){padding_l=padding.left||0;padding_r=padding.right||0;padding_t=padding.top||0;padding_b=padding.bottom||0;}var border_w=0;var border_h=0;if(border){border_w=border._getBorderWidth()||0;border_h=border._getBorderHeight()||0;}ret[0]+=padding_l+padding_r+border_w;ret[1]+=padding_t+padding_b+border_h;var strText=this._displaytext;var font=tabbuttonitemtext._getCurrentStyleInheritValue("font");var wordspace=tabbuttonitemtext._getCurrentStyleInheritValue("wordSpacing");var letterspace=tabbuttonitemtext._getCurrentStyleInheritValue("letterSpacing");if(font){var idx,multi=false;if(strText){idx=strText.search("\n");}multi=(idx== -1)?false:true;var size=nexacro._getTextSize(strText,font,multi,null,"none",wordspace,letterspace);ret[0]+=(Math.ceil(size[0])|0);ret[1]+=(Math.ceil(size[1])|0);}return ret;};_pTabButtonItemControl._getExtraButtonSize=function(bshowextrabutton){if(!this._extrabutton){this._extrabutton=new nexacro._TabExtraButtonControl("extrabutton",0,0,0,0,null,null,null,null,null,null,this);this._extrabutton.createComponent();}var ret={width:0,height:0};var padding=this._extrabutton._getCSSStyleValue("padding");var border=this._extrabutton._getCSSStyleValue("border");var padding_l=0,padding_r=0,padding_t=0,padding_b=0;if(padding){padding_l=padding.left||0;padding_r=padding.right||0;padding_t=padding.top||0;padding_b=padding.bottom||0;}var border_w=0;var border_h=0;if(border){border_w=border._getBorderWidth()||0;border_h=border._getBorderHeight()||0;}ret.width+=padding_l+padding_r+border_w;ret.height+=padding_t+padding_b+border_h;var extrabutton_iconsize=this._getExtraButtonIconSize();if(extrabutton_iconsize){ret.width+=extrabutton_iconsize.width;ret.height+=extrabutton_iconsize.height;}if(!bshowextrabutton){this._extrabutton.destroy();this._extrabutton=null;}return ret;};_pTabButtonItemControl._getExtraButtonIconSize=function(){var icon=this._extrabutton._getCSSStyleValue("icon");if(icon instanceof Object){icon=icon.value;}if(icon){var extrabutton_iconsize=this._extrabutton_iconsize;if(extrabutton_iconsize){var iconurl=icon;if(iconurl.substring(0,4).toLowerCase()=="url("){iconurl=iconurl.substring(5,iconurl.length-2);}iconurl=nexacro._getImageLocation(iconurl,this._getRefFormBaseUrl());if(extrabutton_iconsize.imageurl==iconurl){return {width:extrabutton_iconsize.width,height:extrabutton_iconsize.height};}}var imagesize=nexacro._getImageSize(icon,this._onload_extra_iconimage,this);if(imagesize){return {width:imagesize.width,height:imagesize.height};}}return null;};delete _pTabButtonItemControl;}if(!nexacro._TabExtraButtonControl){nexacro._TabExtraButtonControl=function(id,left,top,width,height,right,bottom,minwidth,maxwidth,minheight,maxheight,parent){nexacro.Button.call(this,id,left,top,width,height,right,bottom,minwidth,maxwidth,minheight,maxheight,parent);};var _pTabExtraButtonControl=nexacro._createPrototype(nexacro.Button,nexacro._TabExtraButtonControl);nexacro._TabExtraButtonControl.prototype=_pTabExtraButtonControl;_pTabExtraButtonControl._type_name="TabExtraButtonControl";_pTabExtraButtonControl._is_subcontrol=true;_pTabExtraButtonControl.on_getIDCSSSelector=function(){return "extrabutton";};delete _pTabExtraButton;}
if(!nexacro.FileDialog){nexacro.FileDialogEventInfo=function(strEventId,strReason,strPath,arrVirtualfiles){this.eventid=strEventId;this.reason=strReason;this.path=strPath;this.virtualfiles=arrVirtualfiles;};var _pFileDialogEventInfo=nexacro.FileDialogEventInfo.prototype=nexacro._createPrototype(nexacro.Event,nexacro.FileDialogEventInfo);_pFileDialogEventInfo._type_name="FileDialogEventInfo";delete _pFileDialogEventInfo;_pFileDialogEventInfo=null;nexacro.FileDialog=function(id,parent){this.id=this.name=id;this.EnvironmentPath=1;this._handle=nexacro._createFileDialogHandle(this);};var _pFileDialog=nexacro.FileDialog.prototype=nexacro._createPrototype(nexacro._EventSinkObject,nexacro.FileDialog);_pFileDialog._type_name="FileDialog";_pFileDialog.accept="";_pFileDialog.defaultextension=true;_pFileDialog.dialogtype=undefined;_pFileDialog.filter="";_pFileDialog.filterindex=0;_pFileDialog._event_list={"onclose":1};nexacro.FileDialog.LOAD=1;nexacro.FileDialog.SAVE=2;nexacro.FileDialog.MULTILOAD=3;nexacro.FileDialog.SELFOLDER=4;_pFileDialog.on_created=nexacro._emptyFn;_pFileDialog.destroy=function(){nexacro._destroyFileDialogHandle(this);this._handle=null;return true;};_pFileDialog.set_accept=function(v){v=nexacro._toString(v);if(this.accept!=v){this.accept=v;this.on_apply_accept();}};_pFileDialog.on_apply_accept=function(){nexacro._setFileDialogHandleAccept(this,this.accept);};_pFileDialog.set_defaultextension=function(v){v=nexacro._toBoolean(v);if(this.defaultextension!=v){this.defaultextension=v;this.on_apply_defaultextension();}};_pFileDialog.on_apply_defaultextension=function(){nexacro._setFileDialogHandleDefaultExtension(this,this.defaultextension);};_pFileDialog.set_dialogtype=function(v){if(this.dialogtype!=v){this.dialogtype=v;}};_pFileDialog.set_filter=function(v){v=nexacro._toString(v);if(this.filter!=v){if(this._isValidPropertyFilter(v)){this.filter=v;this.on_apply_filter();}}};_pFileDialog.on_apply_filter=function(){nexacro._setFileDialogHandleFilter(this,this.filter);};_pFileDialog.set_filterindex=function(v){if(isNaN(v= +v)||v<0){return;}if(this.filterindex!=v){this.filterindex=v;this.on_apply_filterindex();}};_pFileDialog.on_apply_filterindex=function(){nexacro._setFileDialogHandleFilterIndex(this,this.filterindex);};_pFileDialog.open=function(strTitle,constOpenMode,strInitialPath,strFileName,nDlgWidth,nDlgHeight){if(isNaN(constOpenMode= +constOpenMode)||(constOpenMode<1||constOpenMode>4)){return;}strTitle=strTitle?strTitle:this.id;strInitialPath=strInitialPath?strInitialPath:"%USERAPP%";strFileName=strFileName?strFileName:"";nDlgWidth=nDlgWidth?nDlgWidth: -1;nDlgHeight=nDlgHeight?nDlgHeight: -1;var filter=this.filter?this.filter:"All(*.*)|*.*|";var filterarr=filter.split("|");if(this.filter==""){nexacro._setFileDialogHandleFilter(this,"All(*.*)|*.*|");}if(this.defaultextension&&this.filterindex>=(filterarr.length/2)){return false;}nexacro._openFileDialogHandle(this,strTitle,constOpenMode,strInitialPath,strFileName,this.dialogtype,nDlgWidth,nDlgHeight);return true;};_pFileDialog.on_close=function(reason,path,vfiles){this.on_fire_onclose(reason,path,vfiles);};_pFileDialog._onclose=function(objData){var _virtualFile=objData.virtualfiles;var vfiles=new Array(_virtualFile.length);for(var i=0;i<_virtualFile.length;i++ ){var obj=new nexacro.VirtualFile("VirtualFile","");obj.filename=_virtualFile[i].filename;obj.fullpath=_virtualFile[i].fullpath;obj.path=_virtualFile[i].path;vfiles[i]=obj;}this.on_fire_onclose(objData.reason,objData.reason==4?objData.path:undefined,vfiles);};_pFileDialog.on_fire_onclose=function(reason,path,vfiles){if(this.onclose&&this.onclose._has_handlers){var evt=new nexacro.FileDialogEventInfo("onclose",reason,path,vfiles);return this.onclose._fireEvent(this,evt);}return true;};_pFileDialog._isValidPropertyFilter=function(strFilter){if(strFilter===""){return true;}var filterarr=strFilter.split("|");var f_len=filterarr.length;if(f_len<2){return false;}if((f_len%2==1)&&filterarr[f_len-1]!=""){return false;}var normalize=/[\*].[a-zA-Z0-9-\*]/gi;for(var i=0;i<f_len;i++ ){if(i%2==1){if(normalize.test(filterarr[i])==false){return false;}normalize.lastIndex=0;}}return true;};delete _pFileDialog;}
if(!nexacro.FileDownload){nexacro.FileDownloadEventInfo=function(obj,id,url,targetfullpath){this.id=this.eventid=id||"onsuccess";this.fromobject=this.fromreferenceobject=obj;this.url=url;this.targetfullpath=targetfullpath;};var _pFileDownloadEventInfo=nexacro._createPrototype(nexacro.Event,nexacro.FileDownloadEventInfo);nexacro.FileDownloadEventInfo.prototype=_pFileDownloadEventInfo;_pFileDownloadEventInfo._type_name="FileDownloadEventInfo";delete _pFileDownloadEventInfo;nexacro.FileDownloadErrorEventInfo=function(obj,id,errortype,errormsg,errorobj,statuscode,requesturi,locationuri){nexacro.ErrorEventInfo.call(this,obj,id,errortype,errormsg,errorobj,statuscode,requesturi,locationuri);};var _pFileDownloadErrorEventInfo=nexacro._createPrototype(nexacro.ErrorEventInfo,nexacro.FileDownloadErrorEventInfo);nexacro.FileDownloadErrorEventInfo.prototype=_pFileDownloadErrorEventInfo;_pFileDownloadErrorEventInfo._type_name="FileDownloadErrorEventInfo";delete _pFileDownloadErrorEventInfo;nexacro.FileDownload=function(id,left,top,width,height,right,bottom,minwidth,maxwidth,minheight,maxheight,parent){nexacro._IconText.call(this,id,left,top,width,height,right,bottom,minwidth,maxwidth,minheight,maxheight,parent);};var _pFileDownload=nexacro._createPrototype(nexacro._IconText,nexacro.FileDownload);nexacro.FileDownload.prototype=_pFileDownload;_pFileDownload._type_name="FileDownload";_pFileDownload.tabstop=true;_pFileDownload.downloadurl="";_pFileDownload.downloadfilename="";_pFileDownload.filefilter="";_pFileDownload.filefilterindex=0;_pFileDownload._is_simple_control=true;_pFileDownload._is_focus_accept=true;_pFileDownload._use_pushed_status=true;_pFileDownload._event_list={"onclick":1,"ondblclick":1,"ondrag":1,"ondragenter":1,"ondragmove":1,"ondragleave":1,"ondrop":1,"onkeydown":1,"onkeyup":1,"onkillfocus":1,"onsetfocus":1,"onlbuttondown":1,"onlbuttonup":1,"onrbuttondown":1,"onrbuttonup":1,"onmouseenter":1,"onmousemove":1,"onmouseleave":1,"onmove":1,"onsize":1,"onsuccess":1,"onerror":1,"oncontextmenu":1,"ontouchstart":1,"ontouchmove":1,"ontouchend":1};_pFileDownload.accessibilityrole="button";_pFileDownload.on_create_contents=function(){nexacro._IconText.prototype.on_create_contents.call(this);nexacro._create_hidden_frame("",this._on_download_onload,this,"filedownload");};_pFileDownload.on_destroy_contents=function(){nexacro._IconText.prototype.on_destroy_contents.call(this);nexacro._destroy_hidden_frame("",this,"filedownload");};_pFileDownload._getDlgCode=function(){return {want_tab:false,want_return:true,want_escape:false,want_chars:false,want_arrows:false};};_pFileDownload._isFocusAcceptable=function(){return this._is_focus_accept;};_pFileDownload.set_downloadurl=function(v){if(v!=this.downloadurl){this.downloadurl=v;}};_pFileDownload.set_downloadfilename=function(v){if(v!=this.downloadfilename){this.downloadfilename=v;}};_pFileDownload.set_filefilter=function(v){this.filefilter=v;};_pFileDownload.set_filefilterindex=function(v){this.filefilterindex=v;};_pFileDownload.download=function(url,targetpath){var ret=null;var downloadurl=this.downloadurl;var initname=this.downloadfilename;if(targetpath!=undefined){targetpath=nexacro._toString(targetpath);}if(url!=undefined){url=nexacro._toString(url);url=nexacro._getImageLocation(url);ret=nexacro._download(url,this._hidden_frame_handle,initname,targetpath,this.filefilter,this.filefilterindex);}else if(downloadurl!=undefined&&downloadurl!=""){downloadurl=nexacro._getServiceLocation(downloadurl);ret=nexacro._download(downloadurl,this._hidden_frame_handle,initname,targetpath,this.filefilter,this.filefilterindex);}return ret===null?false:true;};_pFileDownload._on_download_onload=function(status,data,url,errcode,httpcode,errmsg,extramsg){if(status<0){nexacro._onHttpSystemError(this,true,this,errcode,url,httpcode,url,null,extramsg);var commerrorobj=nexacro.MakeCommunicationError(this,errcode,url,httpcode,url,null,extramsg);this.on_fire_onerror(this,"ObjectError",commerrorobj.message,this,9901,null,null);}else{this.on_fire_onsuccess(url,data);}};_pFileDownload.on_fire_sys_onkeyup=function(key_code,alt_key,ctrl_key,shift_key,from_comp,from_refer_comp){var ret=nexacro.Component.prototype.on_fire_sys_onkeyup.call(this,key_code,alt_key,ctrl_key,shift_key,from_comp,from_refer_comp);if(key_code==13||key_code==32){this.on_fire_onclick("none",false,false,false, -1, -1, -1, -1, -1, -1,this,this);}return ret;};_pFileDownload.on_fire_onsuccess=function(url,targetfullpath){var application=nexacro.getApplication();if(application){application._endCommProgress();}if(this.onsuccess&&this.onsuccess._has_handlers&&url!=""){var evt=new nexacro.FileDownloadEventInfo(this,"onsuccess",url,targetfullpath);return this.onsuccess._fireEvent(this,evt);}};_pFileDownload.on_fire_onerror=function(obj,errortype,errormsg,errorobj,statuscode,requesturi,locationuri){var application=nexacro.getApplication();if(application){application._endCommProgress();}if(this.onerror&&this.onerror._has_handlers){var evt=new nexacro.FileDownloadErrorEventInfo(obj,"onerror",errortype,errormsg,errorobj,statuscode,requesturi,locationuri);return this.onerror._fireEvent(this,evt);}};_pFileDownload.on_fire_onclick=function(button,alt_key,ctrl_key,shift_key,screenX,screenY,canvasX,canvasY,clientX,clientY,from_comp,from_refer_comp){var ret=nexacro.Component.prototype.on_fire_onclick.call(this,button,alt_key,ctrl_key,shift_key,screenX,screenY,canvasX,canvasY,clientX,clientY,from_comp,from_refer_comp);this.download();return ret;};delete _pFileDownload;}
if(!nexacro.FileDownTransfer){nexacro.FileDownTransferEventInfo=function(obj,id,url,fullpath){this.id=this.eventid=id||"onsuccess";this.fromobject=this.fromreferenceobject=obj;this.url=url;this.targetfullpath=fullpath;};var _pFileDownTransferEventInfo=nexacro._createPrototype(nexacro.Event,nexacro.FileDownTransferEventInfo);nexacro.FileDownTransferEventInfo.prototype=_pFileDownTransferEventInfo;_pFileDownTransferEventInfo._type_name="FileDownTransferEventInfo";delete _pFileDownTransferEventInfo;nexacro.FileDownTransferErrorEventInfo=function(obj,id,errortype,errormsg,errorobj,statuscode,requesturi,locationuri){nexacro.ErrorEventInfo.call(this,obj,id,errortype,errormsg,errorobj,statuscode,requesturi,locationuri);};var _pFileDownTransferErrorEventInfo=nexacro._createPrototype(nexacro.ErrorEventInfo,nexacro.FileDownTransferErrorEventInfo);nexacro.FileDownTransferErrorEventInfo.prototype=_pFileDownTransferErrorEventInfo;_pFileDownTransferErrorEventInfo._type_name="FileDownTransferErrorEventInfo";delete _pFileDownTransferErrorEventInfo;nexacro.FileDownTransfer=function(id,parent){this.id=this.name=id;if(parent){this.parent=parent;}this.postdatalist=new nexacro.Collection();};var _pFileDownTransfer=nexacro.FileDownTransfer.prototype=nexacro._createPrototype(nexacro._EventSinkObject,nexacro.FileDownTransfer);_pFileDownTransfer._type_name="FileDownTransfer";_pFileDownTransfer.url="";_pFileDownTransfer.downloadfilename="";_pFileDownTransfer._event_list={"onsuccess":1,"onerror":1};_pFileDownTransfer.on_created=nexacro._emptyFn;_pFileDownTransfer.destroy=function(){this.postdatalist=null;return true;};_pFileDownTransfer.set_postdatalist=nexacro._emptyFn;_pFileDownTransfer.set_url=function(v){if(this.url!=v){this.url=v;}};_pFileDownTransfer.set_downloadfilename=function(v){if(this.downloadfilename!=v){this.downloadfilename=v;}};_pFileDownTransfer.setPostData=function(strKey,value){if(!strKey){return;}this.postdatalist.setItem(strKey,value);};_pFileDownTransfer.removePostData=function(strKey){this.postdatalist.delete_item(strKey);};_pFileDownTransfer.getPostData=function(strKey){return this.postdatalist.getItem(strKey);};_pFileDownTransfer.clearPostDataList=function(){this.postdatalist.clear();};_pFileDownTransfer.download=function(strUrl,strTargetPath){strUrl=strUrl?nexacro._getImageLocation(strUrl):(this.url?nexacro._getServiceLocation(this.url,null,null,false):"");strTargetPath=nexacro._toString(strTargetPath);if(!strUrl){return;}var postdatalist={};for(var i=0,len=this.postdatalist.length;i<len;i++ ){postdatalist[this.postdatalist._idArray[i]]=this.postdatalist[i];}nexacro._downloadTransfer(postdatalist,strUrl,strTargetPath,this);};_pFileDownTransfer.on_load=function(status,data,url,errcode,httpcode,errmsg,extramsg){if(data){if(!nexacro._isArray(data)){if(status<0){return this.on_fire_onerror("ObjectError",errmsg,this,httpcode,url,url);}else{return this.on_fire_onsuccess(url,data);}}else{}}return this.on_fire_onerror("ObjectError","fail to get",this,9901,url,url);};_pFileDownTransfer.on_error=function(url,errorcode,httpcode,errormsg){this.on_fire_onerror("ObjectError",errormsg,this,httpcode,url,url);};_pFileDownTransfer.on_fire_onsuccess=function(url,fullpath){if(this.onsuccess&&this.onsuccess._has_handlers){var evt=new nexacro.FileDownTransferEventInfo(this,"onsuccess",url,fullpath);this.onsuccess._fireEvent(this,evt);}};_pFileDownTransfer.on_fire_onerror=function(errortype,errormsg,errorobj,statuscode,requesturi,locationuri){if(this.onerror&&this.onerror._has_handlers){var evt=new nexacro.FileDownTransferErrorEventInfo(this,"onerror",errortype,errormsg,errorobj,statuscode,requesturi,locationuri);return this.onerror._fireEvent(this,evt);}return true;};_pFileDownTransfer._getForm=function(){if(this.parent instanceof nexacro.Form){return this.parent;}return null;};delete _pFileDownTransfer;}
if(!nexacro.FileUpload){nexacro.FileUploadItemEventInfo=function(obj,id,idx){this.id=this.eventid=id||"onfileuploaditem";this.fromobject=this.fromreferenceobject=obj;this.index=idx;};var _pEventFileUploadItemEventInfo=nexacro._createPrototype(nexacro.Event,nexacro.FileUploadItemEventInfo);nexacro.FileUploadItemEventInfo.prototype=_pEventFileUploadItemEventInfo;_pEventFileUploadItemEventInfo._type_name="FileUploadItemEventInfo";delete _pEventFileUploadItemEventInfo;nexacro.FileUploadMouseEventInfo=function(obj,id,strButton,altKey,ctrlKey,shiftKey,index,screenX,screenY,canvasX,canvasY,clientX,clientY,from_comp,from_refer_comp){this.id=this.eventid=id||"onmouse";this.fromobject=from_comp;this.fromreferenceobject=from_refer_comp;this.altkey=altKey||false;this.ctrlkey=ctrlKey||false;this.shiftkey=shiftKey||false;this.button=strButton||"";this.index=index;this.screenx=screenX|| -1;this.screeny=screenY|| -1;this.canvasx=canvasX|| -1;this.canvasy=canvasY|| -1;this.clientx=clientX|| -1;this.clienty=clientY|| -1;};var _pFileUploadMouseEventInfo=nexacro._createPrototype(nexacro.Event,nexacro.FileUploadMouseEventInfo);nexacro.FileUploadMouseEventInfo.prototype=_pFileUploadMouseEventInfo;_pFileUploadMouseEventInfo._type_name="FileUploadMouseEventInfo";_pFileUploadMouseEventInfo._xposConvertToRtl=function(obj,from_refer_comp){if(obj&&obj._isRtl&&obj._isRtl()){this._orgcanvasx=this.canvasx;this._orgcliendx=this.clientx;this.canvasx=nexacro._getRTLCanvasXForMouseEvent(obj,from_refer_comp,this.canvasx);this.clientx=obj._getClientXY(this.canvasx,this.canvasy)[0];return true;}return false;};_pFileUploadMouseEventInfo._xposConvertToLtr=function(obj){if(obj&&obj._isRtl&&obj._isRtl()){this.canvasx=this._orgcanvasx;this.clientx=this._orgclientx;delete this._orgcanvas;delete this._orgclientx;}};delete _pFileUploadMouseEventInfo;nexacro.FileUploadEventInfo=function(obj,id,dsArray,code,msg,url){this.id=this.eventid=id||"onsuccess";this.fromobject=this.fromreferenceobject=obj;this.datasets=dsArray;this.errorcode=code;this.errormsg=msg;this.url=url;};var _pFileUploadEventInfo=nexacro._createPrototype(nexacro.Event,nexacro.FileUploadEventInfo);nexacro.FileUploadEventInfo.prototype=_pFileUploadEventInfo;_pFileUploadEventInfo._type_name="FileUploadEventInfo";delete _pFileUploadEventInfo;nexacro.FileUploadItemChangeEventInfo=function(obj,id,index,oldvalue,newvalue){this.id=this.eventid=id||"onitemchanged";this.fromobject=this.fromreferenceobject=obj;this.index=obj.index;this.oldvalue=oldvalue;this.newvalue=newvalue;};var _pFileUploadItemChangeEventInfo=nexacro._createPrototype(nexacro.Event,nexacro.FileUploadItemChangeEventInfo);nexacro.FileUploadItemChangeEventInfo.prototype=_pFileUploadItemChangeEventInfo;_pFileUploadItemChangeEventInfo._type_name="FileUploadItemChangeEventInfo";delete _pFileUploadItemChangeEventInfo;nexacro.FileUploadErrorEventInfo=function(obj,id,errortype,errormsg,errorobj,statuscode,requesturi,locationuri,index){nexacro.ErrorEventInfo.call(this,obj,id,errortype,errormsg,errorobj,statuscode,requesturi,locationuri);this.index=index;};var _pFileUploadErrorEventInfo=nexacro._createPrototype(nexacro.ErrorEventInfo,nexacro.FileUploadErrorEventInfo);nexacro.FileUploadErrorEventInfo.prototype=_pFileUploadErrorEventInfo;_pFileUploadErrorEventInfo._type_name="FileUploadErrorEventInfo";delete _pFileUploadErrorEventInfo;nexacro.FileUpload=function(id,left,top,width,height,right,bottom,minwidth,maxwidth,minheight,maxheight,parent){nexacro.Component.call(this,id,left,top,width,height,right,bottom,minwidth,maxwidth,minheight,maxheight,parent);this.filelist=[];this.filepathedits=new nexacro.Collection();this.filefindbuttons=new nexacro.Collection();this._items=[];this.context=this._refform;};var _pFileUpload=nexacro._createPrototype(nexacro.Component,nexacro.FileUpload);nexacro.FileUpload.prototype=_pFileUpload;_pFileUpload._type_name="FileUpload";_pFileUpload.buttonsize=undefined;_pFileUpload.buttontext="find";_pFileUpload.index= -1;_pFileUpload.itemcount=1;_pFileUpload.itemheight=undefined;_pFileUpload.multiselect=false;_pFileUpload.text="";_pFileUpload.uploadurl="";_pFileUpload.value=undefined;_pFileUpload.filefilter="";_pFileUpload.filefilterindex=0;_pFileUpload._hidden_frame_handle=null;_pFileUpload._last_id= -1;_pFileUpload._bresetscroll=0;_pFileUpload._onPopupWin=false;_pFileUpload._is_listtype=true;_pFileUpload._calc_scroll=false;_pFileUpload._cnt_resetscroll=0;_pFileUpload._iscors=false;_pFileUpload._is_scrollable=true;_pFileUpload.accessibilityaction="";_pFileUpload.accessibilityrole="fileupload";_pFileUpload.accessibilitydesclevel="all";_pFileUpload.accessibilitydescription="";_pFileUpload.accessibilityenable=true;_pFileUpload.accessibilitylabel="";_pFileUpload.buttonaccessibilityaction="";_pFileUpload.buttonaccessibilityrole="";_pFileUpload.buttonaccessibilitydesclevel="all";_pFileUpload.buttonaccessibilitydescription="";_pFileUpload.buttonaccessibilityenable=true;_pFileUpload.buttonaccessibilitylabel="";_pFileUpload.editaccessibilityaction="";_pFileUpload.editaccessibilityrole="";_pFileUpload.editaccessibilitydesclevel="all";_pFileUpload.editaccessibilitydescription="";_pFileUpload.editaccessibilityenable=true;_pFileUpload.editaccessibilitylabel="";_pFileUpload._want_tab=true;_pFileUpload._want_arrow=false;_pFileUpload._first_focus=false;_pFileUpload._editFlag=null;_pFileUpload._buttonFlag=false;_pFileUpload._event_list={"ondblclick":1,"onkeypress":1,"onkeydown":1,"onkeyup":1,"onkillfocus":1,"onsetfocus":1,"ondrag":1,"ondrop":1,"ondragenter":1,"ondragleave":1,"ondragmove":1,"onlbuttondown":1,"onlbuttonup":1,"onrbuttondown":1,"onrbuttonup":1,"onmousedown":1,"onmouseup":1,"onmouseenter":1,"onmouseleave":1,"onmousemove":1,"onmousewheel":1,"onmove":1,"onsize":1,"onsuccess":1,"onerror":1,"oncontextmenu":1,"onappenditem":1,"ondeleteitem":1,"onitemclick":1,"onfindclick":1,"onitemchanged":1,"ontouchstart":1,"ontouchmove":1,"ontouchend":1};_pFileUpload.on_create_contents=function(){var control_elem=this.getElement();if(control_elem){var item;var items=this._items;var itemcount=this.itemcount;for(var i=0;i<itemcount;i++ ){item=this._createFileItem(i,0,0,0,0,true);this.filepathedits.add_item(item.id,item.fileitemedit);this.filefindbuttons.add_item(item.id,item.fileitembutton);items[i]=item;}}};_pFileUpload.on_created_contents=function(){nexacro._create_hidden_frame(this._unique_id,this._on_manager_onload,this,"fileupload");if(!this.context){this.context=this._refform;}this.on_apply_index(this.index);this.on_apply_prop_enable(this._isEnable());this._recalcLayout();var item;var items=this._items;var itemcount=this.itemcount;for(var i=0;i<itemcount;i++ ){item=items[i];item.on_created();item._setEventHandler("onfindclick",this._on_item_onfindclick,this);item._setEventHandler("onitemclick",this._on_item_onitemclick,this);if(nexacro._enableaccessibility){item._setAccessibilityInfoIndex(i+1);item._setAccessibilityInfoCount(itemcount);}}this._buttonFlag=true;if(nexacro._enableaccessibility){this.on_apply_editaccessibility();this.on_apply_buttonaccessibility();}this._onRecalcScrollSize();};_pFileUpload.on_destroy_contents=function(){var items=this._items;var item_len=items.length;for(var i=0;i<item_len;i++ ){items[i].destroy();}this.filelist=null;this._items=null;this.filepathedits.clear();this.filepathedits=null;this.filefindbuttons.clear();this.filefindbuttons=null;nexacro._destroy_hidden_frame(this._unique_id,this,"fileupload");};_pFileUpload.on_create_contents_command=function(){this.on_apply_index(this.index);this.on_apply_prop_enable(this._isEnable());this._recalcLayout();var str="";var items=this._items;var itemcount=this.itemcount;for(var i=0;i<itemcount;i++ ){str+=items[i].createCommand();}return str;};_pFileUpload.on_attach_contents_handle=function(win){nexacro._create_hidden_frame(this._unique_id,this._on_manager_onload,this,"fileupload");var item;var items=this._items;var itemcount=this.itemcount;for(var i=0;i<itemcount;i++ ){item=items[i];item.attachHandle(win);item._setEventHandler("onfindclick",this._on_item_onfindclick,this);item._setEventHandler("onitemclick",this._on_item_onitemclick,this);if(nexacro._enableaccessibility){item._setAccessibilityInfoIndex(i+1);item._setAccessibilityInfoCount(itemcount);}if(this.index==i){if(this._editFlag){item.fileitemedit.setFocus(false);}if(this._buttonFlag){item.fileitembutton.setFocus(false);}this.value=item.value;}}this._buttonFlag=true;if(nexacro._enableaccessibility){this.on_apply_editaccessibility(this.editaccessibility);this.on_apply_buttonaccessibility(this.buttonaccessibility);}if(this.multiselect){this.on_apply_multiselect(this.multiselect);}this._onRecalcScrollSize();};_pFileUpload.on_change_containerRect=function(width,height){if(this._is_created_contents){this._recalcLayout();if(!this._calc_scroll){this._onRecalcScrollSize();}else{this._cnt_resetscroll++ ;this._onResetScrollBar();}}};_pFileUpload.on_change_containerPos=function(left,top){};_pFileUpload._apply_setfocus=function(evt_name){var enableaccessibility=nexacro._enableaccessibility;var selffocus=((evt_name=="lbutton")?false:enableaccessibility);var items=this._items;if(items.length< -1||enableaccessibility){var control_elem=this._control_element;if(control_elem){control_elem.setElementFocus(selffocus);}}else{var item=items[this.index];if(item){item.fileitembutton._control_element.setElementFocus(selffocus);}}};_pFileUpload.on_apply_prop_enable=function(enable){nexacro.Component.prototype.on_apply_prop_enable.call(this,enable);var items=this._items;var item_len=items.length;for(var i=0;i<item_len;i++ ){items[i]._setEnable(enable);items[i].fileitemedit._setEnable(enable);items[i].fileitembutton._setEnable(enable);}};_pFileUpload._onRecalcScrollSize=function(){var control_elem=this.getElement();if(control_elem){var scrollWidth=this._getClientWidth();var scrollHeight=this.itemcount*this._getItemHeight();if(scrollHeight>this._getClientHeight()){var vscroll=this.vscrollbar;if(vscroll){if(!vscroll.visible){scrollWidth-=vscroll._getClientWidth();}}else{scrollWidth-=this._getVScrollBarSize();}}this._calc_scroll=true;control_elem.setElementScrollMaxSize(scrollWidth,scrollHeight);if(!this._cnt_resetscroll){this._onResetScrollBar();}this._calc_scroll=false;this._cnt_resetscroll=0;}};_pFileUpload._on_getAccessibilityAdditionalLabel=function(){if(this._first_focus==false){var count=0;var items=this._items;if(items){count=items.length;}return ( +this.index)+1+" "+count;}return "";};_pFileUpload._getDlgCode=function(keycode,altKey,ctrlKey,shiftKey){var want_tab=this._want_tab;this._want_tab=true;this._want_arrow=this._want_arrow&&this._isEnable();return {want_tab:want_tab,want_return:true,want_escape:false,want_chars:false,want_arrows:this._want_arrow};};_pFileUpload._isAccessibilityEnable=function(){return true;};_pFileUpload.set_text=nexacro._emptyFn;_pFileUpload.set_value=nexacro._emptyFn;_pFileUpload.set_buttonsize=function(v){if(v!==undefined){if(isNaN(v= +v)){return;}}if(this.buttonsize!=v){this.buttonsize=v;this.on_apply_buttonsize(v);}};_pFileUpload.on_apply_buttonsize=function(buttonsize){var items=this._items;var item_len=items.length;for(var i=0;i<item_len;i++ ){if(items[i]){items[i]._recalcLayout();}}};_pFileUpload.set_buttontext=function(v){if(this.buttontext!=v){this.buttontext=v;this.on_apply_buttontext(v);}};_pFileUpload.on_apply_buttontext=function(buttontext){var itembutton;var items=this._items;var item_len=items.length;for(var i=0;i<item_len;i++ ){itembutton=items[i].fileitembutton;if(itembutton){itembutton.set_text(buttontext);}}};_pFileUpload.set_index=function(v){if(isNaN(v= +v)||v< -1){return;}if(this.index!=v){this.index=v;this.on_apply_index(v);this._setAccessibilityStatSelected(v);}};_pFileUpload.on_apply_index=function(index){var control_elem=this.getElement();if(control_elem){var item=this._items[index];if(item){if(this._editFlag){item.fileitemedit.setFocus(false);}if(this._buttonFlag){item.fileitembutton.setFocus(false);}this.value=item.value;}}};_pFileUpload.set_itemcount=function(v){if(isNaN(v= +v)||v<0){return;}if(this.itemcount!=v){var pre_itemcount=this.itemcount;this.itemcount=v;this.on_apply_itemcount(v,pre_itemcount);}};_pFileUpload.on_apply_itemcount=function(itemcount,pre_itemcount){var control_elem=this.getElement();if(control_elem){var item;var items=this._items;var item_len=items.length;while(item_len&&pre_itemcount>itemcount){pre_itemcount-- ;items.pop().destroy();}for(var i=item_len;i<itemcount;i++ ){item=this._items[i]=this._createFileItem(i);this.filepathedits.add_item(item.id,item.fileitemedit);this.filefindbuttons.add_item(item.id,item.fileitembutton);}this._recalcLayout();this._onRecalcScrollSize();}};_pFileUpload.set_itemheight=function(v){if(v!==undefined){if(isNaN(v= +v)){return;}}if(this.itemheight!=v){this.itemheight=v;this.on_apply_itemheight(v);}};_pFileUpload.on_apply_itemheight=function(itemheight){this._recalcLayout();this._onRecalcScrollSize();};_pFileUpload.set_multiselect=function(v){v=nexacro._toBoolean(v);if(this.multiselect!=v){this.multiselect=v;this.on_apply_multiselect(v);}};_pFileUpload.on_apply_multiselect=function(multiselect){var control_elem=this.getElement();if(control_elem){var item;var items=this._items;var item_len=items.length;var comp_name=this._unique_id;for(var i=0;i<item_len;i++ ){item=items[i];nexacro._setMultipleFile(comp_name,item.name,multiselect,item);}}};_pFileUpload.set_uploadurl=function(v){if(this.uploadurl!=v){this.uploadurl=v;}};_pFileUpload.on_apply_accessibility=function(){nexacro.Component.prototype.on_apply_accessibility.call(this);this.on_apply_editaccessibility();this.on_apply_buttonaccessibility();};_pFileUpload.on_apply_editaccessibility=function(){var iLen=this._items.length;var item=null;var role=this.editaccessibilityrole;var label=this.editaccessibilitylabel;var desclevel=this.editaccessibilitydesclevel;var description=this.editaccessibilitydescription;var enable=this.editaccessibilityenable;var action=this.editaccessibilityaction;for(var i=0;i<iLen;i++ ){item=this._getItem(i);var fileitemedit=item.fileitemedit;if(fileitemedit){if(role){fileitemedit.set_accessibilitydescrole(role);}if(label){fileitemedit.set_accessibilitydesclabel(label);}if(desclevel){fileitemedit.set_accessibilitydesclevel(desclevel);}if(action){fileitemedit.set_accessibilityaction(action);}if(description){fileitemedit.set_accessibilitydesclevel(description);}fileitemedit.set_accessibilityenable(enable);}}};_pFileUpload.on_apply_buttonaccessibility=function(buttonaccessibility){var iLen=this._items.length;var item=null;var role=this.editaccessibilityrole;var label=this.editaccessibilitylabel;var desclevel=this.editaccessibilitydesclevel;var description=this.editaccessibilitydescription;var enable=this.editaccessibilityenable;var action=this.editaccessibilityaction;for(var i=0;i<iLen;i++ ){item=this._getItem(i);var fileitembutton=item.fileitembutton;if(fileitembutton){if(role){fileitembutton.set_accessibilitydescrole(role);}if(label){fileitembutton.set_accessibilitydesclabel(label);}if(desclevel){fileitembutton.set_accessibilitydesclevel(desclevel);}if(action){fileitembutton.set_accessibilityaction(action);}if(description){fileitembutton.set_accessibilitydesclevel(description);}fileitembutton.set_accessibilityenable(enable);}}};_pFileUpload.set_filefilter=function(v){this.filefilter=v;};_pFileUpload.set_filefilterindex=function(v){this.filefilterindex=v;};_pFileUpload.appendItem=function(){var control_elem=this.getElement();if(control_elem){var index=this.itemcount;var item=this._items[index]=this._createFileItem(index);this.filepathedits.add_item(item.id,item.fileitemedit);this.filefindbuttons.add_item(item.id,item.fileitembutton);this.itemcount++ ;if(nexacro._enableaccessibility){item._setAccessibilityInfoIndex(index);item._setAccessibilityInfoCount(index+1);}this._recalcLayout();this._onRecalcScrollSize();this.on_fire_onappenditem(this,index);}};_pFileUpload.deleteItem=function(idx){if(idx<0){return;}var cur_index=this.index;var control_elem=this.getElement();if(control_elem){idx=parseInt(idx,10);var items=this._items;if(this.itemcount<=idx){return;}var iCount=this.itemcount;var iCnt=iCount-1;for(var i=idx+1;i<iCount;i++ ){if(cur_index==i){this.index-- ;}items[i].index-- ;if(nexacro._enableaccessibility){items[i]._setAccessibilityInfoIndex(i);items[i]._setAccessibilityInfoCount(iCnt);}}items[idx].destroy();items.splice(idx,1);if(cur_index==idx){this.index= -1;this.value=undefined;}this.itemcount-- ;this._recalcLayout();this._onRecalcScrollSize();this.on_fire_ondeleteitem(this,idx);this._updateFileList();}};_pFileUpload.changeItem=function(idx,newvalue){if(nexacro._Browser=="Runtime"&&nexacro._OS!="Android"){var control_elem=this.getElement();if(control_elem){idx=parseInt(idx,10);if(this.itemcount<=idx){return;}var item=this._items[idx];var value;var fLen=newvalue.length;var trustNewvalue=new Array();if(fLen>0){value="";for(var j=0;j<fLen;j++ ){var filename=newvalue[j];filename=filename.split("/").join("\\");var nIdx=filename.lastIndexOf("\\");var path="";if(nIdx>0){path=filename.substring(0,nIdx+1);}var _window=this._getWindow();if(nexacro._isTrustPath(_window,path)){value+=(trustNewvalue.length>0?", ":"")+newvalue[j];trustNewvalue.push(newvalue[j]);}}}if(value!=item.value){item.oldvalue=item.value;item.value=value;item._changeFiles(trustNewvalue);if(item.fileitemedit){item.fileitemedit.set_value(value);}if(((this.index== -1)?0:this.index)==idx){item.parent._setText(value);item.parent._setValue(value);}item.parent.on_fire_onitemchanged(item,idx,item.oldvalue,item.value,newvalue);}trustNewvalue.length=0;}}};_pFileUpload.getItemCount=function(bHasValue){var control_elem=this.getElement();if(control_elem){bHasValue=nexacro._toBoolean(bHasValue);var cnt=0;var idx=0;var items=this._items;var item_len=items.length;while(idx<item_len){if(bHasValue==true){if(items[idx].value){cnt++ ;}}else{return item_len;}++ idx;}return cnt;}};_pFileUpload.getItemIndex=function(obj){var control_elem=this.getElement();if(control_elem){if(typeof obj=="object"){var idx=0;var items=this._items;while(idx<items.length){if(obj==items[idx].fileitembutton){return idx;}if(obj==items[idx].fileitemedit){return idx;}++ idx;}return  -1;}}};_pFileUpload.hasValue=function(idx){var control_elem=this.getElement();if(control_elem){var i=0,cnt=0;var items=this._items;if(idx== -1){while(i<items.length){if(items[i].value){ ++cnt;}++ i;}if(cnt==items.length){return true;}return false;}if(idx<items.length&&items[idx].value){return true;}return false;}};_pFileUpload.upload=function(v){var ret=false;var uploadurl;if(v==undefined){if(this.uploadurl){uploadurl=nexacro._getServiceLocation(this.uploadurl,null,null,false);}}else{uploadurl=nexacro._getServiceLocation(v,null,null,false);}if(nexacro._Browser!="Runtime"){if(!nexacro._isSameOrigin(uploadurl,nexacro._project_url)){this._iscors=true;}}if(uploadurl){var items=this._items;var len=items?items.length:0;var i;if(nexacro._Browser=="Runtime"&&nexacro._OS!="Android"){var fileinfo=[];var idx=0;for(i=0;i<len;i++ ){if(items[i]._files){fileinfo[idx]=items[i]._files;idx++ ;}}for(i=0;i<len;i++ ){if(items[i]&&items[i].value){if(items[i]._files&&(items[i]._files[0] instanceof nexacro.VirtualFile)){nexacro._submit(this._unique_id,uploadurl,this._hidden_frame_handle,null,items[i].value,fileinfo);}else{nexacro._submit(this._unique_id,uploadurl,this._hidden_frame_handle,null,items[i].value);}return true;}}}else if(nexacro._Browser=="Runtime"&&nexacro._OS=="Android"){if(len>1){var fileinfo=[];var idx=0;for(i=0;i<len;i++ ){if(items[i]._files){fileinfo[idx]=items[i]._files;idx++ ;}}nexacro._submit(this._unique_id,uploadurl,this._hidden_frame_handle,null,items[0].value,fileinfo);ret=true;}else{nexacro._submit(this._unique_id,uploadurl,this._hidden_frame_handle,null,items[0].value);ret=true;}}else if(nexacro._OS=="iOS"&&nexacro._isHybrid&&nexacro._isHybrid()){var evttarget=this;var _on_manager_onload=function(){return function(status,data,url,errcode,httpcode,loaded,total){var errorcode;var errormsg="fail to get";try{if(status==4){}else{var result;var fstr=data.trimLeft().slice(0,5).toUpperCase();if(fstr.indexOf("SSV")==0){result=nexacro._Deserializer["SSV"](data);}else if(fstr.indexOf("<?XML")==0){result=nexacro._Deserializer["XML"](nexacro._parseXMLDocument(data));}if(result){errorcode=result[0]["ErrorCode"];errormsg=result[0]["ErrorMsg"];}else{errormsg=data;}if(errorcode<0){evttarget.on_fire_onerror(evttarget,"ObjectError",errormsg,evttarget,9901,null,null, -1);}else{evttarget.on_fire_onsuccess(result[1],errorcode,errormsg,url,result);}}}catch(e){if(e&&e.message){errormsg=e.message;}evttarget.on_fire_onerror(evttarget,"ObjectError",errormsg,evttarget,9901,null,null, -1);}};};var fileinfo=[];var fileinfo_offset=0;for(i=0;i<len;i++ ){if(items[i].value&&items[i]._files){for(var file_item in items[i]._files){fileinfo[fileinfo_offset++ ]=items[i]._files[file_item];}}}if(fileinfo.length>0){nexacro._uploadTransferXHR(fileinfo,"",uploadurl,_on_manager_onload());ret=true;}}else{for(i=0;i<len;i++ ){if(items[i].value){ret=true;if(nexacro._Browser=="MobileSafari"||nexacro._Browser=="Gecko"){nexacro._request_submit(this._unique_id,uploadurl,this);}else{nexacro._submit(this._unique_id,uploadurl,this._hidden_frame_handle,null,items[i].value);}break;}}}}return ret;};if(nexacro._Browser=="Runtime"){_pFileUpload._on_manager_onload=function(status,data,url,errcode,httpcode,errmsg,cookies){var result,fstr,errorcode= -1,errormsg="fail to get";var xmldoc;if(status<0){nexacro._onHttpSystemError(this,true,this,errcode,url,httpcode,url,null);var commerrorobj=nexacro.MakeCommunicationError(this,errcode,url,httpcode,url,null,cookies);this.on_fire_onerror(this,"ObjectError",commerrorobj.message,this,httpcode,null,null, -1);}else{try{if(data){data=data.trimLeft();fstr=data.slice(0,10).toUpperCase();if(fstr.indexOf("SSV")==0){result=nexacro._Deserializer["SSV"](data);}else if(fstr.indexOf("<?XML")==0){xmldoc=nexacro._getXMLDocument(this._unique_id,data,url);result=nexacro._Deserializer["XML"](xmldoc);}var error_info=result?result[0]:null;if(error_info){errorcode=error_info["ErrorCode"];errormsg=error_info["ErrorMsg"];}if(errorcode<0){this.on_fire_onerror(this,"ObjectError",errormsg,this,9901,null,null, -1);}else{this.on_fire_onsuccess(result[1],errorcode,errormsg,url,result);}}else if(status!=4){this.on_fire_onerror(this,"ObjectError",errormsg,this,9901,null,null, -1);}}catch(e){if(e&&e.message){errormsg=e.message;}this.on_fire_onerror(this,"ObjectError",errormsg,this,9901,null,null, -1);}}};}else{_pFileUpload._bindUploadDataHandler=function(e){var pthis=this._comp,status=this.status,readystate=this.readyState;if(readystate==4){if(status==200){var data=this.responseText.trim();var date_type=data.substring(0,3);if(date_type!="SSV"){data=this.responseXML;date_type=nexacro._getContentType(data);}var result=null;if(nexacro.Deserializer[date_type]){result=nexacro.Deserializer[date_type](data);}if(result){pthis.on_fire_onsuccess(result[1],result[0]["ErrorCode"],result[0]["ErrorMsg"],this.responseURL,result);}else{pthis.on_fire_onerror(pthis,"ObjectError","failed to get",pthis,9901,null,null, -1);}}else{pthis.on_fire_onerror(pthis,"ObjectError","failed to get",pthis,9901,null,null, -1);}}};_pFileUpload._on_manager_onload=function(node,data,url,errcode,httpcode,errmsg){var result,fstr,errorcode= -1,errormsg="fail to get";var xmldoc;try{if(this._iscors){nexacro._setPostMessage(this._unique_id,this);this._iscors=false;}else{xmldoc=nexacro._getXMLDocument(this._unique_id,data,url);if(xmldoc){url=xmldoc.URL?xmldoc.URL:url;if(url=="about:blank"){return;}this.context=this.parent;if(nexacro._getContentType(xmldoc)=="XML"){result=nexacro._Deserializer["XML"](xmldoc);}else{data=nexacro._getDataFromDOM(xmldoc,this);data=nexacro.trimLeft(data);fstr=data.substring(0,3).toUpperCase();if(fstr=="SSV"){result=nexacro._Deserializer["SSV"](data);}}if(result){var error_info=result[0];errorcode=error_info["ErrorCode"];errormsg=error_info["ErrorMsg"];}else{errormsg=data;}if(errorcode<0){this.on_fire_onerror(this,"ObjectError",errormsg,this,9901,null,null, -1);}else{this.on_fire_onsuccess(result[1],errorcode,errormsg,url,result);}}}}catch(e){if(e&&e.message){errormsg=e.message;}this.on_fire_onerror(this,"ObjectError",errormsg,this,9901,null,null, -1);}};}_pFileUpload.on_after_load=function(messageObj){var str=messageObj.message;var result,fstr,url,code= -1,msg="",data="";try{var xmldoc=nexacro._parseXMLDocument(decodeURIComponent(str.replace(/\+/g," ")));url=xmldoc.URL?xmldoc.URL:xmldoc.url;if(url=="about:blank"){return;}this.context=this.parent;if(nexacro._getContentType(xmldoc)=="XML"){result=nexacro._Deserializer["XML"](xmldoc);}else{data=nexacro._getDataFromDOM(xmldoc,this);data=nexacro.trimLeft(data);fstr=data.substring(0,3).toUpperCase();if(fstr=="SSV"){result=nexacro._Deserializer["SSV"](data);}}if(result){var error_info=result[0];if(error_info["ErrorCode"]!=null){code=error_info["ErrorCode"];}if(error_info["ErrorMsg"]!=null){msg=error_info["ErrorMsg"];}}else{msg=data;}if(code<0){this.on_fire_onerror(this,"ObjectError","failed to get",this,9901,null,null, -1);}else{this.on_fire_onsuccess(result[1],code,msg,url,result);}delete this.context;}catch(e){this.on_fire_onerror(this,"ObjectError","failed to get",this,9901,null,null, -1);}};_pFileUpload._setParamter=nexacro._emptyFn;_pFileUpload._on_item_onfindclick=function(obj,e){this.set_index(obj.index);var bHandled=false;var index=nexacro._indexOf(this._items,obj);if(this._isEnable()&&this.enableevent){bHandled=this.on_fire_onfindclick(obj,index);if(bHandled){try{nexacro._findclick(this._unique_id,obj.name,obj,this._hidden_frame_handle,this.filefilter,this.filefilterindex);}catch(e){var errorobj=nexacro.MakeError("ObjectError",this,"comp_incorrect_file");this.on_fire_onerror(this,errorobj.name,errorobj.message,obj,null,null,null,index);}}}return bHandled;};_pFileUpload._on_item_onitemclick=function(obj,e){this.set_index(obj.index);if(this.visible&&this._isEnable()&&this.enableevent){this.on_fire_onitemclick(obj,obj.index);}};_pFileUpload._on_getAccessibilityAdditionalLabel=function(){if(this._first_focus==false){var count=0;var items=this._items;if(items){count=items.length;}return ( +this.index)+1+" "+count;}return "";};_pFileUpload._isAccessibilityEnable=function(){return true;};_pFileUpload.on_get_accessibility_label=function(){var label="";return label;};_pFileUpload.on_fire_sys_onaccessibilitygesture=function(direction,fire_comp,refer_comp){var idx=this.index;var items=this._items;while(true){if(direction){if(!this._buttonFlag&&items[idx].fileitembutton._isAccessibilityEnable()){this._editFlag=false;this._buttonFlag=true;}else{if(items[ ++idx]){this._editFlag=true;this._buttonFlag=false;if(!items[idx].fileitemedit._isAccessibilityEnable()){continue;}}else{this._editFlag=false;this._buttonFlag=false;return this._want_arrow=false;}}}else{if(!this._editFlag&&items[idx].fileitemedit._isAccessibilityEnable()){this._editFlag=true;this._buttonFlag=false;}else{if(items[ --idx]){this._editFlag=false;this._buttonFlag=true;if(!items[idx].fileitembutton._isAccessibilityEnable()){continue;}}else{this._editFlag=false;this._buttonFlag=false;return this._want_arrow=false;}}}break;}if(items[idx]){if(this._editFlag){items[idx].fileitemedit._setAccessibilityNotifyEvent();}else if(this._buttonFlag){items[idx].fileitembutton._setAccessibilityNotifyEvent();}this.index=idx;this.value=items[idx].value;return this._want_arrow=true;}else{return this._want_arrow=false;}};_pFileUpload._setAccessibilityNotifyEvent=function(direction){this._editFlag=false;this._buttonFlag=false;var idx;var items=this._items;var itemLen=items.length;if(itemLen){if(direction){idx=0;if(items[idx]&&items[idx].fileitemedit._isAccessibilityEnable()){this._editFlag=true;}else if(items[idx]&&items[idx].fileitembutton._isAccessibilityEnable()){this._buttonFlag=true;}}else{idx=itemLen-1;if(items[idx]&&items[idx].fileitembutton._isAccessibilityEnable()){this._buttonFlag=true;}else if(items[idx]&&items[idx].fileitemedit._isAccessibilityEnable()){this._editFlag=true;}}if(this._buttonFlag||this._editFlag){if(this._editFlag){items[idx].fileitemedit._setAccessibilityNotifyEvent();}else if(this._buttonFlag){items[idx].fileitembutton._setAccessibilityNotifyEvent();}this.index=idx;this.value=items[idx].value;return this._want_arrow=true;}}this._want_arrow=false;return nexacro.Component.prototype._setAccessibilityNotifyEvent.call(this,direction);};_pFileUpload._setAccessibilityInfoByHover=function(control){if(control){this._editFlag=false;this._buttonFlag=false;var item=control.parent;if(control instanceof nexacro.FileItemEditCtrl){this._editFlag=true;}else if(control instanceof nexacro.FileItemButtonCtrl){this._buttonFlag=true;}this.index=item.index;this._want_arrow=true;control._setAccessibilityNotifyEvent();return true;}return false;};_pFileUpload.on_fire_onerror=function(obj,errortype,errormsg,errorobj,statuscode,requesturi,locationuri,index){if(this.onerror&&this.onerror._has_handlers){var evt=new nexacro.FileUploadErrorEventInfo(obj,"onerror",errortype,errormsg,errorobj,statuscode,requesturi,locationuri,index);return this.onerror._fireEvent(this,evt);}return true;};_pFileUpload.on_fire_user_onlbuttondown=function(button,alt_key,ctrl_key,shift_key,screenX,screenY,canvasX,canvasY,clientX,clientY,from_comp,from_refer_comp){if(this.onlbuttondown&&this.onlbuttondown._has_handlers){var evtinfo_control=this._getEventInfoComponent(from_refer_comp);var evt=new nexacro.FileUploadMouseEventInfo(this,"onlbuttondown",button,alt_key,ctrl_key,shift_key,evtinfo_control.index,screenX,screenY,canvasX,canvasY,clientX,clientY,from_comp,from_refer_comp);return this.onlbuttondown._fireEvent(this,evt);}return false;};_pFileUpload.on_fire_user_onlbuttonup=function(button,alt_key,ctrl_key,shift_key,screenX,screenY,canvasX,canvasY,clientX,clientY,from_comp,from_refer_comp,from_elem){if(this.onlbuttonup&&this.onlbuttonup._has_handlers){var evtinfo_control=this._getEventInfoComponent(from_refer_comp);var evt=new nexacro.FileUploadMouseEventInfo(this,"onlbuttonup",button,alt_key,ctrl_key,shift_key,evtinfo_control.index,screenX,screenY,canvasX,canvasY,clientX,clientY,from_comp,from_refer_comp);return this.onlbuttonup._fireUserEvent(this,evt);}return false;};_pFileUpload.on_fire_user_onkeydown=function(keycode,alt_key,ctrl_key,shift_key,fire_comp,refer_comp){var items=this._items;var idx=this.index;var E=nexacro.Event;if(keycode==E.KEY_TAB){if((shift_key&&idx==0)||(!shift_key&&idx==items.length-1)){this._want_tab=false;this.set_index( -1);}else{if(shift_key){idx-- ;}else{idx++ ;}this.set_index(idx);}this._getWindow()._keydown_element._event_stop=true;}else{if(nexacro._enableaccessibility){var focus_up=keycode==E.KEY_UP;var focus_down=keycode==E.KEY_DOWN;var accessibilityenable=this.accessibilityenable;var buttonaccessibilityenable=this.buttonaccessibilityenable;var editaccessibilityenable=this.editaccessibilityenable;if(focus_up||focus_down){var _window=this._getWindow();if((focus_up&&idx<0)||(focus_down&&this._buttonFlag&&idx==items.length-1)){this._want_arrow=false;}else{while(editaccessibilityenable||buttonaccessibilityenable){if(focus_up){if(!this._editFlag&&editaccessibilityenable){this.index= -1;this._editFlag=true;this._buttonFlag=false;}else{idx-- ;if(buttonaccessibilityenable){if(idx<0){if(accessibilityenable){this._editFlag=false;this._buttonFlag=false;_window._removeFromCurrentFocusPath(this,false);this._setFocus(false);}else{this._want_arrow=false;break;}}else{this.index= -1;this._editFlag=false;this._buttonFlag=true;}}else{if(idx>0){this._buttonFlag=false;continue;}else{this._want_arrow=false;if(accessibilityenable){this._editFlag=false;this._buttonFlag=false;_window._removeFromCurrentFocusPath(this,false);this._setFocus(false);}}}}}else{if(!this._editFlag&&editaccessibilityenable){idx++ ;this._editFlag=true;this._buttonFlag=false;}else{if(buttonaccessibilityenable){this.index= -1;this._editFlag=false;this._buttonFlag=true;}else{if(idx<items.length-1){this._editFlag=false;continue;}else{this._want_arrow=false;break;}}}}this.set_index(idx);this._want_arrow=true;this._getWindow()._keydown_element._event_stop=true;break;}}}else{this._want_arrow=false;}}}return nexacro.Component.prototype.on_fire_user_onkeydown.call(this,keycode,alt_key,ctrl_key,shift_key,fire_comp,refer_comp);};_pFileUpload._on_focus=function(self_flag,evt_name,lose_focus,refer_lose_focus,new_focus,refer_new_focus){nexacro.Component.prototype._on_focus.call(this,self_flag,evt_name,lose_focus,refer_lose_focus,new_focus,refer_new_focus);var idx,focus_dir;var items=this._items;var itemLen=items.length;if(itemLen){this._want_tab=true;focus_dir=evt_name=="shifttabkey";if(evt_name=="shifttabkey"||evt_name=="tabkey"){this._editFlag=false;this._buttonFlag=true;if(focus_dir){idx=this.index<0?itemLen-1:this.index;}else{idx=this.index<0?0:this.index;this._first_focus=true;}this.index= -1;this.set_index(idx);}else{focus_dir=evt_name=="upkey";if(nexacro._enableaccessibility&&this._isAccessibilityEnable()){this._editFlag=false;this._buttonFlag=false;this._want_arrow=true;var accessibility=nexacro._toBoolean(this.accessibilityenable);var editaccessibility=nexacro._toBoolean(this.editaccessibilityenable);var buttonaccessibility=nexacro._toBoolean(this.buttonaccessibilityenable);if(focus_dir){this.index= -1;idx=itemLen-1;if(buttonaccessibility){this._buttonFlag=true;}else if(editaccessibility){this._editFlag=true;}}else{idx= -1;if(accessibility==false){idx=0;this.index= -1;if(editaccessibility){this._editFlag=true;}else if(buttonaccessibility){this._buttonFlag=true;}this._first_focus=(this._editFlag||this._buttonFlag)?true:false;}}this.set_index(idx);}}if(nexacro._enableaccessibility){this._first_focus=false;}}};_pFileUpload._find_item_status=function(item){this._editFlag=(item.fileitemedit._status=="focused");this._buttonFlag=(item.fileitembutton._status=="focused");};_pFileUpload.on_fire_ondeleteitem=function(obj,index){if(this.ondeleteitem&&this.ondeleteitem._has_handlers){var evt=new nexacro.FileUploadItemEventInfo(obj,"ondeleteitem",index);this.ondeleteitem._fireEvent(this,evt);}};_pFileUpload.on_fire_onfindclick=function(obj,index){if(this.onfindclick&&this.onfindclick._has_handlers){var evt=new nexacro.FileUploadItemEventInfo(this,"onfindclick",index);return this.onfindclick._fireCheckEvent(this,evt);}return true;};_pFileUpload.on_fire_onitemchanged=function(obj,index,oldvalue,newvalue){if(this.onitemchanged&&this.onitemchanged._has_handlers){var evt=new nexacro.FileUploadItemChangeEventInfo(obj,"onitemchanged",index,oldvalue,newvalue);this.onitemchanged._fireEvent(this,evt);}};_pFileUpload.on_fire_onitemclick=function(obj,index){if(this.onitemclick&&this.onitemclick._has_handlers){var evt=new nexacro.FileUploadItemEventInfo(this,"onitemclick",index);this.onitemclick._fireEvent(this,evt);}};_pFileUpload.on_fire_onappenditem=function(obj,index){if(this.onappenditem&&this.onappenditem._has_handlers){var evt=new nexacro.FileUploadItemEventInfo(obj,"onappenditem",index);this.onappenditem._fireEvent(this,evt);}};_pFileUpload.on_fire_onsuccess=function(ds,code,msg,url,variables){var application=nexacro.getApplication();if(application){application._endCommProgress();}if(this.onsuccess&&this.onsuccess._has_handlers){var evt;if(variables&&variables.length>0){evt=new nexacro.FileUploadEventInfo(this,"onsuccess",ds,code,msg,url);return this.onsuccess._fireEvent(this,evt);}else{evt=new nexacro.FileUploadEventInfo(this,"onsuccess",ds,undefined,undefined,url);return this.onsuccess._fireEvent(this,evt);}}};_pFileUpload._createFileItem=function(index){var create_only=this._is_created?false:true;var unique=this.itemcount<1?this._last_id=0: ++this._last_id;var item=new nexacro._FileUploadItemControl("upfile"+unique,0,0,0,0,null,null,null,null,null,null,this);item._setControl();item._setItemInfo(index,this.buttontext);item.createComponent(create_only);item._setEventHandler("onfindclick",this._on_item_onfindclick,this);item._setEventHandler("onitemclick",this._on_item_onitemclick,this);return item;};_pFileUpload._recalcLayout=function(){var items=this._items;var item_len=items.length;if(!item_len){return;}var item_left=this._getClientLeft();var item_top;var item_width=this._getClientWidth();var item_height=this._getItemHeight();for(var i=0;i<item_len;i++ ){item_top=item_height*i;items[i].move(item_left,item_top,item_width,item_height,null,null);}};_pFileUpload._updateFileList=function(){this.filelist=[];for(var i=0,item_len=this._items.length,files;i<item_len;i++ ){files=this._items[i]._files;if(files){for(var j=0,files_len=files.length,vfile;j<files_len;j++ ){vfile=new nexacro.VirtualFile("uploadfile"+i+"-"+j,"",files[j]);vfile._setFullPath(files[j].fullpath||"");vfile._setPath(files[j].path||"");vfile._setFileName(files[j].name||"");this.filelist.push(vfile);}}}};_pFileUpload._setText=function(v){if(this.text!=v){this.text=v;}};_pFileUpload._setValue=function(v){if(this.value!=v){this.value=v;}};_pFileUpload._setControlFlag=function(item){this._editFlag=(item.fileitemedit._status=="focused");this._buttonFlag=(item.fileitembutton._status=="focused");};_pFileUpload._getItem=function(index){if(index>=0&&this._items.length>0){return this._items[index];}return null;};_pFileUpload._getItemHeight=function(){var item=this._items[0];if(!item){return 0;}var itemheight=this.itemheight;if(itemheight){return itemheight;}return item._on_getFitSize()[1];};_pFileUpload._getEventInfoComponent=function(refer_comp){while(!refer_comp._is_eventinfo_control){refer_comp=refer_comp.parent;}return refer_comp;};_pFileUpload._isPopupFrame=function(){return this._onPopupWin;};delete _pFileUpload;nexacro._FileUploadItemControl=function(id,left,top,width,height,right,bottom,minwidth,maxwidth,minheight,maxheight,parent){nexacro.Component.call(this,id,left,top,width,height,right,bottom,minwidth,maxwidth,minheight,maxheight,parent);if(nexacro._OS=="iOS"&&nexacro._isHybrid&&nexacro._isHybrid()){this._id=nexacro.Device.makeID();nexacro.Device._userCreatedObj[this._id]=this;var params='""';var jsonstr='{"id":'+this._id+', "div":"FileUpload", "method":"constructor", "params":'+params+'}';nexacro.Device.exec(jsonstr);}};var _pFileUploadItemControl=nexacro._createPrototype(nexacro.Component,nexacro._FileUploadItemControl);nexacro._FileUploadItemControl.prototype=_pFileUploadItemControl;_pFileUploadItemControl._type_name="FileUploadItemControl";_pFileUploadItemControl._is_subcontrol=true;_pFileUploadItemControl.fileitemedit=null;_pFileUploadItemControl.fileitembutton=null;_pFileUploadItemControl.buttontext="find";_pFileUploadItemControl.index=0;_pFileUploadItemControl.value=undefined;_pFileUploadItemControl._oldvalue="";_pFileUploadItemControl._newvalue="";_pFileUploadItemControl.value="";_pFileUploadItemControl.index=0;_pFileUploadItemControl.accessibilityrole="none";_pFileUploadItemControl._event_list={"onfindclick":1,"onitemclick":1};_pFileUploadItemControl.on_create_contents=function(){var control_elem=this.getElement();if(control_elem){var itemedit=this.fileitemedit=new nexacro._FileUploadItemEditControl("fileuploaditemedit",0,0,0,0,null,null,null,null,null,null,this);var itembutton=this.fileitembutton=new nexacro._FileUploadItemButtonControl("fileuploaditembutton",0,0,0,0,null,null,null,null,null,null,this);itemedit.set_readonly("true");itemedit.createComponent(true);itembutton.set_text(this.buttontext);itembutton.createComponent(true);}};_pFileUploadItemControl.on_created_contents=function(){var parent=this.parent;if(parent){nexacro._append_hidden_item(parent._unique_id,this.name,this._on_itemedit_onchange,this,parent._hidden_frame_handle,parent.multiselect);}var itemedit=this.fileitemedit;var itembutton=this.fileitembutton;itemedit.on_created();itemedit._setEventHandler("oneditclick",this._on_itemedit_oneditclick,this);itemedit._setEventHandler("onlbuttondown",this._on_itemedit_oneditlbuttondown,this);itembutton.on_created();itembutton._setEventHandler("onclick",this._on_itembutton_onfindclick,this);itembutton._setEventHandler("onlbuttondown",this._on_itembutton_onfindlbuttondown,this);};_pFileUploadItemControl.on_destroy_contents=function(){if(this.fileitemedit){this.parent.filepathedits.delete_item(this.id);this.fileitemedit.destroy();this.fileitemedit=null;}if(this.fileitembutton){this.parent.filefindbuttons.delete_item(this.id);this.fileitembutton.destroy();this.fileitembutton=null;}if(this._files){this._files=null;}var parent=this.parent;nexacro._remove_hidden_item(parent._unique_id,this.name,parent._hidden_frame_handle);if(this._input_node){this._input_node=null;}if(nexacro._OS=="iOS"&&nexacro._isHybrid&&nexacro._isHybrid()){var params='""';delete nexacro.Device._userCreatedObj[this._id];var jsonstr='{"id":'+this._id+', "div":"FileUpload", "method":"destroy", "params":'+params+'}';nexacro.Device.exec(jsonstr);}};_pFileUploadItemControl.on_create_contents_command=function(){var str="";var itemedit=this.fileitemedit;if(itemedit){str+=itemedit.createCommand();}var itembutton=this.fileitembutton;if(itembutton){str+=itembutton.createCommand();}return str;};_pFileUploadItemControl.on_attach_contents_handle=function(win){var itemedit=this.fileitemedit;var itembutton=this.fileitembutton;itemedit.attachHandle(win);itemedit._setEventHandler("oneditclick",this._on_itemedit_oneditclick,this);itemedit._setEventHandler("onlbuttondown",this._on_itemedit_oneditlbuttondown,this);itembutton.attachHandle(win);itembutton._setEventHandler("onclick",this._on_itembutton_onfindclick,this);itembutton._setEventHandler("onlbuttondown",this._on_itembutton_onfindlbuttondown,this);var parent=this.parent;nexacro._append_hidden_item(parent._unique_id,this.name,this._on_itemedit_onchange,this,parent._hidden_frame_handle,parent._multiselect);};_pFileUploadItemControl.on_change_containerRect=function(width,height){if(this._is_created_contents){this._recalcLayout();}};_pFileUploadItemControl.on_getIDCSSSelector=function(){return "fileuploaditem";};_pFileUploadItemControl._on_getFitSize=function(){var elem=this.getElement();if(elem){var total_w=0;var total_h=0;var itemedit_size=[0,0];var itembutton_size=[0,0];var border=this._getCurrentStyleBorder();if(border){total_w+=border._getBorderWidth();total_h+=border._getBorderHeight();}var padding=this._getCurrentStylePadding();if(padding){total_w+=padding.left+padding.right;total_h+=padding.top+padding.bottom;}var itemedit=this.fileitemedit;if(itemedit){itemedit_size=itemedit._on_getFitSize();}var itembutton=this.fileitembutton;if(itembutton){itembutton_size=itembutton._on_getFitSize();}var itemheight=this._getPropItemHeight();if(itemheight==null){itemheight=Math.max(itemedit_size[1],itembutton_size[1]);}var buttonsize=this._getPropButtonSize();if(buttonsize==null){buttonsize=itembutton_size[0];}total_w+=buttonsize+itemedit_size[1];total_h+=itemheight;return [total_w,total_h];}return [this._adjust_width,this._adjust_height];};_pFileUploadItemControl._on_itemedit_oneditclick=function(obj,e){if(this.onitemclick&&this.onitemclick._has_handlers){this.onitemclick._fireEvent(this,e);}return false;};_pFileUploadItemControl._on_itemedit_oneditlbuttondown=function(obj,e){this._accessibility_find_focus_flag(true,false);this.parent.set_index(this.index);};_pFileUploadItemControl._on_itemedit_onchange=function(value,files,value_arr){if(nexacro._OS=="iOS"&&nexacro._isHybrid&&nexacro._isHybrid()){var objData=value;value=objData.virtualfiles[0].name;files=objData.virtualfiles;value_arr=[objData.virtualfiles[0].name];}if(this.value!=value){this.value=value;this._oldvalue=this._newvalue;this._newvalue=value_arr;var fileitemedit=this.fileitemedit;if(fileitemedit){fileitemedit.set_value(value);}var fileupload=this.parent;if(fileupload){fileupload.set_index(this.index);fileupload._setText(value);fileupload._setValue(value);}if(files){this._files=files;if(fileupload){fileupload._updateFileList();}}fileupload.on_fire_onitemchanged(this,this.index,this._oldvalue,this._newvalue);}};_pFileUploadItemControl._on_itembutton_onfindclick=function(obj,e){if(this.onfindclick&&this.onfindclick._has_handlers){return this.onfindclick._fireCheckEvent(this,e);}return false;};_pFileUploadItemControl._on_itembutton_onfindlbuttondown=function(obj,e){this._accessibility_find_focus_flag(false,true);this.parent.set_index(this.index);};_pFileUploadItemControl._recalcLayout=function(){var control_elem=this.getElement();if(control_elem){var itemedit=this.fileitemedit;var itembutton=this.fileitembutton;var client_w=this._getClientWidth();var itembutton_size=[0,0];if(itembutton){itembutton_size=itembutton._on_getFitSize();}var itemheight=this._getPropItemHeight();if(itemheight==null){var itemedit_size=[0,0];if(itemedit){itemedit_size=itemedit._on_getFitSize();}itemheight=Math.max(itemedit_size[1],itembutton_size[1]);}var buttonsize=this._getPropButtonSize();if(buttonsize==null){buttonsize=itembutton_size[0];}if(client_w<buttonsize){buttonsize=client_w;}var edit_l=this._getClientLeft();var edit_t=this._getClientTop();var edit_w=client_w-buttonsize;var edit_h=itemheight;var button_l=edit_l+edit_w;var button_t=edit_t;var button_w=buttonsize;var button_h=itemheight;if(itemedit){itemedit.move(edit_l,edit_t,edit_w,edit_h,null,null);}if(itembutton){itembutton.move(button_l,button_t,button_w,button_h,null,null);}}};_pFileUploadItemControl._setItemInfo=function(index,buttontext){this.index=index;this.buttontext=buttontext;};_pFileUploadItemControl._getPropButtonSize=function(){var fileupload=this.parent;if(fileupload){return fileupload.buttonsize;}return;};_pFileUploadItemControl._getPropItemHeight=function(){var fileupload=this.parent;if(fileupload){return fileupload.itemheight;}return;};_pFileUploadItemControl._accessibility_find_focus_flag=function(editflag,buttonflag){if(nexacro._enableaccessibility){this.parent._editFlag=editflag;this.parent._buttonFlag=buttonflag;}};_pFileUploadItemControl._isPopupFrame=function(){return this.parent._onPopupWin;};_pFileUploadItemControl._changeFiles=function(files){this._files=[];if(files){var file_list=[];this._files.length=files.length;var v_file;for(var loopI=0;loopI<this._files.length;loopI++ ){v_file=new nexacro.VirtualFile("uploadfile"+loopI);var filename=files[loopI];var nIdx=filename.lastIndexOf("\\");if(nIdx>0){v_file.fullpath=filename;v_file.path=filename.substring(0,nIdx+1);v_file.filename=filename.substring(nIdx+1);}else{v_file.filename=filename;}file_list[loopI]=v_file;}this._files=file_list;}else{this._files=[];}};delete _pFileUploadItemControl;nexacro._FileUploadItemEditControl=function(id,left,top,width,height,right,bottom,minwidth,maxwidth,minheight,maxheight,parent){nexacro.Edit.call(this,id,left,top,width,height,right,bottom,minwidth,maxwidth,minheight,maxheight,parent);};var _pFileUploadItemEditControl=nexacro._createPrototype(nexacro.Edit,nexacro._FileUploadItemEditControl);nexacro._FileUploadItemEditControl.prototype=_pFileUploadItemEditControl;_pFileUploadItemEditControl._type_name="EditControl";_pFileUploadItemEditControl._is_subcontrol=true;_pFileUploadItemEditControl._is_eventinfo_control=false;_pFileUploadItemEditControl._getAccessibilityLabel=function(accessibility){var label="";if(this.parent.parent._first_focus){var comp=this.parent.parent;label=comp._control_element._makeAccessibilityLabelbyReadtype();}label+=" "+nexacro.Component.prototype._getAccessibilityLabel.call(this,accessibility);return label;};_pFileUploadItemEditControl.on_focus_basic_action=function(self_flag,evt_name){if(this._isAccessibilityEnable()){this.on_apply_accessibility();}return nexacro.Component.prototype.on_focus_basic_action.call(this,self_flag,evt_name);};delete _pFileUploadItemEditControl;nexacro._FileUploadItemButtonControl=function(id,left,top,width,height,right,bottom,minwidth,maxwidth,minheight,maxheight,parent){nexacro.Button.call(this,id,left,top,width,height,right,bottom,minwidth,maxwidth,minheight,maxheight,parent);};var _pFileUploadItemButtonControl=nexacro._createPrototype(nexacro.Button,nexacro._FileUploadItemButtonControl);nexacro._FileUploadItemButtonControl.prototype=_pFileUploadItemButtonControl;_pFileUploadItemButtonControl._type_name="ButtonControl";_pFileUploadItemButtonControl._is_subcontrol=true;_pFileUploadItemButtonControl._is_eventinfo_control=false;_pFileUploadItemButtonControl._getAccessibilityLabel=function(accessibility){var label="";if(this.parent.parent._first_focus){var comp=this.parent.parent;label=comp._control_element._makeAccessibilityLabelbyReadtype();}label+=" "+nexacro.Component.prototype._getAccessibilityLabel.call(this,accessibility);return label;};_pFileUploadItemButtonControl.on_fire_sys_onkeyup=function(key_code,alt_key,ctrl_key,shift_key,from_comp,from_refer_comp){var ret=nexacro.Component.prototype.on_fire_sys_onkeyup.call(this,key_code,alt_key,ctrl_key,shift_key,from_comp,from_refer_comp);var window=this._getWindow();var elem=window._cur_ldown_elem||window._keydown_element;if(elem==this._cur_ldown_elem){if(key_code==13||key_code==32){this._click(key_code);}}this._cur_ldown_elem=null;return ret;};delete _pFileUploadItemButtonControl;}
if(!nexacro.FileUpTransfer){nexacro.FileUpTransferEventInfo=function(obj,id,dsArray,code,message,url,index){this.id=this.eventid=id||"onsuccess";this.fromobject=this.fromreferenceobject=obj;this.datasets=dsArray;this.code=code;this.message=message;this.url=url;};var _pFileUpTransferEventInfo=nexacro._createPrototype(nexacro.Event,nexacro.FileUpTransferEventInfo);nexacro.FileUpTransferEventInfo.prototype=_pFileUpTransferEventInfo;_pFileUpTransferEventInfo._type_name="FileUpTransferEventInfo";delete _pFileUpTransferEventInfo;nexacro.FileUpTransferErrorEventInfo=function(obj,id,errortype,errormsg,errorobj,statuscode,requesturi,locationuri,index){nexacro.ErrorEventInfo.call(this,obj,id,errortype,errormsg,errorobj,statuscode,requesturi,locationuri);};var _pFileUpTransferErrorEventInfo=nexacro._createPrototype(nexacro.ErrorEventInfo,nexacro.FileUpTransferErrorEventInfo);nexacro.FileUpTransferErrorEventInfo.prototype=_pFileUpTransferErrorEventInfo;_pFileUpTransferErrorEventInfo._type_name="FileUpTransferErrorEventInfo";delete _pFileUpTransferErrorEventInfo;nexacro.FileUpTransferProgressEventInfo=function(obj,id,loaded,total,index){this.id=this.eventid=id||"onprogress";this.fromobject=this.fromreferenceobject=obj;this.loaded=loaded;this.total=total;};var _pFileUpTransferProgressEventInfo=nexacro._createPrototype(nexacro.ErrorEventInfo,nexacro.FileUpTransferProgressEventInfo);nexacro.FileUpTransferProgressEventInfo.prototype=_pFileUpTransferProgressEventInfo;_pFileUpTransferProgressEventInfo._type_name="FileUpTransferProgressEventInfo";delete _pFileUpTransferProgressEventInfo;nexacro.FileUpTransfer=function(id,parent){this.id=this.name=id;if(parent){this.parent=parent;}this.filelist=new nexacro.Collection();this.postdatalist=new nexacro.Collection();};var _pFileUpTransfer=nexacro.FileUpTransfer.prototype=nexacro._createPrototype(nexacro._EventSinkObject,nexacro.FileUpTransfer);_pFileUpTransfer._type_name="FileUpTransfer";_pFileUpTransfer.url="";_pFileUpTransfer._handle=null;_pFileUpTransfer._aborted=false;_pFileUpTransfer._user_aborted=false;_pFileUpTransfer._TransferType={ALL:1,PART:2,PARTALL:3};_pFileUpTransfer._event_list={"onsuccess":1,"onerror":1,"onprogress":1};_pFileUpTransfer.on_created=nexacro._emptyFn;_pFileUpTransfer.destroy=function(){if(this.filelist){this.filelist.destroy();this.filelist=null;}if(this.postdatalist){this.postdatalist.destroy();this.postdatalist=null;}return true;};_pFileUpTransfer.set_filelist=nexacro._emptyFn;_pFileUpTransfer.set_postdatalist=nexacro._emptyFn;_pFileUpTransfer.set_url=function(v){if(this.url!=v){this.url=v;}};_pFileUpTransfer.setFile=function(nIndex,vFile){if(!vFile||!(vFile instanceof nexacro.VirtualFile)){return false;}return this.filelist.set_item(nIndex,vFile);};_pFileUpTransfer.addFile=function(id,vFile){if(id===null||id===undefined||id===""||this.filelist[id]){return  -1;}if(!vFile||!(vFile instanceof nexacro.VirtualFile)){return  -1;}return this.filelist.add_item(id,vFile);};_pFileUpTransfer.removeFile=function(id){return this.filelist.delete_item(id);};_pFileUpTransfer.removeFileByIndex=function(nIndex){nIndex=nIndex|0;if(nIndex<0||nIndex>=this.filelist.length){return  -1;}return this.filelist.delete_item(nIndex);};_pFileUpTransfer.getFileArrayByFileName=function(strFileName){var ret=null;for(var i=0,file,filelist=this.filelist,len=filelist.length;i<len;i++ ){file=filelist[i];if(strFileName==file.filename){if(!ret){ret=[];}ret.push(file);}}return ret;};_pFileUpTransfer.getIndexArrayByFileName=function(strFileName){var ret=null;for(var i=0,filelist=this.filelist,len=filelist.length;i<len;i++ ){if(strFileName==filelist[i].filename){if(!ret){ret=[];}ret.push(i);}}return ret;};_pFileUpTransfer.existFile=function(vFile){var ret=false;if(!vFile||!(vFile instanceof nexacro.VirtualFile)){return ret;}for(var i=0,filelist=this.filelist,len=filelist.length;i<len;i++ ){if(nexacro._isEqualTransferFile(filelist[i],vFile)){ret=true;break;}}return ret;};_pFileUpTransfer.setPostData=function(strKey,value){if(!strKey){return;}this.postdatalist.setItem(strKey,value);};_pFileUpTransfer.removePostData=function(strKey){this.postdatalist.delete_item(strKey);};_pFileUpTransfer.getPostData=function(strKey){return this.postdatalist.getItem(strKey);};_pFileUpTransfer.clearFileList=function(){this.filelist.clear();};_pFileUpTransfer.clearPostDataList=function(){this.postdatalist.clear();};_pFileUpTransfer.upload=function(strUrl){this._aborted=false;this._user_aborted=false;strUrl=strUrl?nexacro._getServiceLocation(strUrl,null,null,false):(this.url?nexacro._getServiceLocation(this.url,null,null,false):"");if(!strUrl){return;}nexacro._uploadTransfer(this.filelist,this.postdatalist,strUrl, -1,this);};_pFileUpTransfer.on_load=function(data,url,index){if(data){var info=data[0];var datasets=data[1];if(info){var errorcode=info["ErrorCode"];var errormsg=info["ErrorMsg"];if(errorcode<0){return this.on_fire_onerror("ObjectError",errormsg,this,9901,url,url,index);}else{return this.on_fire_onsuccess(datasets,errorcode,errormsg,url,index);}}}return this.on_fire_onerror("ObjectError","fail to get",this,9901,url,url,index);};_pFileUpTransfer.on_message=function(e){var request_url=e.data[0];var request_index=e.data[1];var data=e.message;if(data){data=nexacro.trimLeft(decodeURIComponent(data.replace(/\+/g," ")));var fstr=data.substring(0,3).toUpperCase();if(fstr=="SSV"){data=nexacro._Deserializer["SSV"](data);}else{var xmldoc=nexacro._parseXMLDocument(data);if(nexacro._getContentType(xmldoc)=="XML"){data=nexacro._Deserializer["XML"](xmldoc);}}}this.on_load(data,request_url,request_index);};_pFileUpTransfer.on_error=function(errorcode,errormsg,httpcode,url,index){this.on_fire_onerror("ObjectError",errormsg,this,httpcode||errorcode,url,url,index);};_pFileUpTransfer.on_progress=function(loaded,total,index){this.on_fire_onprogress(loaded,total,index);};_pFileUpTransfer.on_fire_onsuccess=function(datasets,code,msg,url,index){if(this.onsuccess&&this.onsuccess._has_handlers){var evt=new nexacro.FileUpTransferEventInfo(this,"onsuccess",datasets,code,msg,url,index);this.onsuccess._fireEvent(this,evt);}};_pFileUpTransfer.on_fire_onerror=function(errortype,errormsg,errorobj,statuscode,requesturi,locationuri,index){if(this.onerror&&this.onerror._has_handlers){var evt=new nexacro.FileUpTransferErrorEventInfo(this,"onerror",errortype,errormsg,errorobj,statuscode,requesturi,locationuri,index);this.onerror._fireEvent(this,evt);}};_pFileUpTransfer.on_fire_onprogress=function(loaded,total,index){if(this.onprogress&&this.onprogress._has_handlers){var evt=new nexacro.FileUpTransferProgressEventInfo(this,"onprogress",loaded,total,index);return this.onprogress._fireEvent(this,evt);}return true;};_pFileUpTransfer._getForm=function(){if(this.parent instanceof nexacro.Form){return this.parent;}return null;};_pFileUpTransfer._getTransferType=function(){return this._TransferType[this.type.toUpperCase()]||0;};delete _pFileUpTransfer;}
if(!nexacro.VideoPlayer){nexacro.VideoPlayStateChangedEventInfo=function(obj,id,newstate){this.id=this.eventid=id||"onplaystatuschanged";this.fromobject=this.fromreferenceobject=obj;this.newstate=newstate;};var _pPlayStatusChangedInfo=nexacro._createPrototype(nexacro.Event,nexacro.VideoPlayStateChangedEventInfo);nexacro.VideoPlayStateChangedEventInfo.prototype=_pPlayStatusChangedInfo;_pPlayStatusChangedInfo._type_name="VideoPlayStatusChangedInfo";delete _pPlayStatusChangedInfo;nexacro.VideoCurrentTimeChangedEventInfo=function(obj,id,currenttime){this.id=this.eventid=id||"oncurrenttimechanged";this.fromobject=this.fromreferenceobject=obj;this.currenttime=currenttime;};var _pCurrentTimeChangedInfo=nexacro._createPrototype(nexacro.Event,nexacro.VideoCurrentTimeChangedEventInfo);nexacro.VideoCurrentTimeChangedEventInfo.prototype=_pCurrentTimeChangedInfo;_pCurrentTimeChangedInfo._type_name="VideoCurrentTimeChangedInfo";delete _pCurrentTimeChangedInfo;nexacro.VideoErrorEventInfo=function(obj,id,errortype,errormsg,errorobj,statuscode){nexacro.ErrorEventInfo.call(this,obj,id,errortype,errormsg,errorobj,statuscode,undefined,undefined);};var _pVideoErrorInfo=nexacro._createPrototype(nexacro.ErrorEventInfo,nexacro.VideoErrorEventInfo);nexacro.VideoErrorEventInfo.prototype=_pVideoErrorInfo;_pVideoErrorInfo._type_name="VideoErrorInfo";delete _pVideoErrorInfo;nexacro.VideoPlayer=function(id,left,top,width,height,right,bottom,minwidth,maxwidth,minheight,maxheight,parent){nexacro.Component.call(this,id,left,top,width,height,right,bottom,minwidth,maxwidth,minheight,maxheight,parent);};var _pVideo=nexacro.VideoPlayer.prototype=nexacro._createPrototype(nexacro.Component,nexacro.VideoPlayer);_pVideo._type_name="VideoPlayer";_pVideo.codebase="";_pVideo.mimetype="";_pVideo.url="";_pVideo._url="";_pVideo.adjustalpha=false;_pVideo.aspectratio="";_pVideo.currenttime=0;_pVideo._new_currenttime=0;_pVideo.duration=0;_pVideo.mute=false;_pVideo.repeat=false;_pVideo.showcontrolbar=false;_pVideo.videosize={};_pVideo.autoplay=false;_pVideo.status="stop";_pVideo.volume=50;_pVideo.vr360mode=false;_pVideo._is_simple_control=true;_pVideo._obj_id="";_pVideo._obj_elem=null;_pVideo._params=null;_pVideo._event_list={"onclick":1,"ondblclick":1,"onkeypress":1,"onkeydown":1,"onkeyup":1,"onkillfocus":1,"onsetfocus":1,"ondrag":1,"ondrop":1,"ondragenter":1,"ondragleave":1,"ondragmove":1,"onlbuttondown":1,"onlbuttonup":1,"onrbuttondown":1,"onrbuttonup":1,"onmousedown":1,"onmouseup":1,"onmouseenter":1,"onmouseleave":1,"onmousemove":1,"onmousewheel":1,"onmove":1,"onsize":1,"onsuccess":1,"onerror":1,"onappenditem":1,"ondeleteitem":1,"onitemclick":1,"onfindclick":1,"onitemchanged":1,"ontouchstart":1,"ontouchmove":1,"ontouchend":1,"oncurrenttimechanged":1,"onplaystatuschanged":1};_pVideo.on_create_contents=function(){var control_elem=this.getElement();if(control_elem){var obj_elem=this._obj_elem=new nexacro._VideoPlayerPluginElement(control_elem);obj_elem.setElementSize(this._getClientWidth(),this._getClientHeight());}};_pVideo.on_create_contents_command=function(){this.on_apply_mute();this.on_apply_volume();this.on_apply_repeat();this.on_apply_autoplay();this.on_apply_showcontrolbar();this.on_apply_url();this.on_apply_vr360mode();return this._obj_elem.createCommand();};_pVideo.on_attach_contents_handle=function(win){if(this._obj_elem){this._obj_elem.attachHandle(win);}};_pVideo.on_created_contents=function(win){var obj_elem=this._obj_elem;if(obj_elem){obj_elem.component=this;obj_elem.create(win);obj_elem.initEvent();this.on_apply_adjustalpha();this.on_apply_mute();this.on_apply_volume();this.on_apply_repeat();this.on_apply_autoplay();this.on_apply_showcontrolbar();this.on_apply_url();this.on_apply_vr360mode();}};_pVideo.on_destroy_contents=function(){var obj_elem=this._obj_elem;if(obj_elem){obj_elem.destroy();this._obj_elem=null;}};_pVideo.on_update_position=function(resize_flag,move_flag,update){nexacro.Component.prototype.on_update_position.call(this,resize_flag,move_flag,update);var obj_elem=this._obj_elem;if(obj_elem){obj_elem.on_update_position();}};_pVideo.on_change_containerRect=function(width,height){var obj_elem=this._obj_elem;if(obj_elem){obj_elem.setElementSize(width,height);}};_pVideo.set_duration=nexacro._emptyFn;_pVideo.set_status=nexacro._emptyFn;_pVideo.set_videosize=nexacro._emptyFn;_pVideo.set_visible=function(v){if(v===undefined||v===null){return;}v=nexacro._toBoolean(v);nexacro.Component.prototype.set_visible.call(this,v);var obj_elem=this._obj_elem;if(obj_elem){if(obj_elem.setElementVisible!=null){obj_elem.setElementVisible(v);}}};_pVideo.set_codebase=function(v){this.codebase=v;this.on_apply_codebase();};_pVideo.on_apply_codebase=function(){var obj_elem=this._obj_elem;if(obj_elem){var codebase=this.codebase;if(codebase){obj_elem.setElementCodebase(codebase);}}};_pVideo.set_url=function(v){if(this.url!=v){this.url=v;v=nexacro._getURIValue(v);if(v==system.convertRealPath(v)||undefined===system.convertRealPath(v)){v=nexacro._getServiceLocation(v,this._getRefFormBaseUrl());}else{v=system.convertRealPath(v);}if(this._url!=v){this._url=v;this.on_apply_url();}}};_pVideo.on_apply_url=function(){if(this._url===""){return;}var obj_elem=this._obj_elem;if(obj_elem){obj_elem._setVideoUrl("URL",this._url);}};_pVideo.set_adjustalpha=function(v){v=nexacro._toBoolean(v);if(this.adjustalpha!=v){this.adjustalpha=v;this.on_apply_adjustalpha();}};_pVideo.on_apply_adjustalpha=function(){var obj_elem=this._obj_elem;if(obj_elem){obj_elem.setElementAdjustAlpha(this.adjustalpha);}};_pVideo.set_currenttime=function(v){v= +v;if(isNaN(v)){return;}if(v<0){v=0;}else if(v>this.duration){v=this.duration;}this._new_currenttime=v;this.on_apply_currenttime();};_pVideo.on_apply_currenttime=function(){var obj_elem=this._obj_elem;if(obj_elem){var _new_currenttime=this._new_currenttime;if(_new_currenttime> -1){obj_elem._setVideoCurrentTime("currentPosition",_new_currenttime);}}};_pVideo.set_mute=function(v){v=nexacro._toBoolean(v);if(this.mute!=v){this.mute=v;this.on_apply_mute();}};_pVideo.on_apply_mute=function(){var obj_elem=this._obj_elem;if(obj_elem){obj_elem._setVideoMute("settings",this.mute);}};_pVideo.set_repeat=function(v){v=nexacro._toBoolean(v);if(this.repeat!=v){this.repeat=v;this.on_apply_repeat();}};_pVideo.on_apply_repeat=function(){var obj_elem=this._obj_elem;if(obj_elem){obj_elem._setVideoLoop("AutoRewind",this.repeat);}};_pVideo.set_showcontrolbar=function(v){v=nexacro._toBoolean(v);if(this.showcontrolbar!=v){this.showcontrolbar=v;this.on_apply_showcontrolbar();}};_pVideo.on_apply_showcontrolbar=function(){var obj_elem=this._obj_elem;if(obj_elem){obj_elem._setVideoShowControlBar("uiMode",this.showcontrolbar);}};_pVideo.set_autoplay=function(v){v=nexacro._toBoolean(v);if(this.autoplay!=v){this.autoplay=v;this.on_apply_autoplay();}};_pVideo.on_apply_autoplay=function(){var obj_elem=this._obj_elem;if(obj_elem){obj_elem._setVideoAutoPlay("AutoStart",this.autoplay);}};_pVideo.set_volume=function(v){v= +v;if(isNaN(v)){return;}if(v<0){v=0;}else if(v>100){v=100;}if(this.volume!=v){this.volume=v;this.on_apply_volume();}};_pVideo.on_apply_volume=function(){var obj_elem=this._obj_elem;if(obj_elem){obj_elem._setVideoVolume("Volume",this.volume);}};_pVideo.on_apply_prop_enable=function(){var obj_elem=this._obj_elem;if(obj_elem){var enable=this.enable;if(enable!=null){obj_elem._setVideoEnable("Enabled",enable);}}};_pVideo.set_vr360mode=function(v){v=nexacro._toBoolean(v);if(this.vr360mode!=v){this.vr360mode=v;this.on_apply_vr360mode();}};_pVideo.on_apply_vr360mode=function(){var obj_elem=this._obj_elem;if(obj_elem){obj_elem._setVideo360VRMode("VRMode",this.vr360mode);}};_pVideo.play=function(){var obj_elem=this._obj_elem;if(obj_elem){obj_elem._play();}};_pVideo.pause=function(){var obj_elem=this._obj_elem;if(obj_elem){obj_elem._pause();}};_pVideo.rewind=function(){var obj_elem=this._obj_elem;if(obj_elem){obj_elem._rewind();}};_pVideo.stop=function(){var obj_elem=this._obj_elem;if(obj_elem){obj_elem._stop();}};_pVideo.on_fire_onerror=function(obj,errortype,errormsg,errorobj,statuscode){if(this.onerror&&this.onerror._has_handlers){var evt=new nexacro.VideoErrorEventInfo(obj,"onerror",errortype,errormsg,errorobj,statuscode);return this.onerror._fireEvent(this,evt);}};_pVideo.on_fire_oncurrenttimechanged=function(obj,new_currenttime){if(this.oncurrenttimechanged&&this.oncurrenttimechanged._has_handlers){var evt=new nexacro.VideoCurrentTimeChangedEventInfo(obj,"oncurrenttimechanged",new_currenttime);return this.oncurrenttimechanged._fireEvent(this,evt);}};_pVideo.on_fire_onplaystatuschanged=function(obj,new_state){if(this.onplaystatuschanged&&this.onplaystatuschanged._has_handlers){var evt=new nexacro.VideoPlayStateChangedEventInfo(obj,"onplaystatuschanged",new_state);return this.onplaystatuschanged._fireEvent(this,evt);}};_pVideo._on_currenttimechanged=function(new_currenttime){var old_currenttime=this.currenttime;if(old_currenttime!=new_currenttime){this.on_fire_oncurrenttimechanged(this,new_currenttime);}this.currenttime=new_currenttime;};_pVideo._on_volumechangechanged=function(new_volume,new_muted){this.volume=new_volume;this.mute=new_muted;};_pVideo._on_statuschanged=function(new_state){var old_state=this.status;if(old_state!=new_state){this.status=new_state;this.on_fire_onplaystatuschanged(this,new_state);}};_pVideo._on_error=function(errortype,errormsg,statuscode){this.on_fire_onerror(this,errortype,errormsg,this,statuscode);};delete _pVideo;}
if(!nexacro.WebBrowser){nexacro.WebLoadCompEventInfo=function(obj,url,id){this.id=this.eventid=id||"onloadcompleted";this.fromobject=this.fromreferenceobject=obj;this.url=url;};var _pWebLoadCompEventInfo=nexacro._createPrototype(nexacro.Event,nexacro.WebLoadCompEventInfo);nexacro.WebLoadCompEventInfo.prototype=_pWebLoadCompEventInfo;_pWebLoadCompEventInfo._type_name="WebLoadCompEventInfo";delete _pWebLoadCompEventInfo;nexacro.WebUserNotifyEventInfo=function(obj,userdata,id){this.id=this.eventid=id||"onusernotify";this.fromobject=this.fromreferenceobject=obj;this.userdata=userdata;};var _pWebUserNotifyEventInfo=nexacro._createPrototype(nexacro.Event,nexacro.WebUserNotifyEventInfo);nexacro.WebUserNotifyEventInfo.prototype=_pWebUserNotifyEventInfo;_pWebUserNotifyEventInfo._type_name="WebUserNotifyEventInfo";delete _pWebUserNotifyEventInfo;nexacro.WebBrowser=function(id,left,top,width,height,right,bottom,minwidth,maxwidth,minheight,maxheight,parent){nexacro.Component.call(this,id,left,top,width,height,right,bottom,minwidth,maxwidth,minheight,maxheight,parent);};var _pWebBrowser=nexacro._createPrototype(nexacro.Component,nexacro.WebBrowser);nexacro.WebBrowser.prototype=_pWebBrowser;_pWebBrowser._type_name="WebBrowser";_pWebBrowser._ifrm_elem=null;_pWebBrowser.window=null;_pWebBrowser.document=null;_pWebBrowser.url="";_pWebBrowser.useurlhistory=true;_pWebBrowser._url="";_pWebBrowser._blockLoadFlag=false;_pWebBrowser._current_url="";_pWebBrowser.accessibilityrole="webbrowser";_pWebBrowser.accessibilityleavemessage="";_pWebBrowser._event_list={"onclick":1,"ondblclick":1,"onkeypress":1,"onkeydown":1,"onkeyup":1,"onkillfocus":1,"onsetfocus":1,"ondrag":1,"ondragenter":1,"ondragleave":1,"ondragmove":1,"ondrop":1,"onlbuttondown":1,"onlbuttonup":1,"onmouseenter":1,"onmouseleave":1,"onmousemove":1,"onmove":1,"onsize":1,"onrbuttondown":1,"onrbuttonup":1,"oncontextmenu":1,"onloadcompleted":1,"onusernotify":1};_pWebBrowser.on_get_accessibility_label=function(){return this.id;};_pWebBrowser.on_create_contents=function(){var control_elem=this.getElement();if(control_elem){this._ifrm_elem=new nexacro._WebBrowserPluginElement(control_elem);this._ifrm_elem.setElementSize(this._getClientWidth(),this._getClientHeight());}};_pWebBrowser.on_create_contents_command=function(){return "";};_pWebBrowser.on_attach_contents_handle=function(win){this.on_created_contents(win);return;};_pWebBrowser.on_created_contents=function(win){var ifrm_elem=this._ifrm_elem;if(ifrm_elem){ifrm_elem.component=this;ifrm_elem.create(win);ifrm_elem.initEvent();this.document=ifrm_elem._document;this.window=ifrm_elem._winodw;nexacro._observeSysEvent(ifrm_elem.handle,"mouseover","onmouseover",this._webbrowser_mouseover);}if(this._url===""){this._url="about:blank";}this.on_apply_url();this._on_apply_accessibilityleavemessage();};_pWebBrowser.on_destroy_contents=function(){var ifrm_elem=this._ifrm_elem;if(ifrm_elem){nexacro._stopSysObserving(ifrm_elem.handle,"mouseover","onmouseover",this._webbrowser_mouseover);this.window=null;this.document=null;ifrm_elem.destroy();this._ifrm_elem=null;}};_pWebBrowser.on_update_position=function(resize_flag,move_flag,update){nexacro.Component.prototype.on_update_position.call(this,resize_flag,move_flag,update);var ifrm_elem=this._ifrm_elem;if(ifrm_elem){ifrm_elem.on_update_position();}};_pWebBrowser.on_change_containerRect=function(width,height){var ifrm_elem=this._ifrm_elem;if(ifrm_elem){ifrm_elem.setElementSize(width,height);}};_pWebBrowser.on_fire_onloadcompleted=function(obj,url){if(this.onloadcompleted&&this.onloadcompleted._has_handlers){var evt=new nexacro.WebLoadCompEventInfo(obj,url);evt.eventid="onloadcompleted";return this.onloadcompleted._fireEvent(this,evt);}return true;};_pWebBrowser.on_fire_onusernotify=function(obj,userdata){if(this.onusernotify&&this.onusernotify._has_handlers){var evt=new nexacro.WebUserNotifyEventInfo(obj,userdata);evt.eventid="onusernotify";return this.onusernotify._fireEvent(this,evt);}return true;};_pWebBrowser._getDlgCode=function(keycode){var _ifrm_elem=this._ifrm_elem;if(_ifrm_elem){if((!_ifrm_elem._prev_outfocus_message_elem||(_ifrm_elem._prev_outfocus_message_elem._killfocus_flag==true&&keycode==nexacro.Event.KEY_UP))||(!_ifrm_elem._next_outfocus_message_elem||(_ifrm_elem._next_outfocus_message_elem._killfocus_flag==true&&keycode==nexacro.Event.KEY_DOWN))){this._want_arrow=false;}else{this._want_arrow=true;}}return {want_tab:true,want_return:true,want_escape:false,want_chars:false,want_arrows:this._want_arrow};};_pWebBrowser.on_fire_user_onkeydown=function(keycode,alt_key,ctrl_key,shift_key,fire_comp,refer_comp){var E=nexacro.Event;if(keycode==E.KEY_TAB){this._getWindow()._keydown_element._event_stop=false;}else if(nexacro._enableaccessibility){var ifrm_elem=this._ifrm_elem;if(ifrm_elem){ifrm_elem._setElementInternalFocus(keycode);}}return nexacro.Component.prototype.on_fire_user_onkeydown.call(this,keycode,alt_key,ctrl_key,shift_key,fire_comp,refer_comp);};_pWebBrowser._apply_setfocus=function(evt_name){if(nexacro._enableaccessibility){nexacro.Component.prototype._apply_setfocus.call(this,evt_name);}var ifrm_elem=this._ifrm_elem;if(ifrm_elem){ifrm_elem._setElementFocus();}};_pWebBrowser._webbrowser_mouseover=function(){if(this._linked_element&&!this._linked_element._document){nexacro._initDragInfo();nexacro._cur_track_info=null;}};_pWebBrowser.set_text=function(v){v=nexacro._toString(v);if(v&&v!=this.text){this.text=v;this._displaytext=v.replace(/ /g,"\u00a0");this.on_apply_text(v);}};_pWebBrowser.set_enable=function(v){v=nexacro._toBoolean(v);if(this.enable!=v){this.enable=v;if(this._is_created){var enable_flag=(this.parent._real_enable&&v);if(this._real_enable!=enable_flag){this._real_enable=enable_flag;this._changeStatus("enabled",enable_flag?true:false);this.on_apply_prop_enable(this._real_enable);if(this._ifrm_elem){this._ifrm_elem.setElementEnable(enable_flag);}}}}};_pWebBrowser.set_visible=function(v){if(v===undefined||v===null){return;}v=nexacro._toBoolean(v);nexacro.Component.prototype.set_visible.call(this,v);var ifrm_elem=this._ifrm_elem;if(ifrm_elem){ifrm_elem.setElementVisible(v);}};_pWebBrowser.set_cookiesynctype=function(){};_pWebBrowser.set_url=function(v){if(v==undefined){return;}var val=v.toString();if(val!="about:blank"&&val.match(/http:\/\/|file:\/\/|https:\/\//gi)==null){val="http://"+val;}this._url=val;this.url=v;this.on_apply_url();};_pWebBrowser.set_useurlhistory=function(v){this.useurlhistory=nexacro._toBoolean(v);};_pWebBrowser.set_accessibilityleavemessage=function(v){this.accessibilityleavemessage=v;this._on_apply_accessibilityleavemessage();};_pWebBrowser.on_apply_url=function(){if(this._url==="http://"||this._url==="file://"||this._url==="https://"||this._url===""){return;}var ifrm_elem=this._ifrm_elem;if(ifrm_elem){this._blockLoadFlag=false;ifrm_elem._setUrl(this._url,this.useurlhistory);}};_pWebBrowser.on_apply_accessibility=function(){nexacro.Component.prototype.on_apply_accessibility.call(this);this._on_apply_accessibilityleavemessage();};_pWebBrowser.stoploading=function(){};_pWebBrowser.reload=function(){var ifrm_elem=this._ifrm_elem;if(ifrm_elem){if(this._isCrossDomain(this._current_url)){var tmp_url=this._url;ifrm_elem._setUrl("");ifrm_elem._setUrl(tmp_url);}else{ifrm_elem._setGo();}}};_pWebBrowser.goback=function(){var ifrm_elem=this._ifrm_elem;if(ifrm_elem){if(!this._isCrossDomain(this._current_url)){return ifrm_elem._setBack();}}};_pWebBrowser.goforward=function(){var ifrm_elem=this._ifrm_elem;if(ifrm_elem){if(!this._isCrossDomain(this._current_url)){return ifrm_elem._setForward();}}};_pWebBrowser.on_load_handler=function(docurl){if(this._blockLoadFlag){return;}this._current_url=docurl;this.document=this._ifrm_elem._getDoc();if(docurl!="about:blank"){this._blockLoadFlag=true;this.on_fire_onloadcompleted(this,docurl==""?this.url:docurl);}};_pWebBrowser.getProperty=function(prop){var ifrm_elem=this._ifrm_elem;if(ifrm_elem){return ifrm_elem.getProperty(prop);}};_pWebBrowser.setProperty=function(prop,value){var ifrm_elem=this._ifrm_elem;if(ifrm_elem){ifrm_elem.setProperty(prop,value);}};_pWebBrowser.callMethod=function(){var ifrm_elem=this._ifrm_elem;if(ifrm_elem){return nexacro._WebBrowserPluginElement.prototype.callMethod.apply(ifrm_elem,arguments);}};_pWebBrowser.addEventHandler=function(evt_id,func,target){if(evt_id in this._event_list==false){this._event_list[evt_id]=1;}return nexacro.Component.prototype.addEventHandler.call(this,evt_id,func,target);};_pWebBrowser.removeEventHandler=function(evt_id,func,target){return nexacro.Component.prototype.removeEventHandler.call(this,evt_id,func,target);};_pWebBrowser._isCrossDomain=function(target){if(target==""){return true;}var base=this._getRefFormBaseUrl();if(base.match(/^(file):\/\//)){return false;}var regExp=/^(https?):\/\/([^:\/\s]+)(:([^\/]*))?((\/[^\s/\/]+)*)?\/?([^#\s\?]*)(\?([^#\s]*))?(#(\w*))?$/;var u1=target.match(regExp);var u2=base.match(regExp);if(!u1||!u2){return true;}if(u1[2]!=u2[2]){return true;}return false;};_pWebBrowser._on_apply_accessibilityleavemessage=function(){var leavemessage=this.accessibilityleavemessage;if(leavemessage){var ifrm_elem=this._ifrm_elem;if(ifrm_elem){ifrm_elem._setElementLeaveMessage(leavemessage);}}};_pWebBrowser.updateWindow=function(){var ifrm_elem=this._ifrm_elem;if(ifrm_elem){ifrm_elem.updateWindow();}};delete _pWebBrowser;}
if(nexacro.Device&&nexacro._OS=="Android"){if(!nexacro.GoogleMap){nexacro.GoogleMapEventInfo=function(obj,id,centerlocation,coordinates,viewmode,zoomlevel,addresses){this.id=this.eventid=id;this.fromobject=this.fromreferenceobject=obj;this.centerlocation=centerlocation;this.coordinates=coordinates;this.viewmode=viewmode;this.zoomlevel=zoomlevel;this.addresses=addresses;};var _pGoogleMapEventInfo=nexacro._createPrototype(nexacro.Event,nexacro.GoogleMapEventInfo);nexacro.GoogleMapEventInfo.prototype=_pGoogleMapEventInfo;_pGoogleMapEventInfo._type_name="GoogleMapEventInfo";delete _pGoogleMapEventInfo;nexacro.GoogleMapErrorEventInfo=function(obj,id,errorcode,errormsg){this.id=this.eventid=id;this.fromobject=this.fromreferenceobject=obj;this.errortype="ObjectError";this.statuscode=errorcode;this.errormsg=errormsg;};var _pGoogleMapErrorEventInfo=nexacro._createPrototype(nexacro.Event,nexacro.GoogleMapErrorEventInfo);nexacro.GoogleMapErrorEventInfo.prototype=_pGoogleMapErrorEventInfo;_pGoogleMapErrorEventInfo._type_name="GoogleMapErrorEventInfo";delete _pGoogleMapErrorEventInfo;nexacro.GoogleMapClickEventInfo=function(obj,id,location){this.id=this.eventid=id;this.fromobject=this.fromreferenceobject=obj;this.location=location;};var _pGoogleMapClickEventInfo=nexacro._createPrototype(nexacro.Event,nexacro.GoogleMapClickEventInfo);nexacro.GoogleMapClickEventInfo.prototype=_pGoogleMapClickEventInfo;_pGoogleMapClickEventInfo._type_name="GoogleMapClickEventInfo";delete _pGoogleMapClickEventInfo;nexacro.GoogleMapDragEventInfo=function(obj,id,location){this.id=this.eventid=id;this.fromobject=this.fromreferenceobject=obj;this.location=location;};var _pGoogleMapDragEventInfo=nexacro._createPrototype(nexacro.Event,nexacro.GoogleMapDragEventInfo);nexacro.GoogleMapDragEventInfo.prototype=_pGoogleMapDragEventInfo;_pGoogleMapDragEventInfo._type_name="GoogleMapDragEventInfo";delete _pGoogleMapDragEventInfo;nexacro.GoogleMap=function(id,left,top,width,height,right,bottom,parent){nexacro.Component.call(this,id,left,top,width,height,right,bottom,parent);this._ifrm_elem=null;this.window=null;this.document=null;this.centerlocation={latitude:0,longitude:0};this.location={latitude:0,longitude:0};this.showmode=0;this.zoomlevel=15;this.showzoom=false;this.showmode=false;this.shownavigator=false;this.viewmode=0;this.language=undefined;this.region=undefined;this.items=[];this.itemsname=[];this._itemsname=[];this._items=[];this._infowindowname=[];this._infowindow=[];this.bSensor=false;this.bLoaded=false;this._event_list={"onclick":1,"ondblclick":1,"onkeypress":1,"onkeydown":1,"onkeyup":1,"onkillfocus":1,"onsetfocus":1,"ondrag":1,"ondragenter":1,"ondragleave":1,"ondragmove":1,"ondrop":1,"onlbuttondown":1,"onlbuttonup":1,"onmouseenter":1,"onmouseleave":1,"onmousemove":1,"onmove":1,"onsize":1,"onrbuttondown":1,"onrbuttonup":1,"onload":1,"onerror":1,"onrecvsuccess":1,"oncenterchanged":1,"onmapdragstart":1,"onmapdrag":1,"onmapdragend":1};this._location={latitude:0,longitude:0};this._pixel={x:0,y:0};};var _pGoogleMap=nexacro._createPrototype(nexacro.Component,nexacro.GoogleMap);nexacro.GoogleMap.prototype=_pGoogleMap;_pGoogleMap._type="GoogleMap";_pGoogleMap._type_name="GoogleMap";_pGoogleMap.on_create_contents=function(){var control_elem=this.getElement();if(control_elem){this._ifrm_elem=new nexacro._GoogleMapPluginElement(control_elem);this._ifrm_elem.setElementSize(this._getClientWidth(),this._getClientHeight());}};_pGoogleMap.on_create_contents_command=function(){var control_elem=this.getElement();if(control_elem){this._ifrm_elem=new nexacro._GoogleMapPluginElement(control_elem);this._ifrm_elem.setElementSize(this._getClientWidth(),this._getClientHeight());return this._ifrm_elem.createCommand();}return "";};_pGoogleMap.on_attach_contents_handle=function(win){if(this._ifrm_elem){this._ifrm_elem.attachHandle(win);}};_pGoogleMap.on_created_contents=function(win){var ifrm_elem=this._ifrm_elem;if(ifrm_elem){ifrm_elem.create(win);ifrm_elem.initEvent();this.document=ifrm_elem._document;this.window=ifrm_elem._winodw;}};_pGoogleMap.on_destroy_contents=function(){var ifrm_elem=this._ifrm_elem;if(ifrm_elem){this.window=null;this.document=null;ifrm_elem.destroy();this._ifrm_elem=null;}this.items=null;this.itemsname=null;this._itemsname=null;this._items=null;this._infowindowname=null;this._infowindow=null;};_pGoogleMap.on_update_position=function(resize_flag,move_flag,update){nexacro.Component.prototype.on_update_position.call(this,resize_flag,move_flag,update);var ifrm_elem=this._ifrm_elem;if(ifrm_elem){ifrm_elem.on_update_position();}};_pGoogleMap.on_change_containerRect=function(width,height){var ifrm_elem=this._ifrm_elem;if(ifrm_elem){ifrm_elem.setElementSize(width,height);}};_pGoogleMap.on_fire_onload=function(obj,id,centerlocation,coordinates,viewmode,zoomlevel,addresses){if(this.onload&&this.onload._has_handlers){var evt=new nexacro.GoogleMapEventInfo(obj,id,centerlocation,coordinates,viewmode,zoomlevel,addresses);return this.onload._fireEvent(this,evt);}return true;};_pGoogleMap.on_fire_onerror=function(obj,id,errorcode,errormsg){if(this.onerror&&this.onerror._has_handlers){var evt=new nexacro.GoogleMapErrorEventInfo(obj,id,errorcode,errormsg);return this.onerror._fireEvent(this,evt);}return true;};_pGoogleMap.on_fire_onrecvsuccess=function(obj,id,centerlocation,coordinates,viewmode,zoomlevel,addresses){if(this.onrecvsuccess&&this.onrecvsuccess._has_handlers){var evt=new nexacro.GoogleMapEventInfo(obj,id,centerlocation,coordinates,viewmode,zoomlevel,addresses);return this.onrecvsuccess._fireEvent(this,evt);}return true;};_pGoogleMap.on_fire_oncenterchanged=function(obj,id,centerlocation,coordinates,viewmode,zoomlevel,addresses){this.centerlocation=centerlocation;this.zoomlevel=zoomlevel;if(this.oncenterchanged&&this.oncenterchanged._has_handlers){var evt=new nexacro.GoogleMapEventInfo(obj,id,centerlocation,coordinates,viewmode,zoomlevel,addresses);return this.oncenterchanged._fireEvent(this,evt);}return true;};_pGoogleMap.on_fire_onclick=function(obj,id,location){if(this.onclick&&this.onclick._has_handlers){var evt=new nexacro.GoogleMapClickEventInfo(obj,id,location);return this.onclick._fireEvent(this,evt);}return true;};_pGoogleMap.on_fire_ondrag=function(obj,id,location){if(this.ondrag&&this.ondrag._has_handlers){var evt=new nexacro.GoogleMapDragEventInfo(obj,id,location);return this.ondrag._fireEvent(this,evt);}return true;};_pGoogleMap.on_fire_onmapdragstart=function(obj,id,location){if(this.onmapdragstart&&this.onmapdragstart._has_handlers){var evt=new nexacro.GoogleMapDragEventInfo(obj,id,location);return this.onmapdragstart._fireEvent(this,evt);}return true;};_pGoogleMap.on_fire_onmapdrag=function(obj,id,location){if(this.onmapdrag&&this.onmapdrag._has_handlers){var evt=new nexacro.GoogleMapDragEventInfo(obj,id,location);return this.onmapdrag._fireEvent(this,evt);}return true;};_pGoogleMap.on_fire_onmapdragend=function(obj,id,location){if(this.onmapdragend&&this.onmapdragend._has_handlers){var evt=new nexacro.GoogleMapDragEventInfo(obj,id,location);return this.onmapdragend._fireEvent(this,evt);}return true;};_pGoogleMap._apply_setfocus=function(){var ifrm_elem=this._ifrm_elem;if(ifrm_elem){ifrm_elem.setElementFocus(true);}};_pGoogleMap.set_text=function(v){v=nexacro._toString(v);if(v&&v!=this.text){this.text=v;this._displaytext=v.replace(/ /g,"\u00a0");}};_pGoogleMap.set_viewmode=function(v){if(v!=null){this.viewmode=v;var ifrm_elem=this._ifrm_elem;if(ifrm_elem){var params='{"value":"'+this.viewmode+'"}';ifrm_elem.setElementParam("viewmode",params);}}else{return false;}};_pGoogleMap.set_zoomlevel=function(){};_pGoogleMap.set_showzoom=function(v){if(v!=null){if(v==true||(typeof (v)=="string"&&v=="true")){this.showzoom=true;}else if(v==false||(typeof (v)=="string"&&v=="false")){this.showzoom=false;}else{return false;}var ifrm_elem=this._ifrm_elem;if(ifrm_elem){var params='{"value":"'+this.showzoom+'"}';ifrm_elem.setElementParam("showzoom",params);}return true;}};_pGoogleMap.set_shownavigator=function(v){if(v!=null){if(v==true||(typeof (v)=="string"&&v=="true")){this.shownavigator=true;}else if(v==false||(typeof (v)=="string"&&v=="false")){this.shownavigator=false;}else{return false;}var ifrm_elem=this._ifrm_elem;if(ifrm_elem){var params='{"value":"'+this.shownavigator+'"}';ifrm_elem.setElementParam("shownavigator",params);}return true;}};_pGoogleMap.set_showmapscale=function(){};_pGoogleMap.set_showmode=function(){};_pGoogleMap.set_showcompass=function(v){if(v!=null){if(v==true||(typeof (v)=="string"&&v=="true")){this.showcompass=true;}else if(v==false||(typeof (v)=="string"&&v=="false")){this.showcompass=false;}else{return false;}if(this.bLoaded){var ifrm_elem=this._ifrm_elem;if(ifrm_elem){var params='{"value":"'+this.showcompass+'"}';ifrm_elem.setElementParam("showcompass",params);}}return true;}};_pGoogleMap.set_apikey=nexacro._emptyFn;_pGoogleMap.set_language=nexacro._emptyFn;_pGoogleMap.set_region=nexacro._emptyFn;_pGoogleMap.set_enable=function(v){v=nexacro._toBoolean(v);if(this.enable!=v){this.enable=v;if(this._is_created){var enable_flag=(this.parent._real_enable&&v);if(this._ifrm_elem){this._ifrm_elem.setElementEnable(enable_flag);}}}};_pGoogleMap.set_visible=function(v){if(v===undefined||v===null){return;}v=nexacro._toBoolean(v);nexacro.Component.prototype.set_visible.call(this,v);var ifrm_elem=this._ifrm_elem;if(ifrm_elem){if(ifrm_elem.setElementVisible!=null){ifrm_elem.setElementVisible(v);}}};_pGoogleMap.load=function(bUseSensor,nLatitude,nLongitude,constViewMode,nZoomLevel){var strlength=0;if(nZoomLevel!=null){try{strlength=nZoomLevel.toString().split(" ").join("");}catch(e){return false;}if(nZoomLevel.length==0){return false;}var nzoom=0;try{nzoom=Number(nZoomLevel.toString());}catch(e){return false;}if(nzoom>=0){this.zoomlevel=nzoom;}else{return false;}}if((nLatitude!=null)&&(nLongitude!=null)){strlength=0;try{strlength=nLatitude.toString().split(" ").join("");}catch(e){return false;}if(strlength.length==0){return false;}try{strlength=nLongitude.toString().split(" ").join("");}catch(e){return false;}if(strlength.length==0){return false;}var nlat=0;var nlon=0;try{nlat=Number(nLatitude.toString());}catch(e){return false;}if(nlat!=nlat){return false;}try{nlon=Number(nLongitude.toString());}catch(e){return false;}if(nlon!=nlon){return false;}this.centerlocation.latitude=nlat;this.centerlocation.longitude=nlon;_pGoogleMap.centerlocation={latitude:nlat,longitude:nlon};}if(constViewMode!=null){if(constViewMode==0||(typeof (constViewMode)=="string"&&constViewMode=="0")){this.viewmode=0;}else if(constViewMode==1||(typeof (constViewMode)=="string"&&constViewMode=="1")){this.viewmode=1;}else if(constViewMode==2||(typeof (constViewMode)=="string"&&constViewMode=="2")){this.viewmode=2;}else if(constViewMode==3||(typeof (constViewMode)=="string"&&constViewMode=="3")){this.viewmode=3;}else{return false;}}else{this.viewmode=0;}if(bUseSensor!=null){if(bUseSensor==true||(typeof (bUseSensor)=="string"&&bUseSensor=="true")){this.bSensor=true;}else if(bUseSensor==false||(typeof (bUseSensor)=="string"&&bUseSensor=="false")){this.bSensor=false;}else{return false;}}else if(bUseSensor==null){this.bSensor=false;}var params='{"bUseSensor":"'+this.bSensor+'","nLatitude":"'+this.centerlocation.latitude+'","nLongitude":"'+this.centerlocation.longitude+'","constViewMode":"'+this.viewmode+'","nZoomLevel":"'+this.zoomlevel+'"}';var ifrm_elem=this._ifrm_elem;if(ifrm_elem){ifrm_elem._setLoad(params);}this.bLoaded=true;return true;};_pGoogleMap.setMarkerLoc=function(strItemID,lat,lng){this.items[strItemID].location.latitude=lat;this.items[strItemID].location.longitude=lng;};_pGoogleMap.getAddress=function(nLatitude,nLongitude,nMaxResultCount,enumLocale){if(nLatitude==null||nLongitude==null||nMaxResultCount<0){return false;}if(nMaxResultCount==null){nMaxResultCount=1;}var params='{"nLatitude":"'+nLatitude+'","nLongitude":"'+nLongitude+'","nMaxResultCount":"'+nMaxResultCount+'","strLocale":"'+enumLocale+'"}';var ifrm_elem=this._ifrm_elem;if(ifrm_elem){ifrm_elem._getAddress(params);}return true;};_pGoogleMap.getCoordinates=function(strAddress){if(strAddress==null||strAddress==""){return false;}var ifrm_elem=this._ifrm_elem;if(ifrm_elem){ifrm_elem._getCoordinates(strAddress);}return true;};var _itemsname=[];var _items=[];var _infowindowname=[];var _infowindow=[];_pGoogleMap.addItem=function(strItemID,objComponent){var ifrm_elem=this._ifrm_elem;if(strItemID==null||objComponent==null){return false;}if(strItemID==""||objComponent==""||objComponent=="undefined"||strItemID.trim()==""){return false;}if(typeof (this.items[strItemID])!="undefined"){this.on_fire_onerror(this,"onerror","1501","item is already exist.");return false;}if(objComponent instanceof nexacro.GoogleMapMarker||objComponent instanceof nexacro.GoogleMapPolyline||objComponent instanceof nexacro.GoogleMapPolygon||objComponent instanceof nexacro.GoogleMapCircle){this.items[strItemID]=objComponent;this.items.push(strItemID);if(this.bLoaded){if(objComponent._type==0||objComponent._type==1){_pGoogleMap.addMarker(ifrm_elem,strItemID,objComponent);}else if(objComponent._type==2){_pGoogleMap.addPolyline(ifrm_elem,strItemID,objComponent);}else if(objComponent._type==3){_pGoogleMap.addPolygon(ifrm_elem,strItemID,objComponent);}else if(objComponent._type==4){_pGoogleMap.addCircle(ifrm_elem,strItemID,objComponent);}}return true;}else{return false;}};_pGoogleMap.addMarker=function(elem,markName,markObj){if(markObj.imageurl.length>0){var _v=markObj.imageurl.toString().split(" ").join("");if(_v.substring(0,9).toLowerCase()!="%userapp%"&&_v.substring(0,9).toLowerCase()!="%sd_card%"){var _filecache=nexacro._getFileCache(_v);if(null==_filecache){return false;}}}_itemsname.push(markName);_items[markName]="marker";markObj._map=this;markObj._name=markName;var params='{"itemName":"'+markName+'","nLatitude":"'+markObj.latitude+'","nLongitude":"'+markObj.longitude+'","text":"'+markObj.text+'","visible":"'+markObj.visible+'","imageurl":"'+markObj.imageurl+'","draggable":"'+markObj.draggable+'"}';if(elem){elem._setMarker(params);}};_pGoogleMap.addPolygon=function(elem,polygonName,polygonObj){var _lat_lng_arr,_lat,_lng,i;var arr_lat=[];var arr_lng=[];_lat_lng_arr=polygonObj.locationdata.toString().split("]");for(i=0;i<(_lat_lng_arr.length-1);i++ ){_lat=_lat_lng_arr[i].toString().split(",")[0].split(" ").join().substring(1);_lng=_lat_lng_arr[i].toString().split(",")[1].split(" ").join().substring(1);if(_lat.length>0&&_lng.length>0){arr_lat.push(_lat);arr_lng.push(_lng);}}_itemsname.push(polygonName);_items[polygonName]="polygon";polygonObj._map=this;polygonObj._name=polygonName;var params='{"itemName":"'+polygonName+'","nLatitude":'+JSON.stringify(arr_lat)+',"nLongitude":'+JSON.stringify(arr_lng)+',"visible":"'+polygonObj.visible+'","linecolor":"'+polygonObj.linecolor+'","linewidth":"'+polygonObj.linewidth+'","fillbrushcolor":"'+polygonObj.fillbrushcolor+'"}';if(elem){elem._setPolygon(params);}};_pGoogleMap.addPolyline=function(elem,polylineName,polylineObj){var _lat_lng_arr,_lat,_lng,i;var arr_lat=[];var arr_lng=[];_lat_lng_arr=polylineObj.locationdata.toString().split("]");for(i=0;i<(_lat_lng_arr.length-1);i++ ){_lat=_lat_lng_arr[i].toString().split(",")[0].split(" ").join().substring(1);_lng=_lat_lng_arr[i].toString().split(",")[1].split(" ").join().substring(1);if(_lat.length>0&&_lng.length>0){arr_lat.push(_lat);arr_lng.push(_lng);}}_itemsname.push(polylineName);_items[polylineName]="polyline";polylineObj._map=this;polylineObj._name=polylineName;var params='{"itemName":"'+polylineName+'","nLatitude":'+JSON.stringify(arr_lat)+',"nLongitude":'+JSON.stringify(arr_lng)+',"visible":"'+polylineObj.visible+'","linecolor":"'+polylineObj.linecolor+'","linewidth":"'+polylineObj.linewidth+'"}';if(elem){elem._setPolyline(params);}};_pGoogleMap.addCircle=function(elem,circleName,circleObj){_itemsname.push(circleName);_items[circleName]="circle";circleObj._map=this;circleObj._name=circleName;var params='{"itemName":"'+circleName+'","nLatitude":'+circleObj.latitude+',"nLongitude":'+circleObj.longitude+',"radius":'+circleObj.radius+',"visible":"'+circleObj.visible+'"}';if(elem){elem._setCircle(params);}};_pGoogleMap.removeItem=function(strItemID){var ifrm_elem=this._ifrm_elem;if(strItemID==null){return false;}if(strItemID==""){return false;}if(typeof (this.items[strItemID])=="undefined"){this.on_fire_onerror(this,"onerror","1502","item is not exist.");return false;}else{delete this.items[strItemID];for(var i=0;i<this.items.length;i++ ){if(this.items[i]==strItemID){var position=this.items.indexOf(this.items[i]);this.items.splice(position,i+1);}}if(this.bLoaded){_pGoogleMap._removeItem(ifrm_elem,strItemID);}return true;}};_pGoogleMap._removeItem=function(elem,itemname){var params='{"item":"'+_items[itemname]+'","itemname":"'+itemname+'"}';if(elem){elem._setRemove(params);}delete _items[itemname];for(var i=0;i<_itemsname.length;i++ ){if(_itemsname[i]==itemname){_itemsname.splice(i+1,i+1);}}return true;};_pGoogleMap.on_load_handler=function(id,centerlocation,coordinates,viewmode,zoomlevel,addresses){this.on_fire_onload(this,id,centerlocation,coordinates,viewmode,zoomlevel,addresses);};_pGoogleMap.on_error_handler=function(id,code,msg){this.on_fire_onerror(this,id,code,msg);};_pGoogleMap.on_recvsuccess_handler=function(id,centerlocation,coordinates,viewmode,zoomlevel,addresses){this.on_fire_onrecvsuccess(this,id,centerlocation,coordinates,viewmode,zoomlevel,addresses);};_pGoogleMap.on_centerchanged_handler=function(id,centerlocation,viewmode,zoomlevel,addresses){this.on_fire_oncenterchanged(this,id,centerlocation,viewmode,zoomlevel,addresses);};_pGoogleMap.on_click_handler=function(id,location){this.on_fire_onclick(this,id,location);};_pGoogleMap.on_drag_handler=function(id,location){this.on_fire_ondrag(this,id,location);};_pGoogleMap.on_mapdragstart_handler=function(id,location){this.on_fire_onmapdragstart(this,id,location);};_pGoogleMap.on_mapdrag_handler=function(id,location){this.on_fire_onmapdrag(this,id,location);};_pGoogleMap.on_mapdragend_handler=function(id,location){this.on_fire_onmapdragend(this,id,location);};_pGoogleMap.callMethod=function(func){if(this._ifrm_elem){this._ifrm_elem.callScriptMethod(func);}};delete _pGoogleMap;}if(!nexacro.GoogleMapMarker){nexacro.GoogleMapMarker=function(name){this._id=nexacro.Device.makeID();nexacro.Device._userCreatedObj[this._id]=this;this.name=name||"";this._type=0;this.longitude=0;this.latitude=0;this.text="";this.imageurl="";this.visible=true;this.draggable=false;this.style={_GoogleMapMarkerID:0,set_parentID:function(_id){this._GoogleMapMarkerID=_id;},align:{_GoogleMapMarkerID:0,set_parentID:function(_id){this._GoogleMapMarkerID=_id;},halign:"center",valign:"middle",set_halign:function(v){var _v=v.toString().split(" ").join("").toLowerCase();if(_v=="left"||_v=="center"||_v=="right"){this.halign=_v;return true;}else{return false;}},set_valign:function(v){var _v=v.toString().split(" ").join("").toLowerCase();if(_v=="top"||_v=="middle"||_v=="bottom"){this.valign=_v;return true;}else{return false;}},$s:function(name,fnname,val){this[name]=val;}},set_align:function(v){var v_arr=v.split(" ");var ret=true;if(v_arr.length!=2){return false;}ret=this.align.set_halign(v_arr[0]);if(!ret){return ret;}ret=this.align.set_valign(v_arr[1]);return ret;},$s:function(name,fnname,val){this[name]=val;}};this._name=null;};var _pGoogleMapMarker=nexacro.GoogleMapMarker.prototype=nexacro._createPrototype(nexacro._EventSinkObject,nexacro.GoogleMapMarker);_pGoogleMapMarker._type_name="GoogleMapMarker";_pGoogleMapMarker.set_longitude=function(v){try{this.longitude=Number(v.toString());}catch(e){return false;}return true;};_pGoogleMapMarker.set_latitude=function(v){try{this.latitude=Number(v.toString());}catch(e){return false;}return true;};_pGoogleMapMarker.set_text=function(v){this.text=v;return true;};_pGoogleMapMarker.set_imageurl=function(v){this._type=1;this.imageurl=v;return true;};_pGoogleMapMarker.set_draggable=function(v){if(v==null){return false;}else if(v){if(v==true||(typeof (v)=="string"&&v=="true")){this.draggable=true;}else if(v==false||(typeof (v)=="string"&&v=="false")){this.draggable=false;}}else{return false;}};_pGoogleMapMarker.set_visible=function(v){if(v==true||(typeof (v)=="string"&&v=="true")){this.visible=true;}else if(v==false||(typeof (v)=="string"&&v=="false")){this.visible=false;}else{return false;}return true;};delete _pGoogleMapMarker;}if(!nexacro.GoogleMapPolyline){nexacro.GoogleMapPolyline=function(name){this._id=nexacro.Device.makeID();nexacro.Device._userCreatedObj[this._id]=this;this.name=name||"";this._type=2;this.locationdata="";this.visible=true;this.linewidth="";this.linecolor="";this._name=null;};var _pGoogleMapPolyline=nexacro.GoogleMapPolyline.prototype=nexacro._createPrototype(nexacro._EventSinkObject,nexacro.GoogleMapPolyline);_pGoogleMapPolyline._type_name="GoogleMapPolyline";_pGoogleMapPolyline.set_locationdata=function(v){var _lat_lng_arr;_lat_lng_arr=v.toString().split("]");if(_lat_lng_arr.length<2){return false;}this.locationdata=v;return true;};_pGoogleMapPolyline.set_linewidth=function(v){var nWidth=0;try{nWidth=Number(v.toString());}catch(e){return false;}if(nWidth!=nWidth){return false;}this.linewidth=nWidth;return true;};_pGoogleMapPolyline.set_linecolor=function(v){this.linecolor=v;return true;};_pGoogleMapPolyline.set_visible=function(v){if(v==true||(typeof (v)=="string"&&v=="true")){this.visible=true;}else if(v==false||(typeof (v)=="string"&&v=="false")){this.visible=false;}else{return false;}return true;};delete _pGoogleMapPolyline;}if(!nexacro.GoogleMapPolygon){nexacro.GoogleMapPolygon=function(name){this._id=nexacro.Device.makeID();nexacro.Device._userCreatedObj[this._id]=this;this.name=name||"";this._type=3;this.locationdata="";this.visible=true;this.linewidth="";this.linecolor="";this.fillbrushcolor="";this._name=null;};var _pGoogleMapPolygon=nexacro.GoogleMapPolygon.prototype=nexacro._createPrototype(nexacro._EventSinkObject,nexacro.GoogleMapPolygon);_pGoogleMapPolygon._type_name="GoogleMapPolygon";_pGoogleMapPolygon.set_locationdata=function(v){var _lat_lng_arr;_lat_lng_arr=v.toString().split("]");if(_lat_lng_arr.length<2){return false;}this.locationdata=v;return true;};_pGoogleMapPolygon.set_linewidth=function(v){var nWidth=0;try{nWidth=Number(v.toString());}catch(e){return false;}if(nWidth!=nWidth){return false;}this.linewidth=nWidth;return true;};_pGoogleMapPolygon.set_linecolor=function(v){this.linecolor=v;return true;};_pGoogleMapPolygon.set_fillbrushcolor=function(v){this.fillbrushcolor=v;return true;};_pGoogleMapPolygon.set_visible=function(v){if(v==true||(typeof (v)=="string"&&v=="true")){this.visible=true;}else if(v==false||(typeof (v)=="string"&&v=="false")){this.visible=false;}else{return false;}return true;};delete _pGoogleMapPolygon;}if(!nexacro.GoogleMapCircle){nexacro.GoogleMapCircle=function(name){this._id=nexacro.Device.makeID();nexacro.Device._userCreatedObj[this._id]=this;this.name=name||"";this._type=4;this.longitude=0;this.latitude=0;this.radius=100;this.visible=true;this._name=null;};var _pGoogleMapCircle=nexacro.GoogleMapCircle.prototype=nexacro._createPrototype(nexacro._EventSinkObject,nexacro.GoogleMapCircle);_pGoogleMapCircle._type_name="GoogleMapCircle";_pGoogleMapCircle.set_longitude=function(v){try{this.longitude=Number(v.toString());}catch(e){return false;}if(this.longitude!=this.longitude){return false;}return true;};_pGoogleMapCircle.set_latitude=function(v){try{this.latitude=Number(v.toString());}catch(e){return false;}if(this.latitude!=this.latitude){return false;}return true;};_pGoogleMapCircle.set_visible=function(v){if(v==true||(typeof (v)=="string"&&v=="true")){this.visible=true;}else if(v==false||(typeof (v)=="string"&&v=="false")){this.visible=false;}else{return false;}return true;};_pGoogleMapCircle.set_radius=function(v){if(v==null){this.radius=100;}else{this.radius=Number(v.toString());}};delete _pGoogleMapCircle;}}else if((nexacro.Device&&nexacro._OS!="Windows")||nexacro._Browser!="Runtime"&&!(nexacro._Browser=="IE"&&nexacro._BrowserVersion<=8)){if(!nexacro.GoogleMap){nexacro.GoogleMapEventInfo=function(obj,id,centerlocation,viewmode,zoomlevel,addresses,coordinates){this.id=this.eventid=id;this.fromobject=this.fromreferenceobject=obj;this.centerlocation=centerlocation;this.viewmode=viewmode;this.zoomlevel=zoomlevel;this.addresses=addresses;this.coordinates=coordinates;};var _pGoogleMapEventInfo=nexacro._createPrototype(nexacro.Event,nexacro.GoogleMapEventInfo);nexacro.GoogleMapEventInfo.prototype=_pGoogleMapEventInfo;_pGoogleMapEventInfo._type_name="GoogleMapEventInfo";delete _pGoogleMapEventInfo;nexacro.GoogleMapErrorEventInfo=function(obj,id,errorcode,errormsg){this.id=this.eventid=id;this.fromobject=this.fromreferenceobject=obj;this.errortype="ObjectError";this.statuscode=errorcode;this.errormsg=errormsg;};var _pGoogleMapErrorEventInfo=nexacro._createPrototype(nexacro.Event,nexacro.GoogleMapErrorEventInfo);nexacro.GoogleMapErrorEventInfo.prototype=_pGoogleMapErrorEventInfo;_pGoogleMapErrorEventInfo._type_name="GoogleMapErrorEventInfo";delete _pGoogleMapErrorEventInfo;nexacro.GoogleMapClickEventInfo=function(obj,id,location){this.id=this.eventid=id;this.fromobject=this.fromreferenceobject=obj;this.location=location;};nexacro.GoogleMapDragEventInfo=function(obj,id,location){this.id=this.eventid=id;this.fromobject=this.fromreferenceobject=obj;this.location=location;};var _pGoogleMapDragEventInfo=nexacro._createPrototype(nexacro.Event,nexacro.GoogleMapDragEventInfo);nexacro.GoogleMapDragEventInfo.prototype=_pGoogleMapDragEventInfo;_pGoogleMapDragEventInfo._type_name="GoogleMapDragEventInfo";delete _pGoogleMapDragEventInfo;nexacro.googlemaps_loaded=false;nexacro.googlemaps_callback=function(){nexacro.googlemaps_loaded=true;};nexacro.load_googlemaps=function(googleapikey,language,region){if(nexacro.googlemaps_loaded){return;}var script=document.createElement("script");var params="";script.type="text/javascript";if(googleapikey){params+="key="+googleapikey+"&";}if(language){params+="language="+language+"&";}if(region){params+="region="+region+"&";}params+="callback=nexacro.googlemaps_callback";script.src="https://maps.googleapis.com/maps/api/js?"+params;document.body.appendChild(script);};nexacro.GoogleMap=function(id,left,top,width,height,right,bottom,minwidth,maxwidth,minheight,maxheight,parent){nexacro.Component.call(this,id,left,top,width,height,right,bottom,minwidth,maxwidth,minheight,maxheight,parent);this._id=nexacro.Device.makeID();nexacro.Device._userCreatedObj[this._id]=this;this.name=id||"";this.centerlocation={latitude:0,longitude:0};this.location={latitude:0,longitude:0};this.coordinates={latitude:0,longitude:0};this._map_elem=null;this._google_map=null;this.maptype=0;this.viewmode=0;this.zoomlevel=15;this.zoomalign_halign="left";this.zoomalign_valign="top";this.showmode=false;this.showzoom=false;this.shownavigator=false;this.showmapscale=false;this.enableevent=true;this.apikey=null;this.language=undefined;this.region=undefined;this.items=[];this.itemsname=[];this._itemsname=[];this._items=[];this._infowindowname=[];this._infowindow=[];this.bSensor=false;this.bLoaded=false;this.enable=true;this.draggable=false;this.googleloaded=null;this._event_list={"onclick":1,"ondblclick":1,"onkeypress":1,"onkeydown":1,"onkeyup":1,"onkillfocus":1,"onsetfocus":1,"ondragstart":1,"ondrag":1,"ondragenter":1,"ondragleave":1,"ondragmove":1,"ondragend":1,"ondrop":1,"onlbuttondown":1,"onlbuttonup":1,"onmouseenter":1,"onmouseleave":1,"onmousemove":1,"onmove":1,"onsize":1,"onrbuttondown":1,"onrbuttonup":1,"onload":1,"onrecvsuccess":1,"onoverlayclick":1,"oncenterchanged":1,"onviewmodechanged":1,"onzoomchanged":1,"onmapdragstart":1,"onmapdrag":1,"onmapdragend":1,"onerror":1};};var _pGoogleMap=nexacro._createPrototype(nexacro.Component,nexacro.GoogleMap);nexacro.GoogleMap.prototype=_pGoogleMap;_pGoogleMap._type_name="GoogleMap";_pGoogleMap.centerlocation={latitude:0,longitude:0};nexacro.GoogleMap._default_text_align=nexacro.Component._default_align;nexacro.GoogleMap._default_image_align=nexacro.Component._default_buttonimg_align;_pGoogleMap.set_draggable=function(v){if(v==null){return false;}else if(v){if(v==true||(typeof (v)=="string"&&v=="true")){this.draggable=true;}else if(v==false||(typeof (v)=="string"&&v=="false")){this.draggable=false;}}else{return false;}};_pGoogleMap.set_zoomalign=function(name,val){if(name=="halign"){this.zoomalign_halign=val;}else if(name=="valign"){this.zoomalign_valign=val;}else{return false;}this.zoomalign=this._getalign(this.zoomalign_halign,this.zoomalign_valign);this._google_map_option_test={zoomControlOptions:{position:this.zoomalign,style:google.maps.ZoomControlStyle.DEFAULT}};return true;};_pGoogleMap._getalign=function(h,v){if(h=="left"){if(v=="top"){return google.maps.ControlPosition.TOP_LEFT;}else if(v=="middle"){return google.maps.ControlPosition.LEFT;}else if(v=="bottom"){return google.maps.ControlPosition.LEFT_BOTTOM;}}else if(h=="center"){if(v=="top"){return google.maps.ControlPosition.TOP;}else if(v=="bottom"){return google.maps.ControlPosition.BOTTOM;}}else if(h=="right"){if(v=="top"){return google.maps.ControlPosition.TOP_LEFT;}else if(v=="middle"){return google.maps.ControlPosition.RIGHT;}else if(v=="bottom"){return google.maps.ControlPosition.RIGHT_BOTTOM;}}};_itemsname=[];_items=[];_infowindowname=[];_infowindow=[];_pGoogleMap.set_enableevent=function(v){this.enableevent=nexacro._toBoolean(v);return v;};_pGoogleMap.set_viewmode=function(v){if(v!=null){this.viewmode=v;if(this.bLoaded){this._google_map_option={mapTypeId:this._getMapType(this.viewmode)};this._google_map.setOptions(this._google_map_option);}return true;}else{return false;}};_pGoogleMap.__map=function(){var obj=document.getElementById(this._id);var objDoc=obj.contentWindow||obj.contentDocument;return objDoc;};_pGoogleMap.set_showmode=function(v){if(v!=null){if(v==true||(typeof (v)=="string"&&v=="true")){this.showmode=true;}else if(v==false||(typeof (v)=="string"&&v=="false")){this.showmode=false;}else{return false;}if(this.bLoaded){this._google_map_option_test={mapTypeControl:this.showmode,mapTypeControlOptions:{style:google.maps.MapTypeControlStyle.DEFAULT,position:this.modealign}};this._google_map.setOptions(this._google_map_option_test);}return true;}};_pGoogleMap.set_showmapscale=function(v){if(v!=null){if(v==true||(typeof (v)=="string"&&v=="true")){this.showmapscale=true;}else if(v==false||(typeof (v)=="string"&&v=="false")){this.showmapscale=false;}else{return false;}if(this.bLoaded){this._google_map_option_test={mapTypeControl:this.showmapscale};this._google_map.setOptions(this._google_map_option_test);}return true;}};_pGoogleMap.set_showmapscale=function(v){if(v!=null){if(v==true||(typeof (v)=="string"&&v=="true")){this.showmapscale=true;}else if(v==false||(typeof (v)=="string"&&v=="false")){this.showmapscale=false;}else{return false;}if(this.bLoaded){this._google_map_option_test={scaleControl:this.showmapscale};this._google_map.setOptions(this._google_map_option_test);}return true;}};_pGoogleMap.set_shownavigator=function(v){if(v!=null){if(v==true||(typeof (v)=="string"&&v=="true")){this.shownavigator=true;}else if(v==false||(typeof (v)=="string"&&v=="false")){this.shownavigator=false;}else{return false;}if(this.bLoaded){this._google_map_option_test={panControl:this.shownavigator};this._google_map.setOptions(this._google_map_option_test);}return true;}};_pGoogleMap.set_apikey=function(v){if(v==null){return false;}this.apikey=v;};_pGoogleMap.set_language=function(v){v=nexacro._toString(v);this.language=v;};_pGoogleMap.set_region=function(v){v=nexacro._toString(v);this.region=v;};_pGoogleMap._set_option=function(){var _mapType=this._getMapType();var myOptions={center:new google.maps.LatLng(this.centerlocation.latitude,this.centerlocation.longitude),mapTypeId:_mapType,zoom:this.zoomlevel,disableDefaultUI:true,mapTypeControl:this.showmode,mapTypeControlOptions:{style:google.maps.MapTypeControlStyle.DEFAULT,position:this.modealign},scaleControl:this.showmapscale,scaleControlOptions:{position:this.mapscalealign},panControl:this.shownavigator,panControlOptions:{position:this.navigatoralign},zoomControl:this.showzoom,zoomControlOptions:{position:this.zoomalign,style:google.maps.ZoomControlStyle.SMALL}};return myOptions;};_pGoogleMap._getMapType=function(v){var __maptype;switch(v){default:case 0:__maptype=google.maps.MapTypeId.ROADMAP;break;case 1:__maptype=google.maps.MapTypeId.SATELLITE;break;case 2:__maptype=google.maps.MapTypeId.HYBRID;break;case 3:__maptype=google.maps.MapTypeId.TERRAIN;break;}return __maptype;};_pGoogleMap.map_starter=function(v){this._google_map.setOptions(this.setOptions());};_pGoogleMap.set_zoomlevel=function(v){this.zoomlevel=Number(v.toString());};_pGoogleMap.set_enable=function(v){if(v==null){return false;}else if(v){if(v==true||(typeof (v)=="string"&&v=="true")){this.enable=true;}else if(v==false||(typeof (v)=="string"&&v=="false")){this.enable=false;}if(this.bLoaded){this._google_map_option={draggable:this.enable};this._google_map.setOptions(this._google_map_option);}return true;}else{return false;}};_pGoogleMap.set_showzoom=function(v){if(v==null){return false;}if(v){if(v==true||(typeof (v)=="string"&&v=="true")){this.showzoom=true;}else if(v==false||(typeof (v)=="string"&&v=="false")){this.showzoom=false;}else{return false;}if(this.bLoaded){this._google_map_option_test={center:new google.maps.LatLng(this.centerlocation.latitude,this.centerlocation.longitude),zoomControl:this.showzoom};this._google_map.setOptions(this._google_map_option_test);}return true;}};_pGoogleMap.on_apply_text=function(){var control_elem=this._control_element;if(this._control_element){var text_elem=this._text_elem;if(!text_elem){text_elem=new nexacro.TextBoxElement(control_elem);this._text_elem=text_elem;text_elem.setElementSize(this._getClientWidth(),this._getClientHeight());text_elem.setElementColor(this.currentstyle.color);text_elem.setElementFont(this.currentstyle.font);text_elem.setElementAlign(this.currentstyle.align);if(this._is_created){text_elem.create();}}if(this.text!=""){text_elem.setElementText(this.text);this._text_width= -1;this._text_height= -1;if(this._img_elem){this._updateElementPositions(this.currentstyle.align,this.currentstyle.imagealign);}}else{text_elem.setElementText("");this._text_width=0;this._text_height=0;if(this._img_elem){this._updateElementPositions(this.currentstyle.align,this.currentstyle.imagealign);}}}};_pGoogleMap.on_apply_expr=function(){var control=this.getElement();var expr=this.expr;if(control&&expr.length>0){expr=expr.trim().split(":");var len=expr.length;var parser=new nexacro.ExprParser();var conv_expr,exprfn;var str;if(len==1){str=expr[0];}else{if(expr[0].trim().toUpperCase()!="EXPR"){str=expr.join(":");}else{str=expr.slice(1).join(":");}}conv_expr=parser.makeExpr(this,str);exprfn=nexacro._createInlineFunc(conv_expr,[]);if(exprfn){try{this.set_text(exprfn.call(this));}catch(e){return;}}}};_pGoogleMap.on_apply_prop_taborder=function(){var textElem=this._text_elem;if(textElem){if(this.tabstop){textElem.setElementTabIndex(this.taborder);}else{textElem.setElementTabIndex( -1);}}};_pGoogleMap.on_create_contents=function(){var control_elem=this.getElement();if(control_elem){this._map_elem=new nexacro.Element(control_elem);this._map_elem.setElementSize(this._getClientWidth(),this._getClientHeight());}};_pGoogleMap.on_create_contents_command=function(){var control_elem=this.getElement();if(control_elem){this._map_elem=new nexacro.Element(control_elem);this._map_elem.setElementSize(this._getClientWidth(),this._getClientHeight());this._map_elem.setElementTypeCSSSelector("nexamap");return this._map_elem.createCommand();}return "";};_pGoogleMap.on_attach_contents_handle=function(win){if(this._map_elem){this._map_elem.attachHandle(win);}};_pGoogleMap.on_created_contents=function(win){var map_elem=this._map_elem;if(map_elem){map_elem.setElementTypeCSSSelector("nexamap");map_elem.create(win);this.document=map_elem._document;this.window=map_elem._winodw;}};_pGoogleMap.on_destroy_contents=function(){var map_elem=this._map_elem;if(map_elem){map_elem.destroy();this._map_elem=null;}};_pGoogleMap.__onTextchanged=function(){};_pGoogleMap.load=function(bUseSensor,nLatitude,nLongitude,constViewMode,nZoomLevel,retry){var google_map=this._google_map;if(nexacro.googlemaps_loaded==false){if(!retry){nexacro.load_googlemaps(this.apikey,this.language,this.region);}var target=this;nexacro._OnceCallbackTimer.callonce(target,function(){target.load(bUseSensor,nLatitude,nLongitude,constViewMode,nZoomLevel,true);},500);return;}this._id=nexacro.Device.makeID();var parentMap=nexacro.Device._userCreatedObj[this._id]=this;var strlength=0;var myLatlng;if(nZoomLevel){try{strlength=nZoomLevel.toString().split(" ").join("");}catch(e){return false;}if(nZoomLevel.length==0){return false;}var nzoom=0;try{nzoom=Number(nZoomLevel.toString());}catch(e){return false;}if(nzoom>=0){this.zoomlevel=nzoom;}else{return false;}}if(constViewMode){if(constViewMode==0||(typeof (constViewMode)=="string"&&constViewMode=="0")){this.viewmode=0;}else if(constViewMode==1||(typeof (constViewMode)=="string"&&constViewMode=="1")){this.viewmode=1;}else if(constViewMode==2||(typeof (constViewMode)=="string"&&constViewMode=="2")){this.viewmode=2;}else if(constViewMode==3||(typeof (constViewMode)=="string"&&constViewMode=="3")){this.viewmode=3;}else{return false;}}else{this.viewmode=0;}if(nLatitude&&nLongitude){strlength=0;try{strlength=nLatitude.toString().split(" ").join("");}catch(e){return false;}if(strlength.length==0){return false;}try{strlength=nLongitude.toString().split(" ").join("");}catch(e){return false;}if(strlength.length==0){return false;}var nlat=0;var nlon=0;try{nlat=Number(nLatitude.toString());}catch(e){return false;}if(nlat!=nlat){return false;}try{nlon=Number(nLongitude.toString());}catch(e){return false;}if(nlon!=nlon){return false;}this.centerlocation.latitude=nlat;this.centerlocation.longitude=nlon;_pGoogleMap.centerlocation={latitude:nlat,longitude:nlon};}if(bUseSensor){if(bUseSensor==true||(typeof (bUseSensor)=="string"&&bUseSensor=="true")){this.bSensor=true;}else{this.bSensor=false;}if(constViewMode==null){this.viewmode=0;}}else{this.bSensor=false;}var map_elem=this._map_elem;if(map_elem){map_elem.create();}if(this.bSensor){if(navigator.geolocation){navigator.geolocation.getCurrentPosition(function(position){var initialLocation=new google.maps.LatLng(position.coords.latitude,position.coords.longitude);google_map.setCenter(initialLocation);},function(){parentMap._apply_onerror({errorcode:"1503",errormsg:"Device provider disable"});});}else if(google.gears){var geo=google.gears.factory.create('beta.geolocation');geo.getCurrentPosition(function(position){var initialLocation=new google.maps.LatLng(position.latitude,position.longitude);myLatlng=new google.maps.LatLng(position.latitude,position.longitude);google_map.setCenter(initialLocation);},function(){parentMap._apply_onerror({errorcode:"1503",errormsg:"Device provider disable"});});return false;}}else{myLatlng=new google.maps.LatLng(this.centerlocation.latitude,this.centerlocation.longitude);}this._google_map_option={center:myLatlng,panControl:this.shownavigator,zoomControl:this.showzoom,mapTypeControl:this.showmode,scaleControl:this.showmapscale,zoom:this.zoomlevel,disableDefaultUI:true,draggable:this.enable,mapTypeId:_pGoogleMap._getMapType(this.viewmode)};google_map=new google.maps.Map(map_elem.handle,this._google_map_option);this._google_map=google_map;_pGoogleMap._google_map=this._google_map;for(var i=0;i<this.itemsname.length;i++ ){if(this.items[this.itemsname[i]]._type==0||this.items[this.itemsname[i]]._type==1){_pGoogleMap.addMarker(this.itemsname[i],this.items[this.itemsname[i]]);}else if(this.items[this.itemsname[i]]._type==2){_pGoogleMap.addPolyline(this.itemsname[i],this.items[this.itemsname[i]]);}else if(this.items[this.itemsname[i]]._type==3){_pGoogleMap.addPolygon(this.itemsname[i],this.items[this.itemsname[i]]);}else if(this.items[this.itemsname[i]]._type==4){_pGoogleMap.addCircle(this.itemsname[i],this.items[this.itemsname[i]]);}}google.maps.event.addListener(google_map,'click',function(e){if(parentMap.onclick&&parentMap.onclick._has_handlers&&parentMap.enableevent){parentMap.location.latitude=e.latLng.lat();parentMap.location.longitude=e.latLng.lng();var evt=new nexacro.GoogleMapClickEventInfo(parentMap,"onclick",parentMap.location);parentMap.onclick._fireEvent(this,evt);}return true;});google.maps.event.addListener(google_map,'dragstart',function(e){});google.maps.event.addListener(google_map,'mouseout',function(e){});google.maps.event.addListener(google_map,'dragenter',function(e){});google.maps.event.addListener(google_map,'drag',function(e){});google.maps.event.addListener(google_map,'dragend',function(e){});google.maps.event.addListener(google_map,'center_changed',function(e){if(parentMap.oncenterchanged&&parentMap.oncenterchanged._has_handlers&&parentMap.enableevent){parentMap.centerlocation.latitude=google_map.getCenter().lat();parentMap.centerlocation.longitude=google_map.getCenter().lng();var evt=new nexacro.GoogleMapEventInfo(parentMap,"oncenterchanged",parentMap.centerlocation,parentMap.viewmode,parentMap.zoomlevel,parentMap.addresses,parentMap.coordinates);parentMap.oncenterchanged._fireEvent(this,evt);}return true;});google.maps.event.addListener(google_map,'maptypeid_changed',function(e){if(parentMap.onviewmodechanged&&parentMap.onviewmodechanged._has_handlers&&parentMap.enableevent){var evt=new nexacro.GoogleMapEventInfo(parentMap,"onviewmodechanged",parentMap.centerlocation,parentMap.viewmode,parentMap.zoomlevel,parentMap.addresses,parentMap.coordinates);parentMap.onviewmodechanged._fireEvent(this,evt);}return true;});google.maps.event.addListener(google_map,'zoom_changed',function(e){if(parentMap.onzoomchanged&&parentMap.onzoomchanged._has_handlers&&parentMap.enableevent){parentMap.zoomlevel=google_map.getZoom();var evt=new nexacro.GoogleMapEventInfo(parentMap,"onzoomchanged",parentMap.centerlocation,parentMap.viewmode,parentMap.zoomlevel,parentMap.addresses,parentMap.coordinates);parentMap.onzoomchanged._fireEvent(this,evt);}return true;});this.bLoaded=true;this._apply_onload();return true;};_pGoogleMap.setMarkerLoc=function(strItemID,lat,lng){this.items[strItemID].location.latitude=lat;this.items[strItemID].location.longitude=lng;};_pGoogleMap.getAddress=function(nLatitude,nLongitude,nMaxResultCount,strLocale){if(nLatitude==null||nLongitude==null||nMaxResultCount<0){return false;}if(nMaxResultCount==null){nMaxResultCount=1;}var params='{"nLatitude":"'+nLatitude+'","nLongitude":"'+nLongitude+'","nMaxResultCount":"'+nMaxResultCount+'","strLocale":"'+strLocale+'"}';var jsonstr='{"id":'+this._id+', "div":"NexacroMap", "method":"getAddress", "params":'+params+'}';nexacro.Device.exec(jsonstr);return true;};_pGoogleMap.getCoordinates=function(strAddress){if(strAddress==null||strAddress==""){return false;}var params='{"straddress":"'+strAddress+'"}';var jsonstr='{"id":'+this._id+', "div":"NexacroMap", "method":"getCoordinates", "params":'+params+'}';nexacro.Device.exec(jsonstr);return true;};_pGoogleMap.addItem=function(strItemID,objItem){this._id=nexacro.Device.makeID();var parentMap=nexacro.Device._userCreatedObj[this._id]=this;if(strItemID==null||objItem==null){return false;}if(strItemID==""||objItem==""||objItem=="undefined"||strItemID.trim()==""){return false;}if(typeof (this.items[strItemID])!="undefined"){this._apply_onerror({errorcode:"1501",errormsg:"item is already exist."});return false;}if(objItem instanceof nexacro.GoogleMapMarker||objItem instanceof nexacro.GoogleMapPolyline||objItem instanceof nexacro.GoogleMapPolygon||objItem instanceof nexacro.GoogleMapCircle){this.items[strItemID]=objItem;this.items.push(strItemID);if(this.bLoaded){if(objItem._type==0||objItem._type==1){_pGoogleMap.addMarker(strItemID,objItem,parentMap,this);}else if(objItem._type==2){_pGoogleMap.addPolyline(strItemID,objItem);}else if(objItem._type==3){_pGoogleMap.addPolygon(strItemID,objItem);}else if(objItem._type==4){_pGoogleMap.addCircle(strItemID,objItem);}}return true;}else{return false;}};_pGoogleMap.setMarkerOptions=function(markName,markObj){if(typeof (_infowindow[markName])=="undefined"){var temp_infowindow=new google.maps.InfoWindow({content:""});_infowindowname.push(markName);_infowindow[markName]=temp_infowindow;}var markerOpt;if(markObj.imageurl.length>0){var _v=markObj.imageurl.toString().split(" ").join("");var img_path="";if(_v.substring(0,9).toLowerCase()=="%userapp%"){img_path="../"+_v.substring(9,_v.length);}else{img_path=_v;}markerOpt={position:new google.maps.LatLng(markObj._location.latitude,markObj._location.longitude),title:markObj.text,visible:markObj.visible,icon:img_path,draggable:markObj.draggable};}else{markerOpt={position:new google.maps.LatLng(markObj._location.latitude,markObj._location.longitude),title:markObj.text,visible:markObj.visible,draggable:markObj.draggable};}var contentString="<div title=\"\" style='width:100%;height:100%;'><div title=\"\" style='vertical-align:"+markObj.style.align.valign+";text-align:"+markObj.style.align.halign+";'>"+markObj.text+"</div></div>";_infowindow[markName].setContent(contentString);google.maps.event.addListener(_items[markName],'click',function(e){if(_items[markName].title.length>0){_infowindow[markName].open(_pGoogleMap._google_map,_items[markName]);}});google.maps.event.addListener(_items[markName],'drag',function(e){});google.maps.event.addListener(_pGoogleMap._google_map,'click',function(e){_infowindow[markName].close();});if(!markerOpt.visible&&_infowindow[markName]!=null){_infowindow[markName].close();}_items[markName].setOptions(markerOpt);};_pGoogleMap.addMarker=function(markName,markObj,parentMap,obj){if(typeof (_infowindow[markName])=="undefined"){var temp_infowindow=new google.maps.InfoWindow({content:""});_infowindowname.push(markName);_infowindow[markName]=temp_infowindow;}var contentString="<div title=\"\" style='width:100%;height:100%;'><div title=\"\" style='vertical-align:"+markObj.style.align.valign+";text-align:"+markObj.style.align.halign+";'>"+markObj.text+"</div></div>";_infowindow[markName].setContent(contentString);var marker;if(markObj.imageurl.length>0){var _v=markObj.imageurl.toString().split(" ").join("");var img_path="";if(_v.substring(0,9).toLowerCase()=="%userapp%"){img_path=_v.substring(9,_v.length);if(img_path.charAt(0)!="/"){img_path="/"+img_path;}img_path=nexacro.System.userapppath+img_path;}else{img_path=_v;}marker=new google.maps.Marker({position:new google.maps.LatLng(markObj._location.latitude,markObj._location.longitude),title:markObj.text,visible:markObj.visible,icon:img_path,draggable:markObj.draggable});}else{marker=new google.maps.Marker({position:new google.maps.LatLng(markObj._location.latitude,markObj._location.longitude),title:markObj.text,visible:markObj.visible,draggable:markObj.draggable});}google.maps.event.addListener(marker,'dragstart',function(e){if(parentMap.onmapdragstart&&parentMap.onmapdragstart._has_handlers&&parentMap.enableevent){markObj._location.latitude=marker.getPosition().lat();markObj._location.longitude=marker.getPosition().lng();var evt=new nexacro.GoogleMapDragEventInfo(parentMap,"onmapdragstart",markObj._location);parentMap.onmapdragstart._fireEvent(obj,evt);}});google.maps.event.addListener(marker,'drag',function(e){if(parentMap.onmapdrag&&parentMap.onmapdrag._has_handlers&&parentMap.enableevent){markObj._location.latitude=marker.getPosition().lat();markObj._location.longitude=marker.getPosition().lng();var evt=new nexacro.GoogleMapDragEventInfo(parentMap,"onmapdrag",markObj._location);parentMap.onmapdrag._fireEvent(obj,evt);}});google.maps.event.addListener(marker,'dragend',function(e){if(parentMap.onmapdragend&&parentMap.onmapdragend._has_handlers&&parentMap.enableevent){markObj._location.latitude=marker.getPosition().lat();markObj._location.longitude=marker.getPosition().lng();var evt=new nexacro.GoogleMapDragEventInfo(parentMap,"onmapdragend",markObj._location);parentMap.onmapdragend._fireEvent(obj,evt);}});google.maps.event.addListener(marker,'click',function(e){if(marker.title.length>0){_infowindow[markName].open(_pGoogleMap._google_map,marker);}_pGoogleMap.gmap_onoverlayclick(markObj,e.latLng.lat(),e.latLng.lng(),e.pixel.x,e.pixel.y);});google.maps.event.addListener(marker,'drag',function(e){});marker.setMap(_pGoogleMap._google_map);_pGoogleMap._google_map.setCenter(marker.getPosition());_itemsname.push(markName);_items[markName]=marker;markObj._map=this;markObj._name=markName;};_pGoogleMap.setPolygonOptions=function(polygonName,polygonObj){var _path=[];var _lat_lng_arr,_lat,_lng,i;_lat_lng_arr=polygonObj.locationdata.toString().split("]");for(i=0;i<(_lat_lng_arr.length-1);i++ ){_lat=_lat_lng_arr[i].toString().split(",")[0].split(" ").join().substring(1);_lng=_lat_lng_arr[i].toString().split(",")[1].split(" ").join().substring(1);if(_lat.length>0&&_lng.length>0){_path.push(new google.maps.LatLng(Number(_lat),Number(_lng)));}}var _color_stroke;if(typeof (this.parent.nexacro._xreNamedColorList[polygonObj.linecolor])!="undefined"){_color_stroke=this.parent.nexacro._xreNamedColorList[polygonObj.linecolor]+"FF";}else{_color_stroke=polygonObj.linecolor;}var _color_fill;if(typeof (this.parent.nexacro._xreNamedColorList[polygonObj.fillbrushcolor])!="undefined"){_color_fill=this.parent.nexacro._xreNamedColorList[polygonObj.fillbrushcolor]+"FF";}else{_color_fill=polygonObj.fillbrushcolor;}var _alpha_stroke_1;var _alpha_stroke=1.0;if(_color_stroke.length>7){_alpha_stroke_1=parseInt(_color_stroke.substring(7),16);_alpha_stroke=_alpha_stroke_1/255.0;}var _alpha_fill_1;var _alpha_fill=1.0;if(_color_fill.length>7){_alpha_fill_1=parseInt(_color_fill.substring(7),16);_alpha_fill=_alpha_fill_1/255.0;}var polygonOpt={paths:_path,strokeColor:_color_stroke.substring(0,7),strokeOpacity:_alpha_stroke,strokeWeight:polygonObj.linewidth,fillColor:_color_fill.substring(0,7),fillOpacity:_alpha_fill,visible:polygonObj.visible};google.maps.event.addListener(_items[polygonName],'click',function(e){_pGoogleMap.gmap_onoverlayclick(_items[polygonName],e.latLng.lat(),e.latLng.lng(),0,0);});_items[polygonName].setOptions(polygonOpt);};_pGoogleMap.addPolygon=function(polygonName,polygonObj){var _path=[];var _lat_lng_arr,_lat,_lng;_lat_lng_arr=polygonObj.locationdata.toString().split("]");for(var i=0;i<(_lat_lng_arr.length-1);i++ ){_lat=_lat_lng_arr[i].toString().split(",")[0].split(" ").join().substring(1);_lng=_lat_lng_arr[i].toString().split(",")[1].split(" ").join().substring(1);if(_lat.length>0&&_lng.length>0){_path.push(new google.maps.LatLng(Number(_lat),Number(_lng)));}}var _color_stroke;if(typeof (nexacro._xreNamedColorList[polygonObj.linecolor])!="undefined"){_color_stroke=nexacro._xreNamedColorList[polygonObj.linecolor]+"FF";}else{_color_stroke=polygonObj.linecolor;}var _color_fill;if(typeof (nexacro._xreNamedColorList[polygonObj.fillbrushcolor])!="undefined"){_color_fill=nexacro._xreNamedColorList[polygonObj.fillbrushcolor]+"FF";}else{_color_fill=polygonObj.fillbrushcolor;}var _alpha_stroke_1;var _alpha_stroke=1.0;if(_color_stroke.length>7){_alpha_stroke_1=parseInt(_color_stroke.substring(7),16);_alpha_stroke=_alpha_stroke_1/255.0;}var _alpha_fill_1;var _alpha_fill=1.0;if(_color_fill.length>7){_alpha_fill_1=parseInt(_color_fill.substring(7),16);_alpha_fill=_alpha_fill_1/255.0;}var polygonPath=new google.maps.Polygon({paths:_path,strokeColor:_color_stroke.substring(0,7),strokeOpacity:_alpha_stroke,strokeWeight:polygonObj.linewidth,fillColor:_color_fill.substring(0,7),fillOpacity:_alpha_fill,visible:polygonObj.visible});polygonPath.setMap(_pGoogleMap._google_map);_itemsname.push(polygonName);_items[polygonName]=polygonPath;polygonObj._map=this;polygonObj._name=polygonName;google.maps.event.addListener(_items[polygonName],'click',function(e){_pGoogleMap.gmap_onoverlayclick(polygonObj,e.latLng.lat(),e.latLng.lng(),0,0);});};_pGoogleMap.setPolylineOptions=function(polylineName,polylineObj){var _path=[];var _lat_lng_arr,_lat,_lng;_lat_lng_arr=polylineObj.locationdata.toString().split("]");for(var i=0;i<(_lat_lng_arr.length-1);i++ ){_lat=_lat_lng_arr[i].toString().split(",")[0].split(" ").join().substring(1);_lng=_lat_lng_arr[i].toString().split(",")[1].split(" ").join().substring(1);if(_lat.length>0&&_lng.length>0){_path.push(new google.maps.LatLng(Number(_lat),Number(_lng)));}}var _color;if(typeof (this.parent.nexacro._xreNamedColorList[polylineObj.linecolor])!="undefined"){_color=this.parent.nexacro._xreNamedColorList[polylineObj.linecolor]+"FF";}else{_color=polylineObj.linecolor;}var _alpha_1;var _alpha=1.0;if(_color.length>7){_alpha_1=parseInt(_color.substring(7),16);_alpha=_alpha_1/255.0;}var polyLineOpt={path:_path,strokeColor:_color.substring(0,7),strokeOpacity:_alpha,strokeWeight:polylineObj.linewidth,visible:polylineObj.visible};google.maps.event.addListener(_items[polylineName],'click',function(e){_pGoogleMap.gmap_onoverlayclick(_items[polylineName],e.latLng.lat(),e.latLng.lng(),0,0);});_items[polylineName].setOptions(polyLineOpt);};_pGoogleMap.addPolyline=function(polylineName,polylineObj){var _path=[];var _lat_lng_arr,_lat,_lng;_lat_lng_arr=polylineObj.locationdata.toString().split("]");for(var i=0;i<(_lat_lng_arr.length-1);i++ ){_lat=_lat_lng_arr[i].toString().split(",")[0].split(" ").join().substring(1);_lng=_lat_lng_arr[i].toString().split(",")[1].split(" ").join().substring(1);if(_lat.length>0&&_lng.length>0){_path.push(new google.maps.LatLng(Number(_lat),Number(_lng)));}}var _color;if(typeof (nexacro._xreNamedColorList[polylineObj.linecolor])!="undefined"){_color=nexacro._xreNamedColorList[polylineObj.linecolor]+"FF";}else{_color=polylineObj.linecolor;}var _alpha_1;var _alpha=1.0;if(_color.length>7){_alpha_1=parseInt(_color.substring(7),16);_alpha=_alpha_1/255.0;}var polyLinePath=new google.maps.Polyline({path:_path,strokeColor:_color.substring(0,7),strokeOpacity:_alpha,strokeWeight:polylineObj.linewidth,visible:polylineObj.visible});polyLinePath.setMap(_pGoogleMap._google_map);_itemsname.push(polylineName);_items[polylineName]=polyLinePath;polylineObj._map=this;polylineObj._name=polylineName;google.maps.event.addListener(_items[polylineName],'click',function(e){_pGoogleMap.gmap_onoverlayclick(polylineObj,e.latLng.lat(),e.latLng.lng(),0,0);});};_pGoogleMap.setCircleOptions=function(circleName,ciecleObj){_items[circleName].setOptions(ciecleObj);};_pGoogleMap.addCircle=function(circleName,ciecleObj){var circle=new google.maps.Circle({fillOpacity:0,strokeWeight:1.5,center:new google.maps.LatLng(ciecleObj.latitude,ciecleObj.longitude),radius:ciecleObj.radius,visible:ciecleObj.visible});circle.setMap(_pGoogleMap._google_map);_itemsname.push(circleName);_items[circleName]=circle;ciecleObj._map=this;ciecleObj._name=circleName;};_pGoogleMap.removeItem=function(strItemID){if(strItemID==null){return false;}if(strItemID==""){return false;}if(typeof (this.items[strItemID])=="undefined"){this._apply_onerror({errorcode:"1502",errormsg:"item is not exist."});return false;}else{delete this.items[strItemID];for(var i=0;i<this.items.length;i++ ){if(this.items[i]==strItemID){var position=this.items.indexOf(this.items[i]);this.items.splice(position,i+1);}}if(this.bLoaded){_pGoogleMap._removeItem(strItemID);}return true;}};_pGoogleMap._removeItem=function(itemname){_items[itemname].setMap(null);var i;if(typeof (_items[itemname].title)!="undefined"){delete _infowindow[itemname];for(i=0;i<_infowindow.length;i++ ){if(_infowindowname[i]==itemname){_infowindowname.splice(i+1,i+1);}}}delete _items[itemname];for(i=0;i<_itemsname.length;i++ ){if(_itemsname[i]==itemname){_itemsname.splice(i+1,i+1);}}return true;};_pGoogleMap.gmap_ondrag=function(lat,lng){this.on_fire_ondragstart(this,new nexacro.GoogleMapDragEventInfo("ondrag"));};_pGoogleMap.gmap_ondragenter=function(objData){this._fire_ondragenter(this,new nexacro.GoogleMapDragEventInfo("ondragenter"));};_pGoogleMap.gmap_ondragmove=function(lat,lng){this._location.latitude=lat;this._location.longitude=lng;this.centerlocation.latitude=this._location.latitude;this.centerlocation.longitude=this._location.longitude;};_pGoogleMap.gmap_ondragleave=function(objData){this._fire_ondragleave(this,new nexacro.GoogleMapDragEventInfo("ondragleave"));};_pGoogleMap.gmap_dragend=function(lat,lng){this._location.latitude=lat;this._location.longitude=lng;};_pGoogleMap.gmap_onclick=function(lat,lng,x,y){this._location.latitude=lat;this._location.longitude=lng;this._pixel.x=x;this._pixel.y=y;this.kindClick="normalclick";};_pGoogleMap.gmap_onoverlayclick=function(fromobj,lat,lng,x,y){this._location.latitude=lat;this._location.longitude=lng;this._pixel.x=x;this._pixel.y=y;this.overlayfromobj=fromobj;this.kindClick="overlayclick";};_pGoogleMap._on_click=function(elem,button,alt_key,ctrl_key,shift_key,canvasX,canvasY,screenX,screenY){};_pGoogleMap._on_sys_click=function(node,e,bubble){var event=e.changedTouches?e.changedTouches[0]:e;nexacro.ajaxlog("_on_sys_click"+event.screenx+","+event.screeny+":"+node+":"+event+":"+bubble+"]");if(this.$IsReadyFireEvent()&&this.$isEnable()&&this.enableevent){if(this.kindClick=="normalclick"){this._fire_onclick(node._comp,event);}else{if(this.kindClick=="overlayclick"&&typeof (this.overlayfromobj)!="undefined"){this._fire_onoverlayclick(node._comp,event);}}}return true;};_pGoogleMap._fire_onclick=function(obj,e){if(this.onclick._has_handlers&&this.enableevent){this.bClicked=false;var evt=new nexacro.GoogleMapClickEventInfo(this,obj,"onclick",e,this._location,this._pixel);return this.onclick._fireEvent(this,evt);}else{this.bClicked=true;}return false;};_pGoogleMap._fire_onoverlayclick=function(obj,e){if(this.onoverlayclick&&this.onoverlayclick._has_handlers&&this.enableevent){var evt=new nexacro.GoogleMapClickEventInfo(this,this.overlayfromobj,"onoverlayclick",e,this._location,this._pixel);return this.onoverlayclick._fireEvent(this,evt);}};_pGoogleMap._apply_onload=function(){if(this.enable==false){}else if(this.enable==true){}this.on_fire_onload(this);};_pGoogleMap.on_fire_onload=function(obj){if(this.onload&&this.onload._has_handlers&&this.enableevent){var evt=new nexacro.GoogleMapEventInfo(obj,"onload",this.centerlocation,this.viewmode,this.zoomlevel,this.addresses,this.coordinates);return this.onload._fireEvent(this,evt);}};_pGoogleMap._onrecvsuccess=function(objData){if(this.enableevent){if(objData.latitude==undefined||objData.latitude==null||objData.latitude==""||objData.longitude==undefined||objData.longitude==null||objData.longitude==""){this.on_fire_onrecvsuccess(this,objData.eventid,objData.addresses,this.coordinates);}else{this.coordinates.latitude=objData.latitude;this.coordinates.longitude=objData.longitude;this.on_fire_onrecvsuccess(this,objData.eventid,objData.addresses,this.coordinates);}}};_pGoogleMap.on_fire_onrecvsuccess=function(obj,id,addresses,coordinates){if(this.enableevent){var evt=new nexacro.GoogleMapEventInfo(obj,id,this.centerlocation,this.viewmode,this.zoomlevel,addresses,this.coordinates);return this.onrecvsuccess._fireEvent(this,evt);}};_pGoogleMap._apply_onerror=function(objData){if(this.enableevent){var _objData=nexacro._executeGlobalEvalStr(objData);this.on_fire_onerror(this,_objData);}};_pGoogleMap.on_fire_onerror=function(obj,e){if(this.enableevent){var evt=new nexacro.GoogleMapErrorEventInfo(this,"onerror",e.errorcode,e.errormsg);return this.onerror._fireEvent(this,evt);}};_pGoogleMap.on_change_containerRect=function(width,height){var map_elem=this._map_elem;if(map_elem){map_elem.setElementSize(width,height);}};_pGoogleMap.__onDragEnter=function(obj,e){console.debug("__ondragEnter");};delete _pGoogleMap;}if(!nexacro.GoogleMapMarker){nexacro.GoogleMapMarker=function(name,obj){this._id=nexacro.Device.makeID();nexacro.Device._userCreatedObj[this._id]=this;this.name=name||"";this._type=0;this.enableevent=true;this.longitude=0;this.latitude=0;this._location={latitude:0,longitude:0};this.text="";this.visible=true;this.draggable=false;this.imageurl="";this.style={_GoogleMapMarkerID:0,set_parentID:function(_id){this._GoogleMapMarkerID=_id;},align:{_GoogleMapMarkerID:0,set_parentID:function(_id){this._GoogleMapMarkerID=_id;},halign:"center",valign:"middle",set_halign:function(v){var _v=v.toString().split(" ").join("").toLowerCase();if(_v=="left"||_v=="center"||_v=="right"){this.halign=_v;var __parent=nexacro.Device._userCreatedObj[this._GoogleMapMarkerID];if(__parent._map!=null){__parent._map.setMarkerOptions(__parent._name,__parent);}return true;}else{return false;}},set_valign:function(v){var _v=v.toString().split(" ").join("").toLowerCase();if(_v=="top"||_v=="middle"||_v=="bottom"){this.valign=_v;var __parent=nexacro.Device._userCreatedObj[this._GoogleMapMarkerID];if(__parent._map!=null){__parent._map.setMarkerOptions(__parent._name,__parent);}return true;}else{return false;}},$s:function(name,fnname,val){var fn=this[fnname];if(fn){return fn.call(this,val);}return (this[name]=val);}},image:"",set_align:function(v){var v_arr=v.split(" ");var ret=true;if(v_arr.length!=2){return false;}ret=this.align.set_halign(v_arr[0]);if(!ret){return ret;}ret=this.align.set_valign(v_arr[1]);var __parent=nexacro.Device._userCreatedObj[this._GoogleMapMarkerID];if(__parent._map!=null){__parent._map.setMarkerOptions(__parent._name,__parent);}return ret;},$s:function(name,fnname,val){var fn=this[fnname];if(fn){return fn.call(this,val);}return (this[name]=val);}};this._map=null;this._name=null;this.style.set_parentID(this._id);this.style.align.set_parentID(this._id);};var _pGoogleMapMarker=nexacro._createPrototype(nexacro._EventSinkObject,nexacro.GoogleMapMarker);nexacro.GoogleMapMarker.prototype=_pGoogleMapMarker;_pGoogleMapMarker._type_name="GoogleMapMarker";_pGoogleMapMarker.set_longitude=function(v){try{this.longitude=Number(v.toString());}catch(e){return false;}if(this.longitude!=this.longitude){return false;}this._location.longitude=this.longitude;if(this._map!=null){this._map.setMarkerOptions(this._name,this);}return true;};_pGoogleMapMarker.set_latitude=function(v){try{this.latitude=Number(v.toString());}catch(e){return false;}if(this.latitude!=this.latitude){return false;}this._location.latitude=this.latitude;if(this._map!=null){this._map.setMarkerOptions(this._name,this);}return true;};_pGoogleMapMarker.set_text=function(v){this.text=v;if(this._map!=null){this._map.setMarkerOptions(this._name,this);}return true;};_pGoogleMapMarker.set_draggable=function(v){if(v==null){return false;}else if(v){if(v==true||(typeof (v)=="string"&&v=="true")){this.draggable=true;}else if(v==false||(typeof (v)=="string"&&v=="false")){this.draggable=false;}}else{return false;}};_pGoogleMapMarker.set_visible=function(v){if(v==true||(typeof (v)=="string"&&v=="true")){this.visible=true;}else if(v==false||(typeof (v)=="string"&&v=="false")){this.visible=false;}else{return false;}if(this._map!=null){this._map.setMarkerOptions(this._name,this);}return true;};_pGoogleMapMarker.set_imageurl=function(v){this._type=1;this.imageurl=v;if(this._map!=null){this._map.setMarkerOptions(this._name,this);}return true;};_pGoogleMapMarker.set_style=function(v){var v_arr=v.split(";");var i;var _v_arr;var ret=true;for(i=0;i<v_arr.length;i++ ){_v_arr=v_arr[i].split(":");if(_v_arr.length!=2){return false;}else if(_v_arr[0].split(" ").join("").toLowerCase()=="align"){ret=this.style.set_align(_v_arr[1]);}else{ret=false;}if(!ret){return ret;}}if(this._map!=null){this._map.setMarkerOptions(this._name,this);}return ret;};delete _pGoogleMapMarker;nexacro._addRegisterClass("GoogleMapMarker","nexacro.GoogleMapMarker");}if(!nexacro.GoogleMapPolyline){nexacro.GoogleMapPolyline=function(name,obj){this._id=nexacro.Device.makeID();nexacro.Device._userCreatedObj[this._id]=this;this.name=name||"";this._type=2;this.locationdata="";this.visible=true;this.linewidth="";this.linecolor="";this.enableevent=true;this._map=null;this._name=null;};var _pGoogleMapPolyline=nexacro._createPrototype(nexacro._EventSinkObject,nexacro.GoogleMapPolyline);nexacro.GoogleMapPolyline.prototype=_pGoogleMapPolyline;_pGoogleMapPolyline._type_name="GoogleMapPolyline";_pGoogleMapPolyline.set_locationdata=function(v){var _lat_lng_arr;_lat_lng_arr=v.toString().split("]");if(_lat_lng_arr.length<2){return false;}this.locationdata=v;if(this._map!=null){this._map.setPolylineOptions(this._name,this);}return true;};_pGoogleMapPolyline.set_visible=function(v){if(v==true||(typeof (v)=="string"&&v=="true")){this.visible=true;}else if(v==false||(typeof (v)=="string"&&v=="false")){this.visible=false;}else{return false;}if(this._map!=null){this._map.setPolylineOptions(this._name,this);}return true;};_pGoogleMapPolyline.set_linewidth=function(v){var nWidth=0;try{nWidth=Number(v.toString());}catch(e){return false;}if(nWidth!=nWidth){return false;}this.linewidth=nWidth;if(this._map!=null){this._map.setPolylineOptions(this._name,this);}return true;};_pGoogleMapPolyline.set_linecolor=function(v){this.linecolor=v;return true;};delete _pGoogleMapPolyline;}if(!nexacro.GoogleMapPolygon){nexacro.GoogleMapPolygon=function(name,obj){this._id=nexacro.Device.makeID();nexacro.Device._userCreatedObj[this._id]=this;this.name=name||"";this._type=3;this.locationdata="";this.visible=true;this.linewidth="";this.linecolor="";this.fillbrushcolor="";this.enableevent=true;this._map=null;this._name=null;};var _pGoogleMapPolygon=nexacro._createPrototype(nexacro._EventSinkObject,nexacro.GoogleMapPolygon);nexacro.GoogleMapPolygon.prototype=_pGoogleMapPolygon;_pGoogleMapPolygon._type_name="GoogleMapPolygon";_pGoogleMapPolygon.set_locationdata=function(v){var _lat_lng_arr;_lat_lng_arr=v.toString().split("]");if(_lat_lng_arr.length<2){return false;}this.locationdata=v;if(this._map!=null){this._map.setPolygonOptions(this._name,this);}return true;};_pGoogleMapPolygon.set_visible=function(v){if(v==true||(typeof (v)=="string"&&v=="true")){this.visible=true;}else if(v==false||(typeof (v)=="string"&&v=="false")){this.visible=false;}else{return false;}if(this._map!=null){this._map.setPolygonOptions(this._name,this);}return true;};_pGoogleMapPolygon.set_linewidth=function(v){var nWidth=0;try{nWidth=Number(v.toString());}catch(e){return false;}if(nWidth!=nWidth){return false;}this.linewidth=nWidth;if(this._map!=null){this._map.setPolygonOptions(this._name,this);}return true;};_pGoogleMapPolygon.set_linecolor=function(v){this.linecolor=v;return true;};_pGoogleMapPolygon.set_fillbrushcolor=function(v){this.fillbrushcolor=v;return true;};delete _pGoogleMapPolygon;}if(!nexacro.GoogleMapCircle){nexacro.GoogleMapCircle=function(name,obj){this._id=nexacro.Device.makeID();nexacro.Device._userCreatedObj[this._id]=this;this.name=name||"";this._type=4;this.longitude=0;this.latitude=0;this.enableevent=true;this.visible=true;this._map=null;this._name=null;this.radius=100;};var _pGoogleMapCircle=nexacro._createPrototype(nexacro._EventSinkObject,nexacro.GoogleMapCircle);nexacro.GoogleMapCircle.prototype=_pGoogleMapCircle;_pGoogleMapCircle._type_name="GoogleCircle";_pGoogleMapCircle.set_longitude=function(v){try{this.longitude=Number(v.toString());}catch(e){return false;}if(this.longitude!=this.longitude){return false;}if(this._map!=null){this._map.setCircleOptions(this._name,this);}return true;};_pGoogleMapCircle.set_latitude=function(v){try{this.latitude=Number(v.toString());}catch(e){return false;}if(this.latitude!=this.latitude){return false;}if(this._map!=null){this._map.setCircleOptions(this._name,this);}return true;};_pGoogleMapCircle.set_visible=function(v){if(v==true||(typeof (v)=="string"&&v=="true")){this.visible=true;}else if(v==false||(typeof (v)=="string"&&v=="false")){this.visible=false;}else{return false;}if(this._map!=null){this._map.setCircleOptions(this._name,this);}return true;};_pGoogleMapCircle.set_radius=function(v){if(v==null){this.radius=100;}else{this.radius=Number(v.toString());}};delete _pGoogleMapCircle;}}else{if(!nexacro.GoogleMap){nexacro.GoogleMap=function(id,left,top,width,height,right,bottom,parent){nexacro.Component.call(this,id,left,top,width,height,right,bottom,parent);this.on_fire_onclick=function(){};};var _pGoogleMap=nexacro._createPrototype(nexacro.Component,nexacro.GoogleMap);nexacro.GoogleMap.prototype=_pGoogleMap;_pGoogleMap._type="GoogleMap";_pGoogleMap._type_name="GoogleMap";_pGoogleMap.showzoom=false;_pGoogleMap.language=undefined;_pGoogleMap.region=undefined;_pGoogleMap.set_viewmode=function(v){};_pGoogleMap.set_zoomlevel=function(v){};_pGoogleMap.set_showzoom=function(v){v=nexacro._toBoolean(v);this.showzoom=v;};_pGoogleMap.set_shownavigator=function(v){};_pGoogleMap.set_showcompass=function(v){};_pGoogleMap.set_showmapscale=function(v){};_pGoogleMap.set_centerlocation=function(v){};_pGoogleMap.set_showmode=function(v){};_pGoogleMap.set_zoomalign=function(v){};_pGoogleMap.set_navigatoralign=function(v){};_pGoogleMap.set_mapscalealign=function(v){};_pGoogleMap.set_draggable=function(v){};_pGoogleMap.set_apikey=function(v){this.apikey=v;};_pGoogleMap.set_language=nexacro._emptyFn;_pGoogleMap.set_region=nexacro._emptyFn;_pGoogleMap.load=function(bUseSensor,nLatitude,nLongitude,constViewMode,nZoomLevel){};_pGoogleMap.setMarkerLoc=function(strItemID,lat,lng){};_pGoogleMap.getAddress=function(nLatitude,nLongitude,nMaxResultCount,strLocale){};_pGoogleMap.getCoordinates=function(straddress){};_pGoogleMap.addItem=function(strItemID,objComponent){};_pGoogleMap.setMarkerOptions=function(markName,markObj){};_pGoogleMap.addMarker=function(elem,markName,markObj){};_pGoogleMap.addPolyline=function(elem,polylineName,polylineObj){};_pGoogleMap.removeItem=function(strItemID){};_pGoogleMap._removeItem=function(elem,itemname){};delete _pGoogleMap;}if(!nexacro.GoogleMapMarker){nexacro.GoogleMapMarker=function(name,obj){};var _pGoogleMapMarker=nexacro.GoogleMapMarker.prototype=nexacro._createPrototype(nexacro._EventSinkObject,nexacro.GoogleMapMarker);_pGoogleMapMarker._type_name="GoogleMapMarker";_pGoogleMapMarker.set_latitude=function(v){};_pGoogleMapMarker.set_longitude=function(v){};_pGoogleMapMarker.set_text=function(v){};_pGoogleMapMarker.set_draggable=function(v){};_pGoogleMapMarker.set_visible=function(v){};_pGoogleMapMarker.set_style=function(v){};delete _pGoogleMapMarker;}if(!nexacro.GoogleMapPolyline){nexacro.GoogleMapPolyline=function(name,obj){};var _pGoogleMapPolyline=nexacro.GoogleMapPolyline.prototype=nexacro._createPrototype(nexacro._EventSinkObject,nexacro.GoogleMapPolyline);_pGoogleMapPolyline._type_name="GoogleMapPolyline";_pGoogleMapPolyline.set_locationdata=function(v){};_pGoogleMapPolyline.set_linewidth=function(v){};_pGoogleMapPolyline.set_linecolor=function(v){};_pGoogleMapPolyline.set_visible=function(v){};delete _pGoogleMapPolyline;}if(!nexacro.GoogleMapPolygon){nexacro.GoogleMapPolygon=function(name,obj){};var _pGoogleMapPolygon=nexacro.GoogleMapPolygon.prototype=nexacro._createPrototype(nexacro._EventSinkObject,nexacro.GoogleMapPolygon);_pGoogleMapPolygon._type_name="GoogleMapPolygon";_pGoogleMapPolygon.set_locationdata=function(v){};_pGoogleMapPolygon.set_linewidth=function(v){};_pGoogleMapPolygon.set_linecolor=function(v){};_pGoogleMapPolygon.set_fillbrushcolor=function(v){};_pGoogleMapPolygon.set_visible=function(v){};delete _pGoogleMapPolygon;}if(!nexacro.GoogleMapCircle){nexacro.GoogleMapCircle=function(name,obj){};var _pGoogleMapCircle=nexacro.GoogleMapCircle.prototype=nexacro._createPrototype(nexacro._EventSinkObject,nexacro.GoogleMapCircle);_pGoogleMapCircle._type_name="GoogleMapCircle";_pGoogleMapCircle.set_latitude=function(v){};_pGoogleMapCircle.set_longitude=function(v){};_pGoogleMapCircle.set_radius=function(v){};_pGoogleMapCircle.set_visible=function(v){};delete _pGoogleMapCircle;}}
if(!nexacro.Sketch){nexacro.SketchLoadEventInfo=function(obj,id,url){this.id=this.eventid=id||"onload";this.fromobject=this.fromreferenceobject=obj;this.url=url;};var _pSketchLoadEventInfo=nexacro._createPrototype(nexacro.Event,nexacro.SketchLoadEventInfo);nexacro.SketchLoadEventInfo.prototype=_pSketchLoadEventInfo;_pSketchLoadEventInfo._type_name="SketchLoadEventInfo";delete _pSketchLoadEventInfo;_pSketchLoadEventInfo=null;nexacro.SketchErrorEventInfo=function(obj,id,fireerrorcode,errormsg,errortype,errstatus,imageurl,locationuri){this.id=this.eventid=id||"onerror";this.errormsg=errormsg;this.errorobj=obj;this.errortype=errortype;this.locationuri=locationuri;this.requesturi=imageurl;this.statuscode=errstatus?errstatus:0;};var _pSketchErrorEventInfo=nexacro._createPrototype(nexacro.ErrorEventInfo,nexacro.SketchErrorEventInfo);nexacro.SketchErrorEventInfo.prototype=_pSketchErrorEventInfo;_pSketchErrorEventInfo._type_name="SketchErrorEventInfo";delete _pSketchErrorEventInfo;_pSketchErrorEventInfo=null;nexacro.SketchEventInfo=function(obj,id,handle){this.id=this.eventid=id||"onsuccess";this.handle=handle;this.fromobject=this.fromreferenceobject=obj;};var _pSketchEventInfo=nexacro._createPrototype(nexacro.Event,nexacro.SketchEventInfo);nexacro.SketchEventInfo.prototype=_pSketchEventInfo;_pSketchEventInfo._type_name="SketchEventInfo";delete _pSketchEventInfo;nexacro.Sketch=function(id,left,top,width,height,right,bottom,minwidth,maxwidth,minheight,maxheight,parent){nexacro.Component.call(this,id,left,top,width,height,right,bottom,minwidth,maxwidth,minheight,maxheight,parent);this._history=[];this._image_format=["bmp","bmp,mono","gif","jpeg","jpg","png","tif","tiff","icon"];this._save_image_formattype=["BMP","PNG","JPG","GIF","TIF","BMP,Mono"];this._default_stroke_style=nexacro.ColorObject("black");this._currentPath=[];this._path_style={};};var _pSketch=nexacro._createPrototype(nexacro.Component,nexacro.Sketch);nexacro.Sketch.prototype=_pSketch;_pSketch._type_name="Sketch";_pSketch.undoable=false;_pSketch.redoable=false;_pSketch.editmode="stroke";_pSketch.enableredraw=true;_pSketch.imemode="none";_pSketch.usecontextmenu=true;_pSketch.text="";_pSketch.texteditmode="text";_pSketch.readonly=false;_pSketch.undocount=5;_pSketch.undotype="draw";_pSketch.value=null;_pSketch.sketchtextarea=null;_pSketch.accessibilityrole="image";_pSketch._canvas_elem_bg=null;_pSketch._canvas_elem=null;_pSketch._canvas_elem_tmp=null;_pSketch._current_strokes=null;_pSketch._image=null;_pSketch._clr_history=true;_pSketch._current_state= -1;_pSketch._freeze_state= -1;_pSketch._drawpathcount=0;_pSketch._const_stroke="stroke";_pSketch._const_stroke_user="strokeu";_pSketch._const_text="text";_pSketch._const_erase="erase";_pSketch._const_none="none";_pSketch._const_erase_user="eras_handleeu";_pSketch._const_image="image";_pSketch._const_composit_source_over="source-over";_pSketch._const_composit_destination_out="destination-out";_pSketch._const_form="this.parent";_pSketch._const_dot=".";_pSketch._default_line_cap="round";_pSketch._default_line_join="round";_pSketch._default_line_width=1;_pSketch._default_edit_gap=0.5;_pSketch._default_edit_x=0;_pSketch._default_edit_y=0;_pSketch._default_edit_width=100;_pSketch._default_edit_height=50;_pSketch._startDrawStroke=true;_pSketch._startDrawErase=true;_pSketch._pre_draw_status="";_pSketch._butt_count=0;_pSketch._const_code_parameter="0001";_pSketch._const_code_io="1101";_pSketch._const_code_permission="1102";_pSketch._const_code_Irregular="1103";_pSketch._const_code_target="1104";_pSketch._const_code_loadinvalidimage="1105";_pSketch._const_code_incorrectfile="1106";_pSketch._const_code_savefile="1107";_pSketch._const_errortype_obj="ObjectError";_pSketch._const_errortype_type="TypeError";_pSketch._const_code_parameter_msg="comp_fail_parameter";_pSketch._const_code_loadinvalidimage_msg="comm_fail_loadinvalidimage";_pSketch._const_code_incorrectfile_msg="comp_incorrect_file";_pSketch._const_code_savefile_msg="comp_fail_save_file";_pSketch._is_undo=false;_pSketch._apply_client_padding=true;_pSketch._is_touch=false;_pSketch._img_type="url";_pSketch._touch_status=0;_pSketch._font=null;_pSketch._imgurl="";_pSketch._use_readonly_status=true;_pSketch._event_list={"oninit":1,"onclick":1,"ondblclick":1,"onkillfocus":1,"onsetfocus":1,"ontouch":1,"ontouchstart":1,"ontouchmove":1,"ontouchend":1,"onlbuttondown":1,"onlbuttonup":1,"onmousemove":1,"onload":1,"onerror":1,"onsuccess":1,"onsize":1,"onmove":1,"onrbuttondown":1,"onrbuttonup":1,"onmousedown":1,"onmouseup":1,"onmouseenter":1,"onmouseleave":1,"onmousewheel":1,"onkeydown":1,"onkeyup":1,"oninput":1,"ondrag":1,"ondrop":1,"ondragenter":1,"ondragleave":1,"oncontextmenu":1,"ondragmove":1};_pSketch.on_create_contents=function(){var control_elem=this.getElement();if(control_elem){var color=this._color||this._getCurrentStyleInheritValue("color");nexacro.addErrorMessage(system._language,this._const_code_parameter_msg,"Parameter Error.");nexacro.addErrorMessage(system._language,this._const_code_savefile_msg,"Failed to save file.");this._canvas_elem=new nexacro.CanvasElement(control_elem);this._canvas_elem_tmp=new nexacro.CanvasElement(control_elem);var sketchtextarea=new nexacro.SketchEditControl("sketchtextarea",this._default_edit_x,this._default_edit_y,this._default_edit_width,this._default_edit_height,null,null,null,null,null,null,this);sketchtextarea._setControl("TextAreaControl");sketchtextarea.createComponent();sketchtextarea._setEventHandler("oninput",this.on_notify_oninput,this);sketchtextarea._setEventHandler("onkillfocus",this.on_notify_edit_onkillfocus,this);this.sketchtextarea=sketchtextarea;if(!this._font){this._font=this._getCurrentStyleInheritValue("font");}if(this.text){var text_elem=new nexacro.TextBoxElement(control_elem);text_elem.setElementSize(this._getClientWidth(),this._getClientHeight());text_elem.setElementFont(this._font);text_elem.setElementTextAlign("center");text_elem.setElementVerticalAlign("middle");text_elem.setElementText(this.text);this._text_elem=text_elem;}this._path_style={tool:color,globalCompositeOperation:this._const_composit_source_over,strokeColor:color,lineWidth:this._default_line_width,eraseWidth:this._default_line_width,lineCap:this._default_line_cap,lineJoin:this._default_line_join,font:this._font||sketchtextarea._getCurrentStyleInheritValue("font"),fontColor:color,text:""};}};_pSketch.on_created_contents=function(_window){var control_elem=this.getElement();if(control_elem){var canvas_elem_bg=this._canvas_elem_bg;var canvas_elem=this._canvas_elem;var canvas_elem_tmp=this._canvas_elem_tmp;var client_width=this._getClientWidth();var client_height=this._getClientHeight();var line_cap=this._default_line_cap;var line_join=this._default_line_join;if(canvas_elem_bg){canvas_elem_bg.create(_window);canvas_elem_bg.setElementLineCap(line_cap);canvas_elem_bg.setElementLineJoin(line_join);canvas_elem_bg.setElementSize(client_width,client_height);}if(canvas_elem){canvas_elem.create(_window);canvas_elem.setElementLineCap(line_cap);canvas_elem.setElementLineJoin(line_join);canvas_elem.setElementSize(client_width,client_height);}if(canvas_elem_tmp){canvas_elem_tmp.create(_window);canvas_elem_tmp.setElementLineCap(line_cap);canvas_elem_tmp.setElementLineJoin(line_join);}this.on_apply_text(this.text);var text_elem=this._text_elem;if(text_elem){text_elem.create(this._getWindow());control_elem.bringToFrontElement(this._canvas_elem);}var sketchtextarea=this.sketchtextarea;sketchtextarea.on_created();sketchtextarea.set_width(this._default_edit_width);sketchtextarea.set_height(this._default_edit_height);sketchtextarea.set_imemode(this.imemode);sketchtextarea.set_usecontextmenu(this.usecontextmenu);sketchtextarea.set_readonly(this.readonly);sketchtextarea.set_visible(false);}var canvas_elem_screenXY=this._canvas_elem._getElementScreenXY();if(canvas_elem_screenXY){this._screenX=canvas_elem_screenXY.x;this._screenY=canvas_elem_screenXY.y;}};_pSketch.on_create_contents_command=function(){return "";};_pSketch.on_attach_contents_handle=function(win){var canvas_elem_bg=this._canvas_elem_bg;var canvas_elem=this._canvas_elem;var canvas_elem_tmp=this._canvas_elem_tmp;if(canvas_elem_bg){canvas_elem_bg.create(win);}if(canvas_elem){canvas_elem.create(win);}if(canvas_elem_tmp){canvas_elem_tmp.create(win);}var control_elem=this.getElement();if(control_elem){canvas_elem_bg=this._canvas_elem_bg;canvas_elem=this._canvas_elem;canvas_elem_tmp=this._canvas_elem_tmp;var client_width=this._getClientWidth();var client_height=this._getClientHeight();var line_cap=this._default_line_cap;var line_join=this._default_line_join;if(canvas_elem_bg){canvas_elem_bg.setElementLineCap(line_cap);canvas_elem_bg.setElementLineJoin(line_join);canvas_elem_bg.setElementSize(client_width,client_height);}if(canvas_elem){canvas_elem.setElementLineCap(line_cap);canvas_elem.setElementLineJoin(line_join);canvas_elem.setElementSize(client_width,client_height);}if(canvas_elem_tmp){canvas_elem_tmp.setElementLineCap(line_cap);canvas_elem_tmp.setElementLineJoin(line_join);}this.on_apply_text(this.text);var text_elem=this._text_elem;if(text_elem){text_elem.create(this._getWindow());control_elem.bringToFrontElement(this._canvas_elem);}var sketchtextarea=this.sketchtextarea;sketchtextarea.on_created();sketchtextarea.set_width(this._default_edit_width);sketchtextarea.set_height(this._default_edit_height);sketchtextarea.set_imemode(this.imemode);sketchtextarea.set_usecontextmenu(this.usecontextmenu);sketchtextarea.set_readonly(this.readonly);sketchtextarea.set_visible(false);}var canvas_elem_screenXY=this._canvas_elem._getElementScreenXY();if(canvas_elem_screenXY){this._screenX=canvas_elem_screenXY.x;this._screenY=canvas_elem_screenXY.y;}};_pSketch.on_destroy_contents=function(){var canvas_elem_bg=this._canvas_elem_bg;var canvas_elem=this._canvas_elem;var canvas_elem_tmp=this._canvas_elem_tmp;if(canvas_elem_bg){canvas_elem_bg.destroy();}if(canvas_elem){canvas_elem.destroy();}if(canvas_elem_tmp){canvas_elem_tmp.destroy();}};_pSketch.on_change_containerRect=function(width,height){if(this._canvas_elem){this._canvas_elem.setElementSize(width,height);}if(this._canvas_elem_bg){this._canvas_elem_bg.setElementSize(width,height);}var text_elem=this._text_elem;if(text_elem){text_elem.setElementSize(width,height);}if(this._adjust_height>0&&this._adjust_width>0){this._restoreSketch();}};_pSketch.on_change_containerPos=function(left,top){};_pSketch.set_enableredraw=function(v){this.enableredraw=nexacro._toBoolean(v);if(this.enableredraw){this._redrawPath();}return v;};_pSketch.set_editmode=function(editmode){var tmp=this._const_stroke;switch(editmode){case this._const_text:this.set_cursor("text");tmp=editmode;break;case this._const_erase:case this._const_none:this.set_cursor("default");tmp=editmode;break;case this._const_stroke:this.set_cursor("default");break;default:break;}this.editmode=tmp;};_pSketch.set_imemode=function(v){if(v!=this.imemode){this.imemode=nexacro._toString(v);this.on_apply_imemode();}};_pSketch.on_apply_imemode=function(){this.sketchtextarea.set_imemode(this.imemode);};_pSketch.set_usecontextmenu=function(v){v=nexacro._toBoolean(v);if(v!=this.usecontextmenu){this.usecontextmenu=v;this.on_apply_usecontextmenu();}};_pSketch.on_apply_usecontextmenu=function(){this.sketchtextarea.set_usecontextmenu(this.usecontextmenu);};_pSketch.set_readonly=function(v){v=nexacro._toBoolean(v);if(v!=this.readonly){this.readonly=v;this.on_apply_readonly(v);}};_pSketch.on_apply_readonly=function(v){this._changeStatus("readonly",v);var sketchtextarea=this.sketchtextarea;if(sketchtextarea){sketchtextarea.set_readonly(this.readonly);}};_pSketch.set_value=function(v){return;};_pSketch._set_value=function(v){this.value=v;this.on_apply_value();};_pSketch.on_apply_value=function(v){this.sketchtextarea.set_value(this.value);};_pSketch.on_apply_color=function(color){nexacro.Component.prototype.on_apply_color.call(this,color);var sketchtextarea=this.sketchtextarea;if(sketchtextarea){sketchtextarea.set_color(color);}this._path_style.fontColor=this._color;};_pSketch.on_apply_text=function(text){if(this._current_state!= -1){return;}var control_elem=this._control_element;if(control_elem){var text_elem=this._text_elem;if(!text_elem){text_elem=new nexacro.TextBoxElement(control_elem);this._text_elem=text_elem;this.on_apply_wordWrap();text_elem.setElementSize(this._getClientWidth(),this._getClientHeight());text_elem.setElementTextAlign("center");text_elem.setElementVerticalAlign("middle");text_elem.setElementText(text);if(this._is_created){text_elem.create(this._getRootWindow());control_elem.sendToBackElement(text_elem);}}}};_pSketch.on_apply_wordWrap=function(){if(this._text_elem){this._text_elem.setElementWordWrap(this.wordWrap);}};_pSketch.loadSketch=function(url){if(this.readonly){return;}this._imgurl=url;return this._loadSketch(url);};_pSketch.saveSketch=function(){var canvas_elem=this._canvas_elem;if(canvas_elem){var img=canvas_elem.toDataURL();if(img&&img.src){img.setBase64String(img.src);this._set_value(img);this.on_fire_onsuccess(img);return true;}}return false;};_pSketch._restoreSketch=function(){var path=this._currentStrokes();var cnt=this._drawpathcount;this._drawpathcount=0;var img_obj=this._imgurl;if(img_obj){var url="";var img_type=this._img_type;if(img_type=="url"){url=nexacro._getURIValue(img_obj);url=nexacro._getImageLocation(url,this._getRefFormBaseUrl());}else{if(img_obj._base64str){url=img_obj._base64str;}}if(!this._image){this._image=new nexacro.ImageSketchBackground(this);}this._image.set_src(url);}for(var n=0,length=path.length;n<length;n++ ){this._regenStroke(path[n],this._canvas_elem);this._regenStroke(path[n],this._canvas_elem_tmp);}this._drawpathcount=cnt;};_pSketch.saveSketchToFile=function(fileName,fileType,option){var errormsg="";if(!fileName){errormsg=nexacro._GetSystemErrorMsg(this,this._const_code_savefile_msg);this.on_fire_onerror(this,this._const_code_savefile,errormsg,this._const_errortype_obj,this._const_code_savefile,fileName,this._getRefFormBaseUrl());return false;}fileType=fileType?fileType:this._save_image_formattype[0];if(fileType==this._save_image_formattype[2]&&!option){option=100;}if(fileName.lastIndexOf(".")<0){var fileformattype=this._saveImageFileFormatType(fileType);fileName=fileName+this._const_dot+fileformattype;}var rtn=system.saveToImageFile(this,fileName,fileType,option);if(rtn!==undefined){if(rtn){var canvas_elem=this._canvas_elem;if(canvas_elem){var img=canvas_elem.toDataURL();if(img&&img.src){img.setBase64String(img.src);this._set_value(img);this.on_fire_onsuccess(img);return true;}}}else{errormsg=nexacro._GetSystemErrorMsg(this,this._const_code_savefile_msg);this.on_fire_onerror(this,this._const_code_savefile,errormsg,this._const_errortype_obj,this._const_code_savefile,fileName,this._getRefFormBaseUrl());return false;}}return false;};_pSketch._saveImageFileFormatType=function(fileType){var fileformattype;switch(fileType){case "PNG":fileformattype="png";break;case "JPG":fileformattype="jpg";break;case "GIF":fileformattype="gif";break;case "TIF":fileformattype="tif";break;case "BMP,Mono":fileformattype="bmp";break;default:fileformattype="bmp";break;}return fileformattype;};_pSketch.undo=function(){if(this._checkEditmode()==false||this.readonly){return;}this._undo();};_pSketch.redo=function(){if(this._checkEditmode()==false||this.readonly){return;}this._redo();};_pSketch.on_getBindableProperties=function(){return "value";};_pSketch.updateToDataset=function(){var ret=this.applyto_bindSource("value",this.value);return ret;};_pSketch.setBrushType=function(type){if(this._checkEditmode()==false){return;}switch(type){case "square":case "butt":this._path_style.lineCap=type;break;default:this._path_style.lineCap=this._default_line_cap;break;}};_pSketch.setBrushSize=function(size){if(this._checkEditmode()==false){return;}if(size>0){this._path_style.lineWidth=size;}else{this._path_style.lineWidth=this._default_line_width;}};_pSketch.setBrushColor=function(val){if(this._checkEditmode()==false){return;}if(val){if(this._color==null||this._color.value!=val){var color=nexacro.ColorObject(val);this._color=color;this.on_apply_color(color);}}else{if(this._color){this._color=null;this.on_apply_color(null);}}this._path_style.strokeStyle=this._color;};_pSketch.setTextFont=function(val){if(this._checkEditmode()==false){return;}this.font=val;if(val){if(this._font==null||this._font.value!=val){var font=nexacro.FontObject(val);this._font=font;this._path_style.font=font;}}else{if(this._font){this._font=null;this._path_style.font=this._getCurrentStyleInheritValue("font");}}var sketchtextarea=this.sketchtextarea;if(sketchtextarea){sketchtextarea.set_font(val);}};_pSketch.setEraseSize=function(size){if(this._checkEditmode()==false){return;}size= +size;if(size!=size||size<0){size=this._default_line_width;}this._path_style.eraseWidth=size;};_pSketch.drawText=function(x,y,text,multiline){if(this._checkEditmode()==false){return;}if(this.readonly){return;}var canvas_elem=this._canvas_elem;if(canvas_elem){this._initPath(this._path_style,this._const_text,x,y,true);var coords=this._currentPath[0];coords.text=text;coords.globalCompositeOperation=this._const_composit_source_over;this._drawText(coords,coords.x,coords.y,coords.text,multiline);}};_pSketch.drawStroke=function(x,y,start){if(this._checkEditmode()==false||this.readonly){return;}if(!x&&x==undefined){return;}if(!y&&y==undefined){return;}x=(x>=0||x<0)?x:this._default_edit_x;y=(y>=0||x<0)?y:this._default_edit_y;start=(!start&&start==undefined)?false:start;if(this._startDrawStroke){start=true;this._startDrawStroke=false;}this._drawStroke(this._path_style,this._const_stroke,x,y,start);};_pSketch.drawErase=function(x,y,start){if(this._checkEditmode()==false||this.readonly){return;}if(!x&&x==undefined){return;}if(!y&&y==undefined){return;}x=(x>=0||x<0)?x:this._default_edit_x;y=(y>=0||x<0)?y:this._default_edit_y;start=(!start&&start==undefined)?false:start;if(this._startDrawErase){start=true;this._startDrawErase=false;}this._drawStroke(this._path_style,this._const_erase,x,y,start);};_pSketch.drawStamp=function(){};_pSketch.drawTextBox=function(){};_pSketch.setStampImage=function(){};_pSketch.setTextBoxBkColor=function(){};_pSketch.moveTextEditor=function(){};_pSketch.resizeTextEditor=function(){};_pSketch.clear=function(){if(this._checkEditmode()==false){return;}this._clear(this._isEnableRedraw());if(this._current_state== -1){this.on_apply_text(this.getDisplayText());}};_pSketch.showTextEditor=function(x,y,width,height,text){if(!(arguments.length>=4&&arguments.length<6)){return;}var multiline=false;this._initPath(this._path_style,this._const_text,x,y,null,width,height,text);if(text!==undefined&&text!=""){multiline=true;}return this._showTextEditor(x,y,width,height,text,multiline);};_pSketch.hideTextEditor=function(clear){clear=(clear==true||clear==false)?clear:true;return this._hideTextEditor(clear);};_pSketch.redraw=function(){var redraw=this.enableredraw;this.enableredraw=true;this._redrawPath();this.enableredraw=redraw;};_pSketch.on_notify_edit_onkillfocus=function(obj,e){var text=obj.text;var status=(text.length>0)?true:false;var multiline=true;if(status){var canvas_elem=this._canvas_elem;if(canvas_elem){this._initPath(this._path_style,this._const_text,obj._left,obj._top,true);var coords=this._currentPath[0];coords.text=text;coords.globalCompositeOperation=this._const_composit_source_over;this._drawText(coords,coords.x,coords.y,coords.text,multiline);}}this._resetTextEdit(status);};_pSketch.on_fire_ontouchmove=function(touchinfos,changedtouchinfos,from_comp,from_refer_comp){if(touchinfos.length==0){return;}var evt=touchinfos[0];this.on_fire_onmousemove("lbutton",null,null,null,evt.screenx,evt.screeny,evt.canvasx,evt.canvasy,evt._canvasx,evt._canvasy,from_comp,from_refer_comp);};_pSketch.on_fire_sys_ontouchmove=_pSketch.on_fire_ontouchmove;_pSketch.on_fire_onmousemove=function(button,alt_key,ctrl_key,shift_key,screenX,screenY,canvasX,canvasY,clientX,clientY,from_comp,from_refer_comp){nexacro._getElementPositionInFrame(this.getElement(),true);this._moveAction(button,clientX,clientY);return false;};_pSketch.on_fire_sys_ondragmove=function(src_comp,src_refer_comp,dragdata,userdata,button,alt_key,ctrl_key,shift_key,screenX,screenY,canvasX,canvasY,clientX,clientY,from_comp,from_refer_comp){var retn=nexacro.Component.prototype.on_fire_sys_ondragmove.call(this,src_comp,src_refer_comp,dragdata,userdata,button,alt_key,ctrl_key,shift_key,screenX,screenY,canvasX,canvasY,clientX,clientY,from_comp,from_refer_comp);this._moveAction(button,clientX,clientY);return retn;};_pSketch.on_fire_sys_onmousemove=_pSketch.on_fire_onmousemove;_pSketch._moveAction=function(button,clientX,clientY){if(button=="lbutton"||button=="touch"){if(this._checkEditmode()==false||this.readonly){return;}var _window=this._getWindow();var wheelZoom=(_window&&(_window._wheelZoom!=undefined))?_window._wheelZoom/100:1.0;clientX=clientX/wheelZoom;clientY=clientY/wheelZoom;clientY-=nexacro._getCurrentBodyScrollTop();if(button=="touch"){if(this._touch_status==3){this._touch_status=0;}else if(this._touch_status==1){this._touch_status=2;}if(this._touch_status!=0){if(this._path_style.lineCap=="butt"){if(this._butt_count==3){this._drawPath(clientX,clientY);this._butt_count=0;}this._butt_count++ ;}else{this._drawPath(clientX,clientY);}}}else{if(this._path_style.lineCap=="butt"){if(this._butt_count==3){this._drawPath(clientX,clientY);this._butt_count=0;}this._butt_count++ ;}else{this._drawPath(clientX,clientY);}}}};_pSketch.on_fire_ontouchstart=function(touchinfos,changedtouchinfos,from_comp,from_refer_comp){if(touchinfos.length==0){return;}var evt=touchinfos[0];this.on_fire_onlbuttondown("lbutton",null,null,null,evt.screenx,evt.screeny,evt.canvasx,evt.canvasy,evt._canvasx,evt._canvasy,from_comp,from_refer_comp);};_pSketch._on_touch_lbuttondown=function(elem,button,alt_key,ctrl_key,shift_key,canvasX,canvasY,screenX,screenY,event_bubbles,fire_comp,refer_comp){nexacro._skipDragEventAfterMsgBox=false;var ret;var pThis=this._getFromComponent(this);if(!pThis.onlbuttondown||(pThis.onlbuttondown&&!pThis.onlbuttondown.defaultprevented)){this._on_onlbuttondown(button,alt_key,ctrl_key,shift_key,canvasX,canvasY,screenX,screenY,canvasX,canvasY,fire_comp,refer_comp,false);ret=this._on_bubble_touch_lbuttondown(elem,button,alt_key,ctrl_key,shift_key,canvasX,canvasY,screenX,screenY,event_bubbles,fire_comp,refer_comp,false);}return ret;};_pSketch._on_onlbuttondown=function(button,alt_key,ctrl_key,shift_key,screenX,screenY,canvasX,canvasY,clientX,clientY,from_comp,from_refer_comp){if(this._checkEditmode()==false){return;}if(this.readonly){if(this.sketchtextarea.visible){this.sketchtextarea.set_visible(false);}return;}this._delete_text();if(button=="touch"){this._touch_status=1;this._is_touch=true;}clientY-=nexacro._getCurrentBodyScrollTop();this.button=button;var _window=this._getWindow();var wheelZoom=(_window&&(_window._wheelZoom!=undefined))?_window._wheelZoom/100:1.0;this._initPath(this._path_style,this.editmode,(clientX-this._default_edit_gap)/wheelZoom,clientY/wheelZoom);this._drawPath(clientX/wheelZoom,clientY/wheelZoom);};_pSketch.on_fire_sys_ontouchstart=_pSketch.on_fire_ontouchstart;_pSketch.on_fire_onlbuttondown=function(button,alt_key,ctrl_key,shift_key,screenX,screenY,canvasX,canvasY,clientX,clientY,from_comp,from_refer_comp){if(nexacro._isTouchInteraction&&nexacro._SupportTouch&&!nexacro._enabletouchevent){return;}return this._on_onlbuttondown(button,alt_key,ctrl_key,shift_key,screenX,screenY,canvasX,canvasY,clientX,clientY,from_comp,from_refer_comp);};_pSketch.on_fire_sys_onlbuttondown=_pSketch.on_fire_onlbuttondown;_pSketch.on_fire_ontouchend=function(touchinfos,changedtouchinfos,from_comp,from_refer_comp){if(touchinfos.length==0){return;}var evt=touchinfos[0];this.on_fire_onlbuttonup("lbutton",null,null,null,evt.screenx,evt.screeny,evt.canvasx,evt.canvasy,evt.clientx-this._screenX,evt.clienty-this._screenY,from_comp,from_refer_comp);};_pSketch.on_fire_sys_ontouchend=_pSketch.on_fire_ontouchend;_pSketch.on_fire_onlbuttonup=function(button,alt_key,ctrl_key,shift_key,screenX,screenY,canvasX,canvasY,clientX,clientY,from_comp,from_refer_comp){if(this._checkEditmode()==false||this.readonly){return;}if(button=="touch"){this._touch_status=3;}this._endPath();if(button=="touch"){this._delete_text();}};_pSketch.on_fire_sys_onlbuttonup=_pSketch.on_fire_onlbuttonup;_pSketch._endPath=function(){var canvas_elem=this._canvas_elem;if(!canvas_elem||this._currentPath.length==0){return;}var currentpath=this._currentPath[0];var pathstyle=this._path_style;if(this.editmode==this._const_text&&!this.sketchtextarea.visible&&currentpath){var font=pathstyle.font;var color=pathstyle.fontColor;if(font){currentpath.font=pathstyle.font;}if(color&&color.value){currentpath.fontColor=nexacro.ColorObject(color.value);}}this._regenStroke(this._currentPath,canvas_elem);this._regenStroke(this._currentPath,this._canvas_elem_tmp);};_pSketch.on_fire_oninput=function(){if(this.oninput&&this.oninput._has_handlers){var evt=new nexacro.InputEventInfo(this,"oninput");return this.oninput._fireEvent(this,evt);}return true;};_pSketch.on_notify_oninput=function(){return this.on_fire_oninput();};_pSketch.on_fire_onload=function(obj,imageurl){var event=this.onload;if(event&&event._has_handlers){var evt=new nexacro.SketchLoadEventInfo(this,"onload",imageurl);event._fireEvent(this,evt);}};_pSketch.on_fire_onerror=function(obj,fireerrorcode,errormsg,returncode,errstatus,imageurl,locationuri){var event=this.onerror;if(event&&event._has_handlers){var evt=new nexacro.SketchErrorEventInfo(this,"onerror",fireerrorcode,errormsg,returncode,errstatus,imageurl,locationuri);event._fireEvent(this,evt);}};_pSketch.on_fire_onsuccess=function(handle){var event=this.onsuccess;if(event&&event._has_handlers){var evt=new nexacro.SketchEventInfo(this,"onsuccess",handle);return this.onsuccess._fireEvent(this,evt);}};_pSketch._getDlgCode=function(keycode,altKey,ctrlKey,shiftKey){return {want_tab:false,want_return:false,want_escape:false,want_chars:false,want_arrows:false,want_touchstart:true,want_touchmove:true};};_pSketch._refresh_contents=function(){};_pSketch._setImageValue=function(image){if(image instanceof nexacro.ImageSketchBackground){var base64=image.getBase64String();if(!base64){var _image=this._canvas_elem.toDataURL();if(_image&&_image.src){_image.setBase64String(_image.src);this.value=_image;}}}};_pSketch._setImageType=function(v){if(v){if(v instanceof nexacro.Image){v=v._base64str;this._img_type="base64";}else{v=v.toString();var isBase64=nexacro._checkBase64String(v);if(isBase64){if(v.substring(0,10).toLowerCase()=="data:image"){if(v.substring(0,17).toLowerCase()!="data:image;base64"){var comma_idx=v.indexOf(",");if(comma_idx> -1){var tmp=v.slice(comma_idx+1,v.legnth);v="data:image;base64,"+tmp;}}}else{v="data:image;base64,"+v;}this._img_type="base64";}else{this._img_type="url";}}}else{v="";this._img_type="url";}};_pSketch._loadSketch=function(url){var errormsg="";this._clearCanvas(this._isEnableRedraw());if(this._image){}this._setImageType(url);var img_type=this._img_type;if(url){if(img_type=="url"){url=nexacro._getURIValue(url);url=nexacro._getImageLocation(url,this._getRefFormBaseUrl());if(nexacro._OS=="iOS"&&nexacro._isHybrid()){var jsonstr='{"div":"sketch", "method":"toBase64String", "params":"'+url+'"}';url=nexacro.Device.exec(jsonstr,true);if(url==""){url=undefined;}else{img_type=this._img_type="base64";}}}else{if(url._base64str){url=url._base64str;}}}if(url==undefined||arguments.length>1){errormsg=nexacro._GetSystemErrorMsg(this,this._const_code_parameter_msg);this.on_fire_onerror(this,this._const_code_parameter,errormsg,this._const_errortype_obj,this._const_code_parameter,url,this._getRefFormBaseUrl());return false;}if(img_type=="url"&&url){var imgformat=url.substring(url.lastIndexOf(".")+1).toLowerCase();if((this._image_format).indexOf(imgformat)== -1){errormsg=nexacro._GetSystemErrorMsg(this,this._const_code_incorrectfile_msg);this.on_fire_onerror(this,this._const_code_incorrectfile,errormsg,this._const_errortype_type,this._const_code_incorrectfile,url,this._getRefFormBaseUrl());return false;}}nexacro._getImageSize(url,this._imageload,this,this.parent._getRefFormBaseUrl());if(!this._image||!(this._image instanceof nexacro.ImageSketchBackground)){this._image=null;this._image=new nexacro.ImageSketchBackground(this);}var retn=this._image.set_src(url);if(retn){if(this._apply_client_padding){this._delete_text();}this._set_value(this._image);if(this._clr_history){this._initHistory();this._setRedoUndo();}return true;}return false;};_pSketch._imageload=function(url,imgsize,size,imgobj,status){if(imgsize<=0){this._image=null;this._set_value(null);this.value=null;delete nexacro._ImgInfoCacheList[url];nexacro._ImgInfoCacheList[url]=null;}};_pSketch._drawText=function(_style,x,y,text,multiline){if(this.readonly){return;}if(!text||text.length==0){return;}var canvas_elem=this._canvas_elem;var canvas_elem_tmp=this._canvas_elem_tmp;if(canvas_elem){if(this._apply_client_padding){this._delete_text();}x=(x>=0||x<0)? +x:this._default_edit_x;y=(y>=0||x<0)? +y:this._default_edit_y;var font=this._font;if(font==null){font=this.sketchtextarea._getCurrentStyleInheritValue("font");}canvas_elem.setElementFont(font);canvas_elem.setElementGlobalCompositeOperation(_style.globalCompositeOperation);canvas_elem_tmp.setElementFont(font);canvas_elem_tmp.setElementGlobalCompositeOperation(_style.globalCompositeOperation);var tcolor;if(_style.fontColor instanceof nexacro.ColorObject){tcolor=_style.fontColor;}else{tcolor=nexacro.ColorObject(_style.fontColor);}canvas_elem.setElementFillStyle(tcolor);canvas_elem_tmp.setElementFillStyle(tcolor);var multiliney=Number(y);if(multiline){if(text!=""){text=text.replace(/&quot;/g,"\"");if(text.indexOf("\r\n")!= -1||text.indexOf("\n\r")!= -1){text=text.replace(/\r\n/g,"\n").replace(/\n\r/g,"\n");}else{if(text.indexOf("\r")!= -1){text=text.replace(/\r/g,"");}}var multitext=(text.replace(/\\n/g,'\n')).split("\n");var linespace=this.linspace?this.linspace:10;var fontsize="";if(font){fontsize=font._size;}for(var i=0;i<multitext.length;i++ ){if(this._isEnableRedraw()){canvas_elem.drawFillText(multitext[i],x,multiliney);canvas_elem_tmp.drawFillText(multitext[i],x,multiliney);}multiliney+=Number(linespace)+Number(fontsize);}}}else{if(this._isEnableRedraw()){canvas_elem.drawFillText(text,x,multiliney);canvas_elem_tmp.drawFillText(text,x,multiliney);}}}};_pSketch._drawStroke=function(_style,mode,x,y,start){if(this._checkEditmode()==false||this.readonly){return;}if(this._apply_client_padding){this._delete_text();}var clientX=Number(x);var clientY=Number(y);if(this._currentPath[0]&&this._currentPath[0].tool!=mode){start=true;}if(start==true){this._initPath(this._path_style,mode,clientX,clientY);this._drawPath(clientX,clientY);}else{this._drawPath(clientX,clientY);this._endPath();}};_pSketch._showTextEditor=function(x,y,width,height,text){if(this._checkEditmode()==false){return;}var caretpos=0;var value=null;var sketchtextarea=this.sketchtextarea;var rettext=sketchtextarea.value;if(text){value=text;caretpos= -1;}else{value=rettext;}if(x>=0||x<0){sketchtextarea.set_left(x);}else{sketchtextarea.set_left(this._default_edit_x);}if(y>=0||x<0){sketchtextarea.set_top(y);}else{sketchtextarea.set_top(this._default_edit_y);}if(width>=0||x<0){sketchtextarea.set_width(Number(width));}else{sketchtextarea.set_width(Number(this._default_edit_width));}if(height>=0||x<0){sketchtextarea.set_height(Number(height));}else{sketchtextarea.set_height(Number(this._default_edit_height));}sketchtextarea.set_value(value);if(this._isEnableRedraw()){sketchtextarea.set_visible(true);sketchtextarea.setFocus(true);sketchtextarea.setCaretPos(caretpos);if(text!==undefined&&text!=""){if(text.length>0){sketchtextarea.setSelect(0,text.length);}}}return rettext;};_pSketch._hideTextEditor=function(clear){if(this._checkEditmode()==false){return;}var sketchtextarea=this.sketchtextarea;var rettext=sketchtextarea.value;if(clear){sketchtextarea.set_value(undefined);}if(this._isEnableRedraw()){sketchtextarea.set_visible(false);this._control_element.setElementFocus();}return rettext;};_pSketch._redrawPathData=function(path){this._clearCanvas(this._isEnableRedraw());if(this._image){this._loadSketch(this._image.src);}for(var n=0,length=path.length;n<length;n++ ){this._regenStroke(path[n],this._canvas_elem);this._regenStroke(path[n],this._canvas_elem_tmp);}};_pSketch._undoPathData=function(path){this._clearPathCanvas(this._isEnableRedraw());var _imgurl=this._imgurl;if(_imgurl){this._loadSketch(_imgurl);}for(var n=0,length=path.length;n<length;n++ ){this._regenStroke(path[n],this._canvas_elem);this._regenStroke(path[n],this._canvas_elem_tmp);}};_pSketch._redoPathData=function(path){for(var n=this._current_state,length=path.length;n<length;n++ ){this._regenStroke(path[n],this._canvas_elem);this._regenStroke(path[n],this._canvas_elem_tmp);}};_pSketch._drawBcurve=function(path,canavs_elem){var length=path.length-1;if(length<1){return;}for(var n=this._drawpathcount;n<length;n++ ){var p1=path[n];var p2=path[n+1];if(n==0){this._setupCanvasElem(canavs_elem,p1);}else{canavs_elem.moveTo(p1.x,p1.y);}canavs_elem.lineTo(p2.x,p2.y);}canavs_elem.stroke();};_pSketch._drawUserStroke=function(path,canavs_elem){var length=path.length-1;if(length<1){return;}for(var n=0;n<length;n++ ){var p1=path[n];var p2=path[n+1];if(n==0){this._setupCanvasElem(canavs_elem,p1,p2);canavs_elem.lineTo(p2.x,p2.y);canavs_elem.lineTo(p1.x,p1.y);}canavs_elem.lineTo(p2.x,p2.y);}canavs_elem.stroke();};_pSketch._setupCanvasElem=function(canavs_elem,p1){canavs_elem.beginPath();canavs_elem.setElementLineCap(p1.lineCap);canavs_elem.setElementGlobalCompositeOperation(p1.globalCompositeOperation);canavs_elem.moveTo(p1.x,p1.y);switch(p1.tool){case this._const_erase:case this._const_erase_user:canavs_elem.setElementStrokeStyle(this._default_stroke_style);canavs_elem.setElementLineWidth(p1.eraseWidth);break;case this._const_stroke:case this._const_stroke_user:default:canavs_elem.setElementStrokeStyle(p1.strokeStyle);if(p1.lineWidth){canavs_elem.setElementLineWidth(p1.lineWidth);}}};_pSketch._regenStroke=function(path,canavs_elem){if(this._isEnableRedraw()){var _path=this._clone(path);var tool=(this._is_undo&&_path[0].tool!=this._const_text)?this._const_stroke_user:_path[0].tool;switch(tool){case this._const_text:{var tmp=_path[0];this._drawText(tmp,tmp.x,tmp.y,tmp.text,true);}break;case this._const_stroke:case this._const_erase:{this._drawBcurve(_path,canavs_elem);}break;case this._const_stroke_user:case this._const_erase_user:{this._drawUserStroke(_path,canavs_elem);}break;}}};_pSketch._clone=function(obj){if(!obj||typeof (obj)!=='object'){return obj;}var temp=new obj.constructor();for(var key in obj){if(!obj[key]||typeof (obj[key])!=='object'){temp[key]=obj[key];}else{temp[key]=this._clone(obj[key]);}}return temp;};_pSketch._undo=function(){if(this._undoable()){this._current_state-- ;this._current_strokes=null;this._is_undo=true;var path=this._currentStrokes();this._clr_history=false;if(this._isEnableRedraw()){this._undoPathData(path);this._setRedoUndo();if(this._current_state== -1&&!this._image){this.on_apply_text(this.getDisplayText());}}this._clr_history=true;this._is_undo=false;}};_pSketch._redo=function(){if(this._redoable()){if(this._current_state== -1){this._delete_text();}this._current_state++ ;this._current_strokes=null;this._drawpathcount=0;this._clr_history=false;var path=this._currentStrokes();this._redoPathData(path);this._setRedoUndo();this._clr_history=true;if(this._current_state== -1&&!this._image){this.on_apply_text(this.getDisplayText());}}};_pSketch._redrawPath=function(){var path=this._currentStrokes();this._clr_history=false;this._drawpathcount=0;this._redrawPathData(path);this._setRedoUndo();this._clr_history=true;if(this._current_state== -1&&!this._image){this.on_apply_text(this.getDisplayText());}else{this._delete_text();}};_pSketch._checkEditmode=function(){if(this.editmode==this._const_none){return false;}return true;};_pSketch._clearCanvasElem=function(elem){if(elem){elem.clearRect(0,0,this._adjust_width,this._adjust_height);}};_pSketch._clearCanvas=function(bEnableRedaw){var canvas_elem=this._canvas_elem;var canvas_elem_tmp=this._canvas_elem_tmp;if(canvas_elem){this._clearCanvasElem(canvas_elem);}if(canvas_elem_tmp){this._clearCanvasElem(canvas_elem_tmp);}};_pSketch._clearPathCanvas=function(bEnableRedaw){var canvas_elem=this._canvas_elem;var canvas_elem_tmp=this._canvas_elem_tmp;if(canvas_elem){this._clearCanvasElem(canvas_elem);}if(canvas_elem_tmp){this._clearCanvasElem(canvas_elem_tmp);}};_pSketch._clear=function(flag){this._hideTextEditor(true);if(flag){this._clearCanvas(flag);}this._image=null;this._imgurl="";this._initHistory();this._setRedoUndo();this._startDrawStroke=true;this._set_value(null);};_pSketch._setRedoUndo=function(){this.redoable=this._redoable();this.undoable=this._undoable();};_pSketch._drawPath=function(x,y){var coords={};coords.x=x;coords.y=y;var canvas_elem=this._canvas_elem;if(!canvas_elem||!this._currentPath[0]){return;}var dest=canvas_elem;var tool=this._currentPath[0].tool;if(tool!=this._const_text&&!this._is_touch){this._delete_text();}switch(tool){case this._const_text:return;case this._const_erase:case this._const_erase_user:{}break;}this._currentPath.push(coords);this._regenStroke(this._currentPath,dest);this._regenStroke(this._currentPath,this._canvas_elem_tmp);this._drawpathcount=this._currentPath.length-1;};_pSketch._initPath=function(_style,_editmode,clientX,clientY,opt,clientwidth,clientheight,clienttext){if((this._currentPath[0]&&this._currentPath[0].tool)==this._const_stroke_user){this._endPath();}var style=this._clone(_style);var coords={};coords.x=clientX;coords.y=clientY;coords.beginPath=true;style.tool=_editmode;this._drawpathcount=0;var mode=this._const_composit_source_over;if(style.tool!=this._const_text&&this.sketchtextarea.visible){this._resetTextEdit(true);return;}switch(style.tool){case this._const_erase:case this._const_erase_user:mode=this._const_composit_destination_out;break;case this._const_text:{if(opt==null){if(this.sketchtextarea.visible){this._resetTextEdit(true);return;}else{this._showTextEditor(coords.x,coords.y,clientwidth,clientheight,clienttext);}}}break;case this._const_stroke:case this._const_stroke_user:default:break;}style.globalCompositeOperation=mode;for(var key in style){coords[key]=style[key];}this._currentPath=this._add({type:_editmode,stroke:[coords]});this._setRedoUndo();};_pSketch._resetTextEdit=function(arg){var sketchtextarea=this.sketchtextarea;if(sketchtextarea.visible==false){return;}var editval=sketchtextarea.value;this._hideTextEditor(true);if(editval&&arg){this._currentPath[0].text=editval;}else{this._undo();this._setRedoUndo();}sketchtextarea.set_left(this._default_edit_x);sketchtextarea.set_top(this._default_edit_y);};_pSketch._initHistory=function(){this._history=[];this._current_state= -1;this._freeze_state= -1;this._current_strokes=null;};_pSketch._add=function(action){if(this._current_state+1<this._history.length){this._history.splice(this._current_state+1,this._history.length-(this._current_state+1));}this._history.push(action);this._current_state=this._history.length-1;this._current_strokes=null;return action.stroke;};_pSketch._freeze=function(index){if(index===undefined){this._freeze_state=this._current_state;}else{this._freeze_state=index;}};_pSketch._undoable=function(){return (this._current_state> -1&&this._current_state>this._freeze_state);};_pSketch._redoable=function(){return this._current_state<this._history.length-1;};_pSketch._currentStrokes=function(){var cur_strokes=this._current_strokes;if(cur_strokes==null){var strokes=[];for(var i=0;i<=this._current_state;i++ ){var action=this._history[i];switch(action.type){case "init":case "json":case "strokes":case "batch":break;case "clear":strokes=[];break;case this._const_stroke:case this._const_stroke_user:case this._const_image:case this._const_erase:case this._const_erase_user:case this._const_text:default:strokes.push(action.stroke);break;}}cur_strokes=strokes;}this._current_strokes=cur_strokes;return cur_strokes;};_pSketch._delete_text=function(){if(!this._isEnableRedraw()){return;}this._apply_client_padding=false;if(this._text_elem){this._text_elem.destroy();this._text_elem=null;}};_pSketch._isParentdefaultprevented=function(comp,event_name){return true;};_pSketch._getClientXY=function(canvasX,canvasY){var border_left=0,border_top=0;var border=this._getCurrentStyleBorder();if(border){border_top=border._getBorderTopWidth();border_left=border._getBorderLeftWidth();}var clientX=canvasX-border_left;var clientY=canvasY-border_top-nexacro._getCurrentBodyScrollTop();return [clientX,clientY];};delete _pSketch;_pSketch=null;nexacro.SketchEditControl=function(id,left,top,width,height,right,bottom,minwidth,maxwidth,minheight,maxheight,parent){nexacro.TextArea.call(this,id,left,top,width,height,right,bottom,minwidth,maxwidth,minheight,maxheight,parent);};var _pSketchEditControl=nexacro._createPrototype(nexacro.TextArea,nexacro.SketchEditControl);nexacro.SketchEditControl.prototype=_pSketchEditControl;_pSketchEditControl._type_name="TextAreaControl";_pSketchEditControl.on_fire_sys_onlbuttondown=function(){nexacro.TextArea.prototype.on_fire_sys_onlbuttondown.call(this);return true;};_pSketchEditControl.on_fire_sys_ontouchstart=function(){nexacro.TextArea.prototype.on_fire_sys_ontouchstart.call(this);return true;};_pSketchEditControl.on_fire_onclick=function(){nexacro.TextArea.prototype.on_fire_onclick.call(this);return true;};_pSketchEditControl.on_fire_ontab=function(){nexacro.TextArea.prototype.on_fire_ontab.call(this);return true;};delete _pSketchEditControl;_pSketchEditControl=null;nexacro.ImageSketchBackground=function(target){nexacro.Image.call(target);this.parent=target;};var _pImageSketchBackground=nexacro._createPrototype(nexacro.Image,nexacro.ImageSketchBackground);nexacro.ImageSketchBackground.prototype=_pImageSketchBackground;_pImageSketchBackground.on_load=function(imageurl,width,height,handle,errstatus,temp,fireerrorcode,returncode,path,locationuri){this.width=width;this.height=height;var sketch=this.parent;if(errstatus<0){var errormsg="";if(fireerrorcode){errormsg=nexacro._GetSystemErrorMsg(this,fireerrorcode);}else{errormsg=nexacro._GetSystemErrorMsg(this,sketch._const_code_loadinvalidimage_msg).replace("%0",sketch._const_code_loadinvalidimage);}if(!locationuri){locationuri=sketch._getRefFormBaseUrl();}if(sketch._clr_history){sketch.on_fire_onerror(this,fireerrorcode,errormsg,sketch._const_errortype_obj,sketch._const_code_loadinvalidimage,imageurl,locationuri);}}else{if(handle){this.handle=handle;}var canvas_elem=sketch._canvas_elem;var sketch_image=sketch._image;if(canvas_elem&&sketch_image){if(sketch._isEnableRedraw()){canvas_elem.drawImage(sketch_image,0,0,width,height);if(sketch._canvas_elem_tmp){sketch._canvas_elem_tmp.drawImage(sketch_image,0,0,width,height);}sketch._setImageValue(sketch_image);}if(sketch._clr_history){sketch.on_fire_onload(this,imageurl);}}}};_pImageSketchBackground.set_src=function(v){if(this.src!=v){this.src=v;this.handle=nexacro._getImageObject(v,this.on_load,this,this.parent._getRefFormBaseUrl());if(this.handle){return true;}}else{var width=this.width;var height=this.height;var sketch=this.parent;var canvas_elem=sketch._canvas_elem;var sketch_image=sketch._image;if(canvas_elem&&sketch_image){if(sketch._isEnableRedraw()){canvas_elem.drawImage(sketch_image,0,0,width,height);if(sketch._canvas_elem_tmp){sketch._canvas_elem_tmp.drawImage(sketch_image,0,0,width,height);}return true;}}}return false;};delete _pImageSketchBackground;}
if(!nexacro.ExcelExportObject){nexacro.ExcelExportProgressEventInfo=function(obj,id,itemindex,itemtype,recordindex,errorobj){this.id=this.eventid=id||"onprogress";this.fromobject=obj;this.fromreferenceobject=errorobj;this.itemindex=itemindex;this.itemtype=itemtype;this.recordindex=recordindex;};var _pExportEventInfo=nexacro._createPrototype(nexacro.Event,nexacro.ExcelExportProgressEventInfo);nexacro.ExcelExportProgressEventInfo.prototype=_pExportEventInfo;_pExportEventInfo._type_name="ExcelExportProgressEventInfo";delete _pExportEventInfo;nexacro.ExcelExportEventInfo=function(obj,id,url,errorobj){this.id=this.eventid=id||"onsuccess";this.fromobject=obj;this.fromreferenceobject=errorobj;this.url=url;};var _pExcelExportEventInfo=nexacro._createPrototype(nexacro.Event,nexacro.ExcelExportEventInfo);nexacro.ExcelExportEventInfo.prototype=_pExcelExportEventInfo;_pExcelExportEventInfo._type_name="ExcelExportEventInfo";delete _pExcelExportEventInfo;nexacro.ExcelExportErrorEventInfo=function(obj,id,errortype,errormsg,errorobj,statuscode){this.id=this.eventid=id||"onerror";this.fromobject=obj;this.fromreferenceobject=errorobj;this.errortype=errortype;this.errormsg=errormsg;this.statuscode=statuscode;};var _pExportErrorEventInfo=nexacro._createPrototype(nexacro.ErrorEventInfo,nexacro.ExcelExportErrorEventInfo);nexacro.ExcelExportErrorEventInfo.prototype=_pExportErrorEventInfo;_pExportErrorEventInfo._type_name="ExcelExportErrorEventInfo";delete _pExportErrorEventInfo;nexacro.ExcelExportObject=function(name,parent){this.id=this.name=name;if(!parent){var app=nexacro.getApplication();if(app){parent=app.getActiveForm();if(!parent){var currwin=app.mainframe._window;var cur_focus_paths=currwin.getCurrentFocusPaths();var cur_focus_paths_len=(cur_focus_paths?cur_focus_paths.length:0);for(var i=0;i<cur_focus_paths_len;i++ ){var _comp=cur_focus_paths[i];if(!_comp){continue;}if(_comp._is_form){parent=_comp;break;}}}}}this.parent=parent;this._grids=[];this._dataset=[];this._xml=[];this.onsuccess=new nexacro.EventListener("onsuccess");this.onprogress=new nexacro.EventListener("onprogress");this.onerror=new nexacro.EventListener("onerror");this._hidden_frame_handle=null;nexacro._create_hidden_frame("",this.on_complete_download,this,"export");};var _pExcelExport=nexacro.ExcelExportObject.prototype=nexacro._createPrototype(nexacro._EventSinkObject,nexacro.ExcelExportObject);_pExcelExport._type_name="ExportObject";_pExcelExport.activepagename="";_pExcelExport.exportactivemode="noactive";_pExcelExport.exporteventtype="itemrecord";_pExcelExport.exportfilename="";_pExcelExport.exportfilpath="";_pExcelExport.exportmessagealert="";_pExcelExport.exportmessagecomplete="";_pExcelExport.exportmessageprocess="";_pExcelExport.exportmessageready="";_pExcelExport.exportopenmode="noopen";_pExcelExport._exporttype=nexacro.ExportTypes.EXCEL;_pExcelExport.exporttype=nexacro.ExportTypes.EXCEL;_pExcelExport.exportuitype="none";_pExcelExport.templatefilename="";_pExcelExport.commdataformat="";_pExcelExport.commcompress="none";_pExcelExport.exporturl="";_pExcelExport.transferrowcount=500;_pExcelExport.exportfilepasswrod="";_pExcelExport.exportwordwrap=true;_pExcelExport.filefilter="";_pExcelExport.filefilterindex=0;_pExcelExport._exportuitype=0;_pExcelExport._exporturl="";_pExcelExport._commcompress=false;_pExcelExport._commdataformat=2;_pExcelExport._allRowCount=0;_pExcelExport._progress_pos=0;_pExcelExport._uniqueIndex=0;_pExcelExport._fileURL="";_pExcelExport._itemsIndex=0;_pExcelExport._argsParam=null;_pExcelExport._argsDsParam=null;_pExcelExport._orgval_type=0;_pExcelExport._file_password=null;_pExcelExport._wrap_text=true;_pExcelExport._filedownload=true;_pExcelExport._righttoleft=true;_pExcelExport._exportBar=null;_pExcelExport._tempSaveMethod=null;_pExcelExport.excelTypeTable={EXCEL:0x0100,EXCEL97:0x0110,EXCEL2007:0x0120,HANCELL2010:0x0400,HANCELL2014:0x0410,CSV:0x0500,256:0x0100,272:0x0110,288:0x0120,1024:0x0400,1040:0x0410,1280:0x0500};_pExcelExport._event_list={"onsuccess":1,"onerror":1,"onprogress":1};_pExcelExport.on_created=nexacro._emptyFn;_pExcelExport.set_templatefilename=function(v){if(v!=this.templatefilename){this.templatefilename=v;}return v;};_pExcelExport.set_commdataformat=function(v){if(v!=this.commdataformat){this.commdataformat=v;switch(v.toString().toUpperCase()){case "XML":this._commdataformat=0;break;case "BINARY":this._commdataformat=1;break;case "CSV":this._commdataformat=3;break;default:this._commdataformat=2;break;}}return v;};_pExcelExport.set_commcompress=function(v){if(v!=this.commcompress){this.commcompress=v;if(v.toString().toUpperCase()=="COMPRESS"){this._commcompress=true;}else{this._commcompress=false;}}return v;};_pExcelExport.set_exporturl=function(v){if(v!=this.exporturl){this.exporturl=this._exporturl=v;if(v){this._exporturl=nexacro._getServiceLocation(v,this.parent._getFormBaseUrl(),null,false);}}return v;};_pExcelExport.set_exporttype=function(v){if(v!=this.exporttype){this.exporttype=v;var export_type=this.excelTypeTable[(v+"").toUpperCase()];if(!export_type){export_type=256;}this._exporttype=export_type;}return v;};_pExcelExport.set_activepagename=function(v){if(v!=this.activepagename){this.activepagename=v;}return v;};_pExcelExport.set_exportactivemode=function(v){if(v!=this.exportactivemode){this.exportactivemode=v;}return v;};_pExcelExport.set_exporteventtype=function(v){if(v!=this.exporteventtype){this.exporteventtype=v;}return v;};_pExcelExport.set_exportopenmode=function(v){if(v!=this.exportopenmode){this.exportopenmode=v;}return v;};_pExcelExport.set_exportfilename=function(v){v=v+"";if(v!=this.exportfilename){this.exportfilename=v;}return v;};_pExcelExport.set_exportfilepath=function(v){if(v!=this.exportfilepath){this.exportfilepath=v;}return v;};_pExcelExport.set_exportmessagealert=function(v){if(v!=this.exportmessagealert){this.exportmessagealert=v;}return v;};_pExcelExport.set_exportuitype=function(v){if(v!=this.exportuitype){this.exportuitype=v;switch(v){case "exportprogress":this._exportuitype=1;break;case "statusbar":this._exportuitype=2;break;default:this._exportuitype=0;break;}}return v;};_pExcelExport.set_exportmessageready=function(v){if(v!=this.exportmessageready){this.exportmessageready=v;}return v;};_pExcelExport.set_exportmessageprocess=function(v){if(v!=this.exportmessageprocess){this.exportmessageprocess=v;}return v;};_pExcelExport.set_exportmessagecomplete=function(v){if(v!=this.exportmessagecomplete){this.exportmessagecomplete=v;}return v;};_pExcelExport.set_transferrowcount=function(v){this.transferrowcount=nexacro._toInt(v);};_pExcelExport.set_exportfilepassword=function(v){if(v!=this.exportfilepassword){this.exportfilepassword=v;}};_pExcelExport.set_exportwordwrap=function(v){if(v!=this.exportwordwrap){this.exportwordwrap=v;}};_pExcelExport.set_filefilter=function(v){this.filefilter=v;};_pExcelExport.set_filefilterindex=function(v){this.filefilterindex=v;};_pExcelExport.addExportItem=function(type,item){var size= -1;var eItem;var use_arg_len=arguments.length;var arrOrgValueTypeCellindex=null;var orgvalue_cells=[];var orgvalue_param_idx=arguments.length-1;if(nexacro._isArray(arguments[orgvalue_param_idx])){use_arg_len-- ;arrOrgValueTypeCellindex=arguments[orgvalue_param_idx];}if(arrOrgValueTypeCellindex){for(var i=0;i<arrOrgValueTypeCellindex.length;i++ ){orgvalue_cells[(arrOrgValueTypeCellindex[i]|0)]=true;}}if(use_arg_len==2){if(type&&item&&item instanceof nexacro.ExportItem){eItem=item;eItem.parent=this;eItem._setEventHandler("onprogress",this.on_notify_onprogress,this);eItem._setEventHandler("onsuccess",this.on_notify_onsuccess,this);eItem._setEventHandler("onerror",this.on_notify_onerror,this);eItem._orgvalue_cells=orgvalue_cells;}else{return  -1;}}else{if(type&&item&&type==this._getItemType(item)){eItem=new nexacro.ExportItem(this.id+"item"+this._uniqueIndex++ ,this);eItem._setEventHandler("onprogress",this.on_notify_onprogress,this);eItem._setEventHandler("onsuccess",this.on_notify_onsuccess,this);eItem._setEventHandler("onerror",this.on_notify_onerror,this);eItem._orgvalue_cells=orgvalue_cells;switch(use_arg_len){case 11:case 10:arguments[9]&&eItem.set_exportsize(arguments[9]);case 9:arguments[8]&&eItem.set_exceptstyle(arguments[8]);case 8:arguments[7]&&eItem.set_exportimage(arguments[7]);case 7:arguments[6]&&eItem.set_exportvalue(arguments[6]);case 6:arguments[5]&&eItem.set_exportmerge(arguments[5]);case 5:arguments[4]&&eItem.set_exportselect(arguments[4]);case 4:arguments[3]&&eItem.set_exporthead(arguments[3]);case 3:arguments[2]&&eItem.set_range(arguments[2]);case 2:arguments[1]&&eItem.set_source(arguments[1]);break;}}else{return  -1;}}switch(type){case nexacro.ExportItemTypes.GRID:eItem.set_type(type);size=this._grids.push(eItem)-1;eItem._righttoleft=eItem.source._isRtl();break;case nexacro.ExportItemTypes.DATA:break;case nexacro.ExportItemTypes.XML:break;}return size;};_pExcelExport.clear=function(){var count=0;count+=this._grids.length;count+=this._dataset.length;count+=this._xml.length;for(var i=0,len=this._grids.length;i<len;i++ ){var item=this._grids.pop();if(item){item._clear();}}this._grids=[];this._dataset=[];this._xml=[];return count;};_pExcelExport.clearExportItems=function(type){var length;if(type==nexacro.ExportItemTypes.GRID){length=this._grids.length;for(var i=0;i<length;i++ ){var item=this._grids.pop();if(item){item._clear();}}this._grids=[];}if(length==0){this._uniqueIndex=0;}return length;};_pExcelExport.count=function(){var count=0;count+=this._grids.length;count+=this._dataset.length;count+=this._xml.length;return count;};_pExcelExport.countExportItems=function(type){var count=0;if(type==nexacro.ExportItemTypes.GRID){count+=this._grids.length;}return count;};_pExcelExport.delExportItem=function(type,index){var isDelete=false;if(type==nexacro.ExportItemTypes.GRID){if(this._grids.splice(index,1).length>0){isDelete=true;}}return isDelete;};_pExcelExport.getExportItem=function(type,index){var item=null;if(type==nexacro.ExportItemTypes.GRID){item=this._grids[index];}return item?item:null;};_pExcelExport.setExportItem=function(type,index,item){if(!item||!(item instanceof nexacro.ExportItem)){return false;}var reVal=false;if(type==nexacro.ExportItemTypes.GRID){if(index> -1&&index<this._grids.length){item.parent=this;this._grids[index]=item;reVal=true;}}return reVal;};_pExcelExport.exportItems=function(type){var g_len= -1;if(!this.exporturl){return g_len;}if(type==nexacro.ExportItemTypes.GRID){var grid_items=this._grids;g_len=this._gCount=grid_items.length;this._allCount=g_len;if(g_len>0){if(this.exportmessagealert!=""){nexacro.alert(this.exportmessagealert);}grid_items[0]._gridItemExport(this);}}return g_len;};_pExcelExport.exportDataEx=function(argsParam,argsDsParam,bFileDownload){this._is_export_ex=true;var retn=this.exportData(argsParam,argsDsParam,0,bFileDownload);this._is_export_ex=false;return retn;};_pExcelExport.exportData=function(argsParam,argsDsParam,nOrgValueType,bFileDownload){this._argsParam=argsParam;this._argsDsParam=argsDsParam;if(typeof nOrgValueType=="string"){nOrgValueType=nOrgValueType.toLowerCase();switch(nOrgValueType){case "false":case "0":this._orgval_type=0;break;case "true":case "1":this._orgval_type=1;break;case "2":this._orgval_type=2;break;default:this._orgval_type=0;break;}}else if(typeof nOrgValueType=="number"){nOrgValueType=nexacro._toInt(nOrgValueType);if(nOrgValueType<0||nOrgValueType>2){this._orgval_type=0;}else{this._orgval_type=nOrgValueType;}}else{if(nOrgValueType===true||nOrgValueType===false){this._orgval_type=nOrgValueType?1:0;}else{this._orgval_type=0;}}this._filedownload=(bFileDownload!==undefined)?!!bFileDownload:true;var i;this._file_password=null;if(this.exportfilepassword){this._file_password=this.exportfilepassword;}if(this.exportwordwrap!==""){var wordwrap=nexacro._toBoolean(this.exportwordwrap);if(wordwrap!=this._wrap_text){this._wrap_text=wordwrap;}}var ret= -1;if(!this.exporturl){return ret;}var grid_items=this._grids;var g_len=this._gCount=grid_items.length;this._allCount=g_len;if(this._allCount>0&&this.exportmessagealert!=""){nexacro.alert(this.exportmessagealert);}for(i=0;i<g_len;i++ ){this._allRowCount+=grid_items[i].source._getGridRowCount();}if(g_len>0){grid_items[0]._gridItemExport(this);}return this.count();};_pExcelExport.destroy=function(){var exportbar=this._exportBar;if(exportbar){exportbar.destroy();}for(var i=0,len=this._grids.length;i<len;i++ ){var item=this._grids.pop();if(item){item._clear();}}this._grids=null;this._dataset=null;this._grids=null;this._dataset=null;this._excel_suppress_info=null;this._merge_datas=null;this._xml.length=0;if(this.parent){this.parent.removeChild(this.id);}nexacro._EventSinkObject.prototype.destroy.call(this);return true;};_pExcelExport.on_fire_onprogress=function(obj,e){var event=this.onprogress;if(event&&event._has_handlers){event._fireEvent(this,e);}};_pExcelExport.on_fire_onsuccess=function(obj,e){var event=this.onsuccess;if(event&&event._has_handlers){event._fireEvent(this,e);}};_pExcelExport.on_fire_onerror=function(obj,e){var event=this.onerror;var ret;if(event&&event._has_handlers){ret=event._fireEvent(this,e);}return ret;};_pExcelExport.on_notify_onprogress=function(obj,e){this.on_fire_onprogress(obj,e);return false;};_pExcelExport.on_notify_onsuccess=function(obj,e){this.on_fire_onsuccess(obj,e);return false;};_pExcelExport.on_notify_onerror=function(obj,e){this.on_fire_onerror(obj,e);return false;};_pExcelExport.on_complete_download=function(status,data,url,errcode,httpcode,errmsg){if(status>=0){if(this.exportactivemode=="active"){nexacro._execShell(data);}}};_pExcelExport._getItemType=function(item){var rt;switch(item&&item._type_name){case "Grid":rt=nexacro.ExportItemTypes.GRID;break;case "Dataset":break;case "Xml":break;default:if(item instanceof nexacro.Grid){rt=nexacro.ExportItemTypes.GRID;}break;}return rt;};_pExcelExport._getProcessStr=function(item,itemrecord,totalrecord){var str="";str=this.exportmessageprocess.replace("%d",item);str=str.replace("%d",itemrecord);str=str.replace("%d",totalrecord);return str;};_pExcelExport._getForm=function(){if(this.parent instanceof nexacro.Form){return this.parent;}return null;};_pExcelExport._getExportBar=function(uiType){var form=this._getForm();var pbar_name="_exportBar";var obj=form[pbar_name];if(obj){obj.destroy();}obj=new nexacro.ExportProgress(pbar_name,0,0,10,10,null,null,null,null,null,null,form);form.addChild(obj.name,obj);obj._uitype=uiType;if(obj.createComponent(true)){obj.on_created();}return obj;};delete _pExcelExport;nexacro.ExportItem=function(name,parent){this.id=this.name=name;this.parent=parent||null;this._merge_datas=null;this._gridTempInfo=null;this._tmpSuppressInfos=undefined;this._stylecache={};this._excel_suppress_info={};this._style_map1=null;this._style_map2=null;this._ds_style2=null;this._ds_style=null;this._ds_cell=null;this._ds_response=null;this._load_manager=null;this._orgvalue_cells=null;};var _pExportItem=nexacro.ExportItem.prototype=nexacro._createPrototype(nexacro._EventSinkObject,nexacro.ExportItem);_pExportItem._type_name="ExportItem";_pExportItem.exceptstyle="none";_pExportItem.exporthead="allband";_pExportItem._exporthead="";_pExportItem.exportimage="none";_pExportItem.exportmerge="suppress";_pExportItem._exportmerge=1;_pExportItem.exportselect="allrecord";_pExportItem.exportvalue="allstyle";_pExportItem.exportsize="width";_pExportItem.range="";_pExportItem.source="";_pExportItem.type="";_pExportItem._applyA=true;_pExportItem._applyB=true;_pExportItem._applyC=true;_pExportItem._applyF=true;_pExportItem._applyHead=true;_pExportItem._applySumm=true;_pExportItem._applyL=true;_pExportItem._d_BLColor="";_pExportItem._seq=1;_pExportItem._preStartRow=0;_pExportItem._startRow=0;_pExportItem._eof=false;_pExportItem._instanceId="";_pExportItem._a_ct=0;_pExportItem._bg_ct=0;_pExportItem._c_ct=0;_pExportItem._f_ct=0;_pExportItem._l_ct=0;_pExportItem._t_ct=0;_pExportItem._sm_ct=0;_pExportItem._g_ct=0;_pExportItem._s_ct=0;_pExportItem._selectcount=0;_pExportItem._righttoleft=false;_pExportItem._event_list={"onsuccess":1,"onprogress":1,"onerror":1};_pExportItem._suppress_align_table={"first":"top","first,over":"top","middle":"middle","middle,over":"middle","last":"bottom","last,over":"bottom"};_pExportItem._clear=function(){if(this._ds_style2){this._ds_style2.destroy();this._ds_style2=null;delete this._ds_style2;}if(this._ds_style){this._ds_style.destroy();this._ds_style=null;delete this._ds_style;}if(this._style_map1){this._style_map1=null;}if(this._style_map2){this._style_map2=null;}if(this._ds_command){this._ds_command.destroy();this._ds_command=null;delete this._ds_command;}if(this._ds_cell){this._ds_cell.destroy();this._ds_cell=null;delete this._ds_cell;}if(this._ds_response){this._ds_response.destroy();this._ds_response=null;delete this._ds_response;}if(this._load_manager){this._load_manager.destroy();this._load_manager=null;delete this._load_manager;}if(this._merge_datas){this._merge_datas=null;}if(this._stylecache){this._stylecache=null;}if(this.source){this.source=null;}if(this._gridTempInfo){this._gridTempInfo=null;}if(this._excel_suppress_info){this._excel_suppress_info=null;}if(this._tmpSuppressInfos){this._tmpSuppressInfos=null;}this._righttoleft=false;this._orgvalue_cells=null;};_pExportItem.set_exceptstyle=function(v){if(v!=this.exceptstyle){var chkExceptstyle=0;var except=v.replace(/ /g,"").split(",");var eLen=except.length;for(var i=0;i<eLen;i++ ){switch(except[i].toLowerCase()){case "align":this._applyA=false;chkExceptstyle+=1;break;case "background":this._applyB=false;chkExceptstyle+=1;break;case "color":this._applyC=false;chkExceptstyle+=1;break;case "font":this._applyF=false;chkExceptstyle+=1;break;case "border":this._applyL=false;chkExceptstyle+=1;break;case "none":this._applyA=true;this._applyB=true;this._applyC=true;this._applyF=true;this._applyL=true;chkExceptstyle+=1;break;}}if(eLen===chkExceptstyle){this.exceptstyle=v;}}return v;};_pExportItem.set_exporthead=function(v){if(v!=this.exporthead){this.exporthead=v;var except=v.replace(/ /g,"").split(",");var eLen=except.length;for(var i=0;i<eLen;i++ ){switch(except[i].toLowerCase()){case "nohead":this._applyHead=false;break;case "nosumm":this._applySumm=false;break;default:this._applySumm=true;this._applySumm=true;break;}}}if(!this._applyHead||!this._applySumm){if(!this._applyHead&&!this._applySumm){this._exporthead="nohead, nosumm";}else if(!this._applyHead){this._exporthead="nohead";}else{this._exporthead="nosumm";}}else{this._exporthead="allband";}return v;};_pExportItem.set_exportimage=function(v){if(v!=this.exportimage){this.exportimage=v;}return v;};_pExportItem.set_exportmerge=function(v){if(v!=this.exportmerge){this.exportmerge=v;switch(v){case "nosuppress":this._exportmerge=0;break;case "merge":this._exportmerge=2;break;default:this._exportmerge=1;break;}}return v;};_pExportItem.set_exportselect=function(v){if(v!=this.exportselect){this.exportselect=v;}return v;};_pExportItem.set_exportvalue=function(v){if(v!=this.exportvalue){this.exportvalue=v;}return v;};_pExportItem.set_range=function(v){if(v!=this.range){this.range=v;}return v;};_pExportItem.set_source=function(v){if(v!=this.source){this.source=v;}return v;};_pExportItem.set_type=function(v){if(v!=this.type){this.type=v;}return v;};_pExportItem.set_exportsize=function(v){if(v!=this.exportsize){this.exportsize=v;}return v;};_pExportItem.on_fire_onprogress=function(obj,itemindex,itemtype,recordindex){var event=this.parent.onprogress;if(event&&event._has_handlers){var evt=new nexacro.ExcelExportProgressEventInfo(obj,"onprogress",itemindex,itemtype,recordindex,this);event._fireEvent(this,evt);}};_pExportItem.on_fire_onsuccess=function(obj,referObj,url){var event=this.parent.onsuccess;if(event&&event._has_handlers){var evt=new nexacro.ExcelExportEventInfo(obj,"onsuccess",url,this);event._fireEvent(this,evt);}};_pExportItem.on_fire_onerror=function(obj,errortype,errormsg,statuscode){var event=this.parent.onerror;if(event&&event._has_handlers){var evt=new nexacro.ExcelExportErrorEventInfo(obj,"onerror",errortype,errormsg,this,statuscode);event._fireEvent(this,evt);}};_pExportItem._getWindow=function(){var excelexport=this.parent;if(excelexport){var form=excelexport.parent;if(form._is_form){return form._getWindow();}}return null;};_pExportItem._getWindowHandle=function(){var excelexport=this.parent;if(excelexport){var form=excelexport.parent;if(form._is_form){return form._getWindowHandle();}}return null;};_pExportItem._getCellStyle=function(cell,rowIdx,odd,sn,status){var cellStyleinfo;var userstatus=status==true?"selected":undefined;switch(sn){case "align":cellStyleinfo=cell._query_status_align(rowIdx,cell.displaytype,userstatus);break;case "background":cellStyleinfo=cell._query_status_background(rowIdx,userstatus);break;case "border":cellStyleinfo=cell._query_status_border(rowIdx,userstatus);cellStyleinfo=nexacro.BorderObject(cellStyleinfo);break;case "color":cellStyleinfo=cell._query_status_color(rowIdx,userstatus);break;case "font":cellStyleinfo=cell._query_status_font(rowIdx,userstatus);break;case "textDecoration":cellStyleinfo=cell._grid._getCellStyleInfo(cell._cellidx,"textDecoration",rowIdx,userstatus);if(cellStyleinfo){cellStyleinfo=cellStyleinfo.match(/underline|line-through/g);if(cellStyleinfo){cellStyleinfo=cellStyleinfo.join(",");cellStyleinfo=cellStyleinfo.replace("line-through","strikeout");}}break;}return cellStyleinfo;};_pExportItem._getCellText=function(source,rowidx,cellidx,subcellidx){var celltext;if(source&&source instanceof nexacro.Grid){var band;if(rowidx== -1){band="head";}else if(rowidx== -2){band="summ";}else{band="body";}var export_obj=this.parent;var display_type=source.getCellProperty(band,cellidx,"displaytype");var orgv_cells=this._orgvalue_cells;var isdecorate=false;if(display_type=="decoratetext"){isdecorate=true;}if(source.getSubCellCount(band,cellidx)){if(subcellidx==undefined){return null;}if(orgv_cells[cellidx]){celltext=source.getSubCellValue(rowidx,cellidx,subcellidx);}else if(export_obj._orgval_type){if(export_obj._orgval_type!=2||(export_obj._orgval_type==2&&display_type!="date")){celltext=source.getSubCellValue(rowidx,cellidx,subcellidx);isdecorate=false;}else{celltext=source.getSubCellText(rowidx,cellidx,subcellidx);}}else{celltext=source.getSubCellText(rowidx,cellidx,subcellidx);}}else{if(orgv_cells[cellidx]){celltext=source.getCellValue(rowidx,cellidx);}else if(export_obj._orgval_type){if(export_obj._orgval_type!=2||(export_obj._orgval_type==2&&display_type!="date")){celltext=source.getCellValue(rowidx,cellidx);isdecorate=false;}else{celltext=source.getCellText(rowidx,cellidx);}}else{celltext=source.getCellText(rowidx,cellidx);}}if(isdecorate){celltext=nexacro._getDisplayTextfromDecorateText(celltext);}}return celltext;};_pExportItem._getCellLocale=function(cell,rowidx){var locale=cell?cell._getLocale(rowidx):"";if(!locale){locale=nexacro._locale?nexacro._locale:nexacro._getLocale();}locale=locale.replace(/-/g,"_");return locale;};_pExportItem._find_styleName=function(dataset,type,value,count,startRow){var style_map;if(dataset.id=="STYLE"){style_map=this._style_map1;if(!style_map){style_map=this._style_map1={};}}else if(dataset.id=="STYLE2"){style_map=this._style_map2;if(!style_map){style_map=this._style_map2={};}}var style_arr;if(style_map){style_arr=style_map[type];}else{style_map={};}if(!style_arr){style_arr=style_map[type]=[];}var len=style_arr.length;var style_name,val;if(len>0){for(var i=0;i<len;i++ ){val=style_map[type][i].value;if(value==val){style_name=style_map[type][i].name;break;}}}if(!style_name){style_name=type+( ++count);style_map[type][len]={value:value,name:style_name};var r_count=dataset.getRowCount();dataset.addRow();dataset.setColumn(r_count,"type",type);dataset.setColumn(r_count,"name",style_name);var delimiter=String.fromCharCode(29);if(value){val=value.toString();var extra_value=val.split(delimiter);if(extra_value.length>1){value=extra_value[0];var locale=extra_value[1];dataset.setColumn(r_count,"locale",locale);}}dataset.setColumn(r_count,"value",value);}return [style_name,count];};_pExportItem._getFitValue=function(obj){if(!obj){return;}var str=this._fontParseInfo(obj._sysvalue);return str;};_pExportItem._getFitFontValue=function(fontval){var size=this._default_size,face=this._default_face,type;var unit;if(fontval){var font=new nexacro._FontObject(fontval);font._parseInfo(fontval);size=font.size;type=font.type;face=font.face;unit=font._unit;if(unit=="px"){size=parseInt(nexacro._convertPxToPt(size));}}return type+","+size+","+face;};_pExportItem._getHEXtoRGB=function(color){var rgb="transparent";if(color){if(typeof color=="object"){rgb=this._getHexColor(color.value.split(" ")[0]);}else if(typeof (color)=="string"&&(color.indexOf("rgb(")>=0)||(color.indexOf("RGB(")>=0)){rgb="rgbstring";}else if(typeof (color)=="string"&&(color.indexOf("rgba(")>=0)||(color.indexOf("RGBA(")>=0)){rgb="rgbastring";}else{rgb=this._getHexColor(color);}var style_a=[];if(rgb===""){rgb=color._value;}else{if(rgb.indexOf("#")> -1){style_a.push(parseInt(rgb.substring(1,3),16));style_a.push(parseInt(rgb.substring(3,5),16));style_a.push(parseInt(rgb.substring(5,7),16));rgb=style_a.join(",");}else if(rgb=="rgbstring"){color=color.substring(4,17);color=color.split(",");for(var i=0;i<color.length;i++ ){color[i]=parseInt(color[i]);}rgb=color.join(",");}else if(rgb=="rgbastring"||rgb=="transparent"){rgb="transparent";}else{var start=rgb.indexOf("(");var end=rgb.indexOf(")");style_a=rgb.substring(start+1,end-1).split(",");style_a.pop();rgb=style_a.join(",");}}}return rgb;};_pExportItem._makeforDsStyle=function(ds_style,align,background,color,font,line,cell_type,row_merge,col_merge){var rt,style_name="";var cellStyleinfo="";if(this._applyA){rt=this._find_styleName(ds_style,"align",align,this._a_ct);style_name=rt[0];this._a_ct=rt[1];cellStyleinfo+="align:"+style_name+",";}if(this._applyB){rt=this._find_styleName(ds_style,"background",background,this._bg_ct);style_name=rt[0];this._bg_ct=rt[1];cellStyleinfo+="background:"+style_name+",";}if(this._applyC){rt=this._find_styleName(ds_style,"color",color,this._c_ct);style_name=rt[0];this._c_ct=rt[1];cellStyleinfo+="color:"+style_name+",";}if(this._applyF){rt=this._find_styleName(ds_style,"font",font,this._f_ct);style_name=rt[0];this._f_ct=rt[1];cellStyleinfo+="font:"+style_name+",";}line=line.replace(/transparent,[^:]*/g,"empty");rt=this._find_styleName(ds_style,"line",line,this._l_ct);style_name=rt[0];this._l_ct=rt[1];cellStyleinfo+="line:"+style_name+",";rt=this._find_styleName(ds_style,"type",cell_type,this._t_ct);style_name=rt[0];this._t_ct=rt[1];cellStyleinfo+="type:"+style_name;if(row_merge>1){rt=this._find_styleName(ds_style,"rowsuppress",row_merge,this._sm_ct);style_name=rt[0];this._sm_ct=rt[1];cellStyleinfo+=",rowsuppress:"+style_name;}if(col_merge>1){rt=this._find_styleName(ds_style,"colsuppress",col_merge,this._sm_ct);style_name=rt[0];this._sm_ct=rt[1];cellStyleinfo+=",colsuppress:"+style_name;}rt=this._find_styleName(ds_style,"style",cellStyleinfo,this._s_ct);style_name=rt[0];this._s_ct=rt[1];return style_name;};_pExportItem._checkExpr=function(obj,cssclass){if(cssclass&&cssclass._bindtype>0){return true;}if(obj&&obj._bindtype>0){return true;}return false;};_pExportItem._checkGradation=function(background){return false;};_pExportItem._getHexColor=function(color){var v=nexacro._xreNamedColorList[color];if(v){return v;}var len=color.length;if(color.substring(0,1)=='#'){if(len==7){return color;}if(len>7){return color.substr(0,7);}}if(color.substring(0,2)=="0x"){if(len==8){return "#"+color.substring(2);}if(len==10){return "#"+color.substring(2,8);}}return "";};_pExportItem._getGradationColor=function(gradation){var gColor;var gColor2;var gArr=[];if(gradation){gColor=gradation._value;if(gColor!=""){gColor=this._getHexColor(gradation.start_color);gColor2=this._getHexColor(gradation.end_color);if(gColor.indexOf("#")> -1){var name=gColor+gColor2;if(this._stylecache[name]){return this._stylecache[name];}else{gArr.push(Math.round((parseInt(gColor.substring(1,3),16)+parseInt(gColor2.substring(1,3),16))/2));gArr.push(Math.round((parseInt(gColor.substring(3,5),16)+parseInt(gColor2.substring(3,5),16))/2));gArr.push(Math.round((parseInt(gColor.substring(5),16)+parseInt(gColor2.substring(5),16))/2));gColor=gArr.join(",");this._stylecache[name]=gColor;}}return gColor;}}return "";};_pExportItem._getCellBodyStyle=function(cell,idx){var align,background,background2,color,color2,font,line,gradation2,c_style,c_style2,_background2,_color2;var ds_style=this._ds_style;var flag=false;var viewType=cell.displaytype._value;var _linestyle="empty:empty:empty:empty";var linecolor={vertical:"empty",horizon:"empty"};align=cell._query_status_align(0,viewType);if(align==","){align="left,";}background=cell._query_status_background(0);color=cell._query_status_color(0);font=cell._query_status_font(0);if(this._applyL){line=cell._query_status_border(0);line=nexacro.BorderObject(line);}background2=cell._query_status_background(1);color2=cell._query_status_color(1);var _background;var _align=align;if(this._checkGradation(background)){}else{_background=this._getHEXtoRGB(background);}var _color=this._getHEXtoRGB(color);var _font=nexacro._nvl(this._getFitFontValue(font),"");var textdecoration=this._getCellStyle(cell,0,false,"textDecoration","enabled");if(textdecoration){_font=textdecoration+","+_font;}if(this._applyL&&line){if(line.right&&line.right.style!="none"&&line.right._width!=0){linecolor.vertical=this._getHEXtoRGB(line.right.color)+(line.right.style=="solid"?"":","+line.right.style);linecolor.horizon=this._getHEXtoRGB(line.bottom.color)+(line.bottom.style=="solid"?"":","+line.bottom.style);if(this._applyHead){_linestyle=(cell._col==0?linecolor.vertical:"empty")+":"+"empty"+":";}else{_linestyle=(cell._col==0?linecolor.vertical:"empty")+":"+(cell._row==0?linecolor.horizon:"empty")+":";}_linestyle+=linecolor.vertical+":"+linecolor.horizon;}}if(this._checkExpr(align,cell.cssclass)){_align=undefined;}else{this._stylecache[idx+"align"]=_align;}if(this._checkExpr(background,cell.cssclass)){_background=undefined;}else{this._stylecache[idx+"background0"]=_background;}if(this._checkExpr(color,cell.cssclass)){_color=undefined;}else{this._stylecache[idx+"color0"]=_color;}if(this._checkExpr(font,cell.cssclass)){_font=undefined;}else{this._stylecache[idx+"font"]=_font;}if(this._checkExpr(line,cell.cssclass)){}else{this._stylecache[idx+"line"]=_linestyle;}if(background2){if(this._checkGradation(background2)){gradation2=cell._stylecache.gradationtruefalsenormal;if(!gradation2){gradation2=cell.style.gradation2;if(!gradation2){gradation2=cell._query_pseudo_gradation(0,true,false,"enabled");}}_background2=this._getGradationColor(gradation2);}else{_background2=this._getHEXtoRGB(background2);}if(this._checkExpr(background2,cell.cssclass)){_background2=undefined;}else{this._stylecache[idx+"background1"]=_background2;}if(_background!=_background2){flag=true;}}else{this._stylecache[idx+"background1"]=_background2=_background;}if(color2){_color2=this._getHEXtoRGB(color2);if(this._checkExpr(color2,cell.cssclass)){_color2=undefined;}else{this._stylecache[idx+"color1"]=_color2;}if(_color!=_color2){flag=true;}}else{this._stylecache[idx+"color1"]=_color2=_color;}var cell_type=this._getFixedCellType(cell,0);c_style=this._makeforDsStyle(ds_style,_align,_background,_color,_font,_linestyle,cell_type);if(flag){c_style2=this._makeforDsStyle(ds_style,_align,_background2,_color2,_font,_linestyle,cell_type);}var subCell=cell._subcells;var subL=subCell.length;if(subL){var subCellFormat="";for(var i=0;i<subL;i++ ){subCellFormat+=this._modifyFormat(subCell[i],c_style,c_style2,0,cell);}return subCellFormat;}else{return this._modifyFormat(cell,c_style,c_style2,0);}};_pExportItem._getFixedCellType=function(cell,rowidx){var cell_type=cell._getDisplaytype(rowidx);var displaytype="";var format;var exportObj=this.parent;if(exportObj._is_export_ex){if(!this._orgvalue_cells[cell._cellidx]){return "text";}}switch(cell_type){case "number":break;case "maskeditcontrol":case "mask":format=cell._getAttrValue(cell.maskeditformat,rowidx);if(format!=null&&format.length!=0){displaytype=format;}var masktype=cell._getAttrValue(cell.maskedittype,rowidx);if(masktype=="number"){cell_type="number";}else{cell_type="text";}break;case "calendarcontrol":case "date":case "time":case "datetime":cell_type="date";var locale;format=cell._getAttrValue(cell.calendardateformat,rowidx);if(format==null||format.length==0||!format.match(/LONGDATE|SHORTDATE|[yMdHhms]/)){format="yyyy-MM-dd";}else{locale=cell._getAttrValue(cell.locale,rowidx);if(!locale){locale=nexacro._BrowserLang;}if(format=="SHORTDATE"){format=nexacro.Locale._makeDateMaskString(locale,format);if(format==""){format=nexacro.Locale._default_shortdate_format;}}else if(format=="LONGDATE"){format=nexacro.Locale._makeDateMaskString(locale,"SHORTDATE");if(format==""){format=nexacro.Locale._default_longdate_format;}}}displaytype=format;locale=this._getCellLocale(cell,rowidx);var delimiter=String.fromCharCode(29);if(locale){displaytype+=delimiter+locale;}break;case "imagecontrol":if(this.exportimage.toLowerCase()=="image"){displaytype+="image";}cell_type="text";break;case "text":if(cell._getAttrValue(cell.displaytype,rowidx)=="normal"){cell_type="normal";}else{cell_type="text";}break;default:cell_type="text";break;}return cell_type+(displaytype?":"+displaytype:"");};_pExportItem._modifyFormat=function(cell,style1,style2,rowidx,mainCell,virtual_merge_value){var text,temp_str,str;temp_str=str="";var colspan=cell._colspan;var rowspan=cell._rowspan;var row=cell._row;var col=cell._col;var _row=row;var _col=col;if(rowidx<0){text=cell._getDisplayText(rowidx);if(cell._getDisplaytype(rowidx)=="decoratetext"){text=nexacro._getDisplayTextfromDecorateText(text);}}else{text=cell.text._value;}text=nexacro._encodeXml(text);if(mainCell){row=_row+mainCell._row;col=_col+mainCell._col;}str+="<Cell ";str+="row=\""+row+"\" col=\""+col+"\" ";temp_str+="rowspan=\""+rowspan+"\" ";temp_str+="colspan=\""+colspan+"\" ";if(this._exportmerge==1){if(virtual_merge_value!=null){text=virtual_merge_value;}}else if(this._exportmerge==2){if(virtual_merge_value!=null){temp_str=virtual_merge_value;}}str+=temp_str;if(text){str+="text=\""+text+"\" ";}var dataType="";str+="style1=\""+style1+"\" ";if(style2){str+="style2=\""+style2+"\" ";}var cType=cell.displaytype;if(cType){var cTypeVal=cType._value;if(cTypeVal=="imagecontrol"&&this.exportimage.toLowerCase()=="image"){str+="displaytype=\"imagecontrol\" ";}dataType=cell._getDisplaytype(rowidx);switch(dataType){case "imagecontrol":case "text":dataType="string";break;case "number":dataType="int";break;case "calendarcontrol":case "date":case "time":case "datetime":dataType="date";var format=cell._getAttrValue(cell.calendardateformat,rowidx);if(format==null||format.length==0||!format.match(/[yMdHhms]/)){format="yyyy-MM-dd";}str+="displaytype=\""+format+"\" ";break;default:dataType="text";break;}str+="type=\""+dataType+"\" ";}str+="/>";return str;};_pExportItem._getSubCellLine=function(subCell,defaultColor,linecolor,rsp,csp){var lLine,tLine,rLine,bLine;var sbc=subCell._col;var sbr=subCell._row;if(sbc==csp){rLine=linecolor.vertical;}else{rLine="empty";}if(sbc==0){lLine=defaultColor.vertical;}else{lLine="empty";}if(sbr==rsp){bLine=linecolor.horizon;}else{bLine="empty";}if(sbr==0){tLine=defaultColor.horizon;}else{tLine="empty";}return lLine+":"+tLine+":"+rLine+":"+bLine;};_pExportItem._makeVirtualLine=function(str,color,type){var linestyle_str;switch(str){case "topvirtual":case "bottomvirtual":linestyle_str="empty:empty:"+color.vertical+":empty";break;case "rightvirtual":if(type){linestyle_str="empty:empty:empty:"+color.horizon;}else{linestyle_str="empty:"+color.horizon+":empty:empty";}break;case "righttopvirtual":case "rightbottomvirtual":linestyle_str="empty:empty:empty:empty";break;default:if(type){linestyle_str="empty:empty:"+color.vertical+":"+color.horizon;}else{linestyle_str="empty:"+color.horizon+":"+color.vertical+":empty";}break;}return linestyle_str;};_pExportItem._makeFormat=function(grid){var bg,align,font,textdecoration,color,line,style,cell,subCell,background,gradation;var format=grid._curFormat;var hCells=format._headcells;var hLen=hCells?hCells.length:0;var bCells=format._bodycells;var bLen=bCells?bCells.length:0;var sCells=format._summcells;var sLen=sCells?sCells.length:0;var str="";var ds_style=this._ds_style;var linecolor;var linestyle;var subL=0;var f_cols=format._cols;var f_hrows=format._headrows;var f_brows=format._bodyrows;var f_srows=format._summrows;var i,j,fcLen,frLen;var cell_type;var need_merge_cell=false;var virtual_value=null;var merge_data,temp_align,merge_str;str="<Formats><Format><Columns>";for(i=0,fcLen=f_cols.length;i<fcLen;i++ ){str+='<Column size="'+Math.round(f_cols[i].size)+'" />';}str+="</Columns><Rows>";for(i=0,frLen=f_hrows?f_hrows.length:0;i<frLen;i++ ){str+='<Row size="'+Math.round(f_hrows[i].size)+'" band="head" />';}for(i=0,frLen=f_brows?f_brows.length:0;i<frLen;i++ ){str+='<Row size="'+Math.round(f_brows[i].size)+'" />';}for(i=0,frLen=f_srows?f_srows.length:0;i<frLen;i++ ){str+='<Row size="'+Math.round(f_srows[i].size)+'" band="summ" />';}str+="</Rows>";if(hLen>0&&this._applyHead){str+="<Head>";for(i=0;i<hLen;i++ ){if(nexacro._Browser=="Runtime"){nexacro._peekWindowHandleMessageQueuePassing(this._getWindow());}cell=hCells[i];background=this._getCellStyle(cell, -1,false,"background","enabled");if(this._checkGradation(background)){gradation=this._getCellStyle(cell, -1,false,"gradation","enabled");bg=this._getGradationColor(gradation);}else{bg=this._getHEXtoRGB(background);}align=this._getCellStyle(cell, -1,false,"align","enabled");font=this._getFitFontValue(this._getCellStyle(cell, -1,false,"font","enabled"));textdecoration=this._getCellStyle(cell, -1,false,"textDecoration","enabled");if(textdecoration){font=textdecoration+","+font;}color=this._getHEXtoRGB(this._getCellStyle(cell, -1,false,"color","enabled"));linecolor={vertical:"empty",horizon:"empty"};if(this._applyL){line=this._getCellStyle(cell, -1,false,"border","enabled");if(line){if(line.right&&line.right.style!="none"&&line.right._width!=0){linecolor.vertical=this._getHEXtoRGB(line.right.color)+(line.right.style=="solid"?"":","+line.right.style);}if(line.bottom&&line.bottom.style!="none"&&line.bottom._width!=0){linecolor.horizon=this._getHEXtoRGB(line.bottom.color)+(line.bottom.style=="solid"?"":","+line.bottom.style);}}}cell_type=this._getFixedCellType(cell, -1);subCell=cell._subcells;subL=subCell.length;if(subL){for(j=0;j<subL;j++ ){linestyle=this._getSubCellLine(subCell[j],linecolor,linecolor,cell._rowspan-1,cell._colspan-1);style=this._makeforDsStyle(ds_style,align,bg,color,font,linestyle,cell_type);str+=this._modifyFormat(subCell[j],style,null, -1,cell);}}else{linestyle=(cell._col==0?linecolor.vertical:"empty")+":"+(cell._row==0?linecolor.horizon:"empty")+":";linestyle+=linecolor.vertical+":"+linecolor.horizon;if(this._exportmerge==1){if(!!grid._checkVirtualMerge(cell, -1)){linestyle=this._makeVirtualLine(cell._virtualmerge_infos[1].remove,linecolor,true);virtual_value="";merge_data=this._merge_datas&&this._merge_datas[ -1+"_"+i];if(merge_data){if(merge_data.isVirtualStart){virtual_value=nexacro._encodeXml(cell._getDisplayText( -1));if(align!="left,top"){temp_align=align.split(",");merge_str=merge_data[temp_align[1]]+"_"+merge_data[temp_align[0]];if(this._merge_datas[merge_str]){this._merge_datas[merge_str].disPlayText=virtual_value;this._merge_datas[merge_str].showText=true;}else{this._merge_datas[merge_str]={disPlayText:virtual_value,showText:true};}}virtual_value="";}else if(merge_data.showText){virtual_value=merge_data.disPlayText;}}}}else if(this._exportmerge==2){merge_data=this._merge_datas&&this._merge_datas[ -1+"_"+i];if(merge_data){if(merge_data.isVirtualStart){virtual_value="rowspan=\""+merge_data.rowspan+"\" colspan=\""+merge_data.colspan+"\" ";}else{need_merge_cell=true;}}}if(!need_merge_cell){style=this._makeforDsStyle(ds_style,align,bg,color,font,linestyle,cell_type);str+=this._modifyFormat(cell,style,null, -1,false,virtual_value);}}}str+="</Head>";}if(bLen>0){str+="<Body>";for(i=0;i<bLen;i++ ){if(nexacro._Browser=="Runtime"){nexacro._peekWindowHandleMessageQueuePassing(this._getWindow());}cell=bCells[i];str+=this._getCellBodyStyle(cell,i);}str+="</Body>";}if(sLen>0&&this._applySumm){str+="<Summary>";for(i=0;i<sLen;i++ ){if(nexacro._Browser=="Runtime"){nexacro._peekWindowHandleMessageQueuePassing(this._getWindow());}cell=sCells[i];background=this._getCellStyle(cell, -2,false,"background","enabled");if(this._checkGradation(background)){gradation=this._getCellStyle(cell, -2,false,"gradation","enabled");bg=this._getGradationColor(gradation);}else{bg=this._getHEXtoRGB(background);}align=this._getCellStyle(cell, -2,false,"align","enabled");font=this._getFitFontValue(this._getCellStyle(cell, -2,false,"font","enabled"));textdecoration=this._getCellStyle(cell, -2,false,"textDecoration","enabled");if(textdecoration){font=textdecoration+","+font;}color=this._getHEXtoRGB(this._getCellStyle(cell, -2,false,"color","enabled"));linecolor={vertical:"empty",horizon:"empty"};if(this._applyL){line=this._getCellStyle(cell, -2,false,"border","enabled");if(line){if(line.right&&line.right.style!="none"&&line.right._width!=0){linecolor.vertical=this._getHEXtoRGB(line.right.color)+(line.right.style=="solid"?"":","+line.right.style);}if(grid.summarytype=="default"){if(line.top&&line.top.style!="none"&&line.top._width!=0){linecolor.horizon=this._getHEXtoRGB(line.top.color)+(line.top.style=="solid"?"":","+line.top.style);}}else{if(line.bottom&&line.bottom.style!="none"&&line.bottom.width!=0){linecolor.horizon=this._getHEXtoRGB(line.bottom.color)+(line.bottom.style=="solid"?"":","+line.bottom.style);}}}}cell_type=this._getFixedCellType(cell, -2);subCell=cell._subcells;subL=subCell.length;if(subL){for(j=0;j<subL;j++ ){linestyle=this._getSubCellLine(subCell[j],linecolor,linecolor,cell._rowspan-1,cell._colspan-1);style=this._makeforDsStyle(ds_style,align,bg,color,font,linestyle,cell_type);str+=this._modifyFormat(subCell[j],style,null, -2,cell);}}else{need_merge_cell=false;linestyle=linecolor.vertical+":"+linecolor.horizon+":"+linecolor.vertical+":"+linecolor.horizon;if(this._exportmerge==1){if(!!grid._checkVirtualMerge(cell, -2)){linestyle=this._makeVirtualLine(cell._virtualmerge_infos[0].remove,linecolor);virtual_value="";merge_data=this._merge_datas&&this._merge_datas[ -2+"_"+i];if(merge_data){if(merge_data.isVirtualStart){virtual_value=nexacro._encodeXml(cell._getDisplayText( -2));if(align!="left,top"){temp_align=align.split(",");merge_str=merge_data[temp_align[1]]+"_"+merge_data[temp_align[0]];if(this._merge_datas[merge_str]){this._merge_datas[merge_str].disPlayText=virtual_value;this._merge_datas[merge_str].showText=true;}else{this._merge_datas[merge_str]={disPlayText:virtual_value,showText:true};}virtual_value="";}}else if(merge_data.showText){virtual_value=merge_data.disPlayText;}}}}else if(this._exportmerge==2){if(!!grid._checkVirtualMerge(cell, -2)){merge_data=this._merge_datas&&this._merge_datas[ -2+"_"+i];if(merge_data){if(merge_data.isVirtualStart){virtual_value="rowspan=\""+merge_data.rowspan+"\" colspan=\""+merge_data.colspan+"\" ";}else{need_merge_cell=true;}}}}if(!need_merge_cell){style=this._makeforDsStyle(ds_style,align,bg,color,font,linestyle,cell_type);str+=this._modifyFormat(cell,style,null, -2,false,virtual_value);}}}str+="</Summary>";}str+="</Format></Formats>";return str;};_pExportItem._getForm=function(){return this.parent.parent;};_pExportItem._eventExport=function(exportObj,type,row_index,selectCnt){var eventtype=exportObj.exporteventtype;var itemIndex=exportObj._itemsIndex;var exportbar=exportObj._exportBar;if(eventtype!="none"){var row_num=row_index+1;var processStr="";var is_end=row_num==this._bodyRowCnt;var progress_pos=exportObj._progress_pos+row_num;if(eventtype=="item"&&is_end){this.on_fire_onprogress(exportObj,itemIndex,this.type,selectCnt==null?row_index:selectCnt);if(exportbar){processStr=exportObj._getProcessStr(itemIndex+1,progress_pos,exportObj._allRowCount);exportbar._set_text(processStr);exportbar._set_pos((itemIndex+1)/exportObj._allCount*100);}}else if(eventtype=="itemrecord"){this.on_fire_onprogress(exportObj,itemIndex,this.type,selectCnt==null?row_index:selectCnt);if(exportbar){processStr=exportObj._getProcessStr(itemIndex+1,row_num,this._bodyRowCnt);exportbar._set_text(processStr);exportbar._set_pos(row_num/this._bodyRowCnt*100);}}else if(eventtype=="totalrecord"){this.on_fire_onprogress(exportObj,itemIndex,this.type,selectCnt==null?row_index:selectCnt);if(exportbar){processStr=exportObj._getProcessStr(itemIndex+1,progress_pos,exportObj._allRowCount);exportbar._set_text(processStr);exportbar._set_pos(progress_pos/exportObj._allRowCount*100);}}if(progress_pos==exportObj._allRowCount&&exportObj.exportmessagecomplete!=""){if(exportbar){exportbar._set_text(exportObj.exportmessagecomplete);}}if(is_end&&exportbar){if(eventtype=="itemrecord"){exportObj._progress_pos=progress_pos;}else{exportObj._progress_pos+=this._startRow-this._preStartRow;}}}};_pExportItem._updateBarPos=function(exportObj,eventtype){if(eventtype!="none"&&exportObj._exportuitype){var itemIndex=exportObj._itemsIndex+1;var exportbar=exportObj._exportBar;exportObj._progress_pos+=this._startRow-this._preStartRow;var processStr="";var is_end=this._startRow==this._bodyRowCnt;if(eventtype=="item"&&is_end){processStr=exportObj._getProcessStr(itemIndex,exportObj._progress_pos,exportObj._allRowCount);exportbar._set_text(processStr);exportbar._set_pos(itemIndex/exportObj._allCount*100);}else if(eventtype=="itemrecord"){processStr=exportObj._getProcessStr(itemIndex,this._startRow,this._bodyRowCnt);exportbar._set_text(processStr);exportbar._set_pos(this._startRow/this._bodyRowCnt*100);}else if(eventtype=="totalrecord"){processStr=exportObj._getProcessStr(itemIndex,exportObj._progress_pos,exportObj._allRowCount);exportbar._set_text(processStr);exportbar._set_pos(exportObj._progress_pos/exportObj._allRowCount*100);}if(exportObj._progress_pos==exportObj._allRowCount&&exportObj.exportmessagecomplete!=""){exportbar._set_text(exportObj.exportmessagecomplete);}}};_pExportItem._rollbackSuppressInfo=function(){var cells=this.source._curFormat._bodycells;var supLen=this._tmpSuppressInfos&&this._tmpSuppressInfos.length;for(var i=0;i<supLen;i++ ){cells[i]._suppress_infos=this._tmpSuppressInfos.shift();}};_pExportItem._gridSuppressUpdate=function(grid,rowcount){var cells=grid._curFormat._bodycells;var cLen=cells.length;this._tmpSuppressInfos=[];var i;for(i=0;i<cLen;i++ ){this._tmpSuppressInfos.push(cells[i]._suppress_infos);}grid._analyzeSuppress(true);for(i=0;i<rowcount;i++ ){if(nexacro._Browser=="Runtime"){nexacro._peekWindowHandleMessageQueuePassing(this._getWindow());}grid._suppressUpdateRow(i,0,rowcount-1,true);}};_pExportItem._gridExportContinue=function(exportObj){var grid=this.source;var ds_command=this._ds_command;ds_command.setColumn(0,"command","export");ds_command.setColumn(0,"type",exportObj._exporttype);ds_command.setColumn(0,"item",grid.id);ds_command.setColumn(0,"seq",this._seq);ds_command.setColumn(0,"startrow",this._startRow);ds_command.setColumn(0,"instanceid",this._instanceId);ds_command.setColumn(0,"url",exportObj._fileURL);ds_command.setColumn(0,"summarytype",grid.summarytype);ds_command.setColumn(0,"range",this.range);ds_command.setColumn(0,"exportsize",this.exportsize);ds_command.setColumn(0,"exporthead",this._exporthead);ds_command.setColumn(0,"exportimage",this.exportimage);ds_command.setColumn(0,"exportfilename",exportObj.exportfilename);ds_command.setColumn(0,"exportfilepath",exportObj.exportfilepath);ds_command.setColumn(0,"format","");ds_command.setColumn(0,"password",exportObj._file_password);ds_command.setColumn(0,"wraptext",exportObj._wrap_text);ds_command.setColumn(0,"righttoleft",this._righttoleft);var ds_style=this._ds_style;var ds_style2=this._ds_style2;if(!ds_style2){ds_style2=this._ds_style2=new nexacro.Dataset("STYLE2");ds_style2.addColumn("type","String",10);ds_style2.addColumn("name","String",32);ds_style2.addColumn("value","String",1024);ds_style2.addColumn("locale","String",32);}else{this._ds_style2.clearData();}delete this._ds_cell;var ds=new nexacro.Dataset("CELL");this._ds_cell=ds;var bodycntcell=grid.getCellCount("body");var bodycntrow=this._bodyRowCnt;var style_name;var sFlag=false;if(this._exportmerge&&grid._is_use_suppress&&bodycntrow>=grid._bodyBand._get_rows().length){this._gridSuppressUpdate(grid,bodycntrow);}var export_param=null;var export_dsparam=null;if(bodycntcell>0){for(var jj=0;jj<bodycntcell;jj++ ){ds.addColumn("Column"+jj,"String",256);}var partitionRow=this._partitionRow+this._startRow;if(partitionRow>=bodycntrow){partitionRow=bodycntrow;this._eof=true;export_param=this.parent._argsParam;export_dsparam=this.parent._argsDsParam;}var cells=grid._curFormat._bodycells;var is_selected=false;var rr=0;var subcnt;var d_BLColor,merge_data,line,cell_type;var emptyCellFlag=false;var _win=this._getWindow();for(var k=this._startRow;k<partitionRow;k++ ){if(nexacro._Browser=="Runtime"){nexacro._peekWindowHandleMessageQueuePassing(_win);}subcnt=0;var val,j;var selectChk=false;for(j=0;j<bodycntcell;j++ ){selectChk=selectChk||grid.isSelectedCell(j,"body",k, -9);}var is_selectRec=this.exportselect=="selectrecord";var idx;if(selectChk||!is_selectRec){idx=ds.addRow();if(is_selectRec){this._eventExport(exportObj,this.type,k,this._selectcount++ );}else{this._eventExport(exportObj,this.type,k);}}else{continue;}var odd=k%2;var activate_select_style=(this.exportvalue=="selectstyle");for(j=0;j<bodycntcell;j++ ){emptyCellFlag=false;is_selected=grid.isSelectedCell(j,"body",k, -9);if(!is_selected){if(is_selectRec){emptyCellFlag=true;}}var backgroundCell;var alignCell;var fontCell;var colorCell;var lineCell;var cell=cells[j];var rowspan=cell._rowspan;var suppress_infos=cell._suppress_infos;var selected=is_selected&&activate_select_style;var iscssclassexpr=this._checkExpr(null,cell.cssclass);var cssclasses=iscssclassexpr?cell._getAttrValue(cell.cssclass,k):"";var cacheindex=j+(cssclasses?cssclasses:"");var selectedcc=selected?"-c":"";var cacheA=this._stylecache[cacheindex+"align"+selectedcc];var cacheL=this._stylecache[cacheindex+"line"+selectedcc];var cacheB,cacheC,cacheF;{if(emptyCellFlag){cacheB="255,255,255";cacheC="255,255,255";d_BLColor=this._d_BLColor;cacheL=d_BLColor+":"+d_BLColor+":"+d_BLColor+":"+d_BLColor;sFlag=true;}else{cacheB=this._stylecache[cacheindex+"background"+odd+selectedcc];cacheC=this._stylecache[cacheindex+"color"+odd+selectedcc];}cacheF=this._stylecache[cacheindex+"font"+selectedcc];}if(!nexacro._isNull(cacheA)){alignCell=cacheA;if(iscssclassexpr){sFlag=true;}}else{if(this._applyA){sFlag=true;alignCell=nexacro._nvl(this._getCellStyle(cell,k,odd,"align",selected),"");if(iscssclassexpr){this._stylecache[cacheindex+"align"+selectedcc]=alignCell;}}}if(!nexacro._isNull(cacheB)){backgroundCell=cacheB;if(iscssclassexpr){sFlag=true;}}else{if(this._applyB){sFlag=true;backgroundCell=nexacro._nvl(this._getHEXtoRGB(this._getCellStyle(cell,k,odd,"background",selected)),"");if(iscssclassexpr){this._stylecache[cacheindex+"background"+odd+selectedcc]=backgroundCell;}}}if(!nexacro._isNull(cacheC)){colorCell=cacheC;if(iscssclassexpr){sFlag=true;}}else{if(this._applyC){sFlag=true;colorCell=nexacro._nvl(this._getHEXtoRGB(this._getCellStyle(cell,k,odd,"color",selected)),"");if(iscssclassexpr){this._stylecache[cacheindex+"color"+odd+selectedcc]=colorCell;}}}if(!nexacro._isNull(cacheF)){fontCell=cacheF;if(iscssclassexpr){sFlag=true;}}else{if(this._applyF){sFlag=true;fontCell=nexacro._nvl(this._getFitFontValue(this._getCellStyle(cell,k,odd,"font",selected)),"");var textdecoration=this._getCellStyle(cell,k,odd,"textDecoration",selected);if(textdecoration){fontCell=textdecoration+","+fontCell;}if(iscssclassexpr){this._stylecache[cacheindex+"font"+selectedcc]=fontCell;}}}var is_line_changed=false,left_linecolor=null,top_linecolor=null,right_linecolor=null,bottom_linecolor=null,linecolor;var row_suppress_count=0;var col_suppress_count=0;var issupp=false;switch(this._exportmerge){case 0:break;case 1:if(cell.suppress>0){sFlag=is_line_changed=true;if(suppress_infos[k]){if(suppress_infos[k].border_proc){bottom_linecolor="empty";}if(suppress_infos[k].text_proc){emptyCellFlag=true;}}}grid._checkVirtualMerge(cell,k);if(cell._virtualmerge_infos&&cell._virtualmerge_infos[k+2]){var virtual_border_str=cell._virtualmerge_infos[k+2].remove;if(virtual_border_str){sFlag=is_line_changed=true;switch(virtual_border_str){case "bottomvirtual":bottom_linecolor="empty";break;case "rightbottomvirtual":right_linecolor=bottom_linecolor="empty";break;case "rightvirtual":right_linecolor="empty";break;}}}break;case 2:if(cell.suppress>0){sFlag=is_line_changed=true;if(rowspan>1){issupp=true;}var column_suppress=j+"count";var excel_suppress_info=this._excel_suppress_info;if(!excel_suppress_info[column_suppress]){excel_suppress_info[column_suppress]=0;alignCell=alignCell.split(",")[0]+", "+this._suppress_align_table[cell.suppressalign];}if(suppress_infos[k]&&suppress_infos[k].border_proc){this._excel_suppress_info[column_suppress]++ ;}else{row_suppress_count= ++excel_suppress_info[column_suppress];if(issupp){row_suppress_count=row_suppress_count*rowspan;}if(issupp&&row_suppress_count==1){issupp=false;}excel_suppress_info[column_suppress]=0;}}merge_data=this._merge_datas&&this._merge_datas[k+"_"+j];if(merge_data&&merge_data.isVirtualEnd){sFlag=is_line_changed=true;row_suppress_count=merge_data.rowspan;col_suppress_count=merge_data.colspan;}break;}if(grid._supphorztype>0){if(cell._area=="left"||cell._area=="right"){sFlag=is_line_changed=true;if(suppress_infos[k]){if(suppress_infos[k].horz_text_proc){emptyCellFlag=true;}}}}if(!is_line_changed&&!nexacro._isNull(cacheL)){lineCell=cacheL;if(iscssclassexpr){sFlag=true;}}else{if(this._applyL){line=this._getCellStyle(cell,k,odd,"border",selected);if(!left_linecolor){left_linecolor=this._getHEXtoRGB(line.left.color)+(line.left.style=="solid"?"":","+line.left.style);}if(!top_linecolor){top_linecolor=this._getHEXtoRGB(line.top.color)+(line.top.style=="solid"?"":","+line.top.style);}if(!right_linecolor){right_linecolor=this._getHEXtoRGB(line.right.color)+(line.right.style=="solid"?"":","+line.right.style);}if(!bottom_linecolor){bottom_linecolor=this._getHEXtoRGB(line.bottom.color)+(line.bottom.style=="solid"?"":","+line.bottom.style);}lineCell=left_linecolor+":"+top_linecolor+":"+right_linecolor+":"+bottom_linecolor;if(iscssclassexpr){this._stylecache[cacheindex+"line"+selectedcc]=lineCell;}}else{lineCell="empty:empty:empty:empty:";}}cell_type=this._getFixedCellType(cell,k);style_name=this._makeforDsStyle(ds_style2,alignCell,backgroundCell,colorCell,fontCell,lineCell,cell_type,row_suppress_count,col_suppress_count);var longdate_flag=false;if(cell_type.indexOf("date")> -1&&(this._checkExpr(cell.locale)||this._checkExpr(cell.calendardateformat))){sFlag=true;if(cell.calendardateformat=="LONGDATE"){longdate_flag=true;}}if(!sFlag){var display_type=cell._getDisplaytype(k);if(display_type=="mask"||display_type=="maskeditcontrol"){var masktype=cell._getAttrValue(cell.maskedittype,k);if(masktype=="number"){sFlag=true;}}}var display_text=this._getCellText(grid,k,j);val=emptyCellFlag?"":display_text;var is_orgvaluecell=this._orgvalue_cells[j];if(longdate_flag){cell.calendardateformat="SHORTDATE";val=cell._getDisplayText_date(k);cell.calendardateformat="LONGDATE";}var displaytype=grid.getCellProperty("body",j,"displaytype");if(displaytype=="imagecontrol"){var expImg=this.exportimage.toLowerCase();if(expImg=="url"||expImg=="image"){var path=this._getCellText(grid,k,j);if(path){var url=nexacro._getURIValue(path);val=nexacro._getImageLocation(url,this._getForm()._getFormBaseUrl());}else{val=path;}}else{val="";}}var delimiter;if(exportObj._commdataformat==3){delimiter="_x001D_";}else{delimiter=String.fromCharCode(29);}if(this._exportmerge==1){if(cell.suppress>0){if(suppress_infos[k]&&suppress_infos[k].text_proc){val="";}}if(grid._supphorztype>0){if(cell._area=="left"||cell._area=="right"){if(suppress_infos[k]){if(suppress_infos[k].horz_text_proc){val="";}}}}if(!!grid._checkVirtualMerge(cell,k)){val="";merge_data=this._merge_datas&&this._merge_datas[k+"_"+j];if(merge_data){if(merge_data.isVirtualStart){if(alignCell=="left,top"){val=display_text;}else{var temp_align=alignCell.split(",");var merge_str=merge_data[temp_align[1]]+"_"+merge_data[temp_align[0]];if(this._merge_datas[merge_str]){this._merge_datas[merge_str].disPlayText=display_text;this._merge_datas[merge_str].showText=true;}else{this._merge_datas[merge_str]={disPlayText:display_text,showText:true};}}}if(merge_data.showText){val=merge_data.disPlayText;}}}}else if(this._exportmerge==2){if(grid._supphorztype>0){if(cell._area=="left"||cell._area=="right"){if(suppress_infos[k]){if(suppress_infos[k].horz_text_proc){val="";}}}}}if(exportObj._orgval_type||is_orgvaluecell){val=nexacro._isNumber(val)?val:nexacro._isDecimal(val)?val.toString():nexacro._nvl(val,"");}else{val=nexacro._nvl(val,"");}if(issupp){ds.setColumn(idx,"Column"+(j+subcnt),val+delimiter+(sFlag||(is_selected&&activate_select_style)?style_name:"")+delimiter+issupp);issupp=false;}else{ds.setColumn(idx,"Column"+(j+subcnt),val+delimiter+(sFlag||(is_selected&&activate_select_style)?style_name:""));}if(cell._subcells.length){var subCell=cell._subcells;var subL=subCell.length;var rsp=cell._rowspan-1;var csp=cell._colspan-1;var subline="";d_BLColor=this._d_BLColor;if(this._applyL){line=this._getCellStyle(cell,k,odd,"border",selected);linecolor=this._getHEXtoRGB(line.right.color)+(line.right.style=="solid"?"":","+line.right.style);}else{linecolor=d_BLColor;}var lLine;var tLine;var rLine;var bLine;for(var i=0;i<subL;i++ ){var sbc=subCell[i]._col;var sbr=subCell[i]._row;if(sbc==csp){rLine=linecolor;}else{rLine="empty";}if(sbc==0){lLine=d_BLColor;}else{lLine="empty";}if(sbr==rsp){bLine=linecolor;}else{bLine="empty";}if(sbr==0){tLine=d_BLColor;}else{tLine="empty";}subline=lLine+":"+tLine+":"+rLine+":"+bLine;cell_type=this._getFixedCellType(subCell[i],0);style_name=this._makeforDsStyle(ds_style2,alignCell,backgroundCell,colorCell,fontCell,subline,cell_type);if(i!=0){ds.addColumn("Column"+(jj+subcnt),"String",256);subcnt++ ;}display_text=this._getCellText(grid,k,j,i);val=emptyCellFlag?"":display_text;if(exportObj._orgval_type||is_orgvaluecell){val=nexacro._isNumber(val)?val:nexacro._isDecimal(val)?val.toString():nexacro._nvl(val,"");}else{val=nexacro._nvl(val,"");}ds.setColumn(idx,"Column"+(j+subcnt),val+delimiter+style_name);}}}rr++ ;}this._preStartRow=this._startRow;this._startRow=partitionRow;}ds_command.setColumn(0,"eof",this._eof);if(this._ds_response){delete this._ds_response;}this._ds_response=new nexacro.Dataset("RESPONSE");this._rollbackSuppressInfo();if(export_dsparam!=undefined){this._transaction(this.id,exportObj._exporturl,"COMMAND=_ds_command STYLE=_ds_style2 CELL=_ds_cell"+" "+export_dsparam,"_ds_response=RESPONSE",export_param,"_exportCallback",true,exportObj._commdataformat,exportObj._commcompress);}else{this._transaction(this.id,exportObj._exporturl,"COMMAND=_ds_command STYLE=_ds_style2 CELL=_ds_cell","_ds_response=RESPONSE",export_param,"_exportCallback",true,exportObj._commdataformat,exportObj._commcompress);}this._updateBarPos(exportObj,exportObj.exporteventtype);};_pExportItem._onHttpTransactionError=function(obj,bfireevent,errorobj,errortype,url,returncode,requesturi,locationuri,extramsg){var ret=false;var commerrorobj=nexacro.MakeCommunicationError(this,errortype,url,returncode,requesturi,locationuri,extramsg);if(bfireevent){ret=this.on_fire_onerror(obj,commerrorobj.name,commerrorobj.message,errorobj,returncode,requesturi,locationuri);}return ret;};_pExportItem._exportCallback=function(svcid,errstatus,message){var grid=this.source;var exportObj=this.parent;var exportbar=exportObj._exportBar;if(errstatus<0){message=nexacro._decodeXml(message);this.on_fire_onerror(exportObj,"ObjectError",message,errstatus);nexacro._stopTransaction(this,0);if(exportbar){exportbar._hide();exportbar._set_pos(0);exportbar._set_text("");}if(grid._hasTree){grid.set_treeinitstatus(this._gridTempInfo.treeinitstatus);nexacro.Grid.prototype._recreate_contents_all=exportObj._tempSaveMethod;exportObj._tempSaveMethod=null;grid._treeIndexes=this._gridTempInfo.treeIndexes;grid._treeStates=this._gridTempInfo.treeStates;grid.enableevent=this._gridTempInfo.enableevent;this._gridTempInfo=null;}}else{this._instanceId=this._ds_response.getColumn(0,"instanceid");var excelURL=this._ds_response.getColumn(0,"url");if(excelURL!=null&&excelURL!=""){exportObj._fileURL=excelURL;}var itemIndex=exportObj._itemsIndex;var is_finish=itemIndex+1==exportObj._allCount;var is_end=this._startRow==this._bodyRowCnt;this._seq++ ;if(is_end){if(grid._hasTree){grid.set_treeinitstatus(this._gridTempInfo.treeinitstatus);nexacro.Grid.prototype._recreate_contents_all=exportObj._tempSaveMethod;exportObj._tempSaveMethod=null;grid._treeIndexes=this._gridTempInfo.treeIndexes;grid._treeStates=this._gridTempInfo.treeStates;grid.enableevent=this._gridTempInfo.enableevent;this._gridTempInfo=null;}if(is_finish){var completemessage=exportObj.exportmessagecomplete;if(completemessage){exportbar._set_text(completemessage);}if(exportbar){exportbar._hide();exportbar._set_pos(0);exportbar._set_text("");}this._tmpSuppressInfos=null;exportObj._fileURL="";exportObj._allRowCount=0;exportObj._progress_pos=0;exportObj._itemsIndex=0;var exportfilename_;if(excelURL!=null&&excelURL!=""){var index_=excelURL.lastIndexOf("/");if(index_== -1){index_=excelURL.lastIndexOf("\\");}if(index_!= -1){exportfilename_=excelURL.substring(index_+1);}}var application=nexacro.getApplication();if(application){application._endCommProgress();}this.on_fire_onsuccess(exportObj,this,excelURL);if(exportObj._filedownload){switch(exportObj.exporttype){case nexacro.ExportTypes.EXCEL:case nexacro.ExportTypes.EXCEL97:exportfilename_=exportObj.exportfilename;exportfilename_+=".xls";break;case nexacro.ExportTypes.EXCEL2007:exportfilename_=exportObj.exportfilename;exportfilename_+=".xlsx";break;case nexacro.ExportTypes.HANCELL2010:case nexacro.ExportTypes.HANCELL2014:exportfilename_=exportObj.exportfilename;exportfilename_+=".cell";break;case nexacro.ExportTypes.CSV:exportfilename_=exportObj.exportfilename;exportfilename_+=".csv";break;}var exportfilepath_;if(exportObj.exportfilepath!=null&&exportObj.exportfilepath!=""){exportfilepath_=exportObj.exportfilepath;if(exportfilepath_.charAt(exportfilepath_.length-1)!='\\'){exportfilepath_+="\\";}}if(nexacro._Browser=="Runtime"){nexacro._downloadExport(excelURL,exportObj._hidden_frame_handle,exportfilename_,exportfilepath_,exportObj.filefilter,exportObj.filefilterindex,"export");}else{nexacro._downloadExport(excelURL,exportObj._hidden_frame_handle,exportfilename_,undefined,exportObj.filefilter,exportObj.filefilterindex);}}}else{exportObj._itemsIndex++ ;if(exportObj._itemsIndex==exportObj._gCount){}else{exportObj._grids[exportObj._itemsIndex]._gridItemExport(exportObj);}}this._instanceId="";this._startRow=0;this._seq=1;this._eof=false;this._selectcount=0;}else{this._gridExportContinue(exportObj);}}};_pExportItem._makeMergeDatas=function(grid,format_body_rowcount,col_len){var row_len=format_body_rowcount;var merge_datas=this._merge_datas={};var virtual_mergecell,end_row,last_row,start_subrow,temp;start_subrow=0;var rowspan,colspan,top_row,middle_row,bottom_row,left_col,center_col,right_col,start_col,end_col,start_row;var rowcount=grid._getGridRowCount()-1;for(var i=0,len=grid._virtual_mergecell_arr.length;i<len;i++ ){if(nexacro._Browser=="Runtime"){nexacro._peekWindowHandleMessageQueuePassing(this._getWindow());}virtual_mergecell=grid._virtual_mergecell_arr[i];if(virtual_mergecell.start_subrow!=null){start_subrow=virtual_mergecell.start_subrow;}if(virtual_mergecell.end_row>rowcount){last_row=end_row=rowcount;}else{last_row=end_row=virtual_mergecell.end_row;}if(virtual_mergecell.start_row== -1){row_len=grid._curFormat._headrows?grid._curFormat._headrows.length:0;end_row=start_row=0;}else if(virtual_mergecell.start_row== -2){row_len=grid._curFormat._summrows?grid._curFormat._summrows.length:0;end_row=start_row=0;}else{start_row=virtual_mergecell.start_row;}rowspan=(row_len*end_row+virtual_mergecell.end_subrow)-(row_len*start_row+start_subrow)+1;colspan=virtual_mergecell.end_column-virtual_mergecell.start_column+1;temp=((row_len*start_row+start_subrow+1)+(row_len*end_row+virtual_mergecell.end_subrow+1))/2<<0;top_row=virtual_mergecell.start_row;middle_row=(temp-1)/row_len<<0;bottom_row=last_row;start_col=col_len*start_subrow+virtual_mergecell.start_column;end_col=col_len*virtual_mergecell.end_subrow+virtual_mergecell.end_column;left_col=((temp-1)%row_len*col_len+virtual_mergecell.start_column)<<0;center_col=((temp-1)%row_len*col_len+(virtual_mergecell.start_column+virtual_mergecell.end_column)/2)<<0;right_col=((temp-1)%row_len*col_len+virtual_mergecell.end_column)<<0;if(virtual_mergecell.start_row<0){middle_row=virtual_mergecell.start_row;}merge_datas[top_row+"_"+start_col]={isVirtualStart:true,left:left_col,center:center_col,right:right_col,top:top_row,middle:middle_row,bottom:bottom_row,rowspan:rowspan,colspan:colspan};merge_datas[bottom_row+"_"+end_col]={isVirtualEnd:true,rowspan:rowspan,colspan:colspan};}};_pExportItem._gridItemExport=function(exportObj){var uiType=exportObj._exportuitype;if(exportObj.exporteventtype!="none"&&uiType){var exportbar=exportObj._exportBar;if(!exportbar||exportbar._uitype!=uiType){exportbar=exportObj._exportBar=exportObj._getExportBar(uiType);var str=exportObj._getProcessStr(exportObj.count(),exportObj._allRowCount,exportObj._allRowCount);str=nexacro._getLongerStr(str,exportObj.exportmessagecomplete,exportObj.exportmessageready);var textbox=exportbar._textbox;var font=textbox?textbox._getCurrentStyleInheritValue("font"):exportbar.font||exportbar._getCurrentStyleInheritValue("font");var tSize=nexacro._getTextSize(str,font);exportbar._textWidth=tSize[0];exportbar._textHeight=tSize[1];}if(exportObj._itemsIndex==0&&exportObj.exportmessageready!=""){exportbar._set_text(exportObj.exportmessageready);}exportbar._show();}var grid=this.source;var cur_fomat_col_len=grid._curFormat._cols?grid._curFormat._cols.length:0;var cur_fomat_row_len=grid._curFormat._bodyrows?grid._curFormat._bodyrows.length:0;if(grid._hasTree){this._gridTempInfo={};exportObj._tempSaveMethod=nexacro.Grid.prototype._recreate_contents_all;nexacro.Grid.prototype._recreate_contents_all=nexacro._emptyFn;this._gridTempInfo.enableevent=grid.enableevent;grid.enableevent=false;this._gridTempInfo.treeIndexes=grid._treeIndexes.slice(0);this._gridTempInfo.treeStates=grid._treeStates.slice(0);this._gridTempInfo.treeinitstatus=grid.treeinitstatus;grid.set_treeinitstatus("expand,all");}if(grid._is_use_virtualmerge){this._makeMergeDatas(grid,cur_fomat_row_len,cur_fomat_col_len);}this._style_map1=null;this._style_map2=null;var ds_style=this._ds_style;if(!ds_style){ds_style=this._ds_style=new nexacro.Dataset("STYLE");ds_style.addColumn("type","String",10);ds_style.addColumn("name","String",32);ds_style.addColumn("value","String",1024);ds_style.addColumn("locale","String",32);}else{ds_style.clearData();}var ds_command=this._ds_command;if(!ds_command){ds_command=new nexacro.Dataset("COMMAND");this._ds_command=ds_command;ds_command.addColumn("command","String",32);ds_command.addColumn("type","int",32);ds_command.addColumn("item","String",256);ds_command.addColumn("seq","int");ds_command.addColumn("startrow","int",32);ds_command.addColumn("eof","boolean",32);ds_command.addColumn("instanceid","String",256);ds_command.addColumn("url","String",256);ds_command.addColumn("summarytype","String",256);ds_command.addColumn("range","String",32);ds_command.addColumn("exportsize","String",32);ds_command.addColumn("exporthead","String",32);ds_command.addColumn("exportimage","String",32);ds_command.addColumn("exportfilename","String",32);ds_command.addColumn("exportfilepath","String",256);ds_command.addColumn("format","String",1024*1024);ds_command.addColumn("password","String",256);ds_command.addColumn("wraptext","boolean",32);ds_command.addColumn("locale","String",32);ds_command.addColumn("righttoleft","boolean",32);}else{ds_command.clearData();}ds_command.addRow();ds_command.setColumn(0,"command","export");ds_command.setColumn(0,"type",exportObj._exporttype);ds_command.setColumn(0,"item",grid.id);ds_command.setColumn(0,"seq",this._seq);ds_command.setColumn(0,"startrow",this._startRow);ds_command.setColumn(0,"instanceid",this._instanceId);ds_command.setColumn(0,"url",exportObj._fileURL);ds_command.setColumn(0,"summarytype",grid.summarytype);ds_command.setColumn(0,"range",this.range);var is_selectRec=this.exportselect=="selectrecord";var is_show_head=grid.selecttype!=("area"||"multiarea"||"treecell")?true:false;if(is_show_head){if(is_selectRec){if(this._exporthead==""){this._exporthead="nohead, nosumm";this._applyHead=false;this._applySumm=false;}this._exportmerge=false;}}else{this._exporthead="nohead, nosumm";this._applyHead=false;this._applySumm=false;}ds_command.setColumn(0,"exportsize",this.exportsize);ds_command.setColumn(0,"exporthead",this._exporthead);ds_command.setColumn(0,"exportimage",this.exportimage);ds_command.setColumn(0,"exportfilename",exportObj.exportfilename);ds_command.setColumn(0,"exportfilepath",exportObj.exportfilepath);if(nexacro._Browser=="Runtime"){nexacro._flushCommand(this._getWindow());}var madeformat=nexacro._replaceAll(this._makeFormat(grid),"&#13;","");ds_command.setColumn(0,"format",madeformat);ds_command.setColumn(0,"password",exportObj._file_password);ds_command.setColumn(0,"wraptext",exportObj._wrap_text);ds_command.setColumn(0,"righttoleft",this._righttoleft);var locale=grid._getLocale();if(locale){locale=locale.replace(/-/g,"_");ds_command.setColumn(0,"locale",locale);}var ds=new nexacro.Dataset("CELL");this._ds_cell=ds;var bodycntcell=grid.getCellCount("body");var bodycntrow=this._bodyRowCnt=grid._getGridRowCount();var style_name="";if(this._exportmerge&&grid._is_use_suppress&&bodycntrow>=grid._bodyBand._get_rows().length){this._gridSuppressUpdate(grid,bodycntrow);}var export_param=null;var export_dsparam=null;if(bodycntcell>0){for(var jj=0;jj<bodycntcell;jj++ ){ds.addColumn("Column"+jj,"String",256);}var transferrowcount=this.parent?(this.parent.transferrowcount||bodycntrow):bodycntrow;var partRowCount=this._partitionRow=transferrowcount;if(partRowCount>=bodycntrow){partRowCount=bodycntrow;this._eof=true;export_param=this.parent._argsParam;export_dsparam=this.parent._argsDsParam;}var cells=grid._curFormat._bodycells;var activate_select_style=(this.exportvalue=="selectstyle");var is_selected;var subcnt;var emptyCellFlag=false;var d_BLColor,merge_data,line,cell_type;var k,j;var _win=this._getWindow();for(k=0;k<partRowCount;k++ ){subcnt=0;if(nexacro._Browser=="Runtime"){nexacro._peekWindowHandleMessageQueuePassing(_win);}var val;var selectChk=false;var idx;for(j=0;j<bodycntcell;j++ ){selectChk=selectChk||grid.isSelectedCell(j,"body",k, -9);}if(selectChk||!is_selectRec){idx=ds.addRow();if(is_selectRec){this._eventExport(exportObj,this.type,k,this._selectcount++ );}else{this._eventExport(exportObj,this.type,k);}}else{continue;}var odd=k%2;for(j=0;j<bodycntcell;j++ ){emptyCellFlag=false;is_selected=grid.isSelectedCell(j,"body",k, -9);if(!is_selected){if(is_selectRec){emptyCellFlag=true;}}var backgroundCell,alignCell,fontCell,colorCell,lineCell;var cell=cells[j];var suppress_infos=cell._suppress_infos;var selected=is_selected&&activate_select_style;var sFlag=false;var rowspan=cell._rowspan;var iscssclassexpr=this._checkExpr(null,cell.cssclass);var cssclasses=iscssclassexpr?cell._getAttrValue(cell.cssclass,k):"";var cacheindex=j+(cssclasses?cssclasses:"");var selectedcc=selected?"-c":"";var cacheA=this._stylecache[cacheindex+"align"+selectedcc];var cacheL=this._stylecache[cacheindex+"line"+selectedcc];var cacheB,cacheC,cacheF;{if(emptyCellFlag){cacheB="255,255,255";cacheC="255,255,255";d_BLColor=this._d_BLColor;cacheL=d_BLColor+":"+d_BLColor+":"+d_BLColor+":"+d_BLColor;sFlag=true;}else{cacheB=this._stylecache[cacheindex+"background"+odd+selectedcc];cacheC=this._stylecache[cacheindex+"color"+odd+selectedcc];}cacheF=this._stylecache[cacheindex+"font"+selectedcc];}if(!nexacro._isNull(cacheA)){alignCell=cacheA;if(iscssclassexpr){sFlag=true;}}else{if(this._applyA){sFlag=true;alignCell=nexacro._nvl(this._getCellStyle(cell,k,odd,"align",selected),"");if(iscssclassexpr){this._stylecache[cacheindex+"align"+selectedcc]=alignCell;}}else{alignCell=null;}}if(!nexacro._isNull(cacheB)){backgroundCell=cacheB;if(iscssclassexpr){sFlag=true;}}else{if(this._applyB){sFlag=true;backgroundCell=nexacro._nvl(this._getHEXtoRGB(this._getCellStyle(cell,k,odd,"background",selected)),"");if(iscssclassexpr){this._stylecache[cacheindex+"background"+odd+selectedcc]=backgroundCell;}}else{backgroundCell=null;}}if(!nexacro._isNull(cacheC)){colorCell=cacheC;if(iscssclassexpr){sFlag=true;}}else{if(this._applyC){sFlag=true;colorCell=nexacro._nvl(this._getHEXtoRGB(this._getCellStyle(cell,k,odd,"color",selected)),"");if(iscssclassexpr){this._stylecache[cacheindex+"color"+odd+selectedcc]=colorCell;}}else{colorCell=null;}}if(!nexacro._isNull(cacheF)){fontCell=cacheF;if(iscssclassexpr){sFlag=true;}}else{if(this._applyF){sFlag=true;fontCell=nexacro._nvl(this._getFitFontValue(this._getCellStyle(cell,k,odd,"font",selected)),"");var textdecoration=this._getCellStyle(cell,k,odd,"textDecoration",selected);if(textdecoration){fontCell=textdecoration+","+fontCell;}if(iscssclassexpr){this._stylecache[cacheindex+"font"+selectedcc]=fontCell;}}else{fontCell=null;}}var is_line_changed=false,left_linecolor=null,top_linecolor=null,right_linecolor=null,bottom_linecolor=null,linecolor;var row_suppress_count=0;var col_suppress_count=0;var issupp=false;switch(this._exportmerge){case 0:break;case 1:if(cell.suppress>0){sFlag=is_line_changed=true;if(suppress_infos[k]){if(suppress_infos[k].border_proc){bottom_linecolor="empty";}if(suppress_infos[k].text_proc){emptyCellFlag=true;}}}grid._checkVirtualMerge(cell,k);if(cell._virtualmerge_infos&&cell._virtualmerge_infos[k+2]){var virtual_border_str=cell._virtualmerge_infos[k+2].remove;if(virtual_border_str){sFlag=is_line_changed=true;switch(virtual_border_str){case "bottomvirtual":bottom_linecolor="empty";break;case "rightbottomvirtual":right_linecolor=bottom_linecolor="empty";break;case "rightvirtual":right_linecolor="empty";break;}}}break;case 2:if(cell.suppress>0){if(rowspan>1){issupp=true;}sFlag=is_line_changed=true;var column_suppress=j+"count";var excel_suppress_info=this._excel_suppress_info;if(!excel_suppress_info[column_suppress]){excel_suppress_info[column_suppress]=0;alignCell=alignCell.split(",")[0]+", "+this._suppress_align_table[cell.suppressalign];}if(suppress_infos[k]&&suppress_infos[k].border_proc){this._excel_suppress_info[column_suppress]++ ;}else{row_suppress_count= ++excel_suppress_info[column_suppress];if(issupp){row_suppress_count=row_suppress_count*rowspan;}if(issupp&&row_suppress_count==1){issupp=false;}excel_suppress_info[column_suppress]=0;}}merge_data=this._merge_datas&&this._merge_datas[k+"_"+j];if(merge_data&&merge_data.isVirtualEnd){sFlag=is_line_changed=true;row_suppress_count=merge_data.rowspan;col_suppress_count=merge_data.colspan;}break;}if(grid._supphorztype>0){if(cell._area=="left"||cell._area=="right"){sFlag=is_line_changed=true;if(suppress_infos[k]){if(suppress_infos[k].horz_text_proc){emptyCellFlag=true;}}}}if(!is_line_changed&&!nexacro._isNull(cacheL)){lineCell=cacheL;if(iscssclassexpr){sFlag=true;}}else{if(this._applyL){line=this._getCellStyle(cell,k,odd,"border",selected);if(!left_linecolor){left_linecolor=this._getHEXtoRGB(line.left.color)+(line.left.style=="solid"?"":","+line.left.style);}if(!top_linecolor){top_linecolor=this._getHEXtoRGB(line.top.color)+(line.top.style=="solid"?"":","+line.top.style);}if(!right_linecolor){right_linecolor=this._getHEXtoRGB(line.right.color)+(line.right.style=="solid"?"":","+line.right.style);}if(!bottom_linecolor){bottom_linecolor=this._getHEXtoRGB(line.bottom.color)+(line.bottom.style=="solid"?"":","+line.bottom.style);}lineCell=left_linecolor+":"+top_linecolor+":"+right_linecolor+":"+bottom_linecolor;if(iscssclassexpr){this._stylecache[cacheindex+"line"+selectedcc]=lineCell;}}else{lineCell="empty:empty:empty:empty:";}}cell_type=this._getFixedCellType(cell,k);style_name=this._makeforDsStyle(ds_style,alignCell,backgroundCell,colorCell,fontCell,lineCell,cell_type,row_suppress_count,col_suppress_count);var longdate_flag=false;if(cell_type.indexOf("date")> -1&&(this._checkExpr(cell.locale)||this._checkExpr(cell.calendardateformat))){sFlag=true;if(cell.calendardateformat=="LONGDATE"){longdate_flag=true;}}if(!sFlag){var display_type=cell._getDisplaytype(k);if(display_type=="mask"||display_type=="maskeditcontrol"){var masktype=cell._getAttrValue(cell.maskedittype,k);if(masktype=="number"){sFlag=true;}}}var display_text=this._getCellText(grid,k,j);val=emptyCellFlag?"":display_text;var is_orgvaluecell=this._orgvalue_cells[j];if(longdate_flag){cell.calendardateformat="SHORTDATE";val=cell._getDisplayText_date(k);cell.calendardateformat="LONGDATE";}var displaytype=grid.getCellProperty("body",j,"displaytype");if(displaytype=="imagecontrol"){var expImg=this.exportimage.toLowerCase();if(expImg=="url"||expImg=="image"){var path=this._getCellText(grid,k,j);if(path){var url=nexacro._getURIValue(path);val=nexacro._getImageLocation(url,this._getForm()._getFormBaseUrl());}else{val=path;}}else{val="";}}var delimiter;if(exportObj._commdataformat==3){delimiter="_x001D_";}else{delimiter=String.fromCharCode(29);}if(this._exportmerge==1){if(cell.suppress>0){if(suppress_infos[k]&&suppress_infos[k].text_proc){val="";}}if(grid._supphorztype>0){if(cell._area=="left"||cell._area=="right"){if(suppress_infos[k]){if(suppress_infos[k].horz_text_proc){val="";}}}}if(!!grid._checkVirtualMerge(cell,k)){val="";merge_data=this._merge_datas&&this._merge_datas[k+"_"+j];if(merge_data){if(merge_data.isVirtualStart){if(alignCell=="left,top"){val=display_text;}else{var temp_align=alignCell.split(",");var merge_str=merge_data[temp_align[1]]+"_"+merge_data[temp_align[0]];if(this._merge_datas[merge_str]){this._merge_datas[merge_str].disPlayText=display_text;this._merge_datas[merge_str].showText=true;}else{this._merge_datas[merge_str]={disPlayText:display_text,showText:true};}}}if(merge_data.showText){val=merge_data.disPlayText;}}}}else if(this._exportmerge==2){if(grid._supphorztype>0){if(cell._area=="left"||cell._area=="right"){if(suppress_infos[k]){if(suppress_infos[k].horz_text_proc){val="";}}}}}if(exportObj._orgval_type||is_orgvaluecell){val=nexacro._isNumber(val)?val:nexacro._isDecimal(val)?val.toString():nexacro._nvl(val,"");}else{val=nexacro._nvl(val,"");}if(issupp){ds.setColumn(idx,"Column"+(j+subcnt),val+delimiter+(sFlag||(is_selected&&activate_select_style)?style_name:"")+delimiter+issupp);issupp=false;}else{ds.setColumn(idx,"Column"+(j+subcnt),val+delimiter+(sFlag||(is_selected&&activate_select_style)?style_name:""));}if(cell._subcells.length){var subCell=cell._subcells;var subL=subCell.length;var rsp=cell._rowspan-1;var csp=cell._colspan-1;var subline="";d_BLColor=this._d_BLColor;if(this._applyL){line=this._getCellStyle(cell,k,odd,"border",selected);linecolor=this._getHEXtoRGB(line.right.color)+(line.right.style=="solid"?"":","+line.right.style);}else{linecolor=d_BLColor;}var lLine;var tLine;var rLine;var bLine;for(var i=0;i<subL;i++ ){var sbc=subCell[i]._col;var sbr=subCell[i]._row;if(sbc==csp){rLine=linecolor;}else{rLine="empty";}if(sbc==0){lLine=d_BLColor;}else{lLine="empty";}if(sbr==rsp){bLine=linecolor;}else{bLine="empty";}if(sbr==0){tLine=d_BLColor;}else{tLine="empty";}subline=lLine+":"+tLine+":"+rLine+":"+bLine;cell_type=this._getFixedCellType(subCell[i],0);style_name=this._makeforDsStyle(ds_style,alignCell,backgroundCell,colorCell,fontCell,subline,cell_type);if(i!=0){ds.addColumn("Column"+(jj+subcnt),"String",256);subcnt++ ;}display_text=this._getCellText(grid,k,j,i);val=emptyCellFlag?"":display_text;if(exportObj._orgval_type||is_orgvaluecell){val=nexacro._isNumber(val)?val:nexacro._isDecimal(val)?val.toString():nexacro._nvl(val,"");}else{val=nexacro._nvl(val,"");}ds.setColumn(idx,"Column"+(j+subcnt),val+delimiter+style_name);}}}}this._preStartRow=this._startRow;this._startRow=partRowCount;}else{this._eof=true;export_param=this.parent._argsParam;export_dsparam=this.parent._argsDsParam;}ds_command.setColumn(0,"eof",this._eof);if(this._ds_response){delete this._ds_response;}this._ds_response=new nexacro.Dataset("RESPONSE");this._rollbackSuppressInfo();if(export_dsparam!=undefined){this._transaction(this.id,exportObj._exporturl,"COMMAND=_ds_command STYLE=_ds_style CELL=_ds_cell"+" "+export_dsparam,"_ds_response=RESPONSE",export_param,"_exportCallback",true,exportObj._commdataformat,exportObj._commcompress);}else{this._transaction(this.id,exportObj._exporturl,"COMMAND=_ds_command STYLE=_ds_style CELL=_ds_cell","_ds_response=RESPONSE",export_param,"_exportCallback",true,exportObj._commdataformat,exportObj._commcompress);}return true;};_pExportItem._transaction=function(id,url,inDatasetsParam,outDatasetsParam,argsParam,callbackFn,isAsync,datatype,isCompress){this._load_manager=new nexacro._LoadManager(this);var service=nexacro._getServiceObject(url,true);this._load_manager.loadDataModule(url,id,inDatasetsParam,outDatasetsParam,argsParam,callbackFn,isAsync,datatype,isCompress,service);};_pExportItem._stopTransaction=function(){nexacro.Form.prototype._stopTransaction.apply(this,arguments);};_pExportItem._getDatasetObject=function(queryid){var _ds=this[queryid];var form=this.parent.parent;if(_ds==null&&form){_ds=form._getDatasetObject(queryid);}if(_ds==null){var app=nexacro.getApplication();_ds=app[queryid];}return _ds;};_pExportItem._waitCursor=nexacro._emptyFn;_pExportItem._removeUrl=function(v){if(v&&v.length){var index=v.indexOf("'");var end= -1;if(index> -1){end=v.lastIndexOf("'");v=v.substring(index+1,end);}index=v.indexOf("(");if(index> -1){end=v.lastIndexOf(")");v=v.substring(index+1,end);}}return v;};delete _pExportItem;nexacro.ExportProgress=function(id,left,top,width,height,right,bottom,minwidth,maxwidth,minheight,maxheight,parent){nexacro.PopupControl.call(this,id,left,top,width,height,right,bottom,minwidth,maxwidth,minheight,maxheight,parent);this._uitype=0;this.visible=false;this.progressbar=null;this._textWidth=0;this._textHeight=0;};var _pExportProgress=nexacro.ExportProgress.prototype=nexacro._createPrototype(nexacro.PopupControl,nexacro.ExportProgress);_pExportProgress._type_name="ExportProgress";_pExportProgress.on_apply_color=function(color){var textbox=this._textbox;if(textbox){if(color){textbox.set_color(color);}else{textbox.set_color("");}}};_pExportProgress.on_apply_font=function(font){var textbox=this._textbox;if(textbox){textbox.set_font(font);}};_pExportProgress.on_create_contents=function(){var control_elem=this.getElement();if(control_elem){switch(this._uitype){case 1:var progressbar=new nexacro.ProgressBar("progressbar",0,0,1,1,null,null,null,null,null,null,this);progressbar._setControl();progressbar.createComponent();this.progressbar=progressbar;var textbox=new nexacro.Static("progressbar:text",0,0,1,1,null,null,null,null,null,null,this);textbox.set_textAlign("center");textbox._setControl();textbox.createComponent();this._textbox=textbox;break;case 2:var app=nexacro.getApplication();if(app){this.progressbar=app.mainframe.statusbar;}break;}}};_pExportProgress.createCommand=function(){return "";};_pExportProgress.on_created_contents=function(_window){nexacro.PopupControl.prototype.on_created_contents.call(this,_window);_window=_window||this._getWindow();switch(this._uitype){case 1:var textbox=this._textbox;var progressbar=this.progressbar;if(progressbar){progressbar.on_created();}if(textbox){textbox.on_created();}break;case 2:break;}};_pExportProgress.on_change_containerRect=function(width,height){switch(this._uitype){case 1:var textbox=this._textbox;if(textbox){textbox.move(0,0,width,height);}var progressbar=this.progressbar;if(progressbar){progressbar.move(null,null,width,height,0,0);}break;case 2:break;}};_pExportProgress.on_destroy_contents=function(){switch(this._uitype){case 1:var textbox=this._textbox;if(textbox){textbox.destroy();}this.progressbar.destroy();this.progressbar=null;break;case 2:this.textbox=null;this.progressbar=null;break;}};_pExportProgress._getWindow=function(){return nexacro.Component.prototype._getWindow.call(this);};_pExportProgress.on_fire_onlbuttondown=function(button,alt_key,ctrl_key,shift_key,screenX,screenY,canvasX,canvasY,clientX,clientY,from_comp,from_refer_comp){return true;};_pExportProgress._on_keydown=function(elem,keycode,altKey,ctrlKey,shiftKey){if(keycode==nexacro.Event.KEY_TAB){elem._event_stop=true;}else if(keycode==nexacro.Event.KEY_ESC){nexacro._stopTransaction(this,2);}return true;};_pExportProgress._show=function(){if(!this._is_created||!this.parent){return;}var _window=this._getWindow();if(_window){var width,height;if(_window.frame){var frame=_window.frame;width=frame.getOffsetWidth();height=frame.getOffsetHeight();}else{width=_window.getClientWidth();height=_window.getClientHeight();}var capture_comp=_window._getCaptureComp(true,true,this);if(capture_comp!=this){_window._setCaptureLock(this,true,true);}var cpd=this._getCurrentStylePadding();var pWidth=0;var pHeight=0;var _left=0;var _top=0;var gap=20;var half_gap=10;if(this._uitype==1){pWidth=(this._textWidth<80?100:this._textWidth+gap);pHeight=this._textHeight+half_gap;if(cpd){pWidth+=cpd.left+cpd.right;pHeight+=cpd.top+cpd.bottom;}_left=Math.round((width-pWidth)/2);_top=Math.round((height-pHeight)/2);}this.move(_left,_top,pWidth,pHeight,null,null);this.set_visible(true);}};_pExportProgress._hide=function(){var excelexport=this.parent;if(excelexport){var _window=excelexport._getWindow();if(_window){_window._releaseCaptureLock(this);if(nexacro._resize_popup_inbound==true){var control_elem=this._control_element;if(control_elem){control_elem.setElementSize(1,1);}}}}if(this._is_created&&this._is_alive){this.set_visible(false);}};nexacro._getLongerStr=function(str1,str2,str3){var len=arguments.length;if(len<2){return;}var str=arguments[0];for(var i=1;i<len;i++ ){if(str.length<arguments[i].length){str=arguments[i];}}return str;};_pExportProgress._set_text=function(v){switch(this._uitype){case 1:this._textbox.set_text(v);break;case 2:var form=this._getForm();form.set_statustext(v);break;}};_pExportProgress._set_pos=function(v){switch(this._uitype){case 1:if(this.progressbar){this.progressbar.set_pos(v);}break;case 2:var comp=this;while(comp&&!comp._is_top_frame){if(comp._is_frame){comp.statusbar&&comp.statusbar.progressbar.set_pos(v);}comp=comp.parent;}break;}};delete _pExportProgress;}
if(!nexacro.ExcelImportObject){nexacro.ExcelImportEventInfo=function(obj,id,url,refferObj,importid){this.id=this.eventid=id||"onsuccess";this.fromobject=obj;this.fromreferenceobject=refferObj;this.url=url;this.importid=importid;};var _pExcelImportEventInfo=nexacro._createPrototype(nexacro.Event,nexacro.ExcelImportEventInfo,nexacro.ExcelImportEventInfo);nexacro.ExcelImportEventInfo.prototype=_pExcelImportEventInfo;_pExcelImportEventInfo._type_name="ExcelImportEventInfo";delete _pExcelImportEventInfo;nexacro.ExcelImportErrorEventInfo=function(obj,id,errortype,errormsg,errorobj,statuscode){this.id=this.eventid=id||"onerror";this.fromobject=obj;this.fromreferenceobject=errorobj;this.errortype=errortype;this.errormsg=errormsg;this.statuscode=statuscode;};var _pExcelImportErrorEventInfo=nexacro._createPrototype(nexacro.ErrorEventInfo,nexacro.ExcelImportErrorEventInfo);nexacro.ExcelImportErrorEventInfo.prototype=_pExcelImportErrorEventInfo;_pExcelImportErrorEventInfo._type_name="ExcelImportErrorEventInfo";delete _pExcelImportErrorEventInfo;nexacro.ImportTypes={EXCEL:0x0100,EXCEL97:0x0110,EXCEL2007:0x0120,HANCELL2014:0x0410,CSV:0x0500};nexacro.ExcelImportObject=function(name,parent){this.id=this.name=name;if(!parent){var app=nexacro.getApplication();if(app){parent=app.getActiveForm();if(!parent){parent=app.mainframe.childframe.form;}}}this.parent=parent;var unique_id=this._unique_id=this.parent._unique_id+"_"+this.id;if(nexacro._get_hidden_frame(unique_id,this._hidden_frame_handle)){nexacro._destroy_hidden_frame(unique_id,this._hidden_frame_handle);}nexacro._create_hidden_frame(unique_id,this._uploadComplete,this,"import");nexacro._append_hidden_item(unique_id,"upfile",this._checkUploadFile,this,this._hidden_frame_handle);nexacro._append_hidden_textitem(unique_id,"ds_command");this.onerror=new nexacro.EventListener("onerror");this.onsuccess=new nexacro.EventListener("onsuccess");};var _pExcelImport=nexacro.ExcelImportObject.prototype=nexacro._createPrototype(nexacro._EventSinkObject,nexacro.ExcelImportObject);_pExcelImport._type_name="ExcelImportObject";_pExcelImport._hidden_frame_handle=null;_pExcelImport.importfilemode="local";_pExcelImport._importfilemode=0;_pExcelImport.commcompress="none";_pExcelImport._commcompress=false;_pExcelImport.importtype=nexacro.ImportTypes.EXCEL;_pExcelImport.importurl="";_pExcelImport._importurl="";_pExcelImport._uploadurl="";_pExcelImport._uploadservlet="";_pExcelImport._fileurl="";_pExcelImport._range="";_pExcelImport._applyAllsheet=false;_pExcelImport._responseData="";_pExcelImport._responseRVal=null;_pExcelImport._responseLVal=null;_pExcelImport.userawdatevalue=false;_pExcelImport._userawdatevalue=false;_pExcelImport.userawnumbervalue=true;_pExcelImport._userawnumbervalue=true;_pExcelImport._user_data=null;_pExcelImport._file_password=null;_pExcelImport._usehtmltag=true;_pExcelImport._importSheet="";_pExcelImport._importStartCell=null;_pExcelImport._importEndCell=null;_pExcelImport._tran_item=null;_pExcelImport._file_url_ds=null;_pExcelImport._iscors=false;_pExcelImport._importid="";_pExcelImport._importid_list=[];_pExcelImport.filefilter="";_pExcelImport.filefilterindex=0;_pExcelImport._event_list={"onerror":1,"onsuccess":1};_pExcelImport.on_created=nexacro._emptyFn;_pExcelImport.set_importtype=function(v){switch((v+"").toUpperCase()){case "EXCEL":v=0x0100;break;case "EXCEL97":v=0x0110;break;case "EXCEL2007":v=0x0120;break;case "HANCELL2010":v=0x0400;break;case "HANCELL2014":v=0x0410;break;case "CSV":v=0x0500;break;}if(v!=this.importtype){this.importtype=v;}return v;};_pExcelImport.set_importurl=function(v){if(v!=this.importurl){this.importurl=v;if(v==null){this._importurl="";}else{var uploadservlet=this._uploadservlet=nexacro._getServiceLocation(v,this.parent._getFormBaseUrl());var baseurl=uploadservlet.substring(0,uploadservlet.lastIndexOf("/")+1);this._importurl=baseurl+"XExportImport";}}return v;};_pExcelImport.set_commcompress=function(v){if(v!=this.commcompress){this.commcompress=v;v=v.toString().toUpperCase();if(v=="COMPRESS"){this._commcompress=true;}else{this._commcompress=false;}}return v;};_pExcelImport.set_importfilemode=function(v){if(this.importfilemode!=v){this.importfilemode=v;this._importfilemode=v=="server"?1:0;}return v;};_pExcelImport.set_userawdatevalue=function(v){if(this.userawdatevalue!=v){this.userawdatevalue=v;this._userawdatevalue=nexacro._toBoolean(v);}return v;};_pExcelImport.set_userawnumbervalue=function(v){if(this.userawnumbervalue!=v){this.userawnumbervalue=v;this._userawnumbervalue=nexacro._toBoolean(v);}return v;};_pExcelImport.set_filefilter=function(v){this.filefilter=v;};_pExcelImport.set_filefilterindex=function(v){this.filefilterindex=v;};_pExcelImport._setImportRange=function(range){var obj={};if(range){if(range.indexOf("!")>=0){var rg=range.split("!");obj.sheet=rg[0];var cells=rg[1];var temp;if(cells.indexOf(":")>=0){cells=cells.split(":");temp=this._getExcelRowCol(cells[0]);obj.startRow=temp[1]?temp[1]:"";obj.startCol=temp[0]?temp[0]:"";temp=this._getExcelRowCol(cells[1]);obj.endRow=temp[1]?temp[1]:"";obj.endCol=temp[0]?temp[0]:"";}else{temp=this._getExcelRowCol(cells);obj.startRow=temp[1]?temp[1]:"";obj.startCol=temp[0]?temp[0]:"";obj.endRow="";obj.endCol="";}}}else{obj.sheet="";obj.startRow="";obj.startCol="";obj.endRow="";obj.endCol="";}this._range.push(obj);};_pExcelImport.importData=function(fileurl,range,responseData,userData){this._file_password=null;this._fileurl="";if(arguments.length<3){return false;}if(!this.importurl){return false;}var mode=this.importfilemode.toLowerCase();if(mode!="server"||!fileurl){this._importfilemode=0;}else{this._importfilemode=1;}if(range){this._range=range;}else{this._range="";}var i,r_len,u_len;if(responseData){this._responseLVal=[];this._responseRVal=[];var temp_response="";var responseDatas=responseData.split(",");if(responseDatas.length<=1&&responseDatas[0]){responseDatas=responseDatas[0].split(" ");}for(i=0,r_len=responseDatas.length;i<r_len;i++ ){if(responseDatas[i].length){var responArr=responseDatas[i].match(/[_A-Za-z0-9]+/g);this._responseLVal.push(responArr[0]);if(responArr[1]==null){responArr[1]="output"+(i+1);}this._responseRVal.push(responArr[1]);temp_response+=" "+responArr[0]+"="+responArr[1];}}this._responseData=temp_response;}if(userData){var userDatas=nexacro.replaceAll(userData," ","").split(",");for(i=0,u_len=userDatas.length;i<u_len;i++ ){var dataArr=userDatas[i].split("=");if(dataArr[0]=="filepassword"){this._file_password=dataArr[1];userDatas.splice(i,1);userData=userDatas.join(",");break;}}}this._user_data=userData;if(!this._importfilemode){nexacro._change_inputnode_name(this._input_node,"upfile");nexacro._findclick(this._unique_id,"upfile",this,this._hidden_frame_handle,this.filefilter,this.filefilterindex);}else{nexacro._change_inputnode_name(this._input_node,"");if(this._checkFileName(fileurl)){this._fileurl=fileurl;this._requestImport(fileurl);}else{var errormsg="the file extension is wrong";var evt=new nexacro.ExcelImportErrorEventInfo(this,"onerror","ObjectError",errormsg,this, -1);this.on_fire_onerror(this,evt);return false;}}return true;};_pExcelImport.importDataEx=function(importid,fileurl,range,responseData,userData){this._importid=importid;this.importData(fileurl,range,responseData,userData);};_pExcelImport._addImportId=function(v){var list=this._importid_list;var cnt=list?list.length:0;var id;for(var i=0;i<cnt;i++ ){id=list[i];if(id==v){return false;}}list.push(v);return true;};_pExcelImport._removeImportId=function(v){var list=this._importid_list;var cnt=list?list.length:0;var id;for(var i=0;i<cnt;i++ ){id=list[i];if(id==v){return list.splice(i,1);}}return null;};_pExcelImport.destroy=function(){var unique_id=this._unique_id;if(this.parent){this.parent.removeChild(this.id);}if(this._hidden_frame_handle){nexacro._remove_hidden_item(unique_id,"upfile",this._hidden_frame_handle);nexacro._remove_hidden_item(unique_id,"ds_command",this._hidden_frame_handle);nexacro._destroy_hidden_frame(unique_id,this,"import");}this._hidden_frame_handle=null;this.parent=null;return true;};_pExcelImport.on_fire_onerror=function(obj,e){this._setWaitCursor(false);var event=this.onerror;if(event&&event._has_handlers){event._fireEvent(this,e);}};_pExcelImport.on_fire_onsuccess=function(obj,e){this._setWaitCursor(false);var event=this.onsuccess;if(event&&event._has_handlers){event._fireEvent(this,e);}};_pExcelImport._getExcelRowCol=function(cell){var strLen=cell.length;var arr=[];for(var i=0;i<strLen;i++ ){if(!isNaN(cell[i])){arr.push(cell.substring(0,i));arr.push(cell.substring(i));break;}}return arr;};_pExcelImport._transaction=function(id,url,inDatasetsParam,outDatasetsParam,userData,callbackFn,isAsync,datatype,isCompress){this._load_manager=new nexacro._LoadManager(this);var service=nexacro._getServiceObject(url,true);this._load_manager.loadDataModule(url,id,inDatasetsParam,outDatasetsParam,userData,callbackFn,isAsync,datatype,isCompress,service);};_pExcelImport._getDataset=function(ds_id){var r_val=this._responseRVal;var l_val=this._responseLVal;var len=r_val.length;for(var i=0;i<len;i++ ){if(r_val[i]==ds_id){return this._getDatasetObject(l_val[i]);}else if(ds_id=="IMPORTFILES"){return this._getDatasetObject("_file_url_ds");}}return null;};_pExcelImport._waitCursor=nexacro._emptyFn;_pExcelImport._setParamter=nexacro._emptyFn;_pExcelImport._getDatasetObject=function(queryid){var _ds=this[queryid];var app=nexacro.getApplication();if(_ds==null&&this.parent&&this.parent!=app){_ds=this.parent._getDatasetObject(queryid);}if(_ds==null){_ds=app[queryid];}return _ds;};_pExcelImport._getForm=function(){var app=nexacro.getApplication();var form;if(app){form=app.getActiveForm();if(!form){var mainframe=app.getActiveFrame();var pThis=this;while(pThis&&mainframe!=pThis){if(!pThis._is_frame){pThis=pThis.parent;}else if(pThis.form){return pThis.form;}}}}return form;};_pExcelImport._isPopupFrame=function(){return false;};_pExcelImport._makeImportFormat=function(){var str="<Import>";str+="<Sheets>";var sheets=this._range.split("]");var s_len=sheets.length-1;s_len=s_len==0?1:s_len;var properties,property;var output_num=1;for(var i=0;i<s_len;i++ ){str+="<Sheet ";properties=sheets[i].match(/[_A-Za-z0-9]+=[\(\)_!:A-Za-z0-9- \.\-]+/g);if(properties==null){var range=sheets[i];if(range.indexOf("!")>=0){var range_arr=range.split("!");if(range_arr[1].indexOf(":")>=0){var sheet=range_arr[0];var rangeitem=range_arr[1].split(":");var start_row=rangeitem[0].match(/[0-9]+/);var start_col=rangeitem[0].match(/[A-Z]+/);var end_row=rangeitem[1].match(/[0-9]+/);var end_col=rangeitem[1].match(/[A-Z]+/);str+='command=\"getsheetdata\" output=\"'+this._responseRVal+'\" head=\"'+sheet+'!'+start_col+start_row+':'+end_col+start_row+'\" body=\"'+sheet+'!'+start_col+( +start_row+1)+':'+end_col+end_row+'\" />';}else{str+='command=\"getsheetdata\" output=\"'+this._responseRVal+'\" Body=\"'+sheets[i]+'\" />';}}else{str+='command=\"getsheetdata\" output=\"'+this._responseRVal+'\" Body=\"'+sheets[i]+'\" />';}}else{var flag=false;for(var j=0,p_len=properties.length;j<p_len;j++ ){property=properties[j].match(/[\(\)_!:A-Za-z0-9- \.\-]+/g);var property_name=property[0].toLowerCase();if(property_name!="command"){if(j==0){str+='command=\"getsheetdata\" ';}if(property_name=="output"){flag=true;}}str+=property_name+"=\""+property[1]+"\" ";}if(!flag){str+='output=\"output'+output_num+'\" ';output_num++ ;}str+="/>";}}str+="</Sheets>";str+="</Import>";return str;};_pExcelImport._requestImport=function(fileUrl){if(nexacro._Browser!="Runtime"){if(!nexacro._isSameOrigin(this._importurl,nexacro._project_url)){this._iscors=true;}}var ds_command=this._ds_command=new nexacro.NormalDataset("COMMAND");ds_command.addColumn("command","String",32);ds_command.addColumn("type","int",32);ds_command.addColumn("url","String",256);ds_command.addColumn("format","String",256);ds_command.addColumn("filemode","String",256);ds_command.addColumn("password","String",256);ds_command.addColumn("rawdatevalue","String",256);ds_command.addColumn("rawnumbervalue","String",256);ds_command.addColumn("importid","String",256);ds_command.addColumn("usehtmltag","String",256);ds_command.addRow();ds_command.setColumn(0,"command","import");ds_command.setColumn(0,"type",this._importType);ds_command.setColumn(0,"url",fileUrl);ds_command.setColumn(0,"format",this._makeImportFormat());ds_command.setColumn(0,"filemode",this._importfilemode?"server":"local");ds_command.setColumn(0,"password",this._file_password);ds_command.setColumn(0,"rawdatevalue",this._userawdatevalue);ds_command.setColumn(0,"rawnumbervalue",this._userawnumbervalue);ds_command.setColumn(0,"importid",this._importid);ds_command.setColumn(0,"usehtmltag",this._usehtmltag);if(this._iscors){ds_command.addColumn("responsetype","String",256);ds_command.setColumn(0,"responsetype",1);}if(this._ds_response){delete this._ds_response;}var evt;var datasets=this._responseLVal;if(datasets){for(var i=0,d_len=datasets.length;i<d_len;i++ ){var reponseDS=this.parent[datasets[i]];if(reponseDS){}else{evt=new nexacro.ExcelImportErrorEventInfo(this,"onerror","ObjectError","Dataset is null",this, -2011);this.on_fire_onerror(this,evt);return;}}}else{evt=new nexacro.ExcelImportErrorEventInfo(this,"onerror","ObjectError","Dataset is null",this, -2011);this.on_fire_onerror(this,evt);return;}this._file_url_ds=new nexacro.NormalDataset("_file_url_ds",this);this._tran_item=new nexacro.TransactionItem(this._importurl,this,this.id,"COMMAND=_ds_command",this._responseData+", _file_url_ds=IMPORTFILES",this._user_data,0,true);nexacro._setImportCommand(this._unique_id,"ds_command",this,this._hidden_frame_handle,this._tran_item._sendData);nexacro._submit(this._unique_id,this._uploadservlet,this._hidden_frame_handle,this._tran_item._sendData,fileUrl);};if(nexacro._Browser=="Runtime"){_pExcelImport._uploadComplete=function(status,data,url,errcode,httpcode,locationurl,extramsg){var application=nexacro.getApplication();if(application){application._endCommProgress();}var evt,error_info,fileUrl,unique_id=this._unique_id,code= -1,msg="",result=null,importid;if(status<0){nexacro._onHttpSystemError(this,true,this,errcode,url,httpcode,url,null,extramsg);var commerrorobj=nexacro.MakeCommunicationError(this,errcode,url,httpcode,url,null,extramsg);evt=new nexacro.ExcelImportErrorEventInfo(this,"onerror","ObjectError",commerrorobj.message,this,9901);this.on_fire_onerror(this,evt);}else{if(data){if(data.indexOf("<noscript>")>=0){data=data.substr(data.indexOf("<noscript>")+10);data=data.substr(0,data.indexOf("</noscript>"));}this.context=this.parent;var fstr=data.slice(0,10).toUpperCase();if(fstr.indexOf("SSV")==0){result=nexacro._Deserializer["SSV"](data,this);}else if(fstr.indexOf("<?XML")==0){var xmldoc=nexacro._getXMLDocument(this._unique_id,data,url);result=nexacro._Deserializer["XML"](xmldoc,this);}error_info=result?result[0]:null;if(error_info){code=error_info["ErrorCode"];msg=error_info["ErrorMsg"];}}if(code<0){if(status!=4){evt=new nexacro.ExcelImportErrorEventInfo(this,"onerror","ObjectError",msg,this,9901);this.on_fire_onerror(this,evt);}}else{fileUrl=this._fileurl=this._file_url_ds?this._file_url_ds.getColumn(0,3):null;importid=this._file_url_ds?this._file_url_ds.getColumn(0,"importid"):null;this._file_url_ds=null;evt=new nexacro.ExcelImportEventInfo(this,"onsuccess",fileUrl,this,importid);this.on_fire_onsuccess(this,evt);this._removeImportId(importid);}}nexacro._remove_hidden_item(unique_id,"upfile",this._hidden_frame_handle);nexacro._append_hidden_item(unique_id,"upfile",this._checkUploadFile,this,this._hidden_frame_handle);};}else{_pExcelImport._uploadComplete=function(status,data,url){var code= -1;var msg="";var unique_id=this._unique_id;var evt,result,importid;try{if(this._iscors){nexacro._setPostMessage(this._unique_id,this);this._iscors=false;}else{var xmldoc=nexacro._getXMLDocument(unique_id);url=xmldoc.URL?xmldoc.URL:xmldoc.url;if(url=="about:blank"){return;}data=nexacro._getDataFromDOM(xmldoc);if(!data||data.length<=0){var node=xmldoc.childNodes[0];if(node){if(nexacro._Browser=="IE"&&nexacro._BrowserVersion<9){data=node.innerHTML;}else{data=xmldoc.head.innerHTML;}data=nexacro._decodeXml(data);}}if(data.indexOf("<noscript>")>=0){data=data.substr(data.indexOf("<noscript>")+10);data=data.substr(0,data.indexOf("</noscript>"));}this.context=this.parent;var fstr=data.substring(0,3).toUpperCase();switch(fstr){case "XML":xmldoc=nexacro._getXMLDocument(unique_id,data,url);result=nexacro._Deserializer["XML"](xmldoc,this);break;case "SSV":result=nexacro._Deserializer["SSV"](data,this);break;default:break;}if(result){code=result[0]["ErrorCode"];msg=result[0]["ErrorMsg"];}if(code<0){evt=new nexacro.ExcelImportErrorEventInfo(this,"onerror","ObjectError",msg,this,9901);this.on_fire_onerror(this,evt);}else{this._fileurl=this._file_url_ds?this._file_url_ds.getColumn(0,3):null;importid=this._file_url_ds?this._file_url_ds.getColumn(0,"importid"):null;this._file_url_ds=null;evt=new nexacro.ExcelImportEventInfo(this,"onsuccess",this._fileurl,this,importid);this.on_fire_onsuccess(this,evt);this._removeImportId(importid);}}}catch(e){evt=new nexacro.ExcelImportErrorEventInfo(this,"onerror","ObjectError","failed to get",this,9901);this.on_fire_onerror(this,evt);}nexacro._remove_hidden_item(unique_id,"upfile",this._hidden_frame_handle);nexacro._append_hidden_item(unique_id,"upfile",this._checkUploadFile,this,this._hidden_frame_handle);};}_pExcelImport.on_after_load=function(messageObj){var str=messageObj.message;var result,evt,fstr,url,code= -1,msg="",data="";var fileUrl,importid;try{var type=str.slice(0,10).toUpperCase();if(type.indexOf("SSV">=0)){result=nexacro._Deserializer["SSV"](str,this);}else{str=decodeURIComponent(str.replace(/\+/g," "));var xmldoc=nexacro._parseXMLDocument(str);url=xmldoc.URL?xmldoc.URL:xmldoc.url;if(url=="about:blank"){return;}if(nexacro._getContentType(xmldoc)=="XML"){result=nexacro._Deserializer["XML"](xmldoc,this);}else{data=nexacro._getDataFromDOM(xmldoc,this);data=nexacro.trimLeft(data);fstr=data.substring(0,3).toUpperCase();if(fstr=="SSV"){result=nexacro._Deserializer["SSV"](data,this);}}}if(result){var error_info=result[0];if(error_info["ErrorCode"]!=null){code=error_info["ErrorCode"];}if(error_info["ErrorMsg"]!=null){msg=error_info["ErrorMsg"];}}else{msg=data;}if(code<0){evt=new nexacro.ExcelImportErrorEventInfo(this,"onerror","ObjectError",msg,this,9901);this.on_fire_onerror(this,evt);}else{fileUrl=this._fileurl=this._file_url_ds?this._file_url_ds.getColumn(0,3):null;importid=this._file_url_ds?this._file_url_ds.getColumn(0,"importid"):null;this._file_url_ds=null;evt=new nexacro.ExcelImportEventInfo(this,"onsuccess",fileUrl,this,importid);this.on_fire_onsuccess(this,evt);this._removeImportId(importid);}}catch(e){evt=new nexacro.ExcelImportErrorEventInfo(this,"onerror","ObjectError","failed to get",this,9901);this.on_fire_onerror(this,evt);}};_pExcelImport._checkFileName=function(str){if(str==null){return false;}var checkExcel=false;var extension="";var index=str.lastIndexOf("\\");var filename=str.substring(index+1);var _split=filename.split(".");var len=_split.length;if(len>1){extension=_split[len-1];extension=extension.toLowerCase();switch(extension){case "xls":checkExcel=true;this._importType=nexacro.ImportTypes.EXCEL97;break;case "xlsx":case "xlsm":checkExcel=true;this._importType=nexacro.ImportTypes.EXCEL2007;break;case "cell":checkExcel=true;this._importType=this.importtype;break;case "csv":checkExcel=true;this._importType=nexacro.ImportTypes.CSV;break;}}return checkExcel;};_pExcelImport._checkUploadFile=function(excel){this._setWaitCursor(true);if(this._checkFileName(excel)){this._requestImport(excel);}else{var errormsg="the file extension is wrong";var evt=new nexacro.ExcelImportErrorEventInfo(this,"onerror","ObjectError",errormsg,this, -1);this.on_fire_onerror(this,evt);}};_pExcelImport._setWaitCursor=function(wait_flag){var form=this._getForm();if(form){form.setWaitCursor(wait_flag,true);}};_pExcelImport._getWindow=function(){var form=this.parent;if(form._is_form){return form._getWindow();}return null;};_pExcelImport._getWindowHandle=function(){var form=this.parent;if(form._is_form){return form._getWindowHandle();}return null;};_pExcelImport._changeFiles=nexacro._emptyFn;delete _pExcelImport;}
if(!nexacro.Tray){nexacro.Tray=function(id,parent){this.id=id;this.icon="default";this.tooltip="";this.items=new nexacro.Collection();this.name=id;this._handle=null;this._event_list={"onlbuttonup":1,"onrbuttonup":1,"ondblclick":1,"oninnerdatachanged":1};};var _pTray=nexacro._createPrototype(nexacro._EventSinkObject,nexacro.Tray);nexacro.Tray.prototype=_pTray;_pTray._type_name="Tray";_pTray.on_created=function(){this._handle=nexacro._createTrayHandle(this.icon,this.tooltip);var cnt=this.items.length;for(var i=0;i<cnt;i++ ){this.items[i].on_created();}};_pTray._destroy=function(){var cnt=this.items.length;for(var i=cnt-1;i>=0;i-- ){this.items.delete_item(i);}nexacro._removeTrayHandle(this._handle);this._handle=null;var application=nexacro.getApplication();if(application){application.trays.delete_item(this.id);application.all.delete_item(this.id);}};_pTray.set_icon=function(v){if(v!=this.icon){this.icon=v;}if(this._handle){nexacro._setTrayIconHandle(this._handle,this.icon);}};_pTray.set_tooltip=function(v){if(v!=this.tooltip){this.tooltip=v;}if(this._handle){nexacro._setTrayTooltipHandle(this._handle,this.tooltip);}};_pTray.show=function(){this.on_created();};_pTray.destroy=function(){this._destroy();};_pTray.init=function(id,icon,tooltip){this.set_id(id);this.set_icon(icon);this.set_tooltip(tooltip);};_pTray.showBalloonTip=function(titleicon,title,text,nosound){var timeout= -1;if(!nosound){nosound=false;}nexacro._showTrayBalloonTipHandle(this._handle,titleicon,title,text,timeout,nosound);};_pTray.addItem=function(id,obj){if(obj._type_name=="TrayPopupMenu"){if(this.items.indexOf(id)>=0){return  -1;}else{return this.items.add_item(id,obj);}}};_pTray.insertItem=function(index,id,obj){if(obj._type_name=="TrayPopupMenu"){if(this.items.indexOf(id)>=0){return  -1;}else{return this.items.insert_item(index,id,obj);}}};_pTray.deleteItem=function(id){return this.items.delete_item(id);};_pTray.findItem=function(id){var find_pos=this.items.indexOf(id);return find_pos;};_pTray.getItemCount=function(){var count=this.items.length;return count;};_pTray.on_fire_ondblclick=function(button,alt_key,ctrl_key,shift_key,screenX,screenY){if(this.ondblclick&&this.ondblclick._has_handlers){var evt=new nexacro.ClickEventInfo(this,"ondblclick","lbutton",alt_key,ctrl_key,shift_key,screenX,screenY, -1, -1, -1, -1,this,this);return this.ondblclick._fireEvent(this,evt);}return false;};_pTray.on_fire_onlbuttonup=function(button,alt_key,ctrl_key,shift_key,screenX,screenY){if(this.onlbuttonup&&this.onlbuttonup._has_handlers){var evt=new nexacro.MouseEventInfo(this,"onlbuttonup","lbutton",alt_key,ctrl_key,shift_key,screenX,screenY, -1, -1, -1, -1,this,this);return this.onlbuttonup._fireEvent(this,evt);}return false;};_pTray.on_fire_onrbuttonup=function(button,alt_key,ctrl_key,shift_key,screenX,screenY){if(this.onrbuttonup&&this.onrbuttonup._has_handlers){var evt=new nexacro.MouseEventInfo(this,"onrbuttonup","rbutton",alt_key,ctrl_key,shift_key,screenX,screenY, -1, -1, -1, -1,this,this);return this.onrbuttonup._fireEvent(this,evt);}return false;};delete _pTray;}if(!nexacro.TrayPopupMenu){nexacro.TrayPopupMenu=function(id,parent){this.id=this.name=id;this.parent=parent;this._popupmenu=null;this._handle=null;this._is_created=false;this.innerdataset="";this._innerdataset="";this._level=0;this._rowindex=0;this.captioncolumn="";this.checkboxcolumn="";this.enablecolumn="";this.hotkeycolumn="";this.iconcolumn="";this.idcolumn="";this.levelcolumn="";this.userdatacolumn="";this._event_list={"onmenuclick":1};};var _pTrayPopupMenu=nexacro._createPrototype(nexacro._EventSinkObject,nexacro.TrayPopupMenu);nexacro.TrayPopupMenu.prototype=_pTrayPopupMenu;_pTrayPopupMenu._type_name="TrayPopupMenu";_pTrayPopupMenu.on_created=function(){this._is_created=true;if(this._innerdataset==null&&this.innerdataset!=null){var str=this.innerdataset;var application=nexacro.getApplication();if(application){this._innerdataset=application._getDatasetObject(str);this.on_apply_innerdataset();}}this._handle=nexacro._createTrayPopupMenuHandle(this.parent._handle);this._createPopupMenu(this._handle);};_pTrayPopupMenu._createPopupMenu=function(handle){if(this._handle==null||handle==null||handle==0){return;}var ds=this._innerdataset;if(ds&&this.levelcolumn&&this.captioncolumn&&this.idcolumn){var len=ds.getRowCount();for(var rowindex=this._rowindex;rowindex<len;rowindex++ ){var level=ds.getColumn(rowindex,this.levelcolumn);if(level==this._level){var flags="string";var caption=ds.getColumn(rowindex,this.captioncolumn);if(caption=="-"){flags="separator";}var icon=ds.getColumn(rowindex,this.iconcolumn);if(icon){flags="bitmap";}var enable=ds.getColumn(rowindex,this.enablecolumn);if(enable){if(!nexacro._toBoolean(enable)){flags="disabled";}}var id=ds.getColumn(rowindex,this.idcolumn);if(id){id=rowindex;}var checkbox=ds.getColumn(rowindex,this.checkboxcolumn);if(checkbox){if(nexacro._toBoolean(checkbox)){flags="checked";}}icon=ds.getColumn(rowindex,this.iconcolumn);var nextlevel=ds.getColumn(rowindex+1,this.levelcolumn);if(nextlevel-level==1){flags="popup";var sub_handle=nexacro._createTrayPopupMenuHandle(this.parent._handle);this._level++ ;this._rowindex=rowindex+1;this._createPopupMenu(sub_handle);nexacro._setTrayPopupMenuItemHandle(this.parent._handle,handle,flags,sub_handle,caption,icon);this._level-- ;nextlevel=ds.getColumn(this._rowindex+1,this.levelcolumn);if(nextlevel-level<0){break;}}else if(nextlevel-level<0){nexacro._setTrayPopupMenuItemHandle(this.parent._handle,handle,flags,id,caption,icon);this._rowindex=rowindex;break;}else{nexacro._setTrayPopupMenuItemHandle(this.parent._handle,handle,flags,id,caption,icon);}}}}};_pTrayPopupMenu._updatePopupMenu=function(handle){this._level=0;this._rowindex=0;nexacro._destroyTrayPopupMenuHandle(this.parent._handle,handle);this._handle=nexacro._createTrayPopupMenuHandle(this.parent._handle);this._createPopupMenu(this._handle);};_pTrayPopupMenu.trackPopup=function(){if(this._handle){nexacro._current_tray_popup=this;nexacro._displayTrayPopupMenuHandle(this.parent._handle,this._handle);}};_pTrayPopupMenu.set_innerdataset=function(str){if(typeof str!="string"){this.setInnerDataset(str);return;}if(str!=this.innerdataset){if(!str){this._innerdataset=null;this.innerdataset="";}else{str=str.replace("@","");var application=nexacro.getApplication();if(application){this._innerdataset=application._getDatasetObject(str);}this.innerdataset=str;}this.on_apply_innerdataset();}else if(this.innerdataset&&!this._innerdataset){this._setInnerDatasetStr(this.innerdataset);this.on_apply_innerdataset();}};_pTrayPopupMenu.on_apply_innerdataset=function(){var ds=this._innerdataset;if(ds){var callback=this._callbackFromDataset;ds._setEventHandler("onrowposchanged",callback,this);ds._setEventHandler("oncolumnchanged",callback,this);ds._setEventHandler("onrowsetchanged",callback,this);ds._setEventHandler("onvaluechanged",this._callback_onvaluechanged,this);if(this._handle){this._updatePopupMenu(this._handle);}}};_pTrayPopupMenu._callbackFromDataset=function(obj,e){if(this._handle){if(e.eventid=="onrowsetchanged"){this._updatePopupMenu(this._handle);}}};_pTrayPopupMenu._setInnerDatasetStr=function(str){if(!str){this._innerdataset=null;this.innerdataset="";}else{str=str.replace("@","");var application=nexacro.getApplication();if(application){this._innerdataset=application._getDatasetObject(str);}this.innerdataset=str;}};_pTrayPopupMenu.getInnerDataset=function(){return this._innerdataset;};_pTrayPopupMenu.setInnerDataset=function(obj){if(!obj){this._innerdataset=null;this.innerdataset="";this.on_apply_innerdataset();}else if(obj instanceof nexacro.Dataset){this._innerdataset=obj;this.innerdataset=obj.id;this.on_apply_innerdataset();}};_pTrayPopupMenu.set_captioncolumn=function(v){if(v!=this.captioncolumn){this.captioncolumn=v;this.on_apply_captioncolumn();}};_pTrayPopupMenu.on_apply_captioncolumn=function(){var ds=this._innerdataset;if(ds){this._updatePopupMenu(this._handle);}};_pTrayPopupMenu.set_checkboxcolumn=function(v){if(v!=this.checkboxcolumn){this.checkboxcolumn=v;this.on_apply_checkboxcolumn();}};_pTrayPopupMenu.on_apply_checkboxcolumn=function(){var ds=this._innerdataset;if(ds){this._updatePopupMenu(this._handle);}};_pTrayPopupMenu.set_enablecolumn=function(v){if(v!=this.enablecolumn){this.enablecolumn=v;this.on_apply_enablecolumn();}};_pTrayPopupMenu.on_apply_enablecolumn=function(){var ds=this._innerdataset;if(ds){this._updatePopupMenu(this._handle);}};_pTrayPopupMenu.set_hotkeycolumn=function(v){if(v!=this.hotkeycolumn){this.hotkeycolumn=v;this.on_apply_hotkeycolumn();}};_pTrayPopupMenu.on_apply_hotkeycolumn=function(){var ds=this._innerdataset;if(ds){this._updatePopupMenu(this._handle);}};_pTrayPopupMenu.set_iconcolumn=function(v){if(v!=this.iconcolumn){this.iconcolumn=v;this.on_apply_iconcolumn();}};_pTrayPopupMenu.on_apply_iconcolumn=function(){var ds=this._innerdataset;if(ds){this._updatePopupMenu(this._handle);}};_pTrayPopupMenu.set_idcolumn=function(v){if(v!=this.idcolumn){this.idcolumn=v;this.on_apply_idcolumn();}};_pTrayPopupMenu.on_apply_idcolumn=function(){var ds=this._innerdataset;if(ds){this._updatePopupMenu(this._handle);}};_pTrayPopupMenu.set_levelcolumn=function(v){if(v!=this.levelcolumn){this.levelcolumn=v;this.on_apply_levelcolumn();}};_pTrayPopupMenu.on_apply_levelcolumn=function(){var ds=this._innerdataset;if(ds){this._updatePopupMenu(this._handle);}};_pTrayPopupMenu.set_userdatacolumn=function(v){if(v!=this.userdatacolumn){this.userdatacolumn=v;this.on_apply_userdatacolumn();}};_pTrayPopupMenu.on_apply_userdatacolumn=function(){var ds=this._innerdataset;if(ds){this._updatePopupMenu(this._handle);}};_pTrayPopupMenu.on_fire_onmenuclick=function(id){var ds=this._innerdataset;var index=id;var itemid=ds.getColumn(index,this.idcolumn);var itemuserdata=ds.getColumn(index,this.userdatacolumn);var level=ds.getColumn(index,this.levelcolumn);if(this.onmenuclick&&this.onmenuclick._has_handlers){var evt=new nexacro.MenuClickEventInfo(this,"onmenuclick",itemid,itemuserdata,index,level);this.onmenuclick._fireEvent(this,evt);}};_pTrayPopupMenu.on_fire_oninnerdatachanged=function(obj,oldvalue,newvalue,columnid,col,row){if(this.oninnerdatachanged&&this.oninnerdatachanged._has_handlers){var evt=new nexacro.InnerdataChangedEventInfo(obj,"oninnerdatachanged",oldvalue,newvalue,columnid,col,row);return this.oninnerdatachanged._fireEvent(this,evt);}return true;};_pTrayPopupMenu._callback_onvaluechanged=function(obj,e){if(this._is_created){this.on_fire_oninnerdatachanged(obj,e.oldvalue,e.newvalue,e.columnid,e.col,e.row);if(this._handle){this._updatePopupMenu(this._handle);}}};delete _pTrayPopupMenu;}
if(!nexacro.Plugin){nexacro.Plugin=function(id,left,top,width,height,right,bottom,minwidth,maxwidth,minheight,maxheight,parent){nexacro.Component.call(this,id,left,top,width,height,right,bottom,minwidth,maxwidth,minheight,maxheight,parent);this._params=new nexacro.Collection();this._events=new nexacro.Collection();};var _pPlugin=nexacro._createPrototype(nexacro.Component,nexacro.Plugin);nexacro.Plugin.prototype=_pPlugin;_pPlugin._type_name="Plugin";_pPlugin.classid="";_pPlugin.classid64="";_pPlugin.codebase="";_pPlugin.code="";_pPlugin.archive="";_pPlugin.mimetype="";_pPlugin.pluginsrc="";_pPlugin.pluginpage="";_pPlugin.license="";_pPlugin.lpkpath="";_pPlugin.contents="";_pPlugin.adjustalpha=false;_pPlugin.usepersistdata=false;_pPlugin.windowed=false;_pPlugin.popupstyle=false;_pPlugin._obj_id="";_pPlugin._obj_elem=null;_pPlugin._params=null;_pPlugin._event_params=null;_pPlugin.set_visible=function(v){if(v===undefined||v===null){return;}v=nexacro._toBoolean(v);nexacro.Component.prototype.set_visible.call(this,v);var obj_elem=this._obj_elem;if(obj_elem){obj_elem.setElementVisible(v);}};_pPlugin.on_create_contents=function(){var control_elem=this.getElement();if(control_elem){var obj_elem=this._obj_elem=new nexacro.PluginElement(control_elem);obj_elem.setElementSize(this._getClientWidth(),this._getClientHeight());}this.on_apply_classid();this.on_apply_classid64();this.on_apply_codebase();this.on_apply_code();this.on_apply_archive();this.on_apply_mimetype();this.on_apply_pluginsrc();this.on_apply_pluginpage();this.on_apply_plugintype();this.on_apply_license();this.on_apply_lpkpath();this.on_apply_adjustalpha();this.on_apply_usepersistdata();this.on_apply_windowed();this.on_apply_popupstyle();};_pPlugin.on_create_contents_command=function(){if(this._obj_elem){return this._obj_elem.createCommand();}return "";};_pPlugin.on_attach_contents_handle=function(win){if(this._obj_elem){this._obj_elem.attachHandle(win);}};_pPlugin.on_created_contents=function(win){var obj_elem=this._obj_elem;if(obj_elem){obj_elem.component=this;var params=this._params;var i,param_cnt=params.length;for(i=0;i<param_cnt;i++ ){obj_elem.setElementParam(params.get_id(i),params.get_item(i));}var events=this._events;var event_cnt=events.length;for(i=0;i<event_cnt;i++ ){obj_elem.addEventHandler(events.get_id(i),events.get_item(i));}obj_elem.create(win);obj_elem.setElementVisible(this.visible);}};_pPlugin.on_destroy_contents=function(){var obj_elem=this._obj_elem;if(obj_elem){obj_elem.destroy();this._obj_elem=null;}};_pPlugin.on_update_position=function(resize_flag,move_flag,update){nexacro.Component.prototype.on_update_position.call(this,resize_flag,move_flag,update);var obj_elem=this._obj_elem;if(obj_elem){if(resize_flag||move_flag){obj_elem.on_update_position(resize_flag,move_flag,this._adjust_left,this._adjust_top);}}};_pPlugin._apply_setfocus=function(){var obj_elem=this._obj_elem;if(obj_elem){obj_elem.setElementFocus();}};_pPlugin.on_change_containerRect=function(width,height){var obj_elem=this._obj_elem;if(obj_elem){obj_elem.setElementSize(width,height);}};_pPlugin._setContents=function(str){if(str.length){if(str.indexOf("<Contents>")!=0){str="<Contents>"+str+"</Contents>";}var doc=nexacro._parseXMLDocument(str);if(doc){this._params.clear();var elems=doc.getElementsByTagName("Param");if(elems){var len=elems.length;for(var i=0;i<len;i++ ){var param=elems[i];var name=param.getAttribute("name");var value=param.getAttribute("value");var obj_elem=this._obj_elem;if(obj_elem){obj_elem.setElementParam(name,value);}else{this._params.add_item(name,value);}}}}}};_pPlugin.set_contents=function(str){this.contents=str;this._setContents(str);};_pPlugin.set_classid=function(v){this.classid=v;this.on_apply_classid();};_pPlugin.on_apply_classid=function(){var elem=this._obj_elem;if(elem){var classid=this.classid;elem.setElementClassId(classid);}};_pPlugin.set_classid64=function(v){this.classid64=v;this.on_apply_classid64();};_pPlugin.on_apply_classid64=function(){var elem=this._obj_elem;if(elem){var classid64=this.classid64;elem.setElementClassId64(classid64);}};_pPlugin.set_codebase=function(v){this.codebase=v;this.on_apply_codebase();};_pPlugin.on_apply_codebase=function(){var elem=this._obj_elem;if(elem){var codebase=this.codebase;if(codebase){elem.setElementCodebase(codebase);}}};_pPlugin.set_code=function(v){this.code=v;this.on_apply_code();};_pPlugin.on_apply_code=function(){var elem=this._obj_elem;if(elem){var code=this.code;if(code){elem.setElementCode(code);}}};_pPlugin.set_archive=function(v){this.archive=v;this.on_apply_archive();};_pPlugin.on_apply_archive=function(){var elem=this._obj_elem;if(elem){var archive=this.archive;if(archive){elem.setElementArchive(archive);}}};_pPlugin.set_mimetype=function(v){this.mimetype=v;this.on_apply_mimetype();};_pPlugin.on_apply_mimetype=function(){var elem=this._obj_elem;if(elem){var mimetype=this.mimetype;if(mimetype){elem.setElementMIMEType(mimetype);}}};_pPlugin.set_pluginsrc=function(v){this.pluginsrc=v;this.on_apply_pluginsrc();};_pPlugin.on_apply_pluginsrc=function(){var elem=this._obj_elem;if(elem){var pluginsrc=this.pluginsrc;if(pluginsrc){elem.setElementPluginSrc(pluginsrc);}}};_pPlugin.set_plugintype=function(v){this.plugintype=v;this.on_apply_plugintype();};_pPlugin.on_apply_plugintype=function(){var elem=this._obj_elem;if(elem){var plugintype=this.plugintype;if(plugintype){elem.setElementPluginMIMEType(plugintype);}}};_pPlugin.set_pluginpage=function(v){this.pluginpage=v;this.on_apply_pluginpage();};_pPlugin.on_apply_pluginpage=function(){var elem=this._obj_elem;if(elem){var pluginpage=this.pluginpage;if(pluginpage){elem.setElementPluginPage(pluginpage);}}};_pPlugin.set_license=function(v){this.license=v;this.on_apply_license();};_pPlugin.on_apply_license=function(){var elem=this._obj_elem;if(elem){var license=this.license;if(license){elem.setElementLicense(license);}}};_pPlugin.set_lpkpath=function(v){this.lpkpath=v;this.on_apply_lpkpath();};_pPlugin.on_apply_lpkpath=function(){var elem=this._obj_elem;if(elem){var lpkpath=this.lpkpath;if(lpkpath){elem.setElementLicenseFile(lpkpath);}}};_pPlugin.set_adjustalpha=function(v){this.adjustalpha=nexacro._toBoolean(v);this.on_apply_adjustalpha();};_pPlugin.on_apply_adjustalpha=function(){var elem=this._obj_elem;if(elem){var adjustalpha=this.adjustalpha;if(adjustalpha){elem.setElementAdjustAlpha(adjustalpha);}}};_pPlugin.set_usepersistdata=function(v){this.usepersistdata=v;this.on_apply_usepersistdata();};_pPlugin.on_apply_usepersistdata=function(){var elem=this._obj_elem;if(elem){var usepersistdata=this.usepersistdata;if(usepersistdata){elem.setElementUsePersistData(usepersistdata);}}};_pPlugin.set_windowed=function(v){this.windowed=nexacro._toBoolean(v);};_pPlugin.on_apply_windowed=function(){var elem=this._obj_elem;if(elem){var windowed=this.windowed;if(windowed){elem.setElementWindowed(windowed);}}};_pPlugin.set_popupstyle=function(v){this.popupstyle=nexacro._toBoolean(v);this.on_apply_popupstyle();};_pPlugin.on_apply_popupstyle=function(){var elem=this._obj_elem;if(elem){var popupstyle=this.popupstyle;if(popupstyle){elem.setElementPopupStyle(popupstyle);}}};_pPlugin.install=function(){var elem=this._obj_elem;if(elem){elem.install();}};_pPlugin.isInstalled=function(){var elem=this._obj_elem;if(elem){return elem.isInstalled();}return false;};_pPlugin.isLoaded=function(){var elem=this._obj_elem;if(elem){return elem.isLoaded();}return false;};_pPlugin.setProperty=function(propId,val){var fname="set_"+propId;var setFn=this[fname];if(setFn){setFn.call(this,val);}else{var obj_elem=this._obj_elem;if(obj_elem){if(propId.toLowerCase()=="movie"){obj_elem.setElementPluginSrc(val);obj_elem.setElementPluginMIMEType("application/x-shockwave-flash");}obj_elem.setElementParam(propId,val);}else{this._params.add_item(propId,val);}}};_pPlugin.getProperty=function(propId){var val;var obj_elem=this._obj_elem;if(obj_elem){val=obj_elem.getElementParam(propId);}else{this._params.get_item(propId);}if(val==null){val=this[propId];}return val;};_pPlugin.callMethod=function(){var obj_elem=this._obj_elem;if(obj_elem){var conv_args=Array.prototype.slice.call(arguments);for(var i=0;i<conv_args.length;i++ ){if(conv_args[i] instanceof nexacro.Plugin){var plugin_elem=conv_args[i]._obj_elem;if(plugin_elem){conv_args[i]=plugin_elem.getPluginObject();}}}return obj_elem.callMethod.apply(obj_elem,conv_args);}};_pPlugin._fireEvent=function(){var i,ret;var handlers=this._user_handlers;var len=handlers.length;for(i=0;i<len;i++ ){var h=handlers[i];if(h){ret=h.handler.apply(h.target,arguments);}}return ret;};_pPlugin.addEventHandler=function(evt_id,func,target){var ret=false;var obj_elem=this._obj_elem;if(obj_elem){ret=obj_elem.addEventHandler(evt_id,func);}if(ret==false){this._events.add_item(evt_id,func);}if(evt_id in this._event_list==false){this._event_list[evt_id]=1;}ret=nexacro.Component.prototype.addEventHandler.call(this,evt_id,func,target);if(this[evt_id]){this[evt_id]._firePluginEvent=_pPlugin._fireEvent;}return ret;};_pPlugin.removeEventHandler=function(evt_id,func,target){var obj_elem=this._obj_elem;if(obj_elem){obj_elem.removeEventHandler(evt_id,func);}else{this._events.delete_item(evt_id);}return nexacro.Component.prototype.removeEventHandler.call(this,evt_id,func,target);};delete _pPlugin;}
if(!nexacro.VirtualFile){nexacro.VirtualFileEventInfo=function(strEventId,nReason,strTextdata,strBinarydata,strFilelist,strFilesize,strExist){this.eventid=strEventId;this.reason=nReason;this.textdata=strTextdata;this.binarydata=strBinarydata;this.fileattributelist=nexacro._getFileAttributeList(strFilelist);this.filesize=strFilesize;this.fileisexist=strExist;};var _pVirtualFileEventInfo=nexacro.VirtualFileEventInfo.prototype=nexacro._createPrototype(nexacro.Event,nexacro.VirtualFileEventInfo);_pVirtualFileEventInfo._type_name="VirtualFileEventInfo";delete _pVirtualFileEventInfo;nexacro.VirtualFileErrorEventInfo=function(strEventId,intErrorCode,strErrorMsg){this.id=this.eventid=strEventId;this.errortype="ObjectError";this.statuscode=intErrorCode;this.errormsg=strErrorMsg;};var _pVirtualFileErrorEventInfo=nexacro.VirtualFileErrorEventInfo.prototype=nexacro._createPrototype(nexacro.Event,nexacro.VirtualFileErrorEventInfo);_pVirtualFileErrorEventInfo._type_name="VirtualFileErrorEventInfo";delete _pVirtualFileErrorEventInfo;nexacro._FileAttribute=function(jsonObj){this.accesstime=jsonObj.accesstime;this.createtime=jsonObj.createtime;this.filename=jsonObj.filename;this.groupid=jsonObj.groupid;this.modifytime=jsonObj.modifytime;this.size=jsonObj.size;this.userid=jsonObj.userid;this.isdirectory=jsonObj.isdirectory;this.isreadonly=jsonObj.isreadonly;};var _pFileAttribute=nexacro._FileAttribute.prototype=nexacro._createPrototype(nexacro.Object,nexacro._FileAttribute);_pFileAttribute._type_name="_FileAttribute";_pFileAttribute.isDirectory=function(){return this.isdirectory;};_pFileAttribute.isHidden=function(){};_pFileAttribute.isLink=function(){};_pFileAttribute.isReadOnly=function(){return this.isreadonly;};delete _pFileAttribute;nexacro.VirtualFile=function(id,parent){this.id=this.name=id;this.parent=parent;if(arguments.length==3){this._handle=nexacro._createVirtualFileHandle(this,arguments[2]);}else{this._handle=nexacro._createVirtualFileHandle(this);}};var _pVirtualFile=nexacro.VirtualFile.prototype=nexacro._createPrototype(nexacro._EventSinkObject,nexacro.VirtualFile);_pVirtualFile._type_name="VirtualFile";_pVirtualFile.filename="";_pVirtualFile.fullpath="";_pVirtualFile.path="";_pVirtualFile.async="true";_pVirtualFile._file=null;_pVirtualFile._event_list={"onsuccess":1,"onerror":1};nexacro.VirtualFile.openRead=0x0001;nexacro.VirtualFile.openWrite=0x0002;nexacro.VirtualFile.openAppend=0x0010;nexacro.VirtualFile.openCreate=0x1000;nexacro.VirtualFile.openText=0x0100;nexacro.VirtualFile.openBinary=0x0200;nexacro.VirtualFile.seekBegin=0x0000;nexacro.VirtualFile.seekCurrent=0x0001;nexacro.VirtualFile.seekEnd=0x0002;nexacro.VirtualFile.findAll=0x0001;nexacro.VirtualFile.findFileOnly=0x0002;nexacro.VirtualFile.findDirectoryOnly=0x0004;nexacro.VirtualFile.findRecursive=0x0008;nexacro.VirtualFile.findCaseless=0x0010;_pVirtualFile.on_created=nexacro._emptyFn;_pVirtualFile.destroy=function(){nexacro._destroyVirtualFileHandle(this);if(this._handle){this._handle=null;}return true;};_pVirtualFile.set_filename=nexacro._emptyFn;_pVirtualFile.set_fullpath=nexacro._emptyFn;_pVirtualFile.set_path=nexacro._emptyFn;_pVirtualFile.set_async=function(v){v=nexacro._toBoolean(v);if(this.async!=v){this.async=v;this.on_apply_async();}};_pVirtualFile.on_apply_async=function(){nexacro._setVirtualFileHandleAsync(this,this.async);};_pVirtualFile.open=function(strFileName,nConstOptions){if(arguments.length<2){return false;}var bIsValid=this._IsValidConstOptions(nConstOptions);if(!bIsValid){return false;}if(!strFileName){if(this.fullpath||this.path||this.filename){return nexacro._openVirtualFileHandle(this,this.fullpath,nConstOptions);}}else{var strFullPath=strFileName.split("\\").join("/");this._setFullPath(strFullPath);this._setPath(this._getPath(strFullPath));this._setFileName(this._getFileName(strFullPath));return nexacro._openVirtualFileHandle(this,strFileName,nConstOptions);}return false;};_pVirtualFile.close=function(){nexacro._closeVirtualFileHandle(this);};_pVirtualFile.read=function(nLength,strCharset){nLength=nLength|| -1;strCharset=strCharset||"utf-8";if(isNaN(nLength)==false){nLength=nexacro._toInt(nLength);}if(typeof nLength!="number"||typeof strCharset!="string"){return false;}return nexacro._readVirtualFileHandle(this,nLength,strCharset);};_pVirtualFile.readLine=function(strDelimeter,strCharset){strDelimeter=strDelimeter||"\n";strCharset=strCharset||"utf-8";return nexacro._readlineVirtualFileHandle(this,strDelimeter,strCharset);};_pVirtualFile.seek=function(nOffset,nConstOptions){if(isNaN(nOffset= +nOffset)){return false;}if(arguments.length==1){nConstOptions=nexacro.VirtualFile.seekCurrent;}if(isNaN(nConstOptions= +nConstOptions)){return false;}return nexacro._seekVirtualFileHandle(this,nOffset,nConstOptions);};_pVirtualFile.write=function(varData,strCharset){var _varData=varData;var _strCharset="utf-8";if(typeof (_varData)=="undefined"||_varData.length==0){return false;}if(arguments.length==2){_strCharset=strCharset;}return nexacro._writeVirtualFileHandle(this,_varData,_strCharset);};_pVirtualFile.remove=function(strFilePath){if(!strFilePath){return false;}if(strFilePath instanceof nexacro.VirtualFile){strFilePath=strFilePath.fullpath;}return nexacro._removeVirtualFileHandle(this,strFilePath);};_pVirtualFile.copy=function(strSrc,strDest){if(!strSrc||!strDest){return false;}return nexacro._copyVirtualFileHandle(this,strSrc,strDest);};_pVirtualFile.rename=function(strOldname,strNewname){if(!strOldname||!strNewname){return false;}if(typeof strOldname!='string'){return false;}if(typeof strNewname!='string'){return false;}return nexacro._renameVirtualFileHandle(this,strOldname,strNewname);};_pVirtualFile.getFileList=function(strPath,strSearchExpr,nConstOptions){if(!strPath||!strSearchExpr){return false;}if(arguments.length<=2){nConstOptions=nexacro.VirtualFile.findAll;}return nexacro._getFileListVirtualFileHandle(this,strPath,strSearchExpr,nConstOptions);};_pVirtualFile.getFileSize=function(){return nexacro._getFileSizeVirtualFileHandle(this,this.fullpath);};_pVirtualFile.isExist=function(strPath){if(!strPath){return false;}return nexacro._isExistVirtualFileHandle(this,strPath);};_pVirtualFile.createDirectory=function(strPath,bAllCreate){if(!strPath){return false;}if(arguments.length==1){bAllCreate=false;}else if(arguments.length==2){if(typeof bAllCreate!='boolean'){if(typeof bAllCreate=='number'){if(bAllCreate>=1){bAllCreate=true;}}else{bAllCreate=false;}}}return nexacro._createDirectoryVirtualFileHandle(this,strPath,bAllCreate);};_pVirtualFile.deleteDirectory=function(strPath,bAllChild){if(!strPath){return false;}if(arguments.length==1){bAllChild=false;}else if(arguments.length==2){if(typeof bAllChild!='boolean'){if(typeof bAllChild=='number'){if(bAllChild>=1){bAllChild=true;}else{bAllChild=false;}}else if(typeof bAllChild=='string'){if(bAllChild=="true"){bAllChild=true;}else{bAllChild=false;}}else{bAllChild=false;}}}return nexacro._deleteDirectoryVirtualFileHandle(this,strPath,bAllChild);};_pVirtualFile.renameDirectory=function(strPath,strNewName){if(!strPath||!strNewName){return false;}if(strNewName.match(/[\"\/:*?<>|]/)){return false;}return nexacro._renameDirectoryVirtualFileHandle(this,strPath,strNewName);};_pVirtualFile.on_success=function(reason,textdata,bindata,fileattributelist,filesize,fileisexist){textdata=this._replaceEntity(textdata,["&amp;","&lt;","&gt;","&quot;","&apos;","&#32;","&#13;","&#10;","&#9;"])||"";bindata=this._replaceEntity(bindata,["&amp;","&lt;","&gt;","&quot;","&apos;","&#32;","&#13;","&#10;","&#9;"])||"";return this.on_fire_onsuccess(reason,textdata,bindata,fileattributelist,filesize,fileisexist);};_pVirtualFile._onsuccess=function(objData){var textdata=nexacro.base64Decode(objData.textdata);var bindata=nexacro.base64Decode(objData.binarydata);this.on_fire_onsuccess(objData.reason,textdata,bindata,objData.fileattributelist,objData.filesize,objData.fileisexist);};_pVirtualFile.on_fire_onsuccess=function(reason,textdata,bindata,fileattributelist,filesize,fileisexist){if(this.onsuccess&&this.onsuccess._has_handlers){var evt=new nexacro.VirtualFileEventInfo("onsuccess",reason,textdata,bindata,fileattributelist,filesize,fileisexist);this.onsuccess._fireEvent(this,evt);}return true;};_pVirtualFile.on_error=function(errorcode,errormsg){this.on_fire_onerror(errorcode,errormsg);};_pVirtualFile._onerror=function(objData){this.on_fire_onerror(objData.errorcode,objData.errormsg);};_pVirtualFile.on_fire_onerror=function(errorcode,errormsg){if(this.onerror&&this.onerror._has_handlers){var evt=new nexacro.VirtualFileErrorEventInfo("onerror",errorcode,errormsg);this.onerror._fireEvent(this,evt);}return true;};_pVirtualFile._createVirtualFileHandle=function(target){this._handle=nexacro._createVirtualFileHandle(target);};_pVirtualFile._setPath=function(v){this.path=v;};_pVirtualFile._setFullPath=function(v){this.fullpath=v;};_pVirtualFile._setFileName=function(v){this.filename=v;};_pVirtualFile._getPath=function(strFullpath){if(!strFullpath){return strFullpath;}strFullpath=strFullpath.split("\\").join("/");var path_idx=strFullpath.lastIndexOf("/");if(path_idx== -1){path_idx=strFullpath.lastIndexOf("%");}return strFullpath.substring(0,path_idx+1);};_pVirtualFile._getFileName=function(strFullpath){if(!strFullpath){return strFullpath;}strFullpath=strFullpath.split("\\").join("/");var name_idx=strFullpath.lastIndexOf("/");if(name_idx== -1){name_idx=strFullpath.lastIndexOf("%");}return strFullpath.substring(name_idx+1,strFullpath.length);};_pVirtualFile._replaceEntity=function(strText,entitylist){if(!strText){return strText;}var _map={"\&amp\;":"\&","\&lt\;":"\<","\&gt\;":"\>","\&quot\;":"\"","\&apos\;":"\'","\&\#32\;":"\ ","\&\#13\;":"\\r","\&\#10\;":"\\n","\&\#9\;":"\\t"};if(entitylist.length){var entity=entitylist.pop();return this._replaceEntity(strText.replace(new RegExp(entity,"g"),_map[entity]),entitylist);}return strText;};_pVirtualFile._IsValidConstOptions=function(nConstOptions){if(nConstOptions==1||nConstOptions==2||nConstOptions==16||nConstOptions==4096||nConstOptions==256||nConstOptions==512||nConstOptions==3||nConstOptions==17||nConstOptions==4097||nConstOptions==257||nConstOptions==513||nConstOptions==18||nConstOptions==4098||nConstOptions==258||nConstOptions==514||nConstOptions==4112||nConstOptions==528||nConstOptions==4352||nConstOptions==4608||nConstOptions==768||nConstOptions==19||nConstOptions==4099||nConstOptions==259||nConstOptions==515||nConstOptions==4114||nConstOptions==274||nConstOptions==530||nConstOptions==4368||nConstOptions==4624||nConstOptions==4864||nConstOptions==4115||nConstOptions==275||nConstOptions==531||nConstOptions==4370||nConstOptions==4626||nConstOptions==4880||nConstOptions==4371||nConstOptions==4627||nConstOptions==4882||nConstOptions==4883){return true;}return false;};delete _pVirtualFile;}
if(!nexacro.CellInfo){nexacro.CellInfo=function(id,parent,view,type,idx){this.parent=parent;this.id=this.name=id;this._type=type;this._view=view;this._cellidx=idx;this._col=0;this._colspan=0;this._row=0;this._rowspan=0;this._area="";this._endcol=false;this._subcells=[];this._isSubCell=false;this._maskstringtypeobj=new nexacro._EditMaskTypeString();this._masknumbertypeobj=new nexacro._GridMaskTypeNumber();this._key_direction=null;this._blinked_status=[];this._allocatePropertys(this._property_map);};var _pCellInfo=nexacro._createPrototype(nexacro.Object,nexacro.CellInfo);nexacro.CellInfo.prototype=_pCellInfo;_pCellInfo._type_name="CellInfo";nexacro._CELLINFO_PMAP_PROPNAME=0;nexacro._CELLINFO_PMAP_CTRLPROPNAME=1;nexacro._CELLINFO_PMAP_EXPRBIND=2;nexacro._CELLINFO_PMAP_DEFTVALUE=3;nexacro._CELLINFO_PMAP_STYLE=4;nexacro._CELLINFO_PMAP_VALTYPE=5;nexacro._CELLINFO_PMAP_ENUMVAL=6;_pCellInfo._property_map=[];_pCellInfo._property_map_cell=[["cssclass",null,true,"",true],["displaytype",null,true,"normal",false],["edittype",null,true,"none",false],["tooltiptype",null,false,"default",false],["tooltiptext",null,true,undefined,false],["autosizecol",null,false,"default",false,2,["none","limitmin","limitmax","default"]],["autosizerow",null,false,"default",false,2,["none","limitmin","limitmax","default"]],["displayexpdec",null,true, -1,false,0],["locale",null,true,"",false],["text",null,true,null,false],["expr",null,true,null,false],["subsumtext",null,true,null,false],["controlautosizingtype",null,true,"both",false,2,["none","width","height","both"]],["checkboxsize",null,true, -1,false,0],["rtl","rtl",true,undefined,false],["accessibilityaction","accessibilityaction",false,null,false],["accessibilitydesclevel","accessibilitydesclevel",false,"all",false],["accessibilitydescription","accessibilitydescription",false,null,false],["accessibilityenable","accessibilityenable",true,true,false,1],["accessibilitylabel","accessibilitylabel",true,null,false],["accessibilityrole","accessibilityrole",false,"gridcell",false],["color","color",false,null,true],["font","font",false,null,true],["wordSpacing","wordSpacing",false,null,true],["letterSpacing","letterSpacing",false,null,true],["textDecoration","textDecoration",false,null,true],["wordWrap",null,true,null,true],["borderRadius","borderRadius",false,null,true],["border","border",false,null,true],["background","background",false,null,true],["edge","edge",false,null,true],["cursor","cursor",false,null,true],["opacity","opacity",false,null,true],["boxShadow","boxShadow",false,null,true],["padding","padding",false,null,true],["textAlign","textAlign",false,null,true],["verticalAlign","verticalAlign",false,null,true]];_pCellInfo._property_map_checkbox=[["checkboxtruevalue","truevalue",true,null,false],["checkboxfalsevalue","falsevalue",true,null,false]];_pCellInfo._property_map_edit=[["editmaxlength",null,true, -1,false,0],["editautoselect","autoselect",true,false,false],["editautoskip","autoskip",true,false,false],["editimemode","imemode",true,"none",false,2,["none","alpha","alpha,full","hangul","hangul,full","katakana","katakana,full","hiragana","direct"]],["edituseime","useime",true,"global",false,2,["global","local","local,keep","none"]],["editinputfilter","inputfilter",true,"none",false],["editinputmode","inputmode",true,"normal",false],["editinputtype","inputtype",true,"normal",false]];_pCellInfo._property_map_maskedit=[["maskeditautoselect","autoselect",true,false,false],["maskeditlimitbymask","limitbymask",true,"decimal",false,2,["none","integer","decimal","both"]],["maskeditformat","format",true,"",false],["maskeditmaskchar","maskchar",false,"_",false],["maskeditclipmode","clipmode",true,"includespace",false,2,["includespace","excludespace"]],["maskeditautoskip","autoskip",true,false,false],["maskedittrimtype","trimtype",true,"none",false,2,["none","left","righ","both"]],["maskedittype","type",true,"number",false,2,["number","string"]]];_pCellInfo._property_map_textarea=[["textareaacceptsenter",null,true,false,false],["textareaacceptstab",null,true,false,false],["textareamaxlength",null,true, -1,false,0],["textareaautoselect","autoselect",true,false,false],["textareaimemode","imemode",true,"none",false,2,["none","alpha","alpha,full","hangul","hangul,full","katakana","katakana,full","hiragana","direct"]],["textareainputfilter","inputfilter",true,"none",false],["textareainputmode","inputmode",true,"normal",false],["textareainputtype","inputtype",true,"normal",false],["textareascrollbarsize",null,true,undefined,false,0],["textareascrollbartype",null,true,"auto",false],["textareascrolltype",null,true,"both",false,2,["none","both","horizontal","vertical"]],["textareaautoskip","autoskip",true,false,false],["textareauseime","useime",true,"global",false,2,["global","local","local,keep","none"]]];_pCellInfo._property_map_combo=[["combocodecol","codecolumn",true,"",false],["combodatacol","datacolumn",true,"",false],["combodataset","innerdataset",true,"",false],["combodisplaynulltext",null,true,"",false],["combodisplaynulltype",null,true,"none",false,2,["none","nulltext"]],["combodisplayrowcount","displayrowcount",true,undefined,false,0],["combotype","type",true,"dropdown",false,2,["dropdown","search","filter","filterlike","caseisearch","caseifilter","caseifilterlike"]],["comboitemheight","itemheight",true,undefined,false,0],["combopopuptype",null,true,"",false,2,["normal","center","system","none"]],["comboscrollbarsize",null,true,undefined,false,0],["combobuttonsize",null,true,undefined,false],["comboautoselect","autoselect",true,false,false],["comboimemode","imemode",true,"none",false,2,["none","alpha","alpha,full","hangul","hangul,full","katakana","katakana,full","hiragana","direct"]],["combopopupsize",null,true,undefined,false]];_pCellInfo._property_map_calendar=[["calendardisplaynulltext",null,true,"",false],["calendardisplaynulltype",null,true,"default",false,2,["default","none","nulltext","nullmask"]],["calendardisplayinvalidtext",null,true,"invalid value",false],["calendardisplayinvalidtype",null,true,"default",false,2,["default","none","invalidtext"]],["calendarbackgroundcolumn","backgroundcolumn",true,"",false],["calendarbordercolumn","bordercolumn",true,"",false],["calendardatecolumn","datecolumn",true,"",false],["calendartextcolorcolumn","textcolorcolumn",true,"",false],["calendardaysize","daysize",true,undefined,false],["calendarheadformat","headformat",true,"yyyy.MM",false],["calendardateformat",null,true,"yyyy-MM-dd ddd",false],["calendareditformat",null,true,"yyyy-MM-dd",false],["calendarweekformat","weekformat",true,undefined,false],["calendarpopupsize",null,true,undefined,false],["calendarpopuptype",null,true,undefined,false,2,["normal","center","system","none"]],["calendarbuttonsize",null,true,undefined,false],["calendarheadheight","headheight",true,undefined,false,0],["calendarshowmonthspin","showmonthspin",true,false,false,1],["calendarshowyearspin","showyearspin",true,false,false,1],["calendartype","type",true,"normal",false],["calendarusetrailingday","usetrailingday",true,false,false],["calendarautoselect","autoselect",true,false,false]];_pCellInfo._property_map_progressbar=[["progressbarblockgap","blockgap",true,undefined,false],["progressbarblocksize","blocksize",true,undefined,false],["progressbardirection","direction",true,"forward",false],["progressbarsmooth","smooth",true,false,false]];_pCellInfo._property_map_image=[["imagestretch","stretch",true,"none",false,2,["none","fit","fixaspectratio"]]];_pCellInfo._property_map_tree=[["treecheck",null,true,"",false],["treecollapseimage",null,true,"",false],["treeexpandimage",null,true,"",false],["treeitemimage",null,true,"",false],["treelevel",null,true,"",false],["treestartlevel",null,true,0,false,0],["treestate",null,true,"",false]];_pCellInfo._property_map_expand=[["expandchar",null,true,"",false],["expandimage",null,true,"",false],["expandshow",null,true,"hide",false,2,["hide","show"]],["expandsize",null,true,16,false,0]];_pCellInfo._property_map=_pCellInfo._property_map.concat(_pCellInfo._property_map_cell);_pCellInfo._property_map=_pCellInfo._property_map.concat(_pCellInfo._property_map_checkbox);_pCellInfo._property_map=_pCellInfo._property_map.concat(_pCellInfo._property_map_edit);_pCellInfo._property_map=_pCellInfo._property_map.concat(_pCellInfo._property_map_maskedit);_pCellInfo._property_map=_pCellInfo._property_map.concat(_pCellInfo._property_map_textarea);_pCellInfo._property_map=_pCellInfo._property_map.concat(_pCellInfo._property_map_combo);_pCellInfo._property_map=_pCellInfo._property_map.concat(_pCellInfo._property_map_calendar);_pCellInfo._property_map=_pCellInfo._property_map.concat(_pCellInfo._property_map_progressbar);_pCellInfo._property_map=_pCellInfo._property_map.concat(_pCellInfo._property_map_image);_pCellInfo._property_map=_pCellInfo._property_map.concat(_pCellInfo._property_map_tree);_pCellInfo._property_map=_pCellInfo._property_map.concat(_pCellInfo._property_map_expand);_pCellInfo._setCellChildControlProperty=function(prefix,ctrl,datarow){var _property_map=this["_property_map_"+prefix];var v,prop,ctrlprop;for(var i=0,n=_property_map.length;i<n;i++ ){ctrlprop=_property_map[i][nexacro._CELLINFO_PMAP_CTRLPROPNAME];if(ctrlprop!=null){prop=_property_map[i][nexacro._CELLINFO_PMAP_PROPNAME];v=this._getAttrValue(this[prop],datarow);ctrl["set_"+ctrlprop](v);}}};_pCellInfo._setCellControlProperty=function(cellcontrol,datarow){var _property_map=this._property_map_cell;var v,prop,ctrlprop;for(var i=0,n=_property_map.length;i<n;i++ ){ctrlprop=_property_map[i][nexacro._CELLINFO_PMAP_CTRLPROPNAME];if(ctrlprop!=null){prop=_property_map[i][nexacro._CELLINFO_PMAP_PROPNAME];v=this._getAttrValue(this[prop],datarow);cellcontrol["set_"+ctrlprop](v);}}};_pCellInfo._setCellControlPropertyForAutosize=function(cellcontrol,datarow){var _property_map=[["font","font"],["wordSpacing","wordSpacing"],["letterSpacing","letterSpacing"],["border","border"],["padding","padding"]];var v,prop,ctrlprop;for(var i=0,n=_property_map.length;i<n;i++ ){ctrlprop=_property_map[i][1];prop=_property_map[i][0];v=this._getAttrValue(this[prop],datarow);cellcontrol["set_"+ctrlprop](v);}};_pCellInfo._use_displaytype_controls=["buttoncontrol","checkboxcontrol","imagecontrol","treeitemcontrol","combocontrol","calendarcontrol","editcontrol","maskeditcontrol","textareacontrol","progressbarcontrol"];_pCellInfo._chkExistSubControl=function(displaytype){var usecontrols=this._use_displaytype_controls;for(var i=0,n=usecontrols.length;i<n;i++ ){if(usecontrols[i]==displaytype){return displaytype;}}return "";};_pCellInfo._getDefaultPropVal=function(propname){var _property_map=this._property_map;var prop,deft;for(var i=0,n=_property_map.length;i<n;i++ ){prop=_property_map[i][nexacro._CELLINFO_PMAP_PROPNAME];deft=_property_map[i][nexacro._CELLINFO_PMAP_DEFTVALUE];if(prop==propname){return deft;}}return undefined;};_pCellInfo._allocatePropertys=function(_property_map){var prop,bind,deft;for(var i=0;i<_property_map.length;i++ ){prop=_property_map[i][nexacro._CELLINFO_PMAP_PROPNAME];bind=_property_map[i][nexacro._CELLINFO_PMAP_EXPRBIND];deft=_property_map[i][nexacro._CELLINFO_PMAP_DEFTVALUE];if(bind){this[prop]=new nexacro.BindableValue(deft);}else{this[prop]=deft;}}};nexacro._makeCellInfoPropertySetter=function(ptype_val,_property_map){var prop,bind,str,type,styl,eval_str="";function enumjoin(arr){var str="\""+arr[0]+"\"";for(var i=1;i<arr.length;i++ ){str+=",\""+arr[i]+"\"";}return str;}for(var i=0;i<_property_map.length;i++ ){prop=_property_map[i][nexacro._CELLINFO_PMAP_PROPNAME];bind=_property_map[i][nexacro._CELLINFO_PMAP_EXPRBIND];type=_property_map[i][nexacro._CELLINFO_PMAP_VALTYPE];styl=_property_map[i][nexacro._CELLINFO_PMAP_STYLE];if(bind){str="$PTYPE$.set_$ATTR$ = function (v)\n";str+="{\n";str+="    if (v != this.$ATTR$._value)\n";str+="    {\n";if(type==0){str+="        this.$ATTR$._set_intval(v);\n";}else if(type==2){str+="        this.$ATTR$._set_enumval(v, ["+enumjoin(_property_map[i][nexacro._CELLINFO_PMAP_ENUMVAL])+"]);\n";}else{str+="        this.$ATTR$._set(v);\n";}str+="        this._afterProcBindTypeProp();\n";if(styl){str+="        this._changedStyle(\""+prop+"\");\n";}str+="    }\n";str+="};\n\n";}else{str="$PTYPE$.set_$ATTR$ = function (v)\n";str+="{\n";if(type==2){str+="    var val = this.$ATTR$;\n";str+="    switch (v)\n";str+="    {\n";var arr=_property_map[i][nexacro._CELLINFO_PMAP_ENUMVAL];for(var j=0;j<arr.length;j++ ){str+="        case \""+arr[j]+"\":\n";}str+="            val = v;\n";str+="    }\n";str+="    if (val != this.$ATTR$)\n";}else{str+="    if (v != this.$ATTR$)\n";}str+="    {\n";str+="        this.$ATTR$ = v;\n";if(styl){str+="        this._changedStyle(\""+prop+"\");\n";}str+="    }\n";str+="};\n\n";}str=str.replace(/\$PTYPE\$/g,ptype_val).replace(/\$ATTR\$/g,prop);eval_str+=str;}eval(eval_str);};nexacro._makeCellInfoPropertySetter("_pCellInfo",_pCellInfo._property_map);nexacro._makePropertyDesignSetter=function(ptype_val,_property_map){var prop;var str="";for(var i=0;i<_property_map.length;i++ ){prop=_property_map[i][nexacro._CELLINFO_PMAP_PROPNAME];str+="$PTYPE$.design_set_"+prop+" = function (v)\n";str+="{\n";str+="        try\n";str+="        {\n";str+="            this._refinfo.set_"+prop+"(v);\n";str+="            this._updateAll();\n";str+="            this._apply_normalproperty(\""+prop+"\", v);\n";str+="        }\n";str+="        catch(e)\n";str+="        {\n";str+="           if (e.obj)\n";str+="           {\n";str+="               trace(e.message);\n";str+="           }\n";str+="           else\n";str+="           {\n";str+="               var msg = nexacro._getExceptionMessage(e);\n";str+="               trace(msg);\n";str+="           }\n";str+="        }\n";str+="};\n\n";str+="$PTYPE$.design_get_"+prop+" = function ()\n";str+="{\n";str+="        var prop = this._refinfo."+prop+";\n";str+="        if (prop)\n";str+="        {\n";str+="            if (nexacro._isNumber(prop) || prop._bindtype == undefined)\n";str+="                return prop;\n";str+="            else\n";str+="                return prop._value;\n";str+="        }\n";str+="        return prop;\n";str+="};\n\n";}str=str.replace(/\$PTYPE\$/g,ptype_val);eval(str);};_pCellInfo._addPropertyMap=function(ptype_val,_property_map_add,is_add_design_setter){this._property_map=this._property_map.concat(_property_map_add);nexacro._makeCellInfoPropertySetter(ptype_val,_property_map_add);if(is_add_design_setter){nexacro._makePropertyDesignSetter(ptype_val,_property_map_add);}};_pCellInfo.set_id=function(id){this.id=this.name=id;};_pCellInfo.set_name=function(name){};_pCellInfo.set_displaytype=function(v){if(v!=this.displaytype){var oldVal=this.displaytype._value;this.displaytype._set(v);this._afterProcBindTypeProp();if(this._view){if(oldVal=="treeitemcontrol"){this._view._removeTreeCellinfo(this);}if(v=="treeitemcontrol"){this._view._setTreeCellinfo(this);}}}};_pCellInfo.set_maskeditmaskchar=function(v){if(!v){v="_";}var val=v.toString().charAt(0);if(val!=this.maskeditmaskchar){this.maskeditmaskchar=val;this._afterProcBindTypeProp();}};_pCellInfo.set_cssclass=function(v){if(v!=this.cssclass._value){this.cssclass._set(v);this._afterProcBindTypeProp();}};_pCellInfo.set_expr=function(v){if(v!=this.expr._value){var str=v.toString();var tag=str.substr(0,4).toUpperCase();if(tag!=""&&tag!="EXPR"){v="EXPR:"+v;}this.expr._set(v);this._afterProcBindTypeProp();}};_pCellInfo.destroy=function(){this.parent=null;var i;var n=this._subcells.length;for(i=0;i<n;i++ ){this._subcells[i].destroy();}this._subcells=null;this._maskstringtypeobj=null;this._masknumbertypeobj=null;var _property_map=this._property_map;var prop;for(i=0;i<_property_map.length;i++ ){prop=_property_map[i][nexacro._CELLINFO_PMAP_PROPNAME];this[prop]=null;}this._property_map=null;this._key_direction=null;this._blinked_status=null;};_pCellInfo._getBindDataset=function(){if(this._view){return this._view._getBindDataSet?this._view._getBindDataSet():this._view._binddataset;}return null;};_pCellInfo._getExprCacheFn=function(ctx){if(this._view){return this._view._getExprFuncByCtx?this._view._getExprFuncByCtx(ctx):this._view._exprcache[ctx];}};_pCellInfo._setExprCacheFn=function(ctx,func){if(this._view){return this._view._setExprFuncByCtx?this._view._setExprFuncByCtx(ctx,func):this._view._exprcache[ctx]=func;}};_pCellInfo._getValue=function(rowidx,nowritable){if(nowritable){if(this.expr._value!=""&&this.expr._value!=null){return this._getAttrValue(this.expr,rowidx);}}return this._getAttrValue(this.text,rowidx);};_pCellInfo._setValue=function(rowidx,v){this._setAttrValue(this.text,rowidx,v);};_pCellInfo._getDisplaytype=function(rowidx){var dt=this.displaytype;var d=this._getAttrValue(dt,rowidx);if(d===undefined){d="normal";}if(d=="normal"){var t=this.text;if(t._bindtype==1){var dataset=this._getBindDataset();if(!dataset){return "text";}var colid=t._bindexpr;var coltype=dataset._getColumnType(colid);switch(coltype){case 1:case 9:return "text";case 2:case 3:case 4:return "number";case 5:return "date";case 6:return "time";case 7:return "datetime";default:return "none";}}else{return "text";}}return d;};_pCellInfo._getEdittype=function(rowidx){var dt=this.edittype;var d=this._getAttrValue(dt,rowidx);if(d=="normal"){var t=this.text;if(t._bindtype==1){var dataset=this._getBindDataset();if(!dataset){return "text";}var colid=t._bindexpr;var colinfo=dataset._getColumnType(colid);if(!colinfo){return "text";}var coltype=colinfo;switch(coltype){case 1:case 2:case 3:case 4:case 9:return "text";case 5:case 6:case 7:return "date";case 8:return "none";}}else{return "text";}}return d;};_pCellInfo._getWordwrap=function(rowidx){var wordwrap=this._getAttrValue(this.wordWrap,rowidx);return wordwrap;};_pCellInfo._getAttrValue=function(attr,rowidx){if(attr==undefined){return undefined;}if(attr._bindtype==undefined){return attr;}else if(attr._bindtype==0){return attr._value;}else{var dataset=this._getBindDataset();if(dataset==null){return undefined;}if(attr._bindtype==1){return dataset.getColumn(rowidx,attr._bindexpr);}else{var bindexpr=attr._bindexpr;var val=attr._value;var s=val.toLowerCase().indexOf("bind:");if(s>=0){bindexpr=bindexpr.substring(s,bindexpr.length);bindexpr=dataset.getColumn(rowidx,bindexpr);}var exprfn=this._getExprCacheFn(bindexpr);if(exprfn==null){exprfn=dataset._createExprFunc(bindexpr);this._setExprCacheFn(bindexpr,exprfn);}if((typeof exprfn)=="function"){dataset.__getParsedRow(dataset._viewRecords[rowidx]);this.col=this._col;this.row=this._row;return exprfn.call(this,rowidx,rowidx,this._view,dataset,dataset._viewRecords,dataset._viewRecords[rowidx],[]);}}}return undefined;};_pCellInfo._setAttrValue=function(attr,rowidx,v){if(attr._bindtype==1){var dataset=this._getBindDataset();if(dataset){dataset.setColumn(rowidx,attr._bindexpr,v);}}};_pCellInfo._getDefaultTextAlign=function(displayType,rowidx){var align;switch(displayType){case "normal":displayType=this._getDisplaytype(rowidx);if(displayType=="number"){align="right";}else if(displayType=="date"||displayType=="time"||displayType=="datetime"){align="center";}else{align="left";}break;case "mask":var type=this._getAttrValue(this.maskedittype,rowidx);if(type=="number"){align="right";}else{align="left";}break;case "number":case "exponent":case "currency":align="right";break;default:align="center";break;}return align;};_pCellInfo._getCheckboxsize=function(rowidx){var val=this._getAttrValue(this.checkboxsize,rowidx);if((val===""||val<0)&&this._view){val=this._view.cellcheckboxsize;}return val;};_pCellInfo._getControlButtonsize=function(rowidx,control){var val=this._getAttrValue(this[control+"buttonsize"],rowidx);if(val==null&&this._view){val=this._view["cell"+control+"buttonsize"];}return val;};_pCellInfo._getControlScrollbarsize=function(rowidx,control){var val=this._getAttrValue(this[control+"scrollbarsize"],rowidx);if(val==null||val<0){if(this._view){val=this._view["cell"+control+"scrollbarsize"];}}else{val=parseInt(val,10);}if(val==null||val<0){val=undefined;}return val;};_pCellInfo._getControlPopuptype=function(rowidx,control){var val=this._getAttrValue(this[control+"popuptype"],rowidx);if(!val&&this._view){val=this._view["cell"+control+"popuptype"];}return val;};_pCellInfo._getControlPopupsize=function(rowidx,control){var val=this._getAttrValue(this[control+"popupsize"],rowidx);if(!val&&this._view){val=this._view["cell"+control+"popupsize"];}return val;};_pCellInfo._afterProcBindTypeProp=function(){};_pCellInfo._changedStyle=function(prop){};_pCellInfo._getTooltipText=function(rowidx){var text=this._getAttrValue(this.tooltiptext,rowidx);return text;};_pCellInfo._getTreeCheck=function(rowidx){return this._getAttrValue(this.treecheck,rowidx);};_pCellInfo._getTreeCollapseImage=function(rowidx){return this._getAttrValue(this.treecollapseimage,rowidx);};_pCellInfo._getTreeExpandImage=function(rowidx){return this._getAttrValue(this.treeexpandimage,rowidx);};_pCellInfo._getTreeItemImage=function(rowidx){return this._getAttrValue(this.treeitemimage,rowidx);};_pCellInfo._getTreeLevel=function(rowidx){var v=this._getAttrValue(this.treelevel,rowidx);v=parseInt(v)|0;return v;};_pCellInfo._getTreeStartLevel=function(rowidx){var v=this._getAttrValue(this.treestartlevel,rowidx);v=parseInt(v)|0;return v;};_pCellInfo._getTreeState=function(rowidx){return this._getAttrValue(this.treestate,rowidx);};_pCellInfo._setTreeCheck=function(rowidx,v){return this._setTreeBindValue(this.treecheck,rowidx,v);};_pCellInfo._setTreeCollapseImage=function(rowidx,v){return this._setTreeBindValue(this.treecollapseimage,rowidx,v);};_pCellInfo._setTreeExpandImage=function(rowidx,v){return this._setTreeBindValue(this.treeexpandimage,rowidx,v);};_pCellInfo._setTreeItemImage=function(rowidx,v){return this._setTreeBindValue(this.treeitemimage,rowidx,v);};_pCellInfo._setTreeLevel=function(rowidx,v){return this._setTreeBindValue(this.treelevel,rowidx,v);};_pCellInfo._setTreeStartLevel=function(rowidx,v){return this._setTreeBindValue(this.treestartlevel,rowidx,v);};_pCellInfo._setTreeState=function(rowidx,v){return this._setTreeBindValue(this.treestate,rowidx,v);};_pCellInfo._setTreeBindValue=function(attr,rowidx,v){if(attr._bindtype==1){var dataset=this._getBindDataset();if(dataset){dataset._treeBindChanged=true;dataset.setColumn(rowidx,v);}}};_pCellInfo._getLocale=function(rowidx){var locale=this._getAttrValue(this.locale,rowidx);if(!locale&&this._view){locale=this._view._getLocale();}return locale;};_pCellInfo._getDisplayTypeValue=function(rowidx){var dt=this.displaytype;var d=this._getAttrValue(dt,rowidx);if(d===undefined){d="normal";}return d;};_pCellInfo._getDisplayText=function(rowidx){var dataset=this._getBindDataset();if(dataset&&this.subsumtext._value!==null&&this.subsumtext._value!==undefined&&dataset.getRowType(rowidx)==16){return this._getAttrValue(this.subsumtext,rowidx);}var d=this._getDisplayTypeValue(rowidx);if(d=="normal"){var t=this.text;if(t._bindtype==1){if(!dataset){return "text";}var colid=t._bindexpr;var coltype=dataset._getColumnType(colid);switch(coltype){case 1:case 9:return this._getDisplayText_text(rowidx);case 2:case 3:case 4:return this._getDisplayText_number(rowidx);case 5:return this._getDisplayText_date(rowidx,2);case 6:return this._getDisplayText_date(rowidx,0);case 7:return this._getDisplayText_date(rowidx,1);default:return "";}}}else{if(d=="mask"||d=="maskeditcontrol"){var type=this._getAttrValue(this.maskedittype,rowidx);if(type=="number"){return this._getDisplayText_masknumber(rowidx);}else{return this._getDisplayText_maskstring(rowidx);}}else if(d=="number"){return this._getDisplayText_number(rowidx);}else if(d=="currency"){return this._getDisplayText_currency(rowidx);}else if(d=="date"){return this._getDisplayText_date(rowidx);}else if(d=="calendarcontrol"){return this._getDisplayText_date(rowidx,null,true);}else if(d=="combotext"){return this._getDisplayText_combo(rowidx);}else if(d=="combocontrol"){return this._getDisplayText_combo(rowidx,true);}else if(d=="none"){return "";}}return this._getDisplayText_text(rowidx);};_pCellInfo._getTextValueForDisp=function(rowidx){if(this.expr._value!=""&&this.expr._value!=null){return this._getAttrValue(this.expr,rowidx);}return this._getAttrValue(this.text,rowidx);};_pCellInfo._getDisplayText_text=function(rowidx){var v=this._getTextValueForDisp(rowidx);if(v!=null){v=v.toString();}return v;};_pCellInfo._getDisplayText_maskstring=function(rowidx){var v=this._getTextValueForDisp(rowidx);var mask=this._getAttrValue(this.maskeditformat,rowidx);if(v!=null){v=v.toString();}if(mask&&mask.length){var maskobj=this._maskstringtypeobj;var maskchar=this._getAttrValue(this.maskeditmaskchar,rowidx);var locale=this._getLocale(rowidx);maskobj.setLocale(locale);maskobj.setMask(mask);maskobj.setMaskChar(maskchar);v=maskobj.applyMask(v);}return v;};_pCellInfo._getDisplayText_masknumber=function(rowidx){var v=this._getTextValueForDisp(rowidx);var mask=this._getAttrValue(this.maskeditformat,rowidx);if(mask&&mask.length){var locale=this._getLocale(rowidx);var maskobj=this._masknumbertypeobj;var limittype=this._getAttrValue(this.maskeditlimitbymask,rowidx);if(mask==="."){maskobj.setUseGrouping(true);}maskobj.setLimitType(limittype);maskobj.setLocale(locale);maskobj.setMask(mask);v=maskobj.applyMask(v);}else{v=nexacro._toString(v);}return v;};_pCellInfo._getDisplayText_number=function(rowidx){var v=this._getTextValueForDisp(rowidx);var limittype=this._getAttrValue(this.maskeditlimitbymask,rowidx);var locale=this._getLocale(rowidx);var maskobj=this._masknumbertypeobj;maskobj.setUseGrouping(true);maskobj.setLimitType(limittype);maskobj.setLocale(locale);maskobj.setMask("");v=maskobj.applyMask(v);return v;};_pCellInfo._getDisplayText_currency=function(rowidx){var v=this._getTextValueForDisp(rowidx);var locale=this._getLocale(rowidx);if(!isNaN(v)){var nexanum=new nexacro.Number(v);v=nexanum.toLocaleCurrencyString(locale);}return v;};_pCellInfo._getDisplayText_date=function(rowidx,colType,is_control){var v=this._getTextValueForDisp(rowidx);var date=undefined;var nullmask=false;var is_date_empty=false;var dateformatmask=this._getAttrValue(this.calendardateformat,rowidx);var editformatmask=this._getAttrValue(this.calendareditformat,rowidx);v=(v)?v:"";if(v.constructor==Date){date=v;}else{var strVal=v.toString();if(strVal.search(/\S/)> -1){if(colType==undefined){if(!editformatmask){if(strVal.length==8){colType=2;}else if(strVal.length==6||strVal.length==9){colType=0;}else{colType=1;}}else{var maskobj=new nexacro._EditMaskTypeDate();if(maskobj){if(editformatmask&&editformatmask.length){maskobj.setDateMask(editformatmask);maskobj.setEditMask(editformatmask);if(editformatmask=="LONGDATE"||editformatmask=="SHORTDATE"){colType=1;}else{var editformattype=maskobj.getEditFormatType();if(editformattype==0){colType=2;}else if(editformattype==1){colType=0;}else{colType=1;}}}}else{colType=1;}}}date=this.__parseDate(strVal,colType);if(date&&(date._isInvalidDate?date._isInvalidDate():isNaN(date.valueOf()))){if((this.calendardisplayinvalidtype._value=="invalidtext"||this.calendardisplayinvalidtype._value=="default")&&!is_control){return this._getAttrValue(this.calendardisplayinvalidtext,rowidx);}return strVal;}}else{if(this.calendardisplaynulltype._value=="nulltext"&&!is_control){return this._getAttrValue(this.calendardisplaynulltext,rowidx);}else if(this.calendardisplaynulltype._value=="nullmask"&&!is_control){nullmask=true;}else if(this.calendardisplaynulltype._value=="default"){}else{return "";}}}if(date==null){is_date_empty=true;date=new nexacro.Date();date.setFullYear(0);date.setMonth(0);date.setDate(1);}var dateStr;var locale=this._getLocale(rowidx);var locale_info=nexacro.Locale.getLocaleInfo(locale);var format;if(dateformatmask=="SHORTDATE"||dateformatmask=="LONGDATE"){if(dateformatmask=="SHORTDATE"){format=locale_info.shortdate_format;}else{format=locale_info.longdate_format;}if(format==""){format=nexacro.Locale._default_shortdate_format;}var b_ltr_mark=((this._view&&!this._view._isRtl())&&locale_info.direction=="rtl")?true:false;dateStr=date.getLocaleFormatString(locale,format,b_ltr_mark);}else{var yyyy=date.getFullYear();if(yyyy==0){yyyy="0000";}else{yyyy=yyyy.toString().padLeft(4,"0");}var MM=date.getMonth()+1;var MMMM=locale_info.month_names_long[date.getMonth()];MM=(MM<10?"0":"")+MM;var dddd=locale_info.weekday_names_long[date.getDay()];var ddd=locale_info.weekday_names_short[date.getDay()];var dd=date.getDate();dd=(dd<10?"0":"")+dd;var yy=date.getYear()%100;var M= +MM;var d= +dd;var hour=date.getHours();hour=(hour<10?"0":"")+hour;var h= +hour;var minute=date.getMinutes();minute=(minute<10?"0":"")+minute;var mn= +minute;var second=date.getSeconds();second=(second<10?"0":"")+second;var s= +second;var millisecond=date.getMilliseconds();millisecond=(millisecond<10?"00":millisecond<100?"0":"")+millisecond;if(is_date_empty){hour=h="00";minute=mn="00";second=s="00";millisecond="000";}format=dateformatmask;if(format==null||format.length==0||!format.match(/[yMdHhms]/)){format="yyyy-MM-dd ddd";}if(nullmask){var maskchar1="_";var maskchar2=maskchar1+maskchar1;var maskchar3=maskchar2+maskchar1;var maskchar4=maskchar3+maskchar1;dateStr=format.replace("yyyy",maskchar4);dateStr=dateStr.replace("MMMM","lunari");dateStr=dateStr.replace("MM",maskchar2);dateStr=dateStr.replace("ddd","week");dateStr=dateStr.replace("dd",maskchar2);dateStr=dateStr.replace("yy",maskchar2);dateStr=dateStr.replace("M",maskchar1);dateStr=dateStr.replace("d",maskchar1);dateStr=dateStr.replace("tt",maskchar2);dateStr=dateStr.replace("HH",maskchar2);dateStr=dateStr.replace("hh",maskchar2);dateStr=dateStr.replace("H",maskchar1);dateStr=dateStr.replace("h",maskchar1);dateStr=dateStr.replace("mm",maskchar2);dateStr=dateStr.replace("m",maskchar1);dateStr=dateStr.replace("sss",maskchar3);dateStr=dateStr.replace("ss",maskchar2);dateStr=dateStr.replace("s",maskchar1);dateStr=dateStr.replace("lunari",maskchar4);dateStr=dateStr.replace("week",maskchar3);}else{var hh=hour;var tt="";if(hour>12&&hour<25){hh=hour<22?"0"+(hour-12):hour-12;tt="";}dateStr=format.replace("tt",tt);dateStr=dateStr.replace("HH",hour);dateStr=dateStr.replace("hh",hh);dateStr=dateStr.replace("H",h);dateStr=dateStr.replace("h",h);dateStr=dateStr.replace("mm",minute);dateStr=dateStr.replace("m",mn);dateStr=dateStr.replace("sss",millisecond);dateStr=dateStr.replace("ss",second);dateStr=dateStr.replace("s",s);dateStr=dateStr.replace("dddd","weekL");dateStr=dateStr.replace("ddd","week");dateStr=dateStr.replace("yyyy",yyyy);dateStr=dateStr.replace("MMMM","lunari");dateStr=dateStr.replace("MM",MM);dateStr=dateStr.replace("dd",dd);dateStr=dateStr.replace("yy",yy);dateStr=dateStr.replace("M",M);dateStr=dateStr.replace("d",d);dateStr=dateStr.replace("lunari",MMMM);dateStr=dateStr.replace("weekL",dddd);dateStr=dateStr.replace("week",ddd);}}return dateStr;};_pCellInfo.__parseDate=function(v,dFlag){var dateobj;var maskobj=new nexacro._EditMaskTypeDate();if(/[^0-9]/.test(v)){dateobj=new Date(v);if(isNaN(dateobj.valueOf())){return dateobj;}dateobj=new nexacro.Date(dateobj.getFullYear(),dateobj.getMonth(),dateobj.getDate(),dateobj.getHours(),dateobj.getMinutes(),dateobj.getSeconds(),dateobj.getMilliseconds());}else{if(dFlag==0){dateobj=maskobj.convertToDateObject(v,1);}else if(dFlag==1){dateobj=maskobj.convertToDateObject(v,2);}else{dateobj=maskobj.convertToDateObject(v,0);}}return dateobj;};_pCellInfo._getDisplayText_combo=function(rowidx,is_control){var combodataset=this._getAttrValue(this.combodataset,rowidx);var combocodecol=this._getAttrValue(this.combocodecol,rowidx);var combodatacol=this._getAttrValue(this.combodatacol,rowidx);if(combodataset&&combodataset.length&&combocodecol&&combocodecol.length&&combodatacol&&combodatacol.length){var ds=this._findDataset(combodataset);if(ds){var v=this._getTextValueForDisp(rowidx);var text=ds.lookupNF(combocodecol,v,combodatacol);if(text){return text.toString();}}}if(this.combodisplaynulltype._value=="nulltext"&&!is_control){return this._getAttrValue(this.combodisplaynulltext,rowidx);}return "";};_pCellInfo._findDataset=function(combodataset){var view=this._view;if(view){return view._findDataset(combodataset);}return null;};_pCellInfo._loadXmlElement=function(cellElem,subcell_override_info,is_sub){var col=cellElem.getAttribute("col"),row=cellElem.getAttribute("row"),colspan=cellElem.getAttribute("colspan"),rowspan=cellElem.getAttribute("rowspan");this._col=(col==null?0:parseInt(col));this._row=(row==null?0:parseInt(row));this._colspan=(colspan==null?1:parseInt(colspan));this._rowspan=(rowspan==null?1:parseInt(rowspan));var _property_map=this._property_map;var prop,attrval;var i;var n=_property_map.length;for(i=0;i<n;i++ ){prop=_property_map[i][nexacro._CELLINFO_PMAP_PROPNAME];attrval=cellElem.getAttribute(prop);this._loadingxml=true;if(attrval!==null&&attrval!==undefined){this["set_"+prop](attrval);}this._loadingxml=false;}if(!is_sub){var subcells=cellElem.getElementsByTagName("Cell"),subinfo,subcellElem;if(!subcell_override_info){subcell_override_info=nexacro.CellInfo;}for(i=0,n=subcells.length;i<n;i++ ){subcellElem=subcells[i];subinfo=new subcell_override_info((this._type+this._cellidx+"_sub"+i),this.parent,this._view,this._type,i);subinfo._loadXmlElement(subcellElem,true);subinfo._isSubCell=true;this._subcells[i]=subinfo;}}};_pCellInfo._getXmlString=function(){var strContents="";if(this._isSubCell){strContents+="    ";}strContents+="<Cell col=\""+this._col;strContents+="\" row=\""+this._row;if(this._colspan>1){strContents+="\" colspan=\""+this._colspan;}if(this._rowspan>1){strContents+="\" rowspan=\""+this._rowspan;}var _property_map=this._property_map;var prop,bind,deft;var i;var n=_property_map.length;for(i=0;i<n;i++ ){prop=_property_map[i][nexacro._CELLINFO_PMAP_PROPNAME];bind=_property_map[i][nexacro._CELLINFO_PMAP_EXPRBIND];deft=_property_map[i][nexacro._CELLINFO_PMAP_DEFTVALUE];if(bind){if(this[prop]._value!=deft){strContents+="\" "+prop+"=\""+(typeof (this[prop]._value)=="string"?nexacro._encodeXml(this[prop]._value):this[prop]._value);}}else{if(this[prop]!=deft){strContents+="\" "+prop+"=\""+(typeof (this[prop])=="string"?nexacro._encodeXml(this[prop]):this[prop]);}}}var subcells=this._subcells;if(subcells.length>0){strContents+="\">\n";for(i=0,n=subcells.length;i<n;i++ ){strContents+=subcells[i]._getXmlString(true);}strContents+="</Cell>\n";}else{strContents+="\"/>\n";}return strContents;};_pCellInfo._hasEditor=function(datarow){var editType=this._getEdittype(datarow);switch(editType){case "none":return false;case "normal":case "text":case "combo":case "date":case "mask":case "textarea":case "button":case "readonly":return true;}return false;};delete _pCellInfo;}if(!nexacro._CellControl){nexacro._CellControl=function(id,left,top,width,height,right,bottom,parent,refinfo,cellidx,view,rowidx){nexacro.Component.call(this,id,left,top,width,height,right,bottom,null,null,null,null,parent);var add_event_list=["onexpandup","onexpanddown","oninput","ondropdown","oncloseup"];this._view=view;this._rowidx=(rowidx!=undefined)?rowidx: -9;this.tabstop=false;this._cellidx=cellidx;this._refinfo=refinfo?refinfo:this._makeCellInfo(id,null,view,id,cellidx);this.subcells=[];this.parentcell=(parent instanceof nexacro._CellControl)?parent:null;this.selected=false;this.accessibilityrole="gridcell";this._subComp=null;this._text_elem=null;this._curDisplayType="";this._expand_width=0;this._expandCtrl=null;this._isSubCell=(this.parentcell)?true:false;this._fakecell=false;this._hideInner=false;this._is_real_upelem=null;this._editor=null;this._client_mode="";this._disp_show=true;this._writable=false;this._cellExpandObj="_CellExpandControl";this._cellButtonObj="_CellButtonControl";this._cellCheckBoxObj="_CellCheckboxControl";this._cellImageObj="_CellImageControl";this._cellComboObj="_CellComboControl";this._cellCalendarObj="_CellCalendarControl";this._cellEditObj="_CellEditControl";this._cellTextAreaObj="_CellTextAreaControl";this._cellProgressBarObj="_CellProgressBarControl";this._cellMaskEditObj="_CellMaskEditControl";this._cellTreeObj="_CellTreeControl";for(var i=0,n=add_event_list.length;i<n;i++ ){this._event_list[add_event_list[i]]=1;}};var _pCellControl=nexacro._createPrototype(nexacro.Component,nexacro._CellControl);nexacro._CellControl.prototype=_pCellControl;_pCellControl._type_name="CellControl";_pCellControl._is_subcontrol=true;_pCellControl._is_simple_control=true;_pCellControl._use_selected_status=true;_pCellControl._use_readonly_status=true;_pCellControl._is_use_auto_selected_status=true;_pCellControl._avail_left=0;_pCellControl._avail_top=0;_pCellControl._avail_width=0;_pCellControl._avail_height=0;_pCellControl.init=function(id,left,top,width,height,right,bottom,refinfo,cellidx,view,rowidx){nexacro.Component.prototype.init.call(this,id,left,top,width,height,right,bottom,null,null,null,null);var info=this._refinfo;info.id=refinfo.name=id;info._view=view;info._type="";info._cellidx=cellidx;};_pCellControl._makeCellInfo=function(id,parent,view,type,idx){return new nexacro.CellInfo(id,parent,view,type,idx);};_pCellControl._apply_normalproperty=function(prop,val){};_pCellControl._getDisplaytype=function(){var datarow=this._getDataRow();return this._refinfo._getDisplaytype(datarow);};_pCellControl._getCurrentStyleAlign=function(noflush){var align={textAlign:"center",verticalAlign:"middle"};if(this._text_elem){align=this._text_elem._getComputedStyleAlign(noflush);}return align;};_pCellControl.on_create_contents=function(){this._disp_show=this._updateDisplayer();};_pCellControl.on_created_contents=function(win){var control_elem=this._control_element;if(control_elem){var subcells=this.subcells;var subcells_len=subcells.length;if(subcells_len==0){var sub_ctrl=this._subComp;if(sub_ctrl){sub_ctrl.on_created(win);}}var text_elem=this._text_elem;if(text_elem){text_elem.create(win);}var expand_ctrl=this._expandCtrl;if(expand_ctrl){expand_ctrl.on_created();}if(nexacro._enableaccessibility&&this._view&&!this._view._accept_focus){var accessibility=this.accessibility;if(accessibility){this._view._accept_focus=true;}}for(var i=0;i<subcells_len;i++ ){subcells[i].on_created();}if(!this._adjust_width||!this._adjust_height){this._setDisplay(false);}}};_pCellControl._on_changeStatus=function(status,value){this._status_changing=true;nexacro.Component.prototype._on_changeStatus.call(this,status,value);this._status_changing=false;};_pCellControl.on_changeStatus=function(changestatus,value,applystatus,currentstatus,currentuserstatus){if(this._isSubCell){return currentstatus;}return nexacro.Component.prototype.on_changeStatus.call(this,changestatus,value,applystatus,currentstatus,currentuserstatus);};_pCellControl.on_create_contents_command=function(area){var str="";var control_elem=this._control_element;if(control_elem){var subcells=this.subcells;var subcells_len=subcells.length;if(subcells_len==0){var sub_ctrl=this._subComp;if(sub_ctrl){str+=sub_ctrl.createCommand();}}else{for(var i=0;i<subcells_len;i++ ){str+=subcells[i].createCommand();}}var text_elem=this._text_elem;if(text_elem){str+=text_elem.createCommand();}var expand_ctrl=this._expandCtrl;if(expand_ctrl){str+=expand_ctrl.createCommand();}}return str;};_pCellControl.on_attach_contents_handle=function(win){var subcells=this.subcells;var subcells_len=subcells.length;for(var i=0;i<subcells_len;i++ ){subcells[i].attachHandle(win);}var sub_ctrl=this._subComp;if(sub_ctrl){sub_ctrl.attachHandle(win);}var expand_ctrl=this._expandCtrl;if(expand_ctrl){expand_ctrl.attachHandle(win);}var text_elem=this._text_elem;if(text_elem){text_elem.attachHandle(win);}if(nexacro._enableaccessibility&&this._view&&!this._view._accept_focus){var accessibility=this.accessibility;if(accessibility){this._view._accept_focus=true;}}if(!this._adjust_width||!this._adjust_height){this._setDisplay(false);}};_pCellControl.on_destroy_contents=function(){this._destroyDisplayer();if(this._expandCtrl){this._expandCtrl.destroy();this._expandCtrl=null;}var subcells=this.subcells;var subcells_len=subcells.length;var i;for(i=0;i<subcells_len;i++ ){subcells[i].destroy();}if(this._tempdestroyeditor){this._tempdestroyeditor.destroy();}if(this._editor){this._editor.destroy();}if(this._tempdestroyeditor_list){for(i=0;i<this._tempdestroyeditor_list.length;i++ ){this._tempdestroyeditor_list[i].destroy();}this._tempdestroyeditor_list=null;}this._tempdestroyeditor=this._editor=this.subcells=this._refinfo=this._view=this.parentcell=this._band=this._text_elem=this._is_real_upelem=null;};_pCellControl._makeEventInfoBase=function(evt_id){var cellobj=this;var subcellobj=null;if(cellobj.parentcell){subcellobj=cellobj;cellobj=cellobj.parentcell;}var obj={cell: -1,col: -1,row: -9,subrow: -1,mergecell: -1,mergecol: -1,mergerow: -1,pivotindex: -9,eventid:"",id:""};if(evt_id){obj.eventid=obj.id=evt_id;}obj.cell=cellobj._cellidx;obj.col=cellobj._refinfo._col;obj.row=cellobj._getDataRow();obj.subrow=cellobj._refinfo._row;if(subcellobj){obj.mergecell=subcellobj._cellidx;obj.mergecol=subcellobj._refinfo._col;obj.mergerow=subcellobj._refinfo._row;}return obj;};_pCellControl.on_fire_onexpandup=function(button,alt_key,ctrl_key,shift_key,screenX,screenY,canvasX,canvasY,clientX,clientY,from_comp,from_refer_comp){if(this.onexpandup&&this.onexpandup._has_handlers){var evt=this._makeEventInfoBase("onexpandup");evt.button=button;evt.altkey=alt_key;evt.ctrlkey=ctrl_key;evt.shiftkey=shift_key;evt.screenX=screenX;evt.screenY=screenY;evt.canvasX=canvasX;evt.canvasY=canvasY;evt.clientX=clientX;evt.clientY=clientY;evt.fromobject=from_comp;evt.fromreferenceobject=from_refer_comp;return this.onexpandup._fireEvent(this,evt);}return false;};_pCellControl.on_fire_onexpanddown=function(button,alt_key,ctrl_key,shift_key,screenX,screenY,canvasX,canvasY,clientX,clientY,from_comp,from_refer_comp){if(this.onexpandup&&this.onexpandup._has_handlers){var evt=this._makeEventInfoBase("onexpanddown");evt.button=button;evt.altkey=alt_key;evt.ctrlkey=ctrl_key;evt.shiftkey=shift_key;evt.screenX=screenX;evt.screenY=screenY;evt.canvasX=canvasX;evt.canvasY=canvasY;evt.clientX=clientX;evt.clientY=clientY;evt.fromobject=from_comp;evt.fromreferenceobject=from_refer_comp;return this.onexpandup._fireEvent(this,evt);}return false;};_pCellControl.on_fire_oninput=function(){if(this.oninput&&this.oninput._has_handlers){var evt=this._makeEventInfoBase("oninput");return this.oninput._fireEvent(this,evt);}return true;};_pCellControl.on_fire_ondropdown=function(obj){if(this.ondropdown&&this.ondropdown._has_handlers){var evt=this._makeEventInfoBase("ondropdown");evt.value=this.__evtvalue(obj);return this.ondropdown._fireCheckEvent(this,evt);}return true;};_pCellControl.on_fire_oncloseup=function(obj,pretext,posttext,prevalue,postvalue){if(this.oncloseup&&this.oncloseup._has_handlers){var evt=this._makeEventInfoBase("oncloseup");evt.value=this.__evtvalue(obj,postvalue);return this.oncloseup._fireEvent(this,evt);}return true;};_pCellControl.on_fire_onclick=function(button,alt_key,ctrl_key,shift_key,screenX,screenY,canvasX,canvasY,clientX,clientY,from_comp,from_refer_comp,clickitem){if(this.onclick&&this.onclick._has_handlers){var subcomp=from_refer_comp;while(subcomp&&subcomp instanceof nexacro.Component){if(subcomp instanceof nexacro._CellControl){break;}var canvas=subcomp._getRecalcCanvasXY(from_refer_comp._control_element,canvasX,canvasY);canvasX=canvas[0];canvasY=canvas[1];if(this._subComp==subcomp){break;}subcomp=subcomp.parent;}if(this._subComp==from_comp){var padding=this._getCurrentStylePadding();if(padding){canvasX+=padding.left;canvasY+=padding.top;clientX+=padding.left;clientY+=padding.top;}}canvasX+=this._adjust_left;canvasY+=this._adjust_top;clientX+=this._adjust_left;clientY+=this._adjust_top;var evt=this._makeEventInfoBase("onclick");evt.button=button;evt.altkey=alt_key;evt.ctrlkey=ctrl_key;evt.shiftkey=shift_key;evt.screenx=screenX;evt.screeny=screenY;evt.canvasx=canvasX;evt.canvasy=canvasY;evt.clientx=clientX;evt.clienty=clientY;evt.fromobject=from_comp;evt.fromreferenceobject=from_refer_comp;evt.clickitem=clickitem||"";return this.onclick._fireEvent(this,evt);}return false;};_pCellControl.on_fire_ondblclick=function(button,alt_key,ctrl_key,shift_key,screenX,screenY,canvasX,canvasY,clientX,clientY,from_comp,from_refer_comp,clickitem){nexacro._fireBeforeDblclick(this,button,alt_key,ctrl_key,shift_key,screenX,screenY,canvasX,canvasY,clientX,clientY,from_comp,from_refer_comp);if(this.ondblclick&&this.ondblclick._has_handlers){var subcomp=from_refer_comp;while(subcomp&&subcomp instanceof nexacro.Component){if(subcomp instanceof nexacro._CellControl){break;}var canvas=subcomp._getRecalcCanvasXY(from_refer_comp._control_element,canvasX,canvasY);canvasX=canvas[0];canvasY=canvas[1];if(this._subComp==subcomp){break;}subcomp=subcomp.parent;}if(this._subComp==from_comp){var padding=this._getCurrentStylePadding();if(padding){canvasX+=padding.left;canvasY+=padding.top;clientX+=padding.left;clientY+=padding.top;}}canvasX+=this._adjust_left;canvasY+=this._adjust_top;clientX+=this._adjust_left;clientY+=this._adjust_top;var evt=this._makeEventInfoBase("ondblclick");evt.button=button;evt.altkey=alt_key;evt.ctrlkey=ctrl_key;evt.shiftkey=shift_key;evt.screenx=screenX;evt.screeny=screenY;evt.canvasx=canvasX;evt.canvasy=canvasY;evt.clientx=clientX;evt.clienty=clientY;evt.fromobject=from_comp;evt.fromreferenceobject=from_refer_comp;evt.clickitem=clickitem||"";return this.ondblclick._fireEvent(this,evt);}return false;};_pCellControl._common_fire_lbuttonup=function(touchinfos,changedtouchinfos,button,altKey,ctrlKey,shiftKey,screenX,screenY,canvasX,canvasY,clientX,clientY,obj,from_refer_comp,from_elem){var window=this._getWindow();var elem=window._cur_ldown_elem;var comp=window.findComponent(elem,0,0)[0];var up_comp=window.findComponent(from_elem,0,0)[0];if(elem!=from_elem){while(comp){if(comp instanceof nexacro._CellControl){break;}comp=comp.parent;}while(up_comp){if(up_comp instanceof nexacro._CellControl){break;}up_comp=up_comp.parent;}if(comp==up_comp){this.on_fire_onclick(button,altKey,ctrlKey,shiftKey,screenX,screenY,canvasX,canvasY,clientX,clientY,obj,from_refer_comp,"");}}};_pCellControl.on_fire_user_ontouchend=function(touchinfos,changedtouchinfos,from_comp,from_refer_comp){this._common_fire_lbuttonup(touchinfos,changedtouchinfos,"",false,false,false, -1, -1, -1, -1, -1, -1,from_comp,from_refer_comp,null);return nexacro.Component.prototype.on_fire_user_ontouchend.call(this,touchinfos,changedtouchinfos,from_comp,from_refer_comp);};_pCellControl.on_fire_user_onlbuttonup=function(button,altKey,ctrlKey,shiftKey,screenX,screenY,canvasX,canvasY,clientX,clientY,obj,refer_comp,from_elem){this._common_fire_lbuttonup(null,null,button,altKey,ctrlKey,shiftKey,screenX,screenY,canvasX,canvasY,clientX,clientY,obj,refer_comp,from_elem);return nexacro.Component.prototype.on_fire_user_onlbuttonup.call(this,button,altKey,ctrlKey,shiftKey,screenX,screenY,canvasX,canvasY,clientX,clientY,obj,refer_comp,from_elem);};_pCellControl.__evtvalue=function(obj,postvalue){var val="";if(obj&&obj.value){val=obj.value;}else if(postvalue){val=postvalue;}return val;};_pCellControl._destroyDisplayer=function(b_async){if(this._subComp){if(b_async){var subcomp=this._subComp;nexacro._OnceCallbackTimer.callonce(this,function(){if(subcomp){subcomp.destroy();}});subcomp.set_visible(false);this._subComp=null;}else{this._subComp.destroy();this._subComp=null;}}};_pCellControl._getBindDataset=function(){return this._view?(this._view._getBindDataSet?this._view._getBindDataSet():this._view._binddataset):null;};_pCellControl._applyEditorDataset=function(async,prevalue){if(!this._editor||!this._writable){return;}var dataset=this._getBindDataset();if(dataset){var datarow=this._getDataRow();var colid=this._refinfo.text._bindexpr;var value=this._editor._getValueData();var view=this._view;if(this._refinfo.text._bindtype==1){view._is_async_recreate=async;view._dsEventOccured=true;var fail={status:""};dataset.setColumn(datarow,colid,value,fail);if(fail.status=="cancolumnchange"){this._editor.set_value(prevalue);}view._is_async_recreate=false;view._dsEventOccured=false;}}};_pCellControl._getDataRow=function(){return this._rowidx;};_pCellControl._isFakeCell=function(){var datarow=this._getDataRow();var dataset=this._getBindDataset();var rowcount=(dataset)?dataset.rowcount:0;if(rowcount<=datarow||datarow< -2){return true;}return false;};_pCellControl.on_change_containerRect=function(width,height){this._updateAvailableArea();};_pCellControl.on_getIDCSSSelector=function(){if(this._isSubCell){return "subcell";}return "cell";};_pCellControl._getClassCSSSelector=function(){var cssarr=nexacro.Component.prototype._getClassCSSSelector.call(this);if(this._rowidx>=0&&this._rowidx%2){if(!cssarr){cssarr=[];}cssarr.push("oddcell");}return cssarr;};_pCellControl._getElementClassCSSSelector=function(){var cssarr=this._getClassCSSSelector(this);if(cssarr){cssarr.push("dummy");cssarr.push("dummy");cssarr.push("dummy");}return cssarr;};_pCellControl._apply_setfocus=function(evt_name,self_flag){if(self_flag||nexacro._enableaccessibility){nexacro.Component.prototype._apply_setfocus.call(this,evt_name);}};_pCellControl.on_apply_prop_tooltip=function(){var datarow=this._getDataRow();this.tooltiptext=this._refinfo._getTooltipText(datarow);this.tooltiptype=this._refinfo.tooltiptype;nexacro.Component.prototype.on_apply_prop_tooltip.call(this);};_pCellControl.on_fire_onsize=function(width,height){if(width&&height){this._setDisplay(true);}var retn=nexacro.Component.prototype.on_fire_onsize.call(this,width,height);if(!width||!height){this._setDisplay(false);}return retn;};_pCellControl._setDisplay=function(v){if(this._control_element){this._control_element.setElementDisplay((v)?"":"none");}};_pCellControl.on_apply_text=function(){var text_elem=this._text_elem;if(text_elem){var cellinfo=this._refinfo;var datarow=this._getDataRow();var displaytype=cellinfo._getDisplayTypeValue(datarow);var strtext=nexacro._toString(this._displaytext);if(displaytype=="decoratetext"){text_elem.setElementDecorateText(strtext);}else{if(text_elem.decoration!=""){text_elem.decoration="";text_elem.text=null;}if(!text_elem.text&&strtext){text_elem.setElementText(strtext);if(this._expandCtrl&&this._expandCtrl._is_created){this._control_element.bringToFrontElement(this._expandCtrl._control_element);}}else{text_elem.setElementText(strtext);}}}};_pCellControl.on_apply_wordWrap=function(){var text_elem=this._text_elem;if(text_elem){var datarow=this._getDataRow();var wordwrap=this._refinfo._getWordwrap(datarow);text_elem.setElementWordWrap(wordwrap);}};_pCellControl.on_apply_textAlign=function(halign){var text_elem=this._text_elem;if(halign){if(text_elem){text_elem.setElementTextAlign(halign);}if(this._subComp){if(this._subComp._setAlign){this._subComp._setAlign(halign,this.verticalAlign);}else{this._subComp.set_textAlign(halign);}}}};_pCellControl.on_apply_verticalAlign=function(valign){var text_elem=this._text_elem;if(valign){if(text_elem){text_elem.setElementVerticalAlign(valign);}if(this._subComp){if(this._subComp._setAlign){this._subComp._setAlign(this.textAlign,valign);}else{this._subComp.set_verticalAlign(valign);}}}};_pCellControl._needToggle=function(){var datarow=this._getDataRow();var cellinfo=this._refinfo;var displaytype=cellinfo._getDisplaytype(datarow);var edittype=cellinfo._getEdittype(datarow);if(edittype!="checkbox"){return;}if(displaytype=="checkboxcontrol"){if(this._subComp){this._subComp._toggleCheck();}}else{var view=this._view;var v=cellinfo._getValue(datarow);v=nexacro._toBoolean(v);v=(v)?0:1;if(cellinfo.text._bindtype==1){var dataset=this._getBindDataset();view._dsEventOccured=true;dataset.setColumn(datarow,cellinfo.text._bindexpr,v);if(nexacro._enableaccessibility){this._setAccessibilityStatChecked(nexacro._toBoolean(v));}view._dsEventOccured=false;}}};_pCellControl.on_apply_checkboxAlign=function(halign,valign){var controlSizeW=this._subComp._adjust_width;var controlSizeH=this._subComp._adjust_height;var clientrect=this._getAvailableRect();var x=clientrect.left,y=clientrect.top;var w=clientrect.width,h=clientrect.height;switch(halign){case "left":break;case "right":x+=(w-controlSizeW);break;default:x+=((w-controlSizeW)/2);break;}switch(valign){case "top":break;case "bottom":y+=(h-controlSizeH);break;default:y+=((h-controlSizeH)/2);break;}this._subComp.move(x,y,this._subComp._adjust_width,this._subComp._adjust_height);};_pCellControl.on_apply_textDecoration=function(textDecoration){var cellinfo=this._refinfo;if(!textDecoration&&cellinfo.textDecoration){if(this.textDecoration!=cellinfo.textDecoration){this.textDecoration=cellinfo.textDecoration;textDecoration=nexacro.TextDecorationObject(this.textDecoration);this._textdecoration=textDecoration;}else{textDecoration=this._textdecoration;}}if(this._text_elem){this._text_elem.setElementTextDecoration(textDecoration);}else if(this._subComp){this._subComp.set_textDecoration(this.textDecoration);}};_pCellControl._hideInnerElement=function(){var subcells=this.subcells;for(var i=0,n=subcells.length;i<n;i++ ){subcells[i].set_visible(false);}if(this._subComp){this._subComp.set_visible(false);}else if(this._text_elem){this._text_elem.setElementVisible(false);}this._hideInner=true;this.__showExpand(false);if(this._curDisplayType=="treeitemcontrol"){this._subComp._treeline_visible(false);}};_pCellControl._isShowEditor=function(){if(this._editor){return this._editor.visible;}return false;};_pCellControl._isEnterDownable=function(){var cellinfo=this._refinfo;var datarow=this._getDataRow();var edittype=cellinfo._getEdittype(datarow);if(this._curDisplayType=="checkboxcontrol"&&edittype=="checkbox"){return true;}else if(edittype=="button"){return false;}else if(this._isShowEditor()){return true;}return false;};_pCellControl._showInnerElement=function(){var subcells=this.subcells;for(var i=0,n=subcells.length;i<n;i++ ){subcells[i].set_visible(true);}if(this._isShowEditor()==false){if(this._subComp){this._subComp.set_visible(true);}else if(this._text_elem){this._text_elem.setElementVisible(true);}}this._hideInner=false;this.__showExpand(true);if(this._curDisplayType=="treeitemcontrol"){this._subComp._treeline_visible(true);}};_pCellControl.__showExpand=function(flag){if(!this._expandCtrl){return;}if(this._fakecell){this._expandCtrl.set_visible(false);return;}var cellinfo=this._refinfo;var datarow=this._getDataRow();var expandshow=cellinfo._getAttrValue(cellinfo.expandshow,datarow);if(expandshow=="show"){if(flag==false){this._expandCtrl.set_visible(this.selected);}else{this._expandCtrl.set_visible(true);}}else{this._expandCtrl.set_visible(false);}};_pCellControl._createDisplayer=function(displayType){var view=this._view;var cellinfo=this._refinfo;switch(displayType){case "buttoncontrol":this._createButtonDisplayer();break;case "checkboxcontrol":this._createCheckboxDisplayer();break;case "imagecontrol":this._createImageDisplayer();break;case "treeitemcontrol":this._createTreeDisplayer();if(view){view._treeCellinfo=cellinfo;}break;case "combocontrol":this._createComboDisplayer();break;case "calendarcontrol":this._createCalendarDisplayer();break;case "maskeditcontrol":this._createMaskEditDisplayer();break;case "textareacontrol":this._createTextAreaDisplayer();break;case "progressbarcontrol":this._createBarDisplayer();break;case "editcontrol":this._createEditDisplayer();break;default:this._createTextDisplayer();break;}if(this._subComp){this._subComp.on_changeUserStatus=function(changestatus,value,applyuserstatus,currentstatus,currentuserstatus){if(this._displaymode){if(changestatus=="nulltext"&&value){return changestatus;}else{return applyuserstatus;}}return applyuserstatus;};}this._curDisplayType=displayType;this.on_apply_textAlign(cellinfo.textAlign);this.on_apply_verticalAlign(cellinfo.verticalAlign);};_pCellControl._isChangeDisplayer=function(displayType){var view=this._view;var cur_disptype=this._curDisplayType;if((displayType!=cur_disptype)||(view&&view._changeDisplayer)){return true;}return false;};_pCellControl._updateDisplayer=function(){var show=true;var view=this._view;var cellinfo=this._refinfo;var datarow=this._getDataRow();var displayType=cellinfo._getDisplayTypeValue(datarow);if(displayType===undefined){displayType="normal";}if(cellinfo.displaytype._bindtype>0&&displayType==="treeitemcontrol"){if(!view._hasTree&&view._setTreeCellinfo){view._setTreeCellinfo(cellinfo);view._useexprtree=true;}}var expandshow=cellinfo._getAttrValue(cellinfo.expandshow,datarow);var expandsize=cellinfo._getAttrValue(cellinfo.expandsize,datarow);if(expandsize!==0&&!expandsize){expandsize=16;}if(expandshow=="show"){if(!this._expandCtrl){this._createExpandDisplayer();}else{if(this._expand_width!=expandsize){this._expandCtrl.destroy();this._expandCtrl=null;this._createExpandDisplayer();}}this._changeClientmode("expand");}else{if(this._expandCtrl){this._expand_width=0;this._expandCtrl.destroy();this._expandCtrl=null;this._changeClientmode("text");}}if(this._isChangeDisplayer(displayType)){if(this._curDisplayType!=""){this._destroyDisplayer(view?view._lbuttondown_proc:null);}this._createDisplayer(displayType);var def_align=cellinfo._getDefaultTextAlign(displayType,datarow);var textelem=this._text_elem;if(textelem){textelem.setElementTextAlignByClassCSSSelector(def_align);}if(this._subComp&&!this._subComp._is_created){this._subComp.on_created();}this._updateEditor();}else{this.on_apply_wordWrap();}var fake=this._isFakeCell();if(fake&&view){if(view.fillareatype=="datarow"){if(!this._isDisplayDataType(displayType)){if(displayType!="date"){show=false;if(fake!=this._fakecell||view._resetfillarea){this._hideInnerElement();this._fakecell=fake;}}}}else if(view.fillareatype=="linerow"){show=false;if(fake!=this._fakecell||view._resetfillarea){this._hideInnerElement();this._fakecell=fake;}}else if(view.fillareatype=="controlrow"){if(this._isDisplayDataType(displayType)){show=false;if(fake!=this._fakecell||view._resetfillarea){this._hideInnerElement();this._fakecell=fake;}}}}else{if(fake!=this._fakecell){this._showInnerElement();this._fakecell=fake;}}return show;};_pCellControl._isUpdateArea=function(){return true;};_pCellControl.set_select=function(v,no_apply){if(this.selected!=v){this.selected=v;if(!no_apply){this.on_apply_select(v);}}};_pCellControl.on_apply_select=function(select){this._updateAll();};_pCellControl._isSelectedColor=function(){var useselcolor=this._view?this._view.useselcolor:false;return (this.selected&&((useselcolor==undefined)?true:useselcolor));};_pCellControl._getRemoveLine=function(){var remove_l,remove_t,remove_r,remove_b;if(this._isSubCell){remove_l=true;remove_t=true;remove_r=true;remove_b=true;}else{remove_l=true;remove_t=true;remove_r=false;remove_b=false;}return [remove_l,remove_t,remove_r,remove_b];};_pCellControl.__update=function(status,onlycontents,nochk_updatearea){if(!this._is_alive){return false;}var cellinfo=this._refinfo;var view=this._view;var evenodd_change=false;if(this.parent._rowidx>=0){if(this._rowidx!=this.parent._rowidx){var oldrowidx=this._rowidx;this._rowidx=this.parent._rowidx;if((this._rowidx%2)!=(oldrowidx%2)){evenodd_change=true;}this._updateEditor();}}var datarow=this._getDataRow();var cssname=cellinfo._getAttrValue(cellinfo.cssclass,datarow);if(this.cssclass!=cssname){this.set_cssclass(cssname);}else{if(evenodd_change){this.on_apply_cssclass();}}cellinfo._setCellControlProperty(this,datarow);var control_elem=this._control_element;if(control_elem){if(!nochk_updatearea&&this._isUpdateArea()==false){return false;}var readonly=view?!!view.readonly:false;if(this._is_use_auto_selected_status){this._changeUserStatus("selected",this._isSelectedColor());}if(cellinfo._blinked_status[datarow]){this._changeUserStatus("blinked",true);}else{this._changeUserStatus("blinked",false);}this._changeStatus("readonly",readonly);this._disp_show=this._updateDisplayer();if(!onlycontents&&status){this._changeStatus(status,true);}this._displaytext=this._getDisplayText();this.on_apply_text();this.on_apply_textDecoration();var subComp=this._subComp;if(subComp){subComp._updateAll(true,readonly);}if(this._expandCtrl){this._expandCtrl._updateAll(true,readonly);}this.on_apply_prop_tooltip();if(nexacro._enableaccessibility){this.on_apply_accessibility();}}return true;};_pCellControl._updateAll=function(status,onlycontents,nochk_updatearea){if(this.__update(status,onlycontents,nochk_updatearea)){var control_elem=this._control_element;if(control_elem){var remove_line=this._getRemoveLine();var remove_l,remove_t,remove_r,remove_b;remove_l=remove_line[0];remove_t=remove_line[1];remove_r=remove_line[2];remove_b=remove_line[3];if(this.subcells.length>0){for(var i=0,n=this.subcells.length;i<n;i++ ){this.subcells[i]._updateAll();}}else{if(this._disp_show&&this._hideInner){this._showInnerElement();}}if(!onlycontents){this._control_element.setElementBorderNone(remove_l,remove_t,remove_r,remove_b);}if(control_elem._mode=="text"){this._changeClientmode("text");}}}};_pCellControl._updateAllEx=function(){if(!this._is_alive){return false;}var cellinfo=this._refinfo;var view=this._view;var evenodd_change=false;if(this.parent._rowidx>=0){if(this._rowidx!=this.parent._rowidx){var oldrowidx=this._rowidx;this._rowidx=this.parent._rowidx;if((this._rowidx%2)!=(oldrowidx%2)){evenodd_change=true;}}}var datarow=this._getDataRow();var cssname=cellinfo._getAttrValue(cellinfo.cssclass,datarow);if(this.cssclass!=cssname){this.set_cssclass(cssname);}else{if(evenodd_change){this.on_apply_cssclass();}}cellinfo._setCellControlPropertyForAutosize(this,datarow);var control_elem=this._control_element;if(control_elem){var readonly=view?!!view.readonly:false;if(this._is_use_auto_selected_status){this._changeUserStatus("selected",this._isSelectedColor());}this._changeStatus("readonly",readonly);this._disp_show=this._updateDisplayer();this._displaytext=this._getDisplayText();this.on_apply_text();this.on_apply_textDecoration();var subComp=this._subComp;if(subComp){subComp._updateAll(true,readonly);}if(this._expandCtrl){this._expandCtrl._updateAll(true,readonly);}var remove_line=this._getRemoveLine();var remove_l,remove_t,remove_r,remove_b;remove_l=remove_line[0];remove_t=remove_line[1];remove_r=remove_line[2];remove_b=remove_line[3];this._control_element.setElementBorderNone(remove_l,remove_t,remove_r,remove_b);}return true;};_pCellControl.on_apply_accessibility=function(){nexacro.Component.prototype.on_apply_accessibility.call(this);if(this._subComp){this._subComp.on_apply_accessibility();}};_pCellControl.on_apply_prop_cssclass=function(){if(this._editor){this._editor.on_apply_cssclass();}if(this._subComp){this._subComp.on_apply_cssclass();}if(this._expandCtrl){this._expandCtrl.on_apply_cssclass();}};_pCellControl.on_apply_cursor=function(cursor){nexacro.Component.prototype.on_apply_cursor.call(this,cursor);if(this._subComp){this._subComp.set_cursor(cursor);}};_pCellControl._getAvailableRect=function(){var rect={left:0,top:0,right:0,bottom:0,width:0,height:0};rect.left=this._getClientLeft();rect.top=this._getClientTop();rect.right=this._getClientLeft()+this._getClientWidth();rect.bottom=this._getClientTop()+this._getClientHeight();rect.width=this._getClientWidth();rect.height=this._getClientHeight();var expand_ctrl=this._expandCtrl;if(expand_ctrl&&expand_ctrl.visible){rect.width-=expand_ctrl.width;rect.right-=expand_ctrl.width;}return rect;};_pCellControl._changeClientmode=function(mode){var control_elem=this._control_element;if(control_elem){var padding=this._getCurrentStylePadding();if(this._refinfo._subcells.length){mode="normal";}else if(mode=="expand"){if(this._client_mode!="normal"){mode="expandtext";}else{mode="normal";}}else if(mode=="text"){if(this._expandCtrl){mode="expandtext";}else{if(padding){mode=(padding.right>0||padding.bottom>0)?"expandtext":"text";}}}if(mode=="text"||mode=="expandtext"){if(!this._text_elem){this._text_elem=new nexacro.TextBoxElement(control_elem,"text");}}else{if(this._text_elem){this._text_elem.destroy();this._text_elem=null;}}this._updateAvailableArea(true);this._client_mode=mode;}};_pCellControl._createExpandDisplayer=function(){var control_elem=this._control_element;if(control_elem){var cellinfo=this._refinfo;var datarow=this._getDataRow();var border=this._getCurrentStyleBorder();var padding=this._getCurrentStylePadding();this._expand_width=cellinfo._getAttrValue(cellinfo.expandsize,datarow);var l=this._adjust_width-this._expand_width-((border)?border.right._width:0)-((padding)?padding.right:0);var t=this._getClientTop();var r=l+this._expand_width;var b=t+this._getClientHeight();if(l<0){l=this._getClientLeft();r=l+this._getClientWidth();}var expCtrl=this._expandCtrl=new nexacro[this._cellExpandObj](this,l,t,r,b);expCtrl.createComponent();}};_pCellControl._createTextDisplayer=function(){var control_elem=this._control_element;if(control_elem){this._changeClientmode("text");var text_elem=this._text_elem;if(text_elem){if(!this._is_created){this._displaytext=this._getDisplayText();this.on_apply_text();}else{text_elem.create(this._getWindow());}this.on_apply_textDecoration();this.on_apply_wordWrap();}}};_pCellControl._createButtonDisplayer=function(){var control_elem=this._control_element;if(control_elem){var rect=this._getControlRect();this._changeClientmode("normal");var controlComp=new nexacro[this._cellButtonObj]("cellbutton",rect.left,rect.top,rect.width,rect.height,this,true);controlComp.createComponent(true);var datarow=this._getDataRow();var wordwrap=this._refinfo._getWordwrap(datarow);controlComp.set_wordWrap(wordwrap);this._subComp=controlComp;}};_pCellControl._createCheckboxDisplayer=function(){var control_elem=this._control_element;if(control_elem){this._changeClientmode("normal");var controlComp=new nexacro[this._cellCheckBoxObj]("cellcheckbox",0,0,0,0,this,true);controlComp.createComponent(true);controlComp._skip_mobile_tabfocus=true;this._subComp=controlComp;}};_pCellControl._createImageDisplayer=function(){var control_elem=this._control_element;if(control_elem){var rect=this._getControlRect();this._changeClientmode("normal");var controlComp=new nexacro[this._cellImageObj]("cellimage",rect.left,rect.top,rect.width,rect.height,this);controlComp.createComponent(true);this._subComp=controlComp;}};_pCellControl._createComboDisplayer=function(){var control_elem=this._control_element;if(control_elem){var rect=this._getControlRect();this._changeClientmode("normal");var controlComp=new nexacro[this._cellComboObj]("cellcombo",rect.left,rect.top,rect.width,rect.height,this,true);controlComp.createComponent(true);controlComp.comboedit._input_element._isUseDelCaret=true;this._subComp=controlComp;}};_pCellControl._createCalendarDisplayer=function(){var control_elem=this._control_element;if(control_elem){var rect=this._getControlRect();this._changeClientmode("normal");var controlComp=this._subComp=new nexacro[this._cellCalendarObj]("cellcalendar",rect.left,rect.top,rect.width,rect.height,this,true);controlComp.createComponent(true);controlComp.calendaredit._input_element._isUseDelCaret=true;this._subComp=controlComp;}};_pCellControl._createEditDisplayer=function(){var control_elem=this._control_element;if(control_elem){var rect=this._getControlRect();this._changeClientmode("normal");var controlComp=this._subComp=new nexacro[this._cellEditObj]("celledit",rect.left,rect.top,rect.width,rect.height,this,true);controlComp.createComponent(true);controlComp._input_element._isUseDelCaret=true;this._subComp=controlComp;}};_pCellControl._createMaskEditDisplayer=function(){var control_elem=this._control_element;if(control_elem){var rect=this._getControlRect();this._changeClientmode("normal");var controlComp=this._subComp=new nexacro[this._cellMaskEditObj]("cellmaskedit",rect.left,rect.top,rect.width,rect.height,this,true,true);controlComp.createComponent(true);controlComp._input_element._isUseDelCaret=true;this._subComp=controlComp;}};_pCellControl._createTextAreaDisplayer=function(){var control_elem=this._control_element;if(control_elem){var rect=this._getControlRect();this._changeClientmode("normal");var controlComp=this._subComp=new nexacro[this._cellTextAreaObj]("celltextarea",rect.left,rect.top,rect.width,rect.height,this,true);controlComp.createComponent(true);controlComp._input_element._isUseDelCaret=true;var datarow=this._getDataRow();var wordwrap=this._refinfo._getWordwrap(datarow);controlComp.set_wordWrap(wordwrap);this._subComp=controlComp;}};_pCellControl._createBarDisplayer=function(){var control_elem=this._control_element;if(control_elem){var rect=this._getControlRect();this._changeClientmode("normal");var controlComp=this._subComp=new nexacro[this._cellProgressBarObj]("cellprogressbar",rect.left,rect.top,rect.width,rect.height,this,true);controlComp.createComponent(true);this._subComp=controlComp;}};_pCellControl._createTreeDisplayer=function(doc,target){var control_elem=this._control_element;if(control_elem){var rect=this._getControlRect();var left=rect.left;var top=rect.top;var width=rect.width;var height=rect.height;this._changeClientmode("normal");var controlComp=this._subComp=new nexacro[this._cellTreeObj]("celltreeitem",left,top,width,height,null,null,this);controlComp.createComponent(true);this._subComp=controlComp;}};_pCellControl._updateAvailableArea=function(force){var rc=this._getAvailableRect();var subcomp=this._subComp;var l=rc.left;var t=rc.top;var w=rc.width;var h=rc.height;if(!force){if(this._avail_left==l&&this._avail_top==t&&this._avail_width==w&&this._avail_height==h){return false;}}if(subcomp){if(this._curDisplayType=="checkboxcontrol"){this.on_apply_checkboxAlign("center","middle");}else{var ctrlrc=this._getControlRect();subcomp.move(ctrlrc.left,ctrlrc.top,ctrlrc.width,ctrlrc.height);}}if(this._text_elem){this._text_elem.setElementPosition(l,t);this._text_elem.setElementSize(w,h);}if(this._editor&&this._isConditionEditor()){this._editor.move(l,t,w,h);}var expand_ctrl=this._expandCtrl;if(expand_ctrl){var left=this._getClientWidth()+this._getClientLeft()-this._expand_width;var top=rc.top;var width=this._expand_width;var height=rc.height;if(left<0){left=rc.left;width=this._getClientWidth();}expand_ctrl.move(left,top,width,height);}this._avail_left=rc.left;this._avail_top=rc.top;this._avail_width=rc.width;this._avail_height=rc.height;return true;};_pCellControl._isEnable=function(){if(this._view&&this._view._enable!==undefined){return this._view._enable;}if(this.parent&&this.parent._isEnable){return this.parent._isEnable();}return true;};_pCellControl._getDisplayText=function(){if(this._refinfo){var datarow=this._getDataRow();return this._refinfo._getDisplayText(datarow);}return "";};_pCellControl._isDisplayDataType=function(displayType){if(displayType=="number"||displayType=="exponent"||displayType=="currency"||displayType=="normal"||displayType=="text"||displayType=="decoratetext"||displayType=="mask"||displayType=="combotext"||displayType=="date"){return true;}return false;};_pCellControl._updateEditor=function(){var text_elem=this._text_elem;var editComp=this._editor;if(editComp){if(this._isConditionEditor()){if(text_elem){text_elem.setElementVisible(false);}if(this._subComp){this._subComp.set_visible(false);}var rect=this._getControlRect();editComp.move(rect.left,rect.top,rect.width,rect.height);}else{if(text_elem){text_elem.setElementVisible(true);}if(this._subComp){this._subComp.set_visible(true);}editComp.move( -10, -10,0,0);}}};_pCellControl._isConditionEditor=function(){return true;};_pCellControl._getAutoEnter=function(){return this._view.autoenter;};_pCellControl._getAutoUpdateType=function(){return this._view.autoupdatetype;};_pCellControl._showEditor=function(){if(this._isShowEditor()){return;}var text_elem=this._text_elem;var editComp;var view=this._view;if(text_elem){text_elem.setElementVisible(false);}if(this._subComp){this._subComp._changeStatus("mouseover",false);if(nexacro._isTouchInteraction){nexacro._OnceCallbackTimer.callonce(this,function(){this._subComp.set_visible(false);});}else{this._subComp.set_visible(false);}}editComp=this._createEditor();editComp._EditUpdateAll();editComp.set_visible(true);editComp._setFocus(false);if(editComp.setCaretPos&&!editComp.autoselect){editComp.setCaretPos(0);}else if(editComp.comboedit&&editComp.comboedit.setCaretPos){editComp.comboedit.setCaretPos(0);}if(nexacro._isTouchInteraction||(view&&view.selectchangetype=="up")){editComp._setFocus(false);}if(view&&view.autoenter=="select"&&view._lbuttondown_proc){editComp._user_push=true;editComp._changeStatus("focused",true);editComp._is_pushed_area=true;editComp._is_push=true;}else{editComp._changeStatus("focused",true);}this._editor=editComp;};_pCellControl._hideEditor=function(){var text=this._text_elem;if(text){text.setElementVisible(true);}if(this._subComp){this._subComp.set_visible(true);}var value;if(this._editor){value=this._editor._getValueData();this._destroyEditor();}return value;};_pCellControl._hasEditor=function(){return this._refinfo._hasEditor(this._getDataRow());};_pCellControl._destroyEditor=function(){if(this._editor){if(this._tempdestroyeditor){if(!this._tempdestroyeditor_list){this._tempdestroyeditor_list=[];}this._tempdestroyeditor_list.push(this._tempdestroyeditor);nexacro._OnceCallbackTimer.callonce(this,function(){var tempeditor=this._tempdestroyeditor_list.pop();tempeditor.destroy();});}var editComp=this._tempdestroyeditor=this._editor;editComp.set_visible(false);if(nexacro._Browser=="IE"){var control_elem=editComp.getElement();if(control_elem){control_elem.setElementDisplay("none");}}if(nexacro._Browser=="Safari"){nexacro._OnceCallbackTimer.callonce(editComp,function(){editComp.set_visible(false);});}else{if(this._control_element){this._control_element.setElementFocus();}}this._editor=null;}};_pCellControl._getFormatSize=function(){return null;};_pCellControl._getControlRect=function(){var rect=this._getAvailableRect();var fomatsize=this._getFormatSize();var cellinfo=this._refinfo;var controlautosizingtype=cellinfo._getAttrValue(cellinfo.controlautosizingtype,this._getDataRow());if(fomatsize!=null){var left=rect.left,top=rect.top;var width,height,right,bottom;var border=this._getCurrentStyleBorder();var padding=this._getCurrentStylePadding();var fixwidth=fomatsize[0]-(border?border.left._width+border.right._width:0)-(padding?padding.left+padding.right:0);var fixheight=fomatsize[1]-(border?border.top._width+border.bottom._width:0)-(padding?padding.top+padding.bottom:0);if(controlautosizingtype=="none"){width=fixwidth;if(width<rect.width){left+=(rect.width-width)/2;}right=left+width;height=fixheight;if(height<rect.height){top+=(rect.height-height)/2;}bottom=top+height;rect.left=left;rect.top=top;rect.width=width;rect.height=height;rect.right=right;rect.bottom=bottom;}else if(controlautosizingtype=="width"){height=fixheight;if(height<rect.height){top+=(rect.height-height)/2;}bottom=top+height;rect.top=top;rect.height=height;rect.bottom=bottom;}else if(controlautosizingtype=="height"){width=fixwidth;if(width<rect.width){left+=(rect.width-width)/2;}right=left+width;rect.left=left;rect.width=width;rect.right=right;}}return rect;};_pCellControl._createidx=0;_pCellControl._createEditor=function(){var cellinfo=this._refinfo;var datarow=this._getDataRow();var editType=cellinfo._getEdittype(datarow);var creator=this["_createEditor_"+editType];if(creator==null){creator=this._createEditor_text;}this._destroyEditor();this._editor=creator.call(this);this._editor._update_datarow=this._getDataRow();this._createidx++ ;return this._editor;};_pCellControl._createEditor_text=function(){var datarow=this._getDataRow();var rect=this._getControlRect();var cellinfo=this._refinfo;var cEdit=new nexacro[this._cellEditObj]("celledit"+this._createidx,rect.left,rect.top,rect.width,rect.height,this);var v=cellinfo._getValue(datarow);var editmaxlength=cellinfo._getAttrValue(cellinfo.editmaxlength,datarow);var dataset=this._getBindDataset();if(editmaxlength==0){editmaxlength=dataset?dataset._getColumnSize(cellinfo.text._bindtype==1?cellinfo.text._bindexpr:0):0;}cEdit.set_maxlength(editmaxlength);cEdit.set_value(v);cEdit.createComponent();this._writable=true;return cEdit;};_pCellControl._createEditor_mask=function(){var rect=this._getControlRect();var cellinfo=this._refinfo;var cMaskEdit=new nexacro[this._cellMaskEditObj]("cellmaskedit"+this._createidx,rect.left,rect.top,rect.width,rect.height,this);var datarow=this._getDataRow();var value=cellinfo._getValue(datarow);var locale=cellinfo._getLocale(datarow);var mask=cellinfo._getAttrValue(cellinfo.maskeditformat,datarow);var type=cellinfo._getAttrValue(cellinfo.maskedittype,datarow);cMaskEdit.set_type(type);if(mask){cMaskEdit.set_format(mask);}cMaskEdit.set_locale(locale);cMaskEdit.set_value(value);cMaskEdit.createComponent();this._writable=true;return cMaskEdit;};_pCellControl._createEditor_combo=function(){var rect=this._getControlRect();var cCombo=new nexacro[this._cellComboObj]("cellcombo"+this._createidx,rect.left,rect.top,rect.width,rect.height,this);cCombo.createComponent();this._writable=true;return cCombo;};_pCellControl._createEditor_date=function(){var datarow=this._getDataRow();var rect=this._getControlRect();var cellinfo=this._refinfo;var cCalendar=new nexacro[this._cellCalendarObj]("cellcalendar"+this._createidx,rect.left,rect.top,rect.width,rect.height,this);var v=cellinfo._getValue(datarow);var calendardateformat=cellinfo._getAttrValue(cellinfo.calendardateformat,datarow);var calendareditformat=cellinfo._getAttrValue(cellinfo.calendareditformat,datarow);var locale=cellinfo._getLocale(datarow);if(this._displaymode==true&&!v){v=cellinfo._getDisplayText(datarow);}cCalendar.createComponent();if(!calendardateformat){calendardateformat=nexacro.Calendar.prototype.dateformat;}if(!calendareditformat){calendareditformat=nexacro.Calendar.prototype.editformat;}cCalendar.set_dateformat(calendardateformat);cCalendar.set_editformat(calendareditformat);cCalendar.set_locale(locale);cCalendar.set_value(v);cCalendar._recalcLayout();this._writable=true;return cCalendar;};_pCellControl._createEditor_textarea=function(readonly){var datarow=this._getDataRow();var rect=this._getControlRect();var cellinfo=this._refinfo;var cTextArea=new nexacro[this._cellTextAreaObj]("celltextarea"+this._createidx,rect.left,rect.top,rect.width,rect.height,this);var v;if(cTextArea._displaymode==true||readonly){v=cellinfo._getDisplayText(datarow);}else{v=cellinfo._getValue(datarow);}var wordwrap=cellinfo._getWordwrap(datarow);var textareamaxlength=cellinfo._getAttrValue(cellinfo.textareamaxlength,datarow);var dataset=this._getBindDataset();var textareabartype=cellinfo._getAttrValue(cellinfo.textareascrollbartype,datarow);var textareascrolltype=cellinfo._getAttrValue(cellinfo.textareascrolltype,datarow);if(textareamaxlength==0){textareamaxlength=dataset?dataset._getColumnSize(cellinfo._col):0;}cTextArea.set_maxlength(textareamaxlength);cTextArea.set_wordWrap(wordwrap);cTextArea.set_value(v);cTextArea.set_scrollbartype(textareabartype);cTextArea.set_scrolltype(textareascrolltype);cTextArea.createComponent();if(readonly){cTextArea.set_readonly(true);}this._writable=!readonly;return cTextArea;};_pCellControl._createEditor_readonly=function(){return this._createEditor_textarea(true);};_pCellControl._createEditor_button=function(){var rect=this._getControlRect();var cButton=new nexacro[this._cellButtonObj]("cellbutton"+this._createidx,rect.left,rect.top,rect.width,rect.height,this);cButton.createComponent();if(nexacro._Browser=="IE"&&!nexacro._enableaccessibility){nexacro._OnceCallbackTimer.callonce(this,function(){cButton._control_element.setElementFocus();},0);}this._writable=false;return cButton;};_pCellControl._getAccessibilityLabel=function(is_no_make){var label=nexacro.Component.prototype._getAccessibilityLabel.call(this);if(!label&&this.subcells.length>0){var subcells=this.subcells;var subcell_text;for(var i=0,n=subcells.length;i<n;i++ ){if(subcell_text=subcells[i]._getDisplayText()){if(label){label=label+" "+subcell_text;}else{label=subcell_text;}}}}if((nexacro._accessibilitytype==4||nexacro._accessibilitytype==5)&&!is_no_make){var tmp_label=this._getAccessibilityMakeAddLabel();label=tmp_label+" "+label;}return label;};_pCellControl._isEditable=function(){if(this._editor){return (this._editor.visible&&this._editor._adjust_width>0);}return false;};_pCellControl._setAccessibilityStatFocus=function(){if(nexacro._accessibilitytype==4||nexacro._accessibilitytype==5){return;}var acclabel=this._refinfo._getAttrValue(this._refinfo.accessibilitylabel,this._getDataRow());this.set_accessibilitylabel(acclabel);this.on_apply_accessibility();this.on_apply_prop_accessibilitydescription();this.on_apply_prop_accessibilityaction();var tmp_label="";tmp_label=this._getAccessibilityMakeAddLabel()+" "+this._getCellAccessibilityLabel();this._setAccessibilityStatSelected(this.selected);tmp_label=tmp_label.trim();this._setAccessibilityLabel(tmp_label);if(this._editor&&this._editor.visible&&this._editor._adjust_width>0){this._editor._setAccessibilityStatFocus();}else if(this._subComp&&this._curDisplayType!="treeitemcontrol"){this._subComp._setAccessibilityStatFocus();}else{nexacro.Component.prototype._setAccessibilityStatFocus.call(this);}};_pCellControl._getCellAccessibilityLabel=function(){var tmpLabel="";tmpLabel=this._getAccessibilityLabel();if(this._subComp){var subComp=this._subComp;var displayType=this._curDisplayType;if(displayType=="checkboxcontrol"){this._setAccessibilityStatChecked(subComp.isChecked());}else if(displayType=="treeitemcontrol"){var datarow=this._getDataRow();var cellinfo=this._refinfo;var state=this._getTreeStatus();var level=cellinfo._getTreeLevel(datarow);var startlevel=cellinfo._getTreeStartLevel(datarow);switch(state){case 0:this._setAccessibilityStatExpanded(false);break;case 1:this._setAccessibilityStatExpanded(true);break;default:this._setAccessibilityStatExpanded(undefined);}this._setAccessibilityInfoLevel(level-startlevel+1);}}return tmpLabel;};_pCellControl._getTreeStatus=function(){};_pCellControl.__getAccessibilityMakeAddLabelMiddleClass=function(){return "";};_pCellControl._getAccessibilityMakeAddLabel=function(){var tmpLabel="",view=this._view;var desclevel=this._getDescLevel();if(desclevel=="none"||desclevel=="child"){return "";}if(view._is_first_focus&&view._control_element){tmpLabel=view._getAccessibilityLabel();}tmpLabel+=this.__getAccessibilityMakeAddLabelMiddleClass();return tmpLabel;};_pCellControl._getAccessibilityRoleParentType=function(){};_pCellControl._getAccessibilityRole=function(){var role=this.accessibilityrole;if(role=="gridcell"){var _role=this._getAccessibilityRoleParentType();if(_role){role=_role;}if(this._curDisplayType=="treeitemcontrol"){role="treeitem";}else if(this._subComp){role=this._subComp._getAccessibilityRole();}}return role;};_pCellControl.on_get_accessibility_label=function(){var usedecoratetext=false;if(this._refinfo){var dt=this._refinfo.displaytype;if(dt=="checkboxcontrol"){return "";}usedecoratetext=(dt=="decoratetext"?true:false);}var label=this._getDisplayText();if(usedecoratetext){return nexacro._getDisplayTextfromDecorateText(label);}return label;};_pCellControl._setAccessibilityNotifyEvent=function(direction){var label=this._getAccessibilityMakeAddLabel();label+=" "+this._getCellAccessibilityLabel();label=label.trim();this._setAccessibilityLabel(label);return nexacro.Component.prototype._setAccessibilityNotifyEvent.call(this,(direction&&direction>0)?0:1);};_pCellControl._getComputedStyleWithProp=function(prop){var obj;if(prop=="background"){obj=this._control_element._getComputedStyleBackgroundColor();}else if(prop=="textAlign"||prop=="verticalAlign"){var align=this._getCurrentStyleAlign();obj=align[prop];}else if(prop=="font"||prop=="color"||prop=="wordSpacing"||prop=="letterSpacing"){obj=this._getCurrentStyleInheritValue(prop,"enabled");}else if(prop=="border"){obj=this._getCurrentStyleBorder();}else if(prop=="textDecoration"||prop=="borderRadius"||prop=="cursor"||prop=="opacity"){if(prop=="textDecoration"){prop="-nexa-text-decoration";}if(prop=="borderRadius"){prop="border-radius";}obj=nexacro._getStyleProperty(this,prop);}else{obj=this._getCSSStyleValue(prop,"enabled");}return obj;};_pCellControl._getComputedStyle=function(is_subcomp){var ctrl_cs={"styles":{},"subcomp":{"styles":null}};var properties=this._computed_prop_list;var prop;for(var i=0,n=properties.length;i<n;i++ ){prop=properties[i];ctrl_cs.styles[prop]=this._getComputedStyleWithProp(prop);}if(is_subcomp&&this._subComp){ctrl_cs.subcomp=this._subComp._getComputedStyle();}return ctrl_cs;};_pCellControl._setComputedStyle=function(ctrl_cs){var properties=this._computed_prop_list;var subcomp=this._subComp;for(var i=0;i<properties.length;i++ ){var prop_name=properties[i];var func_name="set_"+prop_name;if(ctrl_cs.styles){var val=ctrl_cs.styles[prop_name];val=val&&val.value?val.value:val;if(this[func_name]){this[func_name].call(this,val);}}}if(subcomp){subcomp._setComputedStyle(ctrl_cs.subcomp);}};_pCellControl.on_apply_padding=function(padding){var control_elem=this._control_element;if(control_elem){this._updateAvailableArea();}};_pCellControl.on_apply_prop_enable=function(v){nexacro.Component.prototype.on_apply_prop_enable.call(this,v);if(this._subComp){this._subComp._setEnable(v);}};_pCellControl.on_apply_prop_rtl=function(){if(this._is_created){return;}var v=this.rtl=this._refinfo._getAttrValue(this._refinfo.rtl,this._getDataRow());this._rtl=nexacro._isBoolean(v)?nexacro._toBoolean(v):undefined;nexacro.Component.prototype.on_apply_prop_rtl.call(this);if(this._subComp){this._subComp.set_rtl(this.rtl);}};_pCellControl._getPositionInRootComponent=nexacro._emptyFn;nexacro._CellExpandControl=function(parent,left,top,right,bottom,controlmode){nexacro.Button.call(this,"cellexpandbutton",left,top,right-left,bottom-top,null,null,null,null,null,null,parent);this._controlmode=(controlmode)?true:false;this._view=parent._view;this._cellobj=parent;this._cellinfo=parent._refinfo;this._setControl();};var _pCellExpand=nexacro._createPrototype(nexacro.Button,nexacro._CellExpandControl);nexacro._CellExpandControl.prototype=_pCellExpand;_pCellExpand._is_subcontrol=true;_pCellExpand.on_destroy_contents=function(){nexacro.Button.prototype.on_destroy_contents.call(this);this._view=null;this._cellobj=null;this._cellinfo=null;};_pCellExpand._isEnable=function(){if(this._view&&this._view._enable!==undefined){return this._view._enable;}if(this.parent&&this.parent._isEnable){return this.parent._isEnable();}return true;};_pCellExpand._updateAll=function(onlycontents,breadonly){var control_elem=this._control_element;if(control_elem){if(breadonly!==undefined){if(this.on_apply_readonly){this.on_apply_readonly(breadonly);}else{this._changeStatus("readonly",breadonly);}}var datarow=this._cellobj._getDataRow();if(!onlycontents){this._apply_status(this._oldstatus,this._status,this._olduserstatus,this._userstatus);}if(this._cellinfo){var icon=this._cellinfo._getAttrValue(this._cellinfo.expandimage,datarow);if(icon){this.set_icon(icon);}var text=this._cellinfo._getAttrValue(this._cellinfo.expandchar,datarow);this.set_text(text);}}};_pCellExpand._setAlign=function(halign,valign){var elem=this._text_elem;if(elem){if(halign){this.set_textAlign(halign);}if(valign){this.set_verticalAlign(valign);}}};_pCellExpand.on_fire_ondblclick=function(button,alt_key,ctrl_key,shift_key,screenX,screenY,canvasX,canvasY,clientX,clientY,from_comp,from_refer_comp){return this._cellobj.on_fire_ondblclick(button,alt_key,ctrl_key,shift_key,screenX,screenY,canvasX,canvasY,clientX,clientY,from_comp,from_refer_comp,"expandbutton");};_pCellExpand.on_fire_onclick=function(button,alt_key,ctrl_key,shift_key,screenX,screenY,canvasX,canvasY,clientX,clientY,from_comp,from_refer_comp){return this._cellobj.on_fire_onclick(button,alt_key,ctrl_key,shift_key,screenX,screenY,canvasX,canvasY,clientX,clientY,from_comp,from_refer_comp,"expandbutton");};_pCellExpand._setAccessibilityStatFocus=function(){var cellobj=this._cellobj;this._control_element.setElementAccessibilityLabel(cellobj._getAccessibilityLabel());this._control_element.setElementAccessibilityAction(cellobj.accessibilityaction);this._control_element.setElementAccessibilityDescription(cellobj.accessibilitydescription);this._control_element.setElementAccessibilityParentLabel(cellobj._getAccessibilityMakeAddLabel().trim());nexacro.Button.prototype._setAccessibilityStatFocus.call(this);};_pCellExpand.on_get_accessibility_description=function(){if(this._cellobj){var tooltiptext=this._cellobj.tooltiptext;return nexacro._isNull(tooltiptext)?"":tooltiptext;}return "";};_pCellExpand.on_get_accessibility_label=function(){return this.text;};nexacro._CellButtonControl=function(id,left,top,width,height,parent,displaymode,controlmode){nexacro.Button.call(this,id,left,top,width,height,null,null,null,null,null,null,parent);this.tabstop=false;this._clickevt_able=true;this._displaymode=(displaymode)?true:false;this._controlmode=(controlmode)?true:false;this._view=parent._view;this._cellinfo=parent._refinfo;this._cellobj=parent;this._setControl();};var _pCellButton=nexacro._createPrototype(nexacro.Button,nexacro._CellButtonControl);nexacro._CellButtonControl.prototype=_pCellButton;_pCellButton._is_subcontrol=true;_pCellButton.on_getIDCSSSelector=function(){return "cellbutton";};_pCellButton.on_destroy_contents=function(){nexacro.Button.prototype.on_destroy_contents.call(this);this._view=null;this._cellinfo=null;this._cellobj=null;};_pCellButton._apply_setfocus=function(evt_name){if(!this._displaymode||nexacro._enableaccessibility){nexacro.Button.prototype._apply_setfocus.call(this,evt_name);}};_pCellButton._isEnable=function(){if(this._view&&this._view._enable!==undefined){return this._view._enable;}if(this.parent&&this.parent._isEnable){return this.parent._isEnable();}return true;};_pCellButton.on_fire_onclick=function(button,alt_key,ctrl_key,shift_key,screenX,screenY,canvasX,canvasY,clientX,clientY,from_comp,from_refer_comp){nexacro.Button.prototype.on_fire_onclick.call(this,button,alt_key,ctrl_key,shift_key,screenX,screenY,canvasX,canvasY,clientX,clientY,from_comp,from_refer_comp);this._cellobj.on_fire_onclick(button,alt_key,ctrl_key,shift_key,screenX,screenY,canvasX,canvasY,clientX,clientY,from_comp,from_refer_comp,"control");return true;};_pCellButton.on_fire_ondblclick=function(button,alt_key,ctrl_key,shift_key,screenX,screenY,canvasX,canvasY,clientX,clientY,from_comp,from_refer_comp){nexacro.Button.prototype.on_fire_ondblclick.call(this,button,alt_key,ctrl_key,shift_key,screenX,screenY,canvasX,canvasY,clientX,clientY,from_comp,from_refer_comp);this._cellobj.on_fire_ondblclick(button,alt_key,ctrl_key,shift_key,screenX,screenY,canvasX,canvasY,clientX,clientY,from_comp,from_refer_comp,"control");return true;};_pCellButton._EditUpdateAll=function(){if(this._control_element){this._updateAll();var datarow=this._cellobj._getDataRow();var wordwrap=this._cellinfo._getWordwrap(datarow);this.set_wordWrap(wordwrap);}};_pCellButton._setProperty=function(onlycontrolprop){var cellinfo=this._cellinfo;var cellobj=this._cellobj;var datarow=cellobj._getDataRow();if(onlycontrolprop){return;}var v;if(this._displaymode==true){v=cellinfo._getDisplayText(datarow);}else{v=cellinfo._getValue(datarow,!this._writable);}if(v!=null){this.set_text(v);}else{this.set_text("");}};_pCellButton._getValueData=function(){};_pCellButton._updateAll=function(onlycontents,breadonly){if(breadonly!==undefined){if(this.on_apply_readonly){this.on_apply_readonly(breadonly);}else{this._changeStatus("readonly",breadonly);}}if(!onlycontents){this._apply_status(this._oldstatus,this._status,this._olduserstatus,this._userstatus);}this._setProperty();};_pCellButton._setAccessibilityStatFocus=function(){var cellobj=this._cellobj;this._control_element.setElementAccessibilityLabel(cellobj._getAccessibilityLabel());this._control_element.setElementAccessibilityAction(cellobj.accessibilityaction);this._control_element.setElementAccessibilityDescription(cellobj.accessibilitydescription);this._control_element.setElementAccessibilityParentLabel(cellobj._getAccessibilityMakeAddLabel().trim());nexacro.Component.prototype._setAccessibilityStatFocus.call(this);};_pCellButton.on_get_accessibility_description=function(){if(this._cellobj){var tooltiptext=this._cellobj.tooltiptext;return nexacro._isNull(tooltiptext)?"":tooltiptext;}return "";};_pCellButton.on_get_accessibility_label=function(){return this.text;};_pCellButton._getAccessibilityRole=function(){return this._cellobj?this._cellobj.accessibilityrole:this.accessibilityrole?this.accessibilityrole:"none";};_pCellButton._getComputedStyle=function(){if(!nexacro._getComputedStyleProperties){return;}var properties=this._computed_prop_list;properties=properties.toString();var ctrl_cs={"styles":null};var str=nexacro._getComputedStyleProperties(this._control_element,properties,null,true);eval("ctrl_cs.styles = "+str);return ctrl_cs;};_pCellButton._setComputedStyle=function(ctrl_cs){var properties=this._computed_prop_list;for(var i=0;i<properties.length;i++ ){var prop_name=properties[i];var func_name="set_"+prop_name;if(ctrl_cs.styles){if(this[func_name]){this[func_name].call(this,ctrl_cs.styles[prop_name]);}}}};_pCellButton._getCurrentStyleAlign=function(noflush){return this._cellobj._getCurrentStyleAlign(noflush);};nexacro._CellProgressBarControl=function(id,left,top,width,height,parent,controlmode){nexacro.ProgressBar.call(this,id,left,top,width,height,null,null,null,null,null,null,parent);this.tabstop=false;this.max=100;this.min=0;this.step=1;this._controlmode=(controlmode)?true:false;this._view=parent._view;this._cellinfo=parent._refinfo;this._cellobj=parent;this._setControl();};var _pCellBar=nexacro._CellProgressBarControl.prototype=nexacro._createPrototype(nexacro.ProgressBar,nexacro._CellProgressBarControl);_pCellBar._is_subcontrol=true;_pCellBar.on_destroy_contents=function(){nexacro.ProgressBar.prototype.on_destroy_contents.call(this);this._view=null;this._cellinfo=null;this._cellobj=null;};_pCellBar.set_text=function(v){var retn=nexacro.Component.prototype.set_text.call(this,v);this.set_pos(parseInt(this._displaytext));return retn;};_pCellBar._isEnable=function(){if(this._view&&this._view._enable!==undefined){return this._view._enable;}if(this.parent&&this.parent._isEnable){return this.parent._isEnable();}return true;};_pCellBar.on_fire_onclick=function(button,alt_key,ctrl_key,shift_key,screenX,screenY,canvasX,canvasY,clientX,clientY,from_comp,from_refer_comp){return this._cellobj.on_fire_onclick(button,alt_key,ctrl_key,shift_key,screenX,screenY,canvasX,canvasY,clientX,clientY,from_comp,from_refer_comp,"control");};_pCellBar.on_fire_ondblclick=function(button,alt_key,ctrl_key,shift_key,screenX,screenY,canvasX,canvasY,clientX,clientY,from_comp,from_refer_comp){return this._cellobj.on_fire_ondblclick(button,alt_key,ctrl_key,shift_key,screenX,screenY,canvasX,canvasY,clientX,clientY,from_comp,from_refer_comp,"control");};_pCellBar._getDisplayText=function(){if(this.parent){return this.parent._getDisplayText();}return "";};_pCellBar._updateAll=function(onlycontents,breadonly){if(breadonly!==undefined){if(this.on_apply_readonly){this.on_apply_readonly(breadonly);}else{this._changeStatus("readonly",breadonly);}}if(!onlycontents){this._apply_status(this._oldstatus,this._status,this._olduserstatus,this._userstatus);}this._setProperty();};_pCellBar._setProperty=function(onlycontrolprop){var cellinfo=this._cellinfo;var cellobj=this._cellobj;var datarow=cellobj._getDataRow();cellinfo._setCellChildControlProperty("progressbar",this,datarow);if(onlycontrolprop){return;}var v=cellinfo._getDisplayText(datarow);if(v!=null){this.set_text(v);}else{this.set_text("");}};_pCellBar._setAccessibilityStatFocus=function(){var cellobj=this._cellobj;this._control_element.setElementAccessibilityLabel(cellobj._getAccessibilityLabel());this._control_element.setElementAccessibilityAction(cellobj.accessibilityaction);this._control_element.setElementAccessibilityDescription(cellobj.accessibilitydescription);this._control_element.setElementAccessibilityParentLabel(cellobj._getAccessibilityMakeAddLabel().trim());nexacro.Component.prototype._setAccessibilityStatFocus.call(this);};_pCellBar.on_get_accessibility_description=function(){if(this._cellobj){var tooltiptext=this._cellobj.tooltiptext;return nexacro._isNull(tooltiptext)?"":tooltiptext;}return "";};_pCellBar._getComputedStyle=function(){if(!nexacro._getComputedStyleProperties){return;}var properties=this._computed_prop_list;properties=properties.toString();var ctrl_cs={"styles":null,"progressbaritem":{styles:null},"progressbartext":{styles:null},"progressstartcap":{styles:null},"progressendcap":{styles:null}};var str=nexacro._getComputedStyleProperties(this._control_element,properties,null,true);eval("ctrl_cs.styles = "+str);if(this.progressbaritem){str=nexacro._getComputedStyleProperties(this.progressbaritem._control_element,properties,null,true);eval("ctrl_cs.progressbaritem.styles = "+str);}if(this.progressbartext){str=nexacro._getComputedStyleProperties(this.progressbartext._control_element,properties,null,true);eval("ctrl_cs.progressbartext.styles = "+str);}if(this.progressstartcap){str=nexacro._getComputedStyleProperties(this.progressstartcap._control_element,properties,null,true);eval("ctrl_cs.progressstartcap.styles = "+str);}if(this.progressendcap){str=nexacro._getComputedStyleProperties(this.progressendcap._control_element,properties,null,true);eval("ctrl_cs.progressendcap.styles = "+str);}return ctrl_cs;};_pCellBar._setComputedStyle=function(ctrl_cs){var properties=this._computed_prop_list;var progressbaritem=this.progressbaritem;var progressbartext=this.progressbartext;var progressstartcap=this.progressstartcap;var progressendcap=this.progressendcap;for(var i=0;i<properties.length;i++ ){var prop_name=properties[i];var func_name="set_"+prop_name;if(ctrl_cs.styles){if(this[func_name]){this[func_name].call(this,ctrl_cs.styles[prop_name]);}}if(progressbaritem){if(ctrl_cs.progressbaritem.styles){if(progressbaritem[func_name]){progressbaritem[func_name].call(progressbaritem,ctrl_cs.progressbaritem.styles[prop_name]);}}}if(progressbartext){if(ctrl_cs.progressbartext.styles){if(progressbartext[func_name]){progressbartext[func_name].call(progressbartext,ctrl_cs.progressbartext.styles[prop_name]);}}}if(progressstartcap){if(ctrl_cs.progressstartcap.styles){if(progressstartcap[func_name]){progressstartcap[func_name].call(progressstartcap,ctrl_cs.progressstartcap.styles[prop_name]);}}}if(progressendcap){if(ctrl_cs.progressendcap.styles){if(progressendcap[func_name]){progressendcap[func_name].call(progressendcap,ctrl_cs.progressendcap.styles[prop_name]);}}}}};_pCellBar._getCurrentStyleAlign=function(noflush){return this._cellobj._getCurrentStyleAlign(noflush);};nexacro._CellEditControl=function(id,left,top,width,height,parent,displaymode,controlmode){nexacro.Edit.call(this,id,left,top,width,height,null,null,null,null,null,null,parent,displaymode);this.tabstop=false;if(displaymode){this._displaymode=true;this.readonly=true;}else{this._displaymode=false;}this._controlmode=(controlmode)?true:false;this._view=parent._view;this._cellinfo=parent._refinfo;this._cellobj=parent;this._setControl();};var _pCellEdit=nexacro._createPrototype(nexacro.Edit,nexacro._CellEditControl);nexacro._CellEditControl.prototype=_pCellEdit;_pCellEdit._is_subcontrol=true;_pCellEdit.on_getIDCSSSelector=function(){return "celledit";};_pCellEdit.on_destroy_contents=function(){nexacro.Edit.prototype.on_destroy_contents.call(this);this._view=null;this._cellinfo=null;this._cellobj=null;};_pCellEdit._apply_setfocus=function(evt_name,self_flag,callback){if(this._view._onceTime_focus&&!callback){nexacro._OnceCallbackTimer.callonce(this,function(){var _win=this._getWindow();if(!_win||!_win._isActiveLayerComponent(this)){return;}this._apply_setfocus(evt_name,self_flag,true);},0);return;}return nexacro.Edit.prototype._apply_setfocus.call(this,evt_name,self_flag);};_pCellEdit.setOnlyElementFocus=function(){if(this._input_element){this._input_element._applyElementFocus();}};_pCellEdit.on_fire_oninput=function(){nexacro.Edit.prototype.on_fire_oninput.call(this);return this._cellobj.on_fire_oninput();};_pCellEdit.on_fire_onclick=function(button,alt_key,ctrl_key,shift_key,screenX,screenY,canvasX,canvasY,clientX,clientY,from_comp,from_refer_comp,clickitem){nexacro.Edit.prototype.on_fire_onclick.call(this,button,alt_key,ctrl_key,shift_key,screenX,screenY,canvasX,canvasY,clientX,clientY,from_comp,from_refer_comp);this._cellobj.on_fire_onclick(button,alt_key,ctrl_key,shift_key,screenX,screenY,canvasX,canvasY,clientX,clientY,from_comp,from_refer_comp,clickitem);return true;};_pCellEdit.on_fire_ondblclick=function(button,alt_key,ctrl_key,shift_key,screenX,screenY,canvasX,canvasY,clientX,clientY,from_comp,from_refer_comp){if(this._displaymode){this.setSelect(0,0);}nexacro.Edit.prototype.on_fire_ondblclick.call(this,button,alt_key,ctrl_key,shift_key,screenX,screenY,canvasX,canvasY,clientX,clientY,from_comp,from_refer_comp);this._cellobj.on_fire_ondblclick(button,alt_key,ctrl_key,shift_key,screenX,screenY,canvasX,canvasY,clientX,clientY,from_comp,from_refer_comp,"control");return true;};_pCellEdit.on_getBindableProperties=function(){if(!this._displaymode){return "value";}};_pCellEdit._isEnable=function(){if(this._view&&this._view._enable!==undefined){return this._view._enable;}if(this.parent&&this.parent._isEnable){return this.parent._isEnable();}return true;};_pCellEdit._updateAll=function(onlycontents,breadonly){if(breadonly!==undefined){if(this.on_apply_readonly){this.on_apply_readonly(breadonly);}else{this._changeStatus("readonly",breadonly);}}if(!onlycontents){this._apply_status(this._oldstatus,this._status,this._olduserstatus,this._userstatus);}this._setProperty();};_pCellEdit._setProperty=function(onlycontrolprop){var cellinfo=this._cellinfo;var cellobj=this._cellobj;var datarow=cellobj._getDataRow();cellinfo._setCellChildControlProperty("edit",this,datarow);if(this._view){this.set_usesoftkeyboard(this._view.usesoftkeyboard);}if(onlycontrolprop){return;}var v;if(this._displaymode==true){v=cellinfo._getDisplayText(datarow);}else{v=cellinfo._getValue(datarow);}this.set_value(v);};_pCellEdit._setEditingValue=function(value){return this.set_value(value);};_pCellEdit._EditUpdateAll=function(){this._updateAll();};_pCellEdit._getEditingText=function(){return this.text;};_pCellEdit._getEditingValue=function(){return this.value;};_pCellEdit._getValueData=function(){return this.value;};_pCellEdit._setAccessibilityStatFocus=function(){var cellobj=this._cellobj;this._control_element.setElementAccessibilityLabel(cellobj._getAccessibilityLabel());this._control_element.setElementAccessibilityAction(cellobj.accessibilityaction);this._control_element.setElementAccessibilityDescription(cellobj.accessibilitydescription);this._control_element.setElementAccessibilityParentLabel(cellobj._getAccessibilityMakeAddLabel().trim());nexacro.Component.prototype._setAccessibilityStatFocus.call(this);};_pCellEdit.on_get_accessibility_description=function(){if(this._cellobj){var tooltiptext=this._cellobj.tooltiptext;return nexacro._isNull(tooltiptext)?"":tooltiptext;}return "";};_pCellEdit._getComputedStyle=function(){if(!nexacro._getComputedStyleProperties){return;}var properties=this._computed_prop_list;properties=properties.toString();var ctrl_cs={"styles":null};var str=nexacro._getComputedStyleProperties(this._control_element,properties,null,true);eval("ctrl_cs.styles = "+str);return ctrl_cs;};_pCellEdit._setComputedStyle=function(ctrl_cs){var properties=this._computed_prop_list;for(var i=0;i<properties.length;i++ ){var prop_name=properties[i];var func_name="set_"+prop_name;if(ctrl_cs.styles){if(this[func_name]){this[func_name].call(this,ctrl_cs.styles[prop_name]);}}}};_pCellEdit._getCurrentStyleAlign=function(noflush){var align={textAlign:"center",verticalAlign:"middle"};if(this._input_element){align=this._input_element._getComputedStyleAlign(noflush);}return align;};nexacro._CellTextAreaControl=function(id,left,top,width,height,parent,displaymode,controlmode){nexacro.TextArea.call(this,id,left,top,width,height,null,null,null,null,null,null,parent,displaymode);this.tabstop=false;if(displaymode){this._displaymode=true;this.readonly=true;}else{this._displaymode=false;}this._controlmode=(controlmode)?true:false;this._view=parent._view;this._cellinfo=parent._refinfo;this._cellobj=parent;this._setControl();};var _pCellTextArea=nexacro._createPrototype(nexacro.TextArea,nexacro._CellTextAreaControl);nexacro._CellTextAreaControl.prototype=_pCellTextArea;_pCellTextArea._is_subcontrol=true;_pCellTextArea.on_getIDCSSSelector=function(){return "celltextarea";};_pCellTextArea.on_destroy_contents=function(){nexacro.TextArea.prototype.on_destroy_contents.call(this);this._view=null;this._cellinfo=null;this._cellobj=null;};_pCellTextArea._apply_setfocus=function(evt_name,self_flag,callback){if(this._view._onceTime_focus&&!callback){nexacro._OnceCallbackTimer.callonce(this,function(){var _win=this._getWindow();if(!_win||!_win._isActiveLayerComponent(this)){return;}this._apply_setfocus(evt_name,self_flag,true);},0);return;}return nexacro.TextArea.prototype._apply_setfocus.call(this,evt_name,self_flag);};_pCellTextArea.setOnlyElementFocus=_pCellEdit.setOnlyElementFocus;_pCellTextArea.on_fire_oninput=function(){nexacro.TextArea.prototype.on_fire_oninput.call(this);return this._cellobj.on_fire_oninput();};_pCellTextArea.on_fire_onclick=function(button,alt_key,ctrl_key,shift_key,screenX,screenY,canvasX,canvasY,clientX,clientY,from_comp,from_refer_comp,clickitem){nexacro.TextArea.prototype.on_fire_onclick.call(this,button,alt_key,ctrl_key,shift_key,screenX,screenY,canvasX,canvasY,clientX,clientY,from_comp,from_refer_comp);this._cellobj.on_fire_onclick(button,alt_key,ctrl_key,shift_key,screenX,screenY,canvasX,canvasY,clientX,clientY,from_comp,from_refer_comp,clickitem);return true;};_pCellTextArea.on_fire_ondblclick=function(button,alt_key,ctrl_key,shift_key,screenX,screenY,canvasX,canvasY,clientX,clientY,from_comp,from_refer_comp){if(this._displaymode){this.setSelect(0,0);}nexacro.TextArea.prototype.on_fire_ondblclick.call(this,button,alt_key,ctrl_key,shift_key,screenX,screenY,canvasX,canvasY,clientX,clientY,from_comp,from_refer_comp);this._cellobj.on_fire_ondblclick(button,alt_key,ctrl_key,shift_key,screenX,screenY,canvasX,canvasY,clientX,clientY,from_comp,from_refer_comp,"control");return true;};_pCellTextArea.on_keydown_basic_action=function(keycode,alt_key,ctrl_key,shift_key,refer_comp){nexacro.TextArea.prototype.on_keydown_basic_action.call(this,keycode,alt_key,ctrl_key,shift_key,refer_comp);var cellinfo=this._cellinfo;var cellobj=this._cellobj;var datarow=cellobj._getDataRow();var acceptsenter=cellinfo._getAttrValue(cellinfo.textareaacceptsenter,datarow);acceptsenter=nexacro._toBoolean(acceptsenter);if(keycode==nexacro.Event.KEY_ENTER){if((acceptsenter&&(!ctrl_key&&!alt_key))||(!acceptsenter&&(ctrl_key||alt_key))){var input_elem=this._input_element;var pos=this.getCaretPos();var text=this.text;var chars=text.split("");chars.splice(pos,0,"\n");var newValue=chars.join("");var newPos=pos+"\n".length;if(input_elem&&(this.maxlength==0||newValue.length<=this.maxlength)){nexacro._OnceCallbackTimer.callonce(this,function(){input_elem.updateElementText(newValue,newPos);if(this.scrollbartype=="none"&&(this.scrolltype=="both"||this.scrolltype=="vertical")){var textsize=nexacro._getTextSize("A",this._getCurrentStyleInheritValue("font"),false,undefined,"none",this._getCurrentStyleInheritValue("wordSpacing"),this._getCurrentStyleInheritValue("letterSpacing"));var caretline=this._getCaretLine();var control_elem=this.getElement();var clientheight=control_elem.getClientHeight();var scroll_pos=(textsize[1]*caretline)-clientheight;if(scroll_pos>0){input_elem.setElementVScrollPos(scroll_pos);var adjust_scrollpos=scroll_pos+(textsize[1]-(scroll_pos%textsize[1]));input_elem.setElementVScrollPos(adjust_scrollpos);}}},0);input_elem.stopSysEvent();}}}};_pCellTextArea.on_getBindableProperties=function(){if(!this._displaymode){return "value";}};_pCellTextArea._isEnable=_pCellEdit._isEnable;_pCellTextArea._updateAll=function(onlycontents,breadonly){if(breadonly!==undefined){if(this.on_apply_readonly){this.on_apply_readonly(breadonly);}else{this._changeStatus("readonly",breadonly);}}if(!onlycontents){this._apply_status(this._oldstatus,this._status,this._olduserstatus,this._userstatus);}this._setProperty();};_pCellTextArea._setProperty=function(onlycontrolprop){var cellinfo=this._cellinfo;var cellobj=this._cellobj;var datarow=cellobj._getDataRow();var v;if(!onlycontrolprop){if(this._displaymode==true||this.readonly){v=cellinfo._getDisplayText(datarow);}else{v=cellinfo._getValue(datarow);}this.set_value(v);}cellinfo._setCellChildControlProperty("textarea",this,datarow);if(this._displaymode==true){this.set_scrollbartype("none");}else{v=cellinfo._getAttrValue(cellinfo.textareascrollbartype,datarow);if(v!=null){this.set_scrollbartype(v);}else{this.set_scrollbartype("none");}}v=cellinfo._getAttrValue(cellinfo.textareascrolltype,datarow);if(v!=null){this.set_scrolltype(v);}else{this.set_scrolltype("none");}v=cellinfo._getControlScrollbarsize(datarow,"textarea");if(v!=null){this.set_scrollbarsize(v);}if(this._view){this.set_usesoftkeyboard(this._view.usesoftkeyboard);}};_pCellTextArea._setEditingValue=function(value){return this.set_value(value);};_pCellTextArea._EditUpdateAll=function(){if(this._control_element){var datarow=this._cellobj._getDataRow();this._updateAll();var wordwrap=this._cellinfo._getWordwrap(datarow);this.set_wordWrap(wordwrap);}};_pCellTextArea._getEditingText=function(){return this.text;};_pCellTextArea._getEditingValue=function(){return this.value;};_pCellTextArea._getValueData=function(){return this.value;};_pCellTextArea._setAccessibilityStatFocus=function(){var cellobj=this._cellobj;this._control_element.setElementAccessibilityLabel(cellobj._getAccessibilityLabel());this._control_element.setElementAccessibilityAction(cellobj.accessibilityaction);this._control_element.setElementAccessibilityDescription(cellobj.accessibilitydescription);this._control_element.setElementAccessibilityParentLabel(cellobj._getAccessibilityMakeAddLabel().trim());nexacro.Component.prototype._setAccessibilityStatFocus.call(this);};_pCellTextArea.on_get_accessibility_description=function(){if(this._cellobj){var tooltiptext=this._cellobj.tooltiptext;return nexacro._isNull(tooltiptext)?"":tooltiptext;}return "";};_pCellTextArea._getComputedStyle=function(){if(!nexacro._getComputedStyleProperties){return;}var properties=this._computed_prop_list;properties=properties.toString();var ctrl_cs={"styles":null,"hscrollbar":{styles:null,"decbutton":{styles:null},"incbutton":{styles:null},"trackbar":{styles:null}},"vscrollbar":{styles:null,"decbutton":{styles:null},"incbutton":{styles:null},"trackbar":{styles:null}}};var str=nexacro._getComputedStyleProperties(this._control_element,properties,null,true);eval("ctrl_cs.styles = "+str);if(this.hscrollbar){str=nexacro._getComputedStyleProperties(this.hscrollbar._control_element,properties,null,true);eval("ctrl_cs.hscrollbar.styles = "+str);str=nexacro._getComputedStyleProperties(this.hscrollbar.decbutton._control_element,properties,null,true);eval("ctrl_cs.hscrollbar.decbutton.styles = "+str);str=nexacro._getComputedStyleProperties(this.hscrollbar.incbutton._control_element,properties,null,true);eval("ctrl_cs.hscrollbar.incbutton.styles = "+str);str=nexacro._getComputedStyleProperties(this.hscrollbar.trackbar._control_element,properties,null,true);eval("ctrl_cs.hscrollbar.trackbar.styles = "+str);}if(this.vscrollbar){str=nexacro._getComputedStyleProperties(this.vscrollbar._control_element,properties,null,true);eval("ctrl_cs.vscrollbar.styles = "+str);str=nexacro._getComputedStyleProperties(this.vscrollbar.decbutton._control_element,properties,null,true);eval("ctrl_cs.vscrollbar.decbutton.styles = "+str);str=nexacro._getComputedStyleProperties(this.vscrollbar.incbutton._control_element,properties,null,true);eval("ctrl_cs.vscrollbar.incbutton.styles = "+str);str=nexacro._getComputedStyleProperties(this.vscrollbar.trackbar._control_element,properties,null,true);eval("ctrl_cs.vscrollbar.trackbar.styles = "+str);}return ctrl_cs;};_pCellTextArea._setComputedStyle=function(ctrl_cs){var properties=this._computed_prop_list;var hscrollbar=this.hscrollbar;var vscrollbar=this.vscrollbar;for(var i=0;i<properties.length;i++ ){var prop_name=properties[i];var func_name="set_"+prop_name;if(ctrl_cs.styles){if(this[func_name]){this[func_name].call(this,ctrl_cs.styles[prop_name]);}}if(hscrollbar){if(ctrl_cs.hscrollbar.styles){if(hscrollbar[func_name]){hscrollbar[func_name].call(hscrollbar,ctrl_cs.hscrollbar.styles[prop_name]);}}if(ctrl_cs.hscrollbar.decbutton.styles){if(hscrollbar.decbutton[func_name]){hscrollbar.decbutton[func_name].call(hscrollbar.decbutton,ctrl_cs.hscrollbar.decbutton.styles[prop_name]);}}if(ctrl_cs.hscrollbar.incbutton.styles){if(hscrollbar.incbutton[func_name]){hscrollbar.incbutton[func_name].call(hscrollbar.incbutton,ctrl_cs.hscrollbar.incbutton.styles[prop_name]);}}if(ctrl_cs.hscrollbar.trackbar.styles){if(hscrollbar.trackbar[func_name]){hscrollbar.trackbar[func_name].call(hscrollbar.trackbar,ctrl_cs.hscrollbar.trackbar.styles[prop_name]);}}}if(vscrollbar){if(ctrl_cs.vscrollbar.styles){if(vscrollbar[func_name]){vscrollbar[func_name].call(vscrollbar,ctrl_cs.vscrollbar.styles[prop_name]);}}if(ctrl_cs.vscrollbar.decbutton.styles){if(vscrollbar.decbutton[func_name]){vscrollbar.decbutton[func_name].call(vscrollbar.decbutton,ctrl_cs.vscrollbar.decbutton.styles[prop_name]);}}if(ctrl_cs.vscrollbar.incbutton.styles){if(vscrollbar.incbutton[func_name]){vscrollbar.incbutton[func_name].call(vscrollbar.incbutton,ctrl_cs.vscrollbar.incbutton.styles[prop_name]);}}if(ctrl_cs.vscrollbar.trackbar.styles){if(vscrollbar.trackbar[func_name]){vscrollbar.trackbar[func_name].call(vscrollbar.trackbar,ctrl_cs.vscrollbar.trackbar.styles[prop_name]);}}}}};_pCellTextArea._getCurrentStyleAlign=function(noflush){var align={textAlign:"center",verticalAlign:"middle"};if(this._input_element){align=this._input_element._getComputedStyleAlign(noflush);}return align;};nexacro._CellMaskEditControl=function(id,left,top,width,height,parent,displaymode,controlmode){nexacro.MaskEdit.call(this,id,left,top,width,height,null,null,null,null,null,null,parent,displaymode);this._displaymode=(displaymode)?true:false;this.tabstop=false;this._controlmode=(controlmode)?true:false;this._view=parent._view;this._cellinfo=parent._refinfo;this._cellobj=parent;this._setControl();};var _pCellMaskEdit=nexacro._createPrototype(nexacro.MaskEdit,nexacro._CellMaskEditControl);nexacro._CellMaskEditControl.prototype=_pCellMaskEdit;_pCellMaskEdit._is_subcontrol=true;_pCellMaskEdit.on_getIDCSSSelector=function(){return "cellmaskedit";};_pCellMaskEdit.on_destroy_contents=function(){nexacro.MaskEdit.prototype.on_destroy_contents.call(this);this._view=null;this._cellinfo=null;this._cellobj=null;};_pCellMaskEdit._apply_setfocus=function(evt_name,self_flag,callback){if(this._view._onceTime_focus&&!callback){nexacro._OnceCallbackTimer.callonce(this,function(){var _win=this._getWindow();if(!_win||!_win._isActiveLayerComponent(this)){return;}this._apply_setfocus(evt_name,self_flag,true);},0);return;}return nexacro.MaskEdit.prototype._apply_setfocus.call(this,evt_name,self_flag);};_pCellMaskEdit.setOnlyElementFocus=_pCellEdit.setOnlyElementFocus;_pCellMaskEdit.on_fire_oninput=function(){nexacro.MaskEdit.prototype.on_fire_oninput.call(this);return this._cellobj.on_fire_oninput();};_pCellMaskEdit.on_fire_onclick=function(button,alt_key,ctrl_key,shift_key,screenX,screenY,canvasX,canvasY,clientX,clientY,from_comp,from_refer_comp,clickitem){nexacro.MaskEdit.prototype.on_fire_onclick.call(this,button,alt_key,ctrl_key,shift_key,screenX,screenY,canvasX,canvasY,clientX,clientY,from_comp,from_refer_comp);this._cellobj.on_fire_onclick(button,alt_key,ctrl_key,shift_key,screenX,screenY,canvasX,canvasY,clientX,clientY,from_comp,from_refer_comp,clickitem);return true;};_pCellMaskEdit.on_fire_ondblclick=function(button,alt_key,ctrl_key,shift_key,screenX,screenY,canvasX,canvasY,clientX,clientY,from_comp,from_refer_comp){if(this._displaymode){this.setSelect(0,0);}nexacro.MaskEdit.prototype.on_fire_ondblclick.call(this,button,alt_key,ctrl_key,shift_key,screenX,screenY,canvasX,canvasY,clientX,clientY,from_comp,from_refer_comp);this._cellobj.on_fire_ondblclick(button,alt_key,ctrl_key,shift_key,screenX,screenY,canvasX,canvasY,clientX,clientY,from_comp,from_refer_comp,"control");return true;};_pCellMaskEdit._isEnable=_pCellEdit._isEnable;_pCellMaskEdit._updateAll=function(onlycontents,breadonly){if(breadonly!==undefined){if(this.on_apply_readonly){this.on_apply_readonly(breadonly);}else{this._changeStatus("readonly",breadonly);}}if(!onlycontents){this._apply_status(this._oldstatus,this._status,this._olduserstatus,this._userstatus);}this._setProperty();};_pCellMaskEdit._setProperty=function(onlycontrolprop){var cellinfo=this._cellinfo;var cellobj=this._cellobj;var datarow=cellobj._getDataRow();var dataset=cellinfo._getBindDataset();cellinfo._setCellChildControlProperty("maskedit",this,datarow);if(!onlycontrolprop){var v;if(dataset&&cellinfo.subsumtext._value!=""&&dataset.getRowType(datarow)==16){v=cellinfo._getAttrValue(cellinfo.subsumtext,datarow);}else{v=cellinfo._getValue(datarow);}this.set_value(v);}if(this._view){this.set_usesoftkeyboard(this._view.usesoftkeyboard);}};_pCellMaskEdit._setEditingValue=function(value){return this.set_value(value);};_pCellMaskEdit._EditUpdateAll=function(){this._updateAll();};_pCellMaskEdit._getEditingText=function(){return this.text;};_pCellMaskEdit._getEditingValue=function(){return this.value;};_pCellMaskEdit._getValueData=function(){return this.value;};_pCellMaskEdit._setAccessibilityStatFocus=function(){var cellobj=this._cellobj;this._control_element.setElementAccessibilityLabel(cellobj._getAccessibilityLabel());this._control_element.setElementAccessibilityAction(cellobj.accessibilityaction);this._control_element.setElementAccessibilityDescription(cellobj.accessibilitydescription);this._control_element.setElementAccessibilityParentLabel(cellobj._getAccessibilityMakeAddLabel().trim());nexacro.Component.prototype._setAccessibilityStatFocus.call(this);};_pCellMaskEdit.on_get_accessibility_description=function(){if(this._cellobj){var tooltiptext=this._cellobj.tooltiptext;return nexacro._isNull(tooltiptext)?"":tooltiptext;}return "";};_pCellMaskEdit._getComputedStyle=function(){if(!nexacro._getComputedStyleProperties){return;}var properties=this._computed_prop_list;properties=properties.toString();var ctrl_cs={"styles":null};var str=nexacro._getComputedStyleProperties(this._control_element,properties,null,true);eval("ctrl_cs.styles = "+str);return ctrl_cs;};_pCellMaskEdit._setComputedStyle=function(ctrl_cs){var properties=this._computed_prop_list;for(var i=0;i<properties.length;i++ ){var prop_name=properties[i];var func_name="set_"+prop_name;if(ctrl_cs.styles){if(this[func_name]){this[func_name].call(this,ctrl_cs.styles[prop_name]);}}}};_pCellMaskEdit._getCurrentStyleAlign=function(noflush){var align={textAlign:"center",verticalAlign:"middle"};if(this._input_element){align=this._input_element._getComputedStyleAlign(noflush);}return align;};nexacro._CellCalendarPopupControl=function(id,left,top,width,height,right,bottom,minwidth,maxwidth,minheight,maxheight,parent){nexacro._CalendarPopupControl.call(this,id,left,top,width,height,right,bottom,minwidth,maxwidth,minheight,maxheight,parent);};var _pCellCalendarPopupControl=nexacro._createPrototype(nexacro._CalendarPopupControl,nexacro._CellCalendarPopupControl);nexacro._CellCalendarPopupControl.prototype=_pCellCalendarPopupControl;_pCellCalendarPopupControl._is_subcontrol=true;_pCellCalendarPopupControl._getPopupParentPos=function(){var calendar=this.parent;var rect;var bandrect;if(calendar.parent._getPositionInRootComponent){var ret=calendar.parent._getPositionInRootComponent();rect=ret[0];bandrect=ret[1];var calendar_size=[rect.width,rect.height];var calendar_elem_pos=nexacro._getElementPositionInFrame(calendar.getElement(),true);var xgap=0;var ygap=0;if(0>bandrect.orgl){xgap=Math.abs(bandrect.orgl)-(calendar._adjust_left);}if(0>bandrect.orgt){ygap=Math.abs(bandrect.orgt)-(calendar._adjust_top);}return {"x":calendar_elem_pos.x,"y":calendar_elem_pos.y,"width":calendar_size[0],"height":calendar_size[1],"xgap":xgap,"ygap":ygap};}else{return nexacro._CalendarPopupControl.prototype._getPopupParentPos.call(this);}};nexacro._CellCalendarControl=function(id,left,top,width,height,parent,displaymode,controlmode){nexacro.Calendar.call(this,id,left,top,width,height,null,null,null,null,null,null,parent,displaymode);this.tabstop=false;this.ondropdown="grid";this.readonly=this._displaymode=(displaymode)?true:false;this._controlmode=(controlmode)?true:false;this._view=parent._view;this._cellinfo=parent._refinfo;this._cellobj=parent;this._setControl();};var _pCellCalendar=nexacro._createPrototype(nexacro.Calendar,nexacro._CellCalendarControl);nexacro._CellCalendarControl.prototype=_pCellCalendar;_pCellCalendar._is_subcontrol=true;_pCellCalendar.on_getIDCSSSelector=function(){return "cellcalendar";};_pCellCalendar.on_create_contents=function(win){nexacro.Calendar.prototype.on_create_contents.call(this,win);};_pCellCalendar.on_destroy_contents=function(){nexacro.Calendar.prototype.on_destroy_contents.call(this);this._view=null;this._cellinfo=null;this._cellobj=null;};_pCellCalendar._apply_setfocus=function(evt_name){if(!this._displaymode||nexacro._enableaccessibility){return nexacro.Calendar.prototype._apply_setfocus.call(this,evt_name);}};_pCellCalendar.setOnlyElementFocus=function(){if(this.calendaredit&&this.calendaredit._input_element){this.calendaredit._input_element._applyElementFocus();}};_pCellCalendar._getPopupSizeArr=function(){if(this.type!="monthonly"){return nexacro.Calendar.prototype._getPopupSizeArr.call(this);}var size=this.popupsize;if(!size){size=this.getOffsetWidth()+" "+this.getOffsetHeight();}size=size.split(/\s+/);var width= +size[0];var height=size[1]? +size[1]:width;return {width:width,height:height};};_pCellCalendar._setValueCtrl=function(fire_event,post_text,post_value){this._currentformat="editformat";var edit=this.calendaredit;if(edit&&edit.value!=undefined){var pre_value=this.value;var pre_text=this.text;var cur_value,cur_text;if(post_text!=undefined){cur_value=post_value;cur_text=edit.text;}else{cur_value=edit.value;cur_text=edit.text;}if(pre_value!=cur_value.trim()){if(fire_event){if(!this._on_value_change(pre_text,pre_value,cur_text,cur_value)){cur_value=pre_value;}}this._setValue(cur_value);edit._setValue(cur_value);this._default_value=this.value;this._default_text=this.text;}}};_pCellCalendar._createPopupControl=function(){var popupcontrol=this._popupcontrol;if(!popupcontrol){popupcontrol=this._popupcontrol=new nexacro._CellCalendarPopupControl("calendarpopup",0,0,0,0,null,null,null,null,null,null,this);popupcontrol.createComponent(true);}};_pCellCalendar.on_fire_oninput=function(){nexacro.Calendar.prototype.on_fire_oninput.call(this);return this._cellobj.on_fire_oninput();};_pCellCalendar.on_fire_oncloseup=function(obj,pretext,posttext,prevalue,postvalue,isselect){this._cellobj.on_fire_oncloseup(obj,pretext,posttext,prevalue,postvalue,isselect);};_pCellCalendar.on_fire_ondropdown=function(obj){return this._cellobj.on_fire_ondropdown(obj);};_pCellCalendar.on_fire_sys_onkeydown=function(keycode,alt_key,ctrl_key,shift_key,fire_comp,refer_comp){var ret=nexacro.Calendar.prototype.on_fire_sys_onkeydown.call(this,keycode,alt_key,ctrl_key,shift_key,fire_comp,refer_comp);if(this._view){if(this._isPopupVisible()){this._view._is_editor_keyaction=false;}else{this._view._is_editor_keyaction=true;}}return ret;};_pCellCalendar.on_fire_onclick=function(button,alt_key,ctrl_key,shift_key,screenX,screenY,canvasX,canvasY,clientX,clientY,from_comp,from_refer_comp,clickitem){nexacro.Calendar.prototype.on_fire_onclick.call(this,button,alt_key,ctrl_key,shift_key,screenX,screenY,canvasX,canvasY,clientX,clientY,from_comp,from_refer_comp);this._cellobj.on_fire_onclick(button,alt_key,ctrl_key,shift_key,screenX,screenY,canvasX,canvasY,clientX,clientY,this,from_refer_comp,"control");return true;};_pCellCalendar.on_fire_ondblclick=function(button,alt_key,ctrl_key,shift_key,screenX,screenY,canvasX,canvasY,clientX,clientY,from_comp,from_refer_comp){if(this._displaymode){this.setSelect(0,0);}nexacro.Calendar.prototype.on_fire_ondblclick.call(this,button,alt_key,ctrl_key,shift_key,screenX,screenY,canvasX,canvasY,clientX,clientY,from_comp,from_refer_comp);this._cellobj.on_fire_ondblclick(button,alt_key,ctrl_key,shift_key,screenX,screenY,canvasX,canvasY,clientX,clientY,this,from_refer_comp,"control");return true;};_pCellCalendar._on_edit_oneditclick=function(obj,e){nexacro.Calendar.prototype._on_edit_oneditclick.call(this,obj,e);if(this._displaymode){return this._cellobj.on_fire_onclick(e.button,e.altkey,e.ctrlkey,e.shiftkey,e.screenx,e.screeny,e.canvasx,e.canvasy,e.clientx,e.clienty,e.fromobject,e.fromreferenceobject,"control");}};_pCellCalendar._on_edit_onkeydown=function(obj,e){if(!this._displaymode&&this.visible){return nexacro.Calendar.prototype._on_edit_onkeydown.call(this,obj,e);}else{return false;}};_pCellCalendar._on_drop_onclick=function(obj,e){nexacro.Calendar.prototype._on_drop_onclick.call(this,obj,e);if(this._displaymode){return this._cellobj.on_fire_onclick(e.button,e.altkey,e.ctrlkey,e.shiftkey,e.screenx,e.screeny,e.canvasx,e.canvasy,e.clientx,e.clienty,e.fromobject,e.fromreferenceobject,"control");}};_pCellCalendar.on_fire_onchanged=function(obj,pre_text,pre_value,post_text,post_value){if(!obj._displaymode){var update=this._cellobj._getAutoUpdateType();if(update=="dateselect"||update=="itemselect"){this._cellobj._applyEditorDataset(true,pre_value);}return (nexacro.Calendar.prototype.on_fire_onchanged.call(this,obj,pre_text,pre_value,post_text,post_value));}};_pCellCalendar.on_getBindableProperties=function(){if(!this._displaymode){return "value";}};_pCellCalendar._isEnable=function(){if(this._view&&this._view._enable!==undefined){return this._view._enable;}if(this.parent&&this.parent._isEnable){return this.parent._isEnable();}return true;};_pCellCalendar._getDisplayText=function(){if(this.parent){return this.parent._getDisplayText();}return "";};_pCellCalendar._updateAll=function(onlycontents,breadonly){if(breadonly!==undefined){if(this.on_apply_readonly){this.on_apply_readonly(breadonly);}else{this._changeStatus("readonly",breadonly);}}if(!onlycontents){this._apply_status(this._oldstatus,this._status,this._olduserstatus,this._userstatus);}this._setProperty();};_pCellCalendar._setProperty=function(onlycontrolprop){var cellinfo=this._cellinfo;var cellobj=this._cellobj;var view=this._view;var datarow=cellobj._getDataRow();var dataset=cellinfo._getBindDataset();var calendardateformat=cellinfo._getAttrValue(cellinfo.calendardateformat,datarow);if(!calendardateformat){calendardateformat=nexacro.Calendar.prototype.dateformat;}this.set_dateformat(calendardateformat);var calendareditformat=cellinfo._getAttrValue(cellinfo.calendareditformat,datarow);if(!calendareditformat){calendareditformat=nexacro.Calendar.prototype.editformat;}this.set_editformat(calendareditformat);if(view){this.set_locale(view._getLocale());this.set_usesoftkeyboard(view.usesoftkeyboard);}var org_v;if(dataset&&cellinfo.subsumtext._value!=""&&dataset.getRowType(datarow)==16){org_v=cellinfo._getAttrValue(cellinfo.subsumtext,datarow);}else{org_v=cellinfo._getValue(datarow);}var v=org_v;if(!onlycontrolprop){if(this._displaymode==true&&!v){var maskobj=this._masktypeobj;v=cellinfo._getDisplayText(datarow);v=maskobj.removeMask(v.split(''));v=maskobj.changeNormalizeValue(v);}this.set_value(v);}var buttonsize=cellinfo._getControlButtonsize(datarow,"calendar");this.set_buttonsize(buttonsize);var popuptype=cellinfo._getControlPopuptype(datarow,"calendar");if(popuptype){this.set_popuptype(popuptype);}if(this._displaymode==true){if(nexacro._isNull(org_v)){var calendardisplaynulltype=cellinfo._getAttrValue(cellinfo.calendardisplaynulltype,datarow);if(calendardisplaynulltype!="default"){if(!onlycontrolprop){this.set_value(org_v);}if(calendardisplaynulltype=="nulltext"){v=cellinfo._getAttrValue(cellinfo.calendardisplaynulltext,datarow);if(v!=null){this.set_displaynulltext(v);}}else if(calendardisplaynulltype=="nullmask"){this.set_displaynulltext("");}else{this.set_displaynulltext("");this.set_dateformat("");}}}else{if(this._isInvalidValue(org_v)){var calendardisplayinvalidtype=cellinfo._getAttrValue(cellinfo.calendardisplayinvalidtype,datarow);if(!onlycontrolprop){this.set_value(org_v);}this.set_dateformat("");this.set_displayinvalidtext("");if(calendardisplayinvalidtype=="invalidtext"||calendardisplayinvalidtype=="default"){v=cellinfo._getAttrValue(cellinfo.calendardisplayinvalidtext,datarow);if(v!=null){this.set_displayinvalidtext(v);}}else{this.set_displayinvalidtext(org_v);}}}}var calendarpopupsize=cellinfo._getControlPopupsize(datarow,"calendar");if(calendarpopupsize){this.set_popupsize(calendarpopupsize);}cellinfo._setCellChildControlProperty("calendar",this,datarow);};_pCellCalendar._setEditingValue=function(value){return this.calendaredit.set_value(value);};_pCellCalendar._EditUpdateAll=function(){this._updateAll();};_pCellCalendar._getEditingText=function(){return this.calendaredit.text;};_pCellCalendar._getEditingValue=function(){return this.calendaredit.value;};_pCellCalendar._getValueData=function(){this._setValueCtrl(true);return this.value;};_pCellCalendar._getDlgCode=function(keycode,altKey,ctrlKey,shiftKey){var _want_arrows=this._want_arrows;this._is_first_focus=false;return {want_tab:(this._view?this._view._acceptstab:false),want_return:false,want_escape:false,want_chars:false,want_arrows:_want_arrows};};_pCellCalendar._getChildren=function(){return [this.calendaredit,this.dropbutton];};_pCellCalendar._setAccessibilityStatFocus=function(){var label="";var cellobj=this._cellobj;var addlabel=cellobj._getAccessibilityMakeAddLabel();var tmp_label=cellobj._getAccessibilityLabel();tmp_label=(tmp_label!=cellobj._displaytext)?tmp_label:"";label=addlabel+" "+tmp_label;label=label.trim();this.calendaredit._control_element.setElementAccessibilityLabel(label);nexacro.Component.prototype._setAccessibilityStatFocus.call(this);};_pCellCalendar.on_get_accessibility_description=function(){if(this._cellobj){var tooltiptext=this._cellobj.tooltiptext;return nexacro._isNull(tooltiptext)?"":tooltiptext;}return "";};_pCellCalendar._on_dataset_onvaluechanged=function(obj,e){if(!this._displaymode){nexacro.Combo.prototype._on_dataset_onvaluechanged.call(this,obj,e);}};_pCellCalendar._on_dataset_onrowsetchanged=function(obj,e){if(!this._displaymode){nexacro.Combo.prototype._on_dataset_onrowsetchanged.call(this,obj,e);}};_pCellCalendar._getComputedStyle=function(){if(!nexacro._getComputedStyleProperties){return;}var properties=this._computed_prop_list;properties=properties.toString();var ctrl_cs={"styles":null,"calendaredit":{styles:null},"dropbutton":{styles:null},"calendarspinupbutton":{styles:null},"calendarspindownbutton":{styles:null}};var str=nexacro._getComputedStyleProperties(this._control_element,properties,null,true);eval("ctrl_cs.styles = "+str);if(this.calendaredit){str=nexacro._getComputedStyleProperties(this.calendaredit._control_element,properties,null,true);eval("ctrl_cs.calendaredit.styles = "+str);}if(this.dropbutton){str=nexacro._getComputedStyleProperties(this.dropbutton._control_element,properties,null,true);eval("ctrl_cs.dropbutton.styles = "+str);}if(this.calendarspinupbutton){str=nexacro._getComputedStyleProperties(this.calendarspinupbutton._control_element,properties,null,true);eval("ctrl_cs.calendarspinupbutton.styles = "+str);}if(this.calendarspindownbutton){str=nexacro._getComputedStyleProperties(this.calendarspindownbutton._control_element,properties,null,true);eval("ctrl_cs.calendarspindownbutton.styles = "+str);}return ctrl_cs;};_pCellCalendar._setComputedStyle=function(ctrl_cs){var properties=this._computed_prop_list;var calendaredit=this.calendaredit;var dropbutton=this.dropbutton;var calendarspinupbutton=this.calendarspinupbutton;var calendarspindownbutton=this.calendarspindownbutton;for(var i=0;i<properties.length;i++ ){var prop_name=properties[i];var func_name="set_"+prop_name;if(ctrl_cs.styles){if(this[func_name]){this[func_name].call(this,ctrl_cs.styles[prop_name]);}}if(calendaredit){if(ctrl_cs.calendaredit.styles){if(calendaredit[func_name]){calendaredit[func_name].call(calendaredit,ctrl_cs.calendaredit.styles[prop_name]);}}}if(dropbutton){if(ctrl_cs.dropbutton.styles){if(dropbutton[func_name]){dropbutton[func_name].call(dropbutton,ctrl_cs.dropbutton.styles[prop_name]);}}}if(calendarspinupbutton){if(ctrl_cs.calendarspinupbutton.styles){if(calendarspinupbutton[func_name]){calendarspinupbutton[func_name].call(calendarspinupbutton,ctrl_cs.calendarspinupbutton.styles[prop_name]);}}}if(calendarspindownbutton){if(ctrl_cs.calendarspindownbutton.styles){if(calendarspindownbutton[func_name]){calendarspindownbutton[func_name].call(calendarspindownbutton,ctrl_cs.calendarspindownbutton.styles[prop_name]);}}}}};_pCellCalendar._getCurrentStyleAlign=function(noflush){var align={textAlign:"center",verticalAlign:"middle"};var calendaredit=this.calendaredit;if(calendaredit&&calendaredit._input_element){align=calendaredit._input_element._getComputedStyleAlign(noflush);}return align;};_pCellCalendar._setAccessibilityInputLabel=nexacro._emptyFn;_pCellCalendar.on_apply_readonly=function(readonly){nexacro.Calendar.prototype.on_apply_readonly.call(this,this._view.readonly);};_pCellCalendar.on_apply_prop_enable=function(v){if(this.calendaredit){this.calendaredit._setEnable(v);}if(this.dropbutton&&!this._view.readonly){this.dropbutton._setEnable(v);}if(this.calendarspinupbutton&&!this._view.readonly){this.calendarspinupbutton._setEnable(v);}if(this.calendarspindownbutton&&!this._view.readonly){this.calendarspindownbutton._setEnable(v);}if(this.datepicker){this.datepicker._setEnable(v);}};nexacro._CellComboPopupControl=function(id,left,top,width,height,right,bottom,minwidth,maxwidth,minheight,maxheight,parent){nexacro._ComboPopupControl.call(this,id,left,top,width,height,right,bottom,minwidth,maxwidth,minheight,maxheight,parent);};var _pCellComboPopupControl=nexacro._createPrototype(nexacro._ComboPopupControl,nexacro._CellComboPopupControl);nexacro._CellComboPopupControl.prototype=_pCellComboPopupControl;_pCellComboPopupControl._is_subcontrol=true;_pCellComboPopupControl._getPopupParentPos=function(){var combo=this.parent;var rect;var bandrect;if(combo.parent._getPositionInRootComponent){var ret=combo.parent._getPositionInRootComponent();rect=ret[0];bandrect=ret[1];var combo_size=[rect.width,rect.height];var combo_elem_pos=nexacro._getElementPositionInFrame(combo.getElement(),true);var xgap=0;var ygap=0;if(0>bandrect.orgl){xgap=Math.abs(bandrect.orgl)-(combo._adjust_left);}if(0>bandrect.orgt){ygap=Math.abs(bandrect.orgt)-(combo._adjust_top);}return {"x":combo_elem_pos.x,"y":combo_elem_pos.y,"width":combo_size[0],"height":combo_size[1],"xgap":xgap,"ygap":ygap};}else{return nexacro._ComboPopupControl.prototype._getPopupParentPos.call(this);}};nexacro._CellComboControl=function(id,left,top,width,height,parent,displaymode,controlmode){nexacro.Combo.call(this,id,left,top,width,height,null,null,null,null,null,null,parent,displaymode);this.tabstop=false;if(displaymode){this._displaymode=true;this.readonly=true;}else{this._displaymode=false;}this._controlmode=(controlmode)?true:false;this._view=parent._view;this._cellinfo=parent._refinfo;this._cellobj=parent;this._setControl();};var _pCellCombo=nexacro._createPrototype(nexacro.Combo,nexacro._CellComboControl);nexacro._CellComboControl.prototype=_pCellCombo;_pCellCombo._is_subcontrol=true;_pCellCombo.on_getIDCSSSelector=function(){return "cellcombo";};_pCellCombo.on_create_contents=function(){nexacro.Combo.prototype.on_create_contents.call(this);};_pCellCombo.setOnlyElementFocus=function(){if(this.comboedit&&this.comboedit._input_element){this.comboedit._input_element._applyElementFocus();}};_pCellCombo.on_destroy_contents=function(){nexacro.Combo.prototype.on_destroy_contents.call(this);this._view=null;this._cellinfo=null;this._cellobj=null;};_pCellCombo._apply_setfocus=function(evt_name){if(!this._displaymode||nexacro._enableaccessibility){return nexacro.Combo.prototype._apply_setfocus.call(this,evt_name);}};_pCellCombo.on_fire_oncloseup=function(obj,beforeIndex,beforeText,beforeValue,afterIndex,afterText,afterValue,isSelect){nexacro.Combo.prototype.on_fire_oncloseup.call(this,obj,beforeIndex,beforeText,beforeValue,afterIndex,afterText,afterValue,isSelect);this._cellobj.on_fire_oncloseup(obj,beforeText,afterText,beforeValue,afterValue,isSelect);};_pCellCombo.on_fire_user_onkeydown=function(keycode,alt_key,ctrl_key,shift_key,fire_comp,refer_comp){var view=this._view;if(view){if(keycode==nexacro.Event.KEY_DOWN||keycode==nexacro.Event.KEY_UP||(keycode==nexacro.Event.KEY_DOWN&&alt_key)){view._is_editor_keyaction=false;}}nexacro.Combo.prototype.on_fire_user_onkeydown.call(this,keycode,alt_key,ctrl_key,shift_key,fire_comp,refer_comp);if(!this._displaymode){return this._cellobj.on_fire_user_onkeydown(keycode,alt_key,ctrl_key,shift_key,fire_comp,refer_comp);}};_pCellCombo.on_fire_sys_onmousewheel=function(wheelDeltaX,wheelDeltaY,button,alt_key,ctrl_key,shift_key,screenX,screenY,canvasX,canvasY,clientX,clientY,comp,refer_comp){if(!this._displaymode){return nexacro.Combo.prototype.on_fire_sys_onmousewheel.call(this,wheelDeltaX,wheelDeltaY,button,alt_key,ctrl_key,shift_key,screenX,screenY,canvasX,canvasY,clientX,clientY,comp,refer_comp);}};_pCellCombo.on_fire_ondropdown=function(obj){return this._cellobj.on_fire_ondropdown(obj);};_pCellCombo.on_fire_onclick=function(button,alt_key,ctrl_key,shift_key,screenX,screenY,canvasX,canvasY,clientX,clientY,from_comp,from_refer_comp){nexacro.Combo.prototype.on_fire_onclick.call(this,button,alt_key,ctrl_key,shift_key,screenX,screenY,canvasX,canvasY,clientX,clientY,from_comp,from_refer_comp);this._cellobj.on_fire_onclick(button,alt_key,ctrl_key,shift_key,screenX,screenY,canvasX,canvasY,clientX,clientY,this,from_refer_comp,"control");return true;};_pCellCombo.on_fire_ondblclick=function(button,alt_key,ctrl_key,shift_key,screenX,screenY,canvasX,canvasY,clientX,clientY,from_comp,from_refer_comp){if(this._displaymode){this.setSelect(0,0);}nexacro.Combo.prototype.on_fire_ondblclick.call(this,button,alt_key,ctrl_key,shift_key,screenX,screenY,canvasX,canvasY,clientX,clientY,from_comp,from_refer_comp);this._cellobj.on_fire_ondblclick(button,alt_key,ctrl_key,shift_key,screenX,screenY,canvasX,canvasY,clientX,clientY,this,from_refer_comp,"control");return true;};_pCellCombo._on_edit_oneditclick=function(obj,e){nexacro.Combo.prototype._on_edit_oneditclick.call(this,obj,e);if(this._displaymode){return this._cellobj.on_fire_onclick(e.button,e.altkey,e.ctrlkey,e.shiftkey,e.screenx,e.screeny,e.canvasx,e.canvasy,e.clientx,e.clienty,e.fromobject,e.fromreferenceobject,"control");}};_pCellCombo._on_edit_onkeydown=function(obj,e){if(!this._displaymode&&this.visible){return nexacro.Combo.prototype._on_edit_onkeydown.call(this,obj,e);}else{return false;}};_pCellCombo._on_drop_onclick=function(obj,e){nexacro.Combo.prototype._on_drop_onclick.call(this,obj,e);if(this._displaymode){return this._cellobj.on_fire_onclick(e.button,e.altkey,e.ctrlkey,e.shiftkey,e.screenx,e.screeny,e.canvasx,e.canvasy,e.clientx,e.clienty,e.fromobject,e.fromreferenceobject,"control");}};_pCellCombo.on_fire_oninput=function(){nexacro.Combo.prototype.on_fire_oninput.call(this);return this._cellobj.on_fire_oninput();};_pCellCombo.on_lbuttondown_basic_action=function(elem,button,alt_key,ctrl_key,shift_key,canvasX,canvasY,screenX,screenY,refer_comp){var retn=nexacro.Component.prototype.on_lbuttondown_basic_action.call(this,elem,button,alt_key,ctrl_key,shift_key,canvasX,canvasY,screenX,screenY,refer_comp);if(this._isPopupVisible()&&this==refer_comp){this._closePopup();}return retn;};_pCellCombo.on_fire_onitemchanged=function(obj,preindex,pretext,prevalue,postindex,posttext,postvalue){if(!obj._displaymode){var update=this._cellobj._getAutoUpdateType();if(update=="comboselect"||update=="itemselect"){this._cellobj._applyEditorDataset(true,prevalue);}return (nexacro.Combo.prototype.on_fire_onitemchanged.call(this,obj,preindex,pretext,prevalue,postindex,posttext,postvalue));}};_pCellCombo.on_getBindableProperties=function(){if(!this._displaymode){return "value";}};_pCellCombo._isEnable=function(){if(this._view&&this._view._enable!==undefined){return this._view._enable;}if(this.parent&&this.parent._isEnable){return this.parent._isEnable();}return true;};_pCellCombo._updateAll=function(onlycontents,breadonly){if(breadonly!==undefined){if(this.on_apply_readonly){this.on_apply_readonly(breadonly);}else{this._changeStatus("readonly",breadonly);}}if(!onlycontents){this._apply_status(this._oldstatus,this._status,this._olduserstatus,this._userstatus);}this._setProperty();};_pCellCombo._setProperty=function(onlycontrolprop){var cellinfo=this._cellinfo,cellobj=this._cellobj;var datarow=cellobj._getDataRow();var buttonsize=cellinfo._getControlButtonsize(datarow,"combo");this.set_buttonsize(buttonsize);var popuptype=cellinfo._getControlPopuptype(datarow,"combo");if(popuptype){this.set_popuptype(popuptype);}var scrollsize=cellinfo._getControlScrollbarsize(datarow,"combo");if(scrollsize!=null){this.set_scrollbarsize(scrollsize);}var popupsize=cellinfo._getControlPopupsize(datarow,"combo");if(popupsize){this.set_popupsize(popupsize);}var v;v=cellinfo._getAttrValue(cellinfo.combodisplaynulltype,datarow);if(v=="nulltext"){v=cellinfo._getAttrValue(cellinfo.combodisplaynulltext,datarow);if(v!=null){this.set_displaynulltext(v);}}else{this.set_displaynulltext("");}cellinfo._setCellChildControlProperty("combo",this,datarow);if(!onlycontrolprop){if(this._displaymode==true){this.value=cellinfo._getValue(datarow);v=cellinfo._getDisplayText(datarow);this.set_text(v);}else{v=cellinfo._getValue(datarow);this.set_value(v);}}if(this._view){this.set_usesoftkeyboard(this._view.usesoftkeyboard);}};_pCellCombo._setEditingValue=function(value){return this.comboedit.set_value(value);};_pCellCombo.on_apply_text=function(text){if(this._displaymode==true){if(!nexacro._isNull(this.value)){this._setEditValue(text);}else{if(this.displaynulltext||text==""){this._setEditValue(undefined);}else{this._setEditValue(text);}}}else{return nexacro.Combo.prototype.on_apply_text.call(this,text);}};_pCellCombo._EditUpdateAll=function(){this._updateAll();};_pCellCombo._getEditingText=function(){return this.comboedit.text;};_pCellCombo._getEditingValue=function(){return this.comboedit.value;};_pCellCombo._getValueData=function(){return this.value;};_pCellCombo._getDlgCode=function(keycode,altKey,ctrlKey,shiftKey){var _want_arrows=this._want_arrows;this._is_first_focus=false;return {want_tab:(this._view?this._view._acceptstab:false),want_return:false,want_escape:false,want_chars:false,want_arrows:_want_arrows};};_pCellCombo._getChildren=function(){return [this.comboedit,this.dropbutton];};_pCellCombo._setAccessibilityStatFocus=function(){var label="";var cellobj=this._cellobj;var addlabel=cellobj._getAccessibilityMakeAddLabel();var tmp_label=cellobj._getAccessibilityLabel();tmp_label=(tmp_label!=cellobj._displaytext)?tmp_label:"";label=addlabel+" "+tmp_label;label=label.trim();this.comboedit._control_element.setElementAccessibilityLabel(label);nexacro.Combo.prototype._setAccessibilityStatFocus.call(this);};_pCellCombo.on_get_accessibility_description=function(){if(this._cellobj){var tooltiptext=this._cellobj.tooltiptext;return nexacro._isNull(tooltiptext)?"":tooltiptext;}return "";};_pCellCombo._on_dataset_onvaluechanged=function(obj,e){if(!this._displaymode){nexacro.Combo.prototype._on_dataset_onvaluechanged.call(this,obj,e);}};_pCellCombo._on_dataset_onrowsetchanged=function(obj,e){if(!this._displaymode){nexacro.Combo.prototype._on_dataset_onrowsetchanged.call(this,obj,e);}};_pCellCombo._getComputedStyle=function(){if(!nexacro._getComputedStyleProperties){return;}var properties=this._computed_prop_list;properties=properties.toString();var ctrl_cs={"styles":null,"comboedit":{styles:null},"dropbutton":{styles:null}};var str=nexacro._getComputedStyleProperties(this._control_element,properties,null,true);eval("ctrl_cs.styles = "+str);if(this.comboedit){str=nexacro._getComputedStyleProperties(this.comboedit._control_element,properties,null,true);eval("ctrl_cs.comboedit.styles = "+str);}if(this.dropbutton){str=nexacro._getComputedStyleProperties(this.dropbutton._control_element,properties,null,true);eval("ctrl_cs.dropbutton.styles = "+str);}return ctrl_cs;};_pCellCombo._setComputedStyle=function(ctrl_cs){var properties=this._computed_prop_list;var comboedit=this.comboedit;var dropbutton=this.dropbutton;for(var i=0;i<properties.length;i++ ){var prop_name=properties[i];var func_name="set_"+prop_name;if(ctrl_cs.styles){if(this[func_name]){this[func_name].call(this,ctrl_cs.styles[prop_name]);}}if(comboedit){if(ctrl_cs.comboedit.styles){if(comboedit[func_name]){comboedit[func_name].call(comboedit,ctrl_cs.comboedit.styles[prop_name]);}}}if(dropbutton){if(ctrl_cs.dropbutton.styles){if(dropbutton[func_name]){dropbutton[func_name].call(dropbutton,ctrl_cs.dropbutton.styles[prop_name]);}}}}};_pCellCombo._getCurrentStyleAlign=function(noflush){var align={textAlign:"center",verticalAlign:"middle"};var comboedit=this.comboedit;if(comboedit&&comboedit._input_element){align=this.comboedit._input_element._getComputedStyleAlign(noflush);}return align;};_pCellCombo._setAccessibilityInputLabel=nexacro._emptyFn;_pCellCombo.on_apply_readonly=function(readonly){nexacro.Combo.prototype.on_apply_readonly.call(this,this._view.readonly);};_pCellCombo.on_apply_prop_enable=function(v){if(this.comboedit){this.comboedit._setEnable(v);}if(this.dropbutton&&!this._view.readonly){this.dropbutton._setEnable(v);}if(this.combolist){this.combolist._setEnable(v);}};_pCellCombo._createPopupControl=function(){var popupcontrol=this._popupcontrol;if(!popupcontrol){popupcontrol=this._popupcontrol=new nexacro._CellComboPopupControl("combopopup",0,0,0,0,null,null,null,null,null,null,this);popupcontrol._setType(this.popuptype);popupcontrol.createComponent(true);}};nexacro._CellCheckboxControlBase=function(id,left,top,width,height,parent){nexacro.CheckBox.call(this,id,left,top,width,height,null,null,null,null,null,null,parent);this.tabstop=false;this._is_usetextbox=false;var wnd=parent;while(wnd){if(wnd._refinfo){this._cellobj=wnd;this._cellinfo=wnd._refinfo;this._view=wnd._view;break;}wnd=wnd.parent;}this.checked=false;this._setControl();};var _pCellCheckboxBase=nexacro._createPrototype(nexacro.CheckBox,nexacro._CellCheckboxControlBase);nexacro._CellCheckboxControlBase.prototype=_pCellCheckboxBase;_pCellCheckboxBase._is_subcontrol=true;_pCellCheckboxBase._apply_setfocus=function(evt_name,callback){};_pCellCheckboxBase.on_create_contents=function(){this._adjustAlign();nexacro.CheckBox.prototype.on_create_contents.call(this);};_pCellCheckboxBase.on_destroy_contents=function(){nexacro.CheckBox.prototype.on_destroy_contents.call(this);this._view=null;this._cellinfo=null;this._cellobj=null;};_pCellCheckboxBase.on_fire_onclick=function(button,alt_key,ctrl_key,shift_key,screenX,screenY,canvasX,canvasY,clientX,clientY,from_comp,from_refer_comp){return this.parent.on_fire_onclick(button,alt_key,ctrl_key,shift_key,screenX,screenY,canvasX,canvasY,clientX,clientY,from_comp,from_refer_comp,"control");};_pCellCheckboxBase.on_fire_ondblclick=function(button,alt_key,ctrl_key,shift_key,screenX,screenY,canvasX,canvasY,clientX,clientY,from_comp,from_refer_comp){return this.parent.on_fire_ondblclick(button,alt_key,ctrl_key,shift_key,screenX,screenY,canvasX,canvasY,clientX,clientY,from_comp,from_refer_comp,"control");};_pCellCheckboxBase._isEnable=function(){if(this._view&&this._view._enable!==undefined){return this._view._enable;}if(this.parent&&this.parent._isEnable){return this.parent._isEnable();}return true;};_pCellCheckboxBase._on_icon_onload=function(url,width,height){nexacro._IconText.prototype._on_icon_onload.call(this,url,width,height);this._adjustAlign(undefined,undefined,width,height);};_pCellCheckboxBase._adjustAlign=function(halign,valign,w,h){var prect=this._cellobj._getAvailableRect();var left=prect.left;var top=prect.top;var right=prect.right;var bottom=prect.bottom;var width=prect.width;var height=prect.height;var datarow=this._cellobj._getDataRow();var controlSize=this._cellinfo._getCheckboxsize(datarow);if(controlSize<0||controlSize==undefined){var size=this._on_getFitSize(w,h);controlSize=size[1];}if(!halign){halign="center";}if(!valign){valign="middle";}if(halign=="center"){left+=((width-controlSize)/2);}else if(halign=="right"){left=right-controlSize;}if(valign=="middle"){top+=((height-controlSize)/2);}else if(valign=="bottom"){top=bottom-controlSize;}this.move(left,top,controlSize,controlSize);};_pCellCheckboxBase._updateAll=function(onlycontents,breadonly){if(breadonly!==undefined){if(this.on_apply_readonly){this.on_apply_readonly(breadonly);}else{this._changeStatus("readonly",breadonly);}}if(!onlycontents){this._apply_status(this._oldstatus,this._status,this._olduserstatus,this._userstatus);}this._adjustAlign();this._setProperty();};_pCellCheckboxBase._getCheckValue=function(){var cellinfo=this._cellinfo;var cellobj=this._cellobj;var datarow=cellobj._getDataRow();var v=cellinfo._getTextValueForDisp(datarow);return v;};_pCellCheckboxBase._setProperty=function(onlycontrolprop){var cellinfo=this._cellinfo,cellobj=this._cellobj;var datarow=cellobj._getDataRow();cellinfo._setCellChildControlProperty("checkbox",this,datarow);if(onlycontrolprop){return;}var v=this._getCheckValue();this.set_value(v);this.checked=this._isChecked(v);this._cellobj._setAccessibilityStatChecked(this.checked);};_pCellCheckboxBase._setAccessibilityStatFocus=function(){var cellobj=this._cellobj;this._control_element.setElementAccessibilityLabel(cellobj._getAccessibilityLabel());this._control_element.setElementAccessibilityAction(cellobj.accessibilityaction);this._control_element.setElementAccessibilityDescription(cellobj.accessibilitydescription);this._control_element.setElementAccessibilityParentLabel(cellobj._getAccessibilityMakeAddLabel().trim());this._setAccessibilityStatChecked(this.isChecked());cellobj._setAccessibilityStatChecked(this.isChecked());nexacro.Component.prototype._setAccessibilityStatFocus.call(this);};_pCellCheckboxBase.on_get_accessibility_description=function(){if(this._cellobj){var tooltiptext=this._cellobj.tooltiptext;return nexacro._isNull(tooltiptext)?"":tooltiptext;}return "";};_pCellCheckboxBase.on_get_accessibility_label=function(){return "";};_pCellCheckboxBase._getComputedStyle=function(){var ctrl_cs={"styles":null};return ctrl_cs;};_pCellCheckboxBase._setComputedStyle=function(ctrl_cs){};_pCellCheckboxBase._getCurrentStyleAlign=function(noflush){return this._cellobj._getCurrentStyleAlign(noflush);};_pCellCheckboxBase._on_getFitSize=function(w,h){var control_elem=this.getElement();if(control_elem){var total_w=0;var total_h=0;var border=this._getCurrentStyleBorder();if(border){total_w+=border._getBorderWidth();total_h+=border._getBorderHeight();}var icon=this._icon||this._getCSSStyleValue("icon");if(icon){var icon_pos=this.iconPosition||this._getCSSStyleValue("iconPosition");var icon_size;if(w!==undefined&&h!==undefined){icon_size={width:w,height:h};}else{icon_size=nexacro._getImageSize(icon.url,this._on_icon_onload,this,this._view?this._view._getRefFormBaseUrl():undefined,icon.value)||{width:0,height:0};}if(icon_pos=="top"||icon_pos=="bottom"){total_h+=icon_size.height;total_w=Math.max(total_w,icon_size.width);}else{total_w+=icon_size.width;total_h=Math.max(total_h,icon_size.height);}}return [total_w,total_h];}return [this._adjust_width,this._adjust_height];};nexacro._CellCheckboxControl=function(id,left,top,width,height,parent,controlmode){nexacro._CellCheckboxControlBase.call(this,id,left,top,width,height,parent);this._controlmode=(controlmode)?true:false;};var _pCellCheckbox=nexacro._createPrototype(nexacro._CellCheckboxControlBase,nexacro._CellCheckboxControl);nexacro._CellCheckboxControl.prototype=_pCellCheckbox;_pCellCheckbox.on_fire_onclick=function(button,alt_key,ctrl_key,shift_key,screenX,screenY,canvasX,canvasY,clientX,clientY,from_comp,from_refer_comp){if(!this._is_alive){return;}if(this._cellobj._isFakeCell()){return false;}if(this._view&&this._view.selectchangetype!="down"){if(nexacro._toBoolean(this._view.readonly)==false){this._toggleCheck();}}return this._cellobj.on_fire_onclick(button,alt_key,ctrl_key,shift_key,screenX,screenY,canvasX,canvasY,clientX,clientY,from_comp,from_refer_comp,"control");};_pCellCheckbox.on_fire_ondblclick=function(button,alt_key,ctrl_key,shift_key,screenX,screenY,canvasX,canvasY,clientX,clientY,from_comp,from_refer_comp){if(this._cellobj._isFakeCell()){return false;}return this._cellobj.on_fire_ondblclick(button,alt_key,ctrl_key,shift_key,screenX,screenY,canvasX,canvasY,clientX,clientY,from_comp,from_refer_comp,"control");};_pCellCheckbox._toggleCheck=function(){var cellobj=this._cellobj;var cellinfo=this._cellinfo;var view=this._view;var datarow=cellobj._getDataRow();var editType=cellinfo._getEdittype(datarow);if(view&&(editType=="checkboxcontrol"||editType=="checkbox")){var v=this._isChecked(this.value);if(v){v=nexacro._isNull(this.falsevalue)?0:this.falsevalue;}else{v=nexacro._isNull(this.truevalue)?1:this.truevalue;}if(cellinfo.text._bindtype==1){view._dsEventOccured=true;var dataset=cellobj._getBindDataset();if(dataset&&dataset.setColumn(datarow,cellinfo.text._bindexpr,v)){v=cellinfo._getTextValueForDisp(datarow);this.set_value(v);}view._dsEventOccured=false;}}};_pCellCheckbox._getDisplayText=function(){if(this.parent){return this.parent._getDisplayText();}return "";};_pCellCheckbox._getCurrentStyleAlign=function(noflush){return this._cellobj._getCurrentStyleAlign(noflush);};nexacro._CellImageControl=function(id,left,top,width,height,parent){nexacro._ImageAreaControl.call(this,id,left,top,width,height,null,null,null,null,null,null,parent);this.tabstop=false;this.imagewidth=0;this.imageheight=0;this._view=parent._view;this._cellinfo=parent._refinfo;this._cellobj=parent;this._img_elem=null;this._img_type="url";this.accessibilityrole="image";};var _pCellImage=nexacro._createPrototype(nexacro._ImageAreaControl,nexacro._CellImageControl);nexacro._CellImageControl.prototype=_pCellImage;_pCellImage.on_destroy_contents=function(){nexacro._ImageAreaControl.prototype.on_destroy_contents.call(this);this._view=null;this._cellinfo=null;this._cellobj=null;};_pCellImage.on_apply_text=function(){this.set_image(this._getDisplayText());};_pCellImage.on_fire_onclick=function(button,alt_key,ctrl_key,shift_key,screenX,screenY,canvasX,canvasY,clientX,clientY,from_comp,from_refer_comp){return this.parent.on_fire_onclick(button,alt_key,ctrl_key,shift_key,screenX,screenY,canvasX,canvasY,clientX,clientY,from_comp,from_refer_comp,"cellimage");};_pCellImage.on_fire_user_ontouchstart=function(touchinfos,changedtouchinfos,from_comp,from_refer_comp){return this.parent.on_fire_user_ontouchstart(touchinfos,changedtouchinfos,this,from_refer_comp);};_pCellImage.on_fire_ondblclick=function(button,alt_key,ctrl_key,shift_key,screenX,screenY,canvasX,canvasY,clientX,clientY,from_comp,from_refer_comp){return this.parent.on_fire_ondblclick(button,alt_key,ctrl_key,shift_key,screenX,screenY,canvasX,canvasY,clientX,clientY,this,from_refer_comp,"cellimage");};_pCellImage.on_fire_onsize=function(width,height){if(this._complete){this.__apply_text();}return nexacro._ImageAreaControl.prototype.on_fire_onsize.call(this,width,height);};_pCellImage._isEnable=function(){if(this._view&&this._view._enable!==undefined){return this._view._enable;}if(this.parent&&this.parent._isEnable){return this.parent._isEnable();}return true;};_pCellImage._getDisplayText=function(){if(this.parent){return this.parent._getDisplayText();}return "";};_pCellImage._updateAll=function(onlycontents,breadonly){if(breadonly!==undefined){if(this.on_apply_readonly){this.on_apply_readonly(breadonly);}else{this._changeStatus("readonly",breadonly);}}if(!onlycontents){this._apply_status(this._oldstatus,this._status,this._olduserstatus,this._userstatus);}this._setProperty();};_pCellImage._setProperty=function(onlycontrolprop){var cellinfo=this._cellinfo;var cellobj=this._cellobj;var datarow=cellobj._getDataRow();if(!onlycontrolprop){this.on_apply_text();}cellinfo._setCellChildControlProperty("image",this,datarow);};_pCellImage._adjustAlign=function(halign,valign){if(!halign){halign="center";}if(!valign){valign="middle";}this.set_imagealign(halign+" "+valign);this._updateElementPositions();};_pCellImage._setAccessibilityStatFocus=function(){var cellobj=this._cellobj;this._control_element.setElementAccessibilityLabel(cellobj._getAccessibilityLabel());this._control_element.setElementAccessibilityAction(cellobj.accessibilityaction);this._control_element.setElementAccessibilityDescription(cellobj.accessibilitydescription);this._control_element.setElementAccessibilityParentLabel(cellobj._getAccessibilityMakeAddLabel().trim());nexacro.Component.prototype._setAccessibilityStatFocus.call(this);};_pCellImage.on_get_accessibility_description=function(){if(this._cellobj){var tooltiptext=this._cellobj.tooltiptext;return nexacro._isNull(tooltiptext)?"":tooltiptext;}return "";};_pCellImage.on_get_accessibility_label=function(){return this.text;};_pCellImage._getComputedStyle=function(){var ctrl_cs={"styles":null};return ctrl_cs;};_pCellImage._setComputedStyle=function(ctrl_cs){};_pCellImage._getCurrentStyleAlign=function(noflush){return this._cellobj._getCurrentStyleAlign(noflush);};nexacro._CellTreeControl=function(id,left,top,width,height,right,bottom,parent){nexacro.Component.call(this,id,left,top,width,height,right,bottom,null,null,null,null,parent);this.tabstop=false;this._view=parent._view;this._cellinfo=parent._refinfo;this._cellobj=parent;this._leftline_ctrls=[];this._btnimg_ctrl=null;this._chk_ctrl=null;this._img_ctrl=null;this._text_ctrl=null;this._displaytext="";this._upline_ctrl=null;this._downline_ctrl=null;this._clicktarget=null;this._checkboxObj="_CellCheckboxControlBase";};var _pCellTree=nexacro._createPrototype(nexacro.Component,nexacro._CellTreeControl);nexacro._CellTreeControl.prototype=_pCellTree;_pCellTree._is_subcontrol=true;_pCellTree._type_name="CellTreeItemControl";_pCellTree._apply_setfocus=function(evt_name){};_pCellTree.on_create_contents=function(){this._createLines(true);this._createCheckbox(true);this._createImage(true);this._createButton(true);this._createText(true);};_pCellTree._createLines=function(bCreateOnly){if(!this._view||!this._view.treeuseline){return;}if(!this._rightline_ctrl){this._rightline_ctrl=new nexacro._CellTreeLineControl("treerightline",0,0,0,0,null,null,this.parent);this._childctrl_setevent(this._rightline_ctrl);this._rightline_ctrl.createComponent(bCreateOnly);}if(!this._upline_ctrl){this._upline_ctrl=new nexacro._CellTreeLineControl("treeupline",0,0,0,0,null,null,this.parent);this._childctrl_setevent(this._upline_ctrl);this._upline_ctrl.createComponent(bCreateOnly);}if(!this._downline_ctrl){this._downline_ctrl=new nexacro._CellTreeLineControl("treedownline",0,0,0,0,null,null,this.parent);this._childctrl_setevent(this._downline_ctrl);this._downline_ctrl.createComponent(bCreateOnly);}};_pCellTree._createCheckbox=function(bCreateOnly){if(!this._view&&!this._view.treeusecheckbox){return;}if(!this._chk_ctrl){this._chk_ctrl=new nexacro[this._checkboxObj]("treeitemcheckbox",0,0,0,0,this);this._childctrl_setevent(this._chk_ctrl);this._chk_ctrl._getCheckValue=function(){var cellinfo=this._cellinfo;var cellobj=this._cellobj;var datarow=cellobj._getDataRow();if(cellinfo.treecheck._bindtype>0){return cellinfo._getAttrValue(cellinfo.treecheck,datarow);}else{return this._view._treeChecked[datarow];}};if(nexacro._enableaccessibility){this._chk_ctrl.accessibilityenable=false;}this._chk_ctrl.createComponent(bCreateOnly);}};_pCellTree._createImage=function(bCreateOnly){if(!this._view||!this._view.treeuseimage){return;}if(!this._img_ctrl){this._img_ctrl=new nexacro._TreeItemIconControl("treeitemimage",0,0,0,0,null,null,this);this._childctrl_setevent(this._img_ctrl);if(nexacro._enableaccessibility){this._img_ctrl.accessibilityenable=false;}this._img_ctrl.createComponent(bCreateOnly);}};_pCellTree._createButton=function(bCreateOnly){this._btnimg_ctrl=new nexacro._TreeItemIconControl("treeitembutton",0,0,0,0,null,null,this);this._childctrl_setevent(this._btnimg_ctrl);if(nexacro._enableaccessibility){this._btnimg_ctrl.accessibilityenable=false;}this._btnimg_ctrl.createComponent(bCreateOnly);};_pCellTree._createText=function(bCreateOnly){this._text_ctrl=new nexacro._TreeItemTextControl("treeitemtext",0,0,0,0,null,null,null,null,null,null,this);this._text_ctrl._setControl();this._childctrl_setevent(this._text_ctrl);this._text_ctrl.createComponent(bCreateOnly);};_pCellTree._childctrl_setevent=function(obj){obj.on_fire_onclick=function(button,alt_key,ctrl_key,shift_key,screenX,screenY,canvasX,canvasY,clientX,clientY,from_comp,from_refer_comp){var clickitem=this.id;if(clickitem=="treeitemtext"||clickitem=="treeitemimage"){clickitem="";}return this.parent.on_fire_onclick(button,alt_key,ctrl_key,shift_key,screenX,screenY,canvasX,canvasY,clientX,clientY,from_comp,from_refer_comp,clickitem);};obj.on_fire_ondblclick=function(button,alt_key,ctrl_key,shift_key,screenX,screenY,canvasX,canvasY,clientX,clientY,from_comp,from_refer_comp){var clickitem=this.id;if(clickitem=="treeitemtext"||clickitem=="treeitemimage"){clickitem="";}return this.parent.on_fire_ondblclick(button,alt_key,ctrl_key,shift_key,screenX,screenY,canvasX,canvasY,clientX,clientY,from_comp,from_refer_comp,clickitem);};obj._on_last_lbuttonup=function(){return this.parent._on_last_lbuttonup();};};_pCellTree.on_created_contents=function(win){var leftlines=this._leftline_ctrls;for(var i=0,n=leftlines.length;i<n;i++ ){leftlines[i].on_created(win);}if(this._rightline_ctrl){this._rightline_ctrl.on_created(win);}if(this._upline_ctrl){this._upline_ctrl.on_created(win);}if(this._downline_ctrl){this._downline_ctrl.on_created(win);}if(this._btnimg_ctrl){this._btnimg_ctrl.on_created(win);}if(this._chk_ctrl){this._chk_ctrl.on_created(win);}if(this._img_ctrl){this._img_ctrl.on_created(win);}if(this._text_ctrl){this._text_ctrl.on_created(win);}this._is_created=true;};_pCellTree.on_attach_contents_handle=_pCellTree.on_created_contents;_pCellTree.on_destroy_contents=function(){var leftlines=this._leftline_ctrls;for(var i=0,n=leftlines.length;i<n;i++ ){leftlines[i].destroy();}this._leftline_ctrls=null;if(this._rightline_ctrl){this._rightline_ctrl.destroy();this._rightline_ctrl=null;}if(this._upline_ctrl){this._upline_ctrl.destroy();this._upline_ctrl=null;}if(this._downline_ctrl){this._downline_ctrl.destroy();this._downline_ctrl=null;}if(this._btnimg_ctrl){this._btnimg_ctrl.destroy();this._btnimg_ctrl=null;}if(this._chk_ctrl){this._chk_ctrl.destroy();this._chk_ctrl=null;}if(this._img_ctrl){this._img_ctrl.destroy();this._img_ctrl=null;}if(this._text_ctrl){this._text_ctrl.destroy();this._text_ctrl=null;}this._clicktarget=null;this._view=null;this._cellinfo=null;this._cellobj=null;};_pCellTree.on_apply_text=function(){var text_ctrl=this._text_ctrl;if(text_ctrl){text_ctrl.set_text(this._displaytext);}};_pCellTree.on_fire_ondblclick=function(button,alt_key,ctrl_key,shift_key,screenX,screenY,canvasX,canvasY,clientX,clientY,from_comp,from_refer_comp,clickitem){return this._cellobj.on_fire_ondblclick(button,alt_key,ctrl_key,shift_key,screenX,screenY,canvasX,canvasY,clientX,clientY,from_comp,from_refer_comp,clickitem);};_pCellTree.on_fire_onclick=function(button,alt_key,ctrl_key,shift_key,screenX,screenY,canvasX,canvasY,clientX,clientY,from_comp,from_refer_comp,clickitem){return this._cellobj.on_fire_onclick(button,alt_key,ctrl_key,shift_key,screenX,screenY,canvasX,canvasY,clientX,clientY,from_comp,from_refer_comp,clickitem);};_pCellTree._isEditTypeTree=function(){var cellobj=this._cellobj;var cellinfo=this._cellinfo;var datarow=cellobj._getDataRow();var editType=cellinfo._getEdittype(datarow);return (editType=="tree");};_pCellTree._getLineHeight=function(){var height=this.parent._adjust_height;var border=this.parent._getCurrentStyleBorder();var bordbottom=(border)?border.bottom._width:0;return height-bordbottom;};_pCellTree._isEnable=function(){if(this._view&&this._view._enable!==undefined){return this._view._enable;}if(this.parent&&this.parent._isEnable){return this.parent._isEnable();}return true;};_pCellTree._load_image=function(img_ctrl,image){var val=(image)?image.toString():null;if(this._control_element&&val){if(val!="none"){val=nexacro._getURIValue(val);val=nexacro._getImageLocation(val,this._getRefFormBaseUrl());img_ctrl._load_url=val;var size=nexacro._getImageSize(val,this._on_loadImage,this,this._getRefFormBaseUrl(),image.value);if(size){this._on_loadImage(val,size.width,size.height);}}}};_pCellTree._on_loadImage=function(url,imgW,imgH){var adjust=false;var width,height;if(this._btnimg_ctrl&&this._btnimg_ctrl._load_url==url){width=this._btnimg_ctrl._adjust_width;height=this._btnimg_ctrl._adjust_height;if(width!=imgW||height!=imgH){adjust=true;this._btnimg_ctrl.move(this._btnimg_ctrl._adjust_left,this._btnimg_ctrl._adjust_top,imgW,imgH);}}if(this._img_ctrl&&this._img_ctrl._load_url==url){width=this._img_ctrl._adjust_width;height=this._img_ctrl._adjust_height;if(width!=imgW||height!=imgH){adjust=true;this._img_ctrl.move(this._img_ctrl._adjust_left,this._img_ctrl._adjust_top,imgW,imgH);}}if(adjust){this._adjustSubCompAlign(this._lvl);}};_pCellTree._changeTreeStatus=function(changestatus,value){this._userstatus=changestatus;if(this._img_ctrl){this._img_ctrl._changeUserStatus(changestatus,value);}if(changestatus!="leaf"&&this._btnimg_ctrl){this._btnimg_ctrl._changeUserStatus(changestatus,value);}};_pCellTree._buttonUpdate=function(state){var view=this._view;if(view&&view.treeusebutton!=this._treeusebutton){if(view.treeusebutton=="use"){this._btnimg_ctrl.set_visible(true);}else{this._btnimg_ctrl.set_visible(false);}this._treeusebutton=view.treeusebutton;}var val;if(state==2||state==3||state== -1){val=this._btnimg_ctrl._getCSSStyleValue("icon","expand");this._load_image(this._btnimg_ctrl,val);this._btnimg_ctrl.set_visible(false);this._btnimg_ctrl._tmpw=this._btnimg_ctrl.width;this._btnimg_ctrl._tmph=this._btnimg_ctrl.height;this._btnimg_ctrl.move(this._btnimg_ctrl._adjust_left,this._btnimg_ctrl._adjust_top,0,0);}else{val=this._btnimg_ctrl._getCSSStyleValue("icon",this._userstatus);this._load_image(this._btnimg_ctrl,val);}};_pCellTree._checkUpdate=function(check){var view=this._view;if(view&&view.treeusecheckbox!=this._treeusecheckbox){if(this._chk_ctrl){this._chk_ctrl.set_visible(view.treeusecheckbox);}else{this._createCheckbox();}this._treeusecheckbox=view.treeusecheckbox;}if(view){this._chk_ctrl._changeStatus("readonly",view.readonly);}if(this._chk_ctrl){this._chk_ctrl.set_value(check);this._chk_ctrl._adjustAlign();}};_pCellTree._imageUpdate=function(state){var view=this._view;if(view&&view.treeuseimage!=this._treeuseimage){if(this._img_ctrl){this._img_ctrl.set_visible(view.treeuseimage);}else{this._createImage();}this._treeuseimage=view.treeuseimage;}if(this._img_ctrl){var val=this._img_ctrl._getCSSStyleValue("icon",this._userstatus);this._load_image(this._img_ctrl,val);if(val&&val!="none"){this._img_ctrl.set_visible(view?view.treeuseimage:true);}else{this._img_ctrl.set_visible(false);}}this._adjustSubCompAlign(this._lvl);};_pCellTree._lineUpdate=function(rowidx,level){var view=this._view;if(view&&view.treeuseline!=this._treeuseline){this._createLines();if(this._rightline_ctrl){this._rightline_ctrl.set_visible(view.treeuseline);}if(this._upline_ctrl){this._upline_ctrl.set_visible(view.treeuseline);}if(this._downline_ctrl){this._downline_ctrl.set_visible(view.treeuseline);}this._treeuseline=view.treeuseline;}var startlevel=this._cellinfo._getTreeStartLevel(rowidx);var bExistNextNode=(view&&view._hasSameNextNode[rowidx])?view._hasSameNextNode[rowidx][1]:false;var bRootNode=(startlevel>=level)?true:false;this._createLeftLine(rowidx);var ctrl;if(this._rightline_ctrl){ctrl=this._rightline_ctrl;ctrl._set_line(false,true);}if(this._upline_ctrl){ctrl=this._upline_ctrl;ctrl._set_line(!bRootNode,false);}if(this._downline_ctrl&&!bRootNode&&bExistNextNode){ctrl=this._downline_ctrl;ctrl._set_line(true,false);}else if(this._downline_ctrl){this._downline_ctrl.set_visible(false);}this._treeline_visible(!this._cellobj._hideInner);};_pCellTree._createLeftLine=function(rowidx){var view=this._view;var i;if(!view||!view.treeuseline){var n=this._leftline_ctrls.length;for(i=0;i<n;i++ ){this._leftline_ctrls[i].destroy();}this._leftline_ctrls=[];return;}var level=this._cellinfo._getTreeLevel(rowidx);var parentlevel=level-1;var bExistNextParentNode;i=0;var leftlines=this._leftline_ctrls;while(view._rootlevel<parentlevel){bExistNextParentNode=this.__isNextSameLevelInSameParent(parentlevel,rowidx);if(bExistNextParentNode){var parentheight=this._getLineHeight();var ctrl=leftlines[i];if(!ctrl){ctrl=new nexacro._CellTreeLineControl("treeleftline",0,0,1,parentheight,null,null,this.parent);ctrl.createComponent();this._leftline_ctrls[i]=ctrl;}else{ctrl.set_height(parentheight);}ctrl._set_line(true,false);ctrl._depth=parentlevel;i++ ;}parentlevel-- ;}while(leftlines.length>i){leftlines[leftlines.length-1].destroy();leftlines.splice(leftlines.length-1,1);}};_pCellTree._toggleItem=function(bHide,state){var view=this._view;if(!view||bHide){if(this._btnimg_ctrl){this._btnimg_ctrl.set_visible(false);}if(this._rightline_ctrl){this._rightline_ctrl.set_visible(false);}if(this._upline_ctrl){this._upline_ctrl.set_visible(false);}if(this._downline_ctrl){this._downline_ctrl.set_visible(false);}if(this._chk_ctrl){this._chk_ctrl.set_visible(false);}if(this._img_ctrl){this._img_ctrl.set_visible(false);}if(this._text_ctrl){this._text_ctrl.set_visible(false);}}else{if(view.treeusebutton=="use"){this._btnimg_ctrl.set_visible(true);}else{this._btnimg_ctrl.set_visible(false);}if(state==2||state==3||state== -1){this._btnimg_ctrl.set_visible(false);this._btnimg_ctrl.move(this._btnimg_ctrl._adjust_left,this._btnimg_ctrl._adjust_top,0,0);}if(this._rightline_ctrl){this._rightline_ctrl.set_visible(view.treeuseline);}if(this._upline_ctrl){this._upline_ctrl.set_visible(view.treeuseline);}if(this._downline_ctrl){this._downline_ctrl.set_visible(view.treeuseline);}if(this._chk_ctrl){this._chk_ctrl.set_visible(view.treeusecheckbox);}if(this._img_ctrl){this._img_ctrl.set_visible(view.treeuseimage);}if(this._text_ctrl){this._text_ctrl.set_visible(true);}}};_pCellTree.on_apply_prop_tooltip=function(){var datarow=this._cellobj._getDataRow();this.tooltiptext=this._cellinfo._getTooltipText(datarow);this.tooltiptype=this._cellinfo.tooltiptype;nexacro.Component.prototype.on_apply_prop_tooltip.call(this);};_pCellTree._treeline_visible=function(v){var i;var n=this._leftline_ctrls.length;if(v){for(i=0;i<n;i++ ){this._leftline_ctrls[i]._control_element.setElementVisible(this._leftline_ctrls[i].visible);}if(this._rightline_ctrl){this._rightline_ctrl._control_element.setElementVisible(this._rightline_ctrl.visible);}if(this._upline_ctrl){this._upline_ctrl._control_element.setElementVisible(this._upline_ctrl.visible);}if(this._downline_ctrl){this._downline_ctrl._control_element.setElementVisible(this._downline_ctrl.visible);}}else{for(i=0;i<n;i++ ){this._leftline_ctrls[i]._control_element.setElementVisible(false);}if(this._rightline_ctrl){this._rightline_ctrl._control_element.setElementVisible(false);}if(this._upline_ctrl){this._upline_ctrl._control_element.setElementVisible(false);}if(this._downline_ctrl){this._downline_ctrl._control_element.setElementVisible(false);}}};_pCellTree.on_apply_prop_cssclass=function(){if(this._chk_ctrl){this._chk_ctrl.on_apply_cssclass();}if(this._img_ctrl){this._img_ctrl.on_apply_cssclass();}if(this._text_ctrl){this._text_ctrl.on_apply_cssclass();}if(this._btnimg_ctrl){this._btnimg_ctrl.on_apply_cssclass();}};_pCellTree.on_apply_prop_enable=function(v){if(this._chk_ctrl){this._chk_ctrl._apply_status(this._oldstatus,this._status,this._olduserstatus,this._userstatus);}if(this._img_ctrl){this._img_ctrl._apply_status(this._oldstatus,this._status,this._olduserstatus,this._userstatus);}if(this._text_ctrl){this._text_ctrl._apply_status(this._oldstatus,this._status,this._olduserstatus,this._userstatus);}if(this._btnimg_ctrl){this._btnimg_ctrl._apply_status(this._oldstatus,this._status,this._olduserstatus,this._userstatus);}};_pCellTree.on_apply_prop_rtl=function(){nexacro.Component.prototype.on_apply_prop_rtl.call(this);if(this._chk_ctrl){this._chk_ctrl.set_rtl(this.rtl);}if(this._img_ctrl){this._img_ctrl.set_rtl(this.rtl);}if(this._text_ctrl){this._text_ctrl.set_rtl(this.rtl);}if(this._btnimg_ctrl){this._btnimg_ctrl.set_rtl(this.rtl);}};_pCellTree._updateAll=function(onlycontents,breadonly){if(this._control_element){if(breadonly!==undefined){if(this.on_apply_readonly){this.on_apply_readonly(breadonly);}else{this._changeStatus("readonly",breadonly);}}var view=this._view;var cellobj=this._cellobj;var rowidx=cellobj._getDataRow();var stats=1;var check=0;var level=0;if(view&&!cellobj._isFakeCell()){stats=view._getTreeStats(rowidx);check=view._getTreeCheck(rowidx);level=view._getTreeLevel?view._getTreeLevel(rowidx):this._cellinfo._getTreeLevel(rowidx);}if(rowidx==null||rowidx== -9){this._toggleItem(true,stats);return;}else{this._toggleItem(false,stats);}if(!onlycontents){this._apply_status(cellobj._oldstatus,cellobj._status,cellobj._olduserstatus,cellobj._userstatus);}this._lvl=level;if(stats==0){this._changeTreeStatus("collapse",true);}else if(stats==1){this._changeTreeStatus("expand",true);}else if(stats>=2){this._changeTreeStatus("leaf",true);}this._buttonUpdate(stats);this._lineUpdate(rowidx,level);this._checkUpdate(check);this._imageUpdate(stats);var txt=this.parent._getDisplayText();if(this._displaytext!=txt){this._text_ctrl.set_text(txt);this._displaytext=txt;}this.on_apply_prop_tooltip();this._adjustSubCompAlign(level);}};_pCellTree._getCurrentStyleAlign=function(noflush){var align={textAlign:"center",verticalAlign:"middle"};if(this._text_ctrl&&this._text_ctrl._cell_elem){align=this._text_ctrl._cell_elem._getComputedStyleAlign(noflush);}return align;};_pCellTree._adjustSubCompAlign=function(level){var cellobj=this.parent;var cellinfo=this._cellinfo;var rect=cellobj._getControlRect();var width=rect.width;var height=rect.height;var datarow=cellobj._getDataRow();var start=cellinfo._getTreeStartLevel(datarow);var defaultsize=9;var gap=16;var parentlevel=level-1;level-=start;if(level<0){level=0;}var line_adjust_top=cellobj._adjust_top;var padding=cellobj._getCurrentStylePadding();var line_adjust_left=((padding)?padding.left:0);var parentheight=this._getLineHeight();var offset=(level*gap)+defaultsize;var lineleft=offset;var linetop=line_adjust_top;var linewidth=0;var halfheight=(parentheight/2);var lineheight=halfheight;var left_lines=this._leftline_ctrls;var left_lines_len=left_lines.length;var j=0;var elem;for(var i=0;j<left_lines_len;i++ ){if(parentlevel==left_lines[j]._depth){elem=left_lines[j++ ]._control_element;elem.setElementPosition(offset-(gap*(i+1))+line_adjust_left,linetop);}if(parentlevel-- <0){break;}}var line_button_gap_width=0;var line_button_gap_height=0;if(this._btnimg_ctrl){var buttonWidth=this._btnimg_ctrl.width;if(buttonWidth<=0&&this._btnimg_ctrl._tmpw){buttonWidth=this._btnimg_ctrl._tmpw;}var buttonHeight=this._btnimg_ctrl.height;if(buttonHeight<=0&&this._btnimg_ctrl._tmph){buttonHeight=this._btnimg_ctrl._tmph;}var buttonLeft=offset-(buttonWidth/2);if(buttonLeft<0){buttonLeft=offset-(defaultsize/2);}if(!this._rightline_ctrl||!this._rightline_ctrl.visible){buttonLeft-=((buttonWidth/2)*level);}var buttonTop=((height-buttonHeight)/2);if(this._btnimg_ctrl.visible){lineheight=((parentheight-buttonHeight)/2);line_button_gap_width=buttonWidth;line_button_gap_height=buttonHeight;offset=buttonLeft+buttonWidth;}else{if(!this._view.treeuseline){offset=buttonLeft+buttonWidth;}}linewidth=buttonWidth;this._btnimg_ctrl.move(buttonLeft,buttonTop,buttonWidth,buttonHeight);}else{linewidth=defaultsize;}if(this._rightline_ctrl&&this._rightline_ctrl.visible){this._rightline_ctrl.move(offset+line_adjust_left,linetop,linewidth-(line_button_gap_width/2),halfheight);offset=this._rightline_ctrl.left+this._rightline_ctrl.width-line_adjust_left;}else{offset+=1;}if(this._upline_ctrl&&this._upline_ctrl.visible){this._upline_ctrl.move(lineleft+line_adjust_left,linetop,linewidth,lineheight);}if(this._downline_ctrl&&this._downline_ctrl.visible){linetop=line_adjust_top+lineheight+line_button_gap_height;var b=lineheight+linetop;var pb=parentheight+line_adjust_top;if(b>pb){lineheight=pb-linetop;}this._downline_ctrl.move(lineleft+line_adjust_left,linetop,linewidth,lineheight);}if(this._chk_ctrl&&this._chk_ctrl.visible){var checkWidth=this._chk_ctrl.width;var checkHeight=this._chk_ctrl.height;var checkLeft=offset;var checkTop=((height-checkHeight)/2);offset+=checkWidth;this._chk_ctrl.move(checkLeft,checkTop,checkWidth,checkHeight);}if(this._img_ctrl&&this._img_ctrl.visible){offset+=1;var imageWidth=this._img_ctrl._adjust_width;var imageHeight=this._img_ctrl._adjust_height;var imageLeft=null;var imageTop=null;if(imageWidth>0&&imageHeight>0){imageLeft=offset;imageTop=((height-imageHeight)/2);offset+=imageWidth;}else{}this._img_ctrl.move(imageLeft,imageTop,imageWidth,imageHeight);offset+=5;}else{offset+=4;}if(this._text_ctrl){this._text_ctrl.move(offset,0,width-offset,height);}};_pCellTree._setAlign=function(halign,valign){if(halign){this._text_ctrl.set_textAlign(halign);}if(valign){this._text_ctrl.set_verticalAlign(valign);}};if(nexacro._Browser=="Runtime"){_pCellTree.on_change_containerRect=function(width,height){if(this._lvl||this._isRtl()){this._adjustSubCompAlign(this._lvl);}};}else{_pCellTree.on_change_containerRect=function(width,height){if(this._lvl){this._adjustSubCompAlign(this._lvl);}};}_pCellTree._setAccessibilityStatFocus=function(evt_name){var cellobj=this._cellobj;var label=cellobj._getCellAccessibilityLabel();label=label.trim();this._setAccessibilityLabel(label);var datarow=cellobj._getDataRow();var level=this._cellinfo._getTreeLevel(datarow);var startlevel=this._cellinfo._getTreeStartLevel(datarow);if(cellobj._getTreeStatus()==0){if(this._text_ctrl){this._text_ctrl._setAccessibilityStatExpanded(false);}}else{if(this._text_ctrl){this._text_ctrl._setAccessibilityStatExpanded(true);}}this._setAccessibilityInfoLevel(level-startlevel+1);nexacro.Component.prototype._setAccessibilityStatFocus.call(this,evt_name);};_pCellTree.on_get_accessibility_description=function(){if(this._cellobj){var tooltiptext=this._cellobj.tooltiptext;return nexacro._isNull(tooltiptext)?"":tooltiptext;}return "";};_pCellTree._getComputedStyle=function(){var ctrl_cs={"styles":null};return ctrl_cs;};_pCellTree._setComputedStyle=function(ctrl_cs){};nexacro._TreeItemIconControl=function(id,left,top,width,height,right,bottom,parent){nexacro._Icon.call(this,id,left,top,width,height,right,bottom,null,null,null,null,parent);};var _pTreeItemIcon=nexacro._createPrototype(nexacro._Icon,nexacro._TreeItemIconControl);nexacro._TreeItemIconControl.prototype=_pTreeItemIcon;_pTreeItemIcon._is_subcontrol=true;_pTreeItemIcon._type_name="TreeItemIconControl";_pTreeItemIcon.on_changeUserStatus=function(changestatus,value,applyuserstatus,currentstatus,currentuserstatus){return changestatus;};nexacro._TreeItemTextControl=function(id,left,top,width,height,right,bottom,minwidth,maxwidth,minheight,maxheight,parent){nexacro.Static.call(this,id,left,top,width,height,right,bottom,null,null,null,null,parent);};var _pTreeItemTextControl=nexacro._createPrototype(nexacro.Static,nexacro._TreeItemTextControl);nexacro._TreeItemTextControl.prototype=_pTreeItemTextControl;nexacro._CellTreeLineControl=function(id,left,top,width,height,right,bottom,parent){nexacro.Component.call(this,id,left,top,width,height,right,bottom,null,null,null,null,parent);this.tabstop=false;this._is_simple_control=true;this._is_nc_control=true;this._view=parent._view;this._depth= -1;this._showleft=false;this._showbottom=false;};var _pCellTreeLine=nexacro._createPrototype(nexacro.Component,nexacro._CellTreeLineControl);nexacro._CellTreeLineControl.prototype=_pCellTreeLine;_pCellTreeLine._is_subcontrol=true;_pCellTreeLine._type_name="CellTreeLineControl";_pCellTreeLine.on_destroy_contents=function(){this._view=null;};_pCellTreeLine._isEnable=function(){if(this._view&&this._view._enable!==undefined){return this._view._enable;}if(this.parent&&this.parent._isEnable){return this.parent._isEnable();}return true;};_pCellTreeLine._set_line=function(left,bottom){var control_elem=this._control_element;if(control_elem){this._showleft=left;this._showbottom=bottom;this._apply_status(this._oldstatus,this._status,this._olduserstatus,this._userstatus);}};_pCellTreeLine._on_apply_status=function(oldstatus,status,olduserstatus,userstatus,apply,is_userstatus,status_param,value_param,applycssstatus,applycssuserstatus){nexacro.Component.prototype._on_apply_status.call(this,oldstatus,status,olduserstatus,userstatus,apply,is_userstatus,status_param,value_param,applycssstatus,applycssuserstatus);var remove_l=false,remove_t=false,remove_r=false,remove_b=false;if(this.id=="treerightline"){remove_l=true;remove_r=true;remove_t=true;}else if(this.id=="treeleftline"||this.id=="treeupline"||"treedownline"){remove_r=true;remove_t=true;remove_b=true;}if(!this._showbottom){remove_b=true;}if(!this._showleft){remove_l=true;}this._control_element.setElementBorderNone(remove_l,remove_t,remove_r,remove_b);};_pCellTreeLine.on_getIDCSSSelector=function(){return "celltreeline";};delete _pCellControl;delete _pSubCellControl;delete _pCellExpand;delete _pCellButton;delete _pCellBar;delete _pCellEdit;delete _pCellTextArea;delete _pCellMaskEdit;delete _pCellCalendar;delete _pCellCombo;delete _pCellCheckboxBase;delete _pCellCheckbox;delete _pCellImage;delete _pCellTree;delete _pTreeItemIcon;delete _pTreeItemTextControl;delete _pCellTreeLine;}
